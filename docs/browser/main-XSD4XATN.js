import{a as et,b as wn,c as x1,d as YP,e as Sh,f as on}from"./chunk-EQDQRRRY.js";var id=YP((zx,Bx)=>{"use strict";(function(t,r){typeof zx=="object"&&typeof Bx<"u"?Bx.exports=r():typeof define=="function"&&define.amd?define(r):(t=typeof globalThis<"u"?globalThis:t||self,t.maplibregl=r())})(zx,function(){"use strict";var t={},r={};function i(u,s,x){if(r[u]=x,u==="index"){var M="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(t,S),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([M],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){"use strict";function s(l,n,a,d){return new(a||(a=Promise))(function(p,y){function _(I){try{C(d.next(I))}catch(D){y(D)}}function b(I){try{C(d.throw(I))}catch(D){y(D)}}function C(I){var D;I.done?p(I.value):(D=I.value,D instanceof a?D:new a(function(P){P(D)})).then(_,b)}C((d=d.apply(l,n||[])).next())})}function x(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var M,S;function B(){if(S)return M;function l(n,a){this.x=n,this.y=a}return S=1,M=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,d=n.y-this.y;return a*a+d*d},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),d=Math.sin(n),p=d*this.x+a*this.y;return this.x=a*this.x-d*this.y,this.y=p,this},_rotateAround:function(n,a){var d=Math.cos(n),p=Math.sin(n),y=a.y+p*(this.x-a.x)+d*(this.y-a.y);return this.x=a.x+d*(this.x-a.x)-p*(this.y-a.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(n){return n instanceof l?n:Array.isArray(n)?new l(n[0],n[1]):n},M}typeof SuppressedError=="function"&&SuppressedError;var W,$,he=x(B()),ge=function(){if($)return W;function l(n,a,d,p){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=d,this.p2y=p}return $=1,W=l,l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,p=0;p<8;p++){var y=this.sampleCurveX(d)-n;if(Math.abs(y)<a)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var b=0,C=1;for(d=n,p=0;p<20&&(y=this.sampleCurveX(d),!(Math.abs(y-n)<a));p++)n>y?b=d:C=d,d=.5*(C-b)+b;return d},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},W}(),ze=x(ge);let qe,Ye;function lt(){return qe==null&&(qe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),qe}function gt(){if(Ye==null&&(Ye=!1,lt())){let n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let d=0;d<5*5;d++){let p=4*d;n.fillStyle=`rgb(${p},${p+1},${p+2})`,n.fillRect(d%5,Math.floor(d/5),1,1)}let a=n.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&a[d]!==d){Ye=!0;break}}}return Ye||!1}var ft,_t=1e-6,dt=typeof Float32Array<"u"?Float32Array:Array;function Vt(){var l=new dt(9);return dt!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function ki(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function $s(){var l=new dt(3);return dt!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function bo(l,n,a){var d=new dt(3);return d[0]=l,d[1]=n,d[2]=a,d}function Wi(l,n,a){var d=n[0],p=n[1],y=n[2],_=n[3];return l[0]=a[0]*d+a[4]*p+a[8]*y+a[12]*_,l[1]=a[1]*d+a[5]*p+a[9]*y+a[13]*_,l[2]=a[2]*d+a[6]*p+a[10]*y+a[14]*_,l[3]=a[3]*d+a[7]*p+a[11]*y+a[15]*_,l}function qr(){var l=new dt(4);return dt!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function dr(){var l=new dt(2);return dt!=Float32Array&&(l[0]=0,l[1]=0),l}function Ga(l,n){var a=new dt(2);return a[0]=l,a[1]=n,a}Math.hypot||(Math.hypot=function(){for(var l=0,n=arguments.length;n--;)l+=arguments[n]*arguments[n];return Math.sqrt(l)}),$s(),ft=new dt(4),dt!=Float32Array&&(ft[0]=0,ft[1]=0,ft[2]=0,ft[3]=0),$s(),bo(1,0,0),bo(0,1,0),qr(),qr(),Vt(),dr();let Zt=8192;function Hs(l,n,a){return n*(Zt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}function xo(l,n){return(l%n+n)%n}function Xo(l,n,a){return l*(1-a)+n*a}function Yo(l){if(l<=0)return 0;if(l>=1)return 1;let n=l*l,a=n*l;return 4*(l<.5?a:3*(l-n)+a-.75)}function Gs(l,n,a,d){let p=new ze(l,n,a,d);return y=>p.solve(y)}let Oi=Gs(.25,.1,.25,1);function fi(l,n,a){return Math.min(a,Math.max(n,l))}function Zr(l,n,a){let d=a-n,p=((l-n)%d+d)%d+n;return p===n?a:p}function nr(l,...n){for(let a of n)for(let d in a)l[d]=a[d];return l}let Ko=1;function Qo(l,n,a){let d={};for(let p in l)d[p]=n.call(this,l[p],p,l);return d}function Jo(l,n,a){let d={};for(let p in l)n.call(this,l[p],p,l)&&(d[p]=l[p]);return d}function kr(l){return Array.isArray(l)?l.map(kr):typeof l=="object"&&l?Qo(l,kr):l}let qa={};function hr(l){qa[l]||(typeof console<"u"&&console.warn(l),qa[l]=!0)}function jn(l,n,a){return(a.y-l.y)*(n.x-l.x)>(n.y-l.y)*(a.x-l.x)}function Xi(l){return typeof WorkerGlobalScope<"u"&&l!==void 0&&l instanceof WorkerGlobalScope}let Dn=null;function es(l){return typeof ImageBitmap<"u"&&l instanceof ImageBitmap}let ts="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function pi(l,n,a,d,p){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");let y=new VideoFrame(l,{timestamp:0});try{let _=y?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);let b=_.startsWith("BGR"),C=new Uint8ClampedArray(d*p*4);if(yield y.copyTo(C,function(I,D,P,k,L){let F=4*Math.max(1,0),j=(Math.max(0,P)-P)*k*4+F,Z=4*k,J=Math.max(0,D),ue=Math.max(0,P);return{rect:{x:J,y:ue,width:Math.min(I.width,D+k)-J,height:Math.min(I.height,P+L)-ue},layout:[{offset:j,stride:Z}]}}(l,n,a,d,p)),b)for(let I=0;I<C.length;I+=4){let D=C[I];C[I]=C[I+2],C[I+2]=D}return C}finally{y.close()}})}let wo,Co;function Or(l){return l/Math.PI*180}let ns="AbortError";function rs(){return new Error(ns)}let Eo={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Za(l){return Eo.REGISTERED_PROTOCOLS[l.substring(0,l.indexOf("://"))]}let is="global-dispatcher";class Yi extends Error{constructor(n,a,d,p){super(`AJAXError: ${a} (${n}): ${d}`),this.status=n,this.statusText=a,this.url=d,this.body=p}}let os=()=>Xi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ki=function(l,n){if(/:\/\//.test(l.url)&&!/^https?:|^file:/.test(l.url)){let d=Za(l.url);if(d)return d(l,n);if(Xi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,targetMapId:is},n)}if(!(/^file:/.test(a=l.url)||/^file:/.test(os())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,p){return s(this,void 0,void 0,function*(){let y=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:os(),signal:p.signal}),_,b;d.type!=="json"||y.headers.has("Accept")||y.headers.set("Accept","application/json");try{_=yield fetch(y)}catch(I){throw new Yi(0,I.message,d.url,new Blob)}if(!_.ok){let I=yield _.blob();throw new Yi(_.status,_.statusText,d.url,I)}b=d.type==="arrayBuffer"||d.type==="image"?_.arrayBuffer():d.type==="json"?_.json():_.text();let C=yield b;if(p.signal.aborted)throw rs();return{data:C,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(l,n);if(Xi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:l,mustQueue:!0,targetMapId:is},n)}var a;return function(d,p){return new Promise((y,_)=>{var b;let C=new XMLHttpRequest;C.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(C.responseType="arraybuffer");for(let I in d.headers)C.setRequestHeader(I,d.headers[I]);d.type==="json"&&(C.responseType="text",!((b=d.headers)===null||b===void 0)&&b.Accept||C.setRequestHeader("Accept","application/json")),C.withCredentials=d.credentials==="include",C.onerror=()=>{_(new Error(C.statusText))},C.onload=()=>{if(!p.signal.aborted)if((C.status>=200&&C.status<300||C.status===0)&&C.response!==null){let I=C.response;if(d.type==="json")try{I=JSON.parse(C.response)}catch(D){return void _(D)}y({data:I,cacheControl:C.getResponseHeader("Cache-Control"),expires:C.getResponseHeader("Expires")})}else{let I=new Blob([C.response],{type:C.getResponseHeader("Content-Type")});_(new Yi(C.status,C.statusText,d.url,I))}},p.signal.addEventListener("abort",()=>{C.abort(),_(rs())}),C.send(d.body)})}(l,n)};function ss(l){if(!l||l.indexOf("://")<=0||l.indexOf("data:image/")===0||l.indexOf("blob:")===0)return!0;let n=new URL(l),a=window.location;return n.protocol===a.protocol&&n.host===a.host}function Io(l,n,a){a[l]&&a[l].indexOf(n)!==-1||(a[l]=a[l]||[],a[l].push(n))}function qs(l,n,a){if(a&&a[l]){let d=a[l].indexOf(n);d!==-1&&a[l].splice(d,1)}}class Zs{constructor(n,a={}){nr(this,a),this.type=n}}class Wa extends Zs{constructor(n,a={}){super("error",nr({error:n},a))}}class To{on(n,a){return this._listeners=this._listeners||{},Io(n,a,this._listeners),{unsubscribe:()=>{this.off(n,a)}}}off(n,a){return qs(n,a,this._listeners),qs(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Io(n,a,this._oneTimeListeners),this):new Promise(d=>this.once(n,d))}fire(n,a){typeof n=="string"&&(n=new Zs(n,a||{}));let d=n.type;if(this.listens(d)){n.target=this;let p=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(let b of p)b.call(this,n);let y=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(let b of y)qs(d,b,this._oneTimeListeners),b.call(this,n);let _=this._eventedParent;_&&(nr(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof Wa&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var X={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};let V=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function H(l,n){let a={};for(let d in l)d!=="ref"&&(a[d]=l[d]);return V.forEach(d=>{d in n&&(a[d]=n[d])}),a}function G(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let a=0;a<l.length;a++)if(!G(l[a],n[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&n!==null){if(typeof n!="object"||Object.keys(l).length!==Object.keys(n).length)return!1;for(let a in l)if(!G(l[a],n[a]))return!1;return!0}return l===n}function te(l,n){l.push(n)}function ae(l,n,a){te(a,{command:"addSource",args:[l,n[l]]})}function pe(l,n,a){te(n,{command:"removeSource",args:[l]}),a[l]=!0}function be(l,n,a,d){pe(l,a,d),ae(l,n,a)}function fe(l,n,a){let d;for(d in l[a])if(Object.prototype.hasOwnProperty.call(l[a],d)&&d!=="data"&&!G(l[a][d],n[a][d]))return!1;for(d in n[a])if(Object.prototype.hasOwnProperty.call(n[a],d)&&d!=="data"&&!G(l[a][d],n[a][d]))return!1;return!0}function Te(l,n,a,d,p,y){l=l||{},n=n||{};for(let _ in l)Object.prototype.hasOwnProperty.call(l,_)&&(G(l[_],n[_])||a.push({command:y,args:[d,_,n[_],p]}));for(let _ in n)Object.prototype.hasOwnProperty.call(n,_)&&!Object.prototype.hasOwnProperty.call(l,_)&&(G(l[_],n[_])||a.push({command:y,args:[d,_,n[_],p]}))}function Ce(l){return l.id}function me(l,n){return l[n.id]=n,l}class de{constructor(n,a,d,p){this.message=(n?`${n}: `:"")+d,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)}}function $e(l,...n){for(let a of n)for(let d in a)l[d]=a[d];return l}class Ve extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class at{constructor(n,a=[]){this.parent=n,this.bindings={};for(let[d,p]of a)this.bindings[d]=p}concat(n){return new at(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}let pt={kind:"null"},Ae={kind:"number"},He={kind:"string"},Qe={kind:"boolean"},Et={kind:"color"},Ft={kind:"projectionDefinition"},ut={kind:"object"},Xe={kind:"value"},Cn={kind:"collator"},Mo={kind:"formatted"},Vn={kind:"padding"},On={kind:"resolvedImage"},dn={kind:"variableAnchorOffsetCollection"};function Nr(l,n){return{kind:"array",itemType:l,N:n}}function hn(l){if(l.kind==="array"){let n=hn(l.itemType);return typeof l.N=="number"?`array<${n}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${n}>`}return l.kind}let Xa=[pt,Ae,He,Qe,Et,Ft,Mo,ut,Nr(Xe),Vn,On,dn];function Ws(l,n){if(n.kind==="error")return null;if(l.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Ws(l.itemType,n.itemType))&&(typeof l.N!="number"||l.N===n.N))return null}else{if(l.kind===n.kind)return null;if(l.kind==="value"){for(let a of Xa)if(!Ws(a,n))return null}}return`Expected ${hn(l)} but found ${hn(n)} instead.`}function ld(l,n){return n.some(a=>a.kind===l.kind)}function as(l,n){return n.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function ls(l,n){return l.kind==="array"&&n.kind==="array"?l.itemType.kind===n.itemType.kind&&typeof l.N=="number":l.kind===n.kind}let Ff=.96422,cd=.82521,zf=4/29,Xs=6/29,Bf=3*Xs*Xs,Vy=Xs*Xs*Xs,Uy=Math.PI/180,$y=180/Math.PI;function jf(l){return(l%=360)<0&&(l+=360),l}function ud([l,n,a,d]){let p,y,_=dd((.2225045*(l=cs(l))+.7168786*(n=cs(n))+.0606169*(a=cs(a)))/1);l===n&&n===a?p=y=_:(p=dd((.4360747*l+.3850649*n+.1430804*a)/Ff),y=dd((.0139322*l+.0971045*n+.7141733*a)/cd));let b=116*_-16;return[b<0?0:b,500*(p-_),200*(_-y),d]}function cs(l){return l<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function dd(l){return l>Vy?Math.pow(l,1/3):l/Bf+zf}function Vf([l,n,a,d]){let p=(l+16)/116,y=isNaN(n)?p:p+n/500,_=isNaN(a)?p:p-a/200;return p=1*hd(p),y=Ff*hd(y),_=cd*hd(_),[us(3.1338561*y-1.6168667*p-.4906146*_),us(-.9787684*y+1.9161415*p+.033454*_),us(.0719453*y-.2289914*p+1.4052427*_),d]}function us(l){return(l=l<=.00304?12.92*l:1.055*Math.pow(l,1/2.4)-.055)<0?0:l>1?1:l}function hd(l){return l>Xs?l*l*l:Bf*(l-zf)}function lc(l){return parseInt(l.padEnd(2,l),16)/255}function Uf(l,n){return ds(n?l/100:l,0,1)}function ds(l,n,a){return Math.min(Math.max(n,l),a)}function fd(l){return!l.some(Number.isNaN)}let Ni={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function It(l,n,a){return l+a*(n-l)}function Li(l,n,a){return l.map((d,p)=>It(d,n[p],a))}class Dt{constructor(n,a,d,p=1,y=!0){this.r=n,this.g=a,this.b=d,this.a=p,y||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[n,a,d,p]))}static parse(n){if(n instanceof Dt)return n;if(typeof n!="string")return;let a=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];let p=Ni[d];if(p){let[_,b,C]=p;return[_/255,b/255,C/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){let _=d.length<6?1:2,b=1;return[lc(d.slice(b,b+=_)),lc(d.slice(b,b+=_)),lc(d.slice(b,b+=_)),lc(d.slice(b,b+_)||"ff")]}if(d.startsWith("rgb")){let _=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){let[b,C,I,D,P,k,L,F,j,Z,J,ue]=_,ne=[D||" ",L||" ",Z].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){let N=[I,k,j].join(""),q=N==="%%%"?100:N===""?255:0;if(q){let re=[ds(+C/q,0,1),ds(+P/q,0,1),ds(+F/q,0,1),J?Uf(+J,ue):1];if(fd(re))return re}}return}}let y=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){let[_,b,C,I,D,P,k,L,F]=y,j=[C||" ",D||" ",k].join("");if(j==="  "||j==="  /"||j===",,"||j===",,,"){let Z=[+b,ds(+I,0,100),ds(+P,0,100),L?Uf(+L,F):1];if(fd(Z))return function([J,ue,ne,N]){function q(re){let _e=(re+J/30)%12,ke=ue*Math.min(ne,1-ne);return ne-ke*Math.max(-1,Math.min(_e-3,9-_e,1))}return J=jf(J),ue/=100,ne/=100,[q(0),q(8),q(4),N]}(Z)}}}(n);return a?new Dt(...a,!1):void 0}get rgb(){let{r:n,g:a,b:d,a:p}=this,y=p||1/0;return this.overwriteGetter("rgb",[n/y,a/y,d/y,p])}get hcl(){return this.overwriteGetter("hcl",function(n){let[a,d,p,y]=ud(n),_=Math.sqrt(d*d+p*p);return[Math.round(1e4*_)?jf(Math.atan2(p,d)*$y):NaN,_,a,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ud(this.rgb))}overwriteGetter(n,a){return Object.defineProperty(this,n,{value:a}),a}toString(){let[n,a,d,p]=this.rgb;return`rgba(${[n,a,d].map(y=>Math.round(255*y)).join(",")},${p})`}static interpolate(n,a,d,p="rgb"){switch(p){case"rgb":{let[y,_,b,C]=Li(n.rgb,a.rgb,d);return new Dt(y,_,b,C,!1)}case"hcl":{let[y,_,b,C]=n.hcl,[I,D,P,k]=a.hcl,L,F;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?L=NaN:(L=I,b!==1&&b!==0||(F=D)):(L=y,P!==1&&P!==0||(F=_));else{let ne=I-y;I>y&&ne>180?ne-=360:I<y&&y-I>180&&(ne+=360),L=y+d*ne}let[j,Z,J,ue]=function([ne,N,q,re]){return ne=isNaN(ne)?0:ne*Uy,Vf([q,Math.cos(ne)*N,Math.sin(ne)*N,re])}([L,F??It(_,D,d),It(b,P,d),It(C,k,d)]);return new Dt(j,Z,J,ue,!1)}case"lab":{let[y,_,b,C]=Vf(Li(n.lab,a.lab,d));return new Dt(y,_,b,C,!1)}}}}Dt.black=new Dt(0,0,0,1),Dt.white=new Dt(1,1,1,1),Dt.transparent=new Dt(0,0,0,0),Dt.red=new Dt(1,0,0,1);class cc{constructor(n,a,d){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}let $f=["bottom","center","top"];class Ya{constructor(n,a,d,p,y,_){this.text=n,this.image=a,this.scale=d,this.fontStack=p,this.textColor=y,this.verticalAlign=_}}class In{constructor(n){this.sections=n}static fromString(n){return new In([new Ya(n,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof In?n:In.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class Un{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Un)return n;if(typeof n=="number")return new Un([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(let a of n)if(typeof a!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new Un(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,d){return new Un(Li(n.values,a.values,d))}}class vn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}let pd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class fr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof fr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let a=0;a<n.length;a+=2){let d=n[a],p=n[a+1];if(typeof d!="string"||!pd.has(d)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new fr(n)}}toString(){return JSON.stringify(this.values)}static interpolate(n,a,d){let p=n.values,y=a.values;if(p.length!==y.length)throw new vn(`Cannot interpolate values of different length. from: ${n.toString()}, to: ${a.toString()}`);let _=[];for(let b=0;b<p.length;b+=2){if(p[b]!==y[b])throw new vn(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${p[b]}, to[${b}]: ${y[b]}`);_.push(p[b]);let[C,I]=p[b+1],[D,P]=y[b+1];_.push([It(C,D,d),It(I,P,d)])}return new fr(_)}}class pr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new pr({name:n,available:!1}):null}}class mr{constructor(n,a,d){this.from=n,this.to=a,this.transition=d}static interpolate(n,a,d){return new mr(n,a,d)}static parse(n){return n instanceof mr?n:Array.isArray(n)&&n.length===3&&typeof n[0]=="string"&&typeof n[1]=="string"&&typeof n[2]=="number"?new mr(n[0],n[1],n[2]):typeof n=="object"&&typeof n.from=="string"&&typeof n.to=="string"&&typeof n.transition=="number"?new mr(n.from,n.to,n.transition):typeof n=="string"?new mr(n,n,1):void 0}}function md(l,n,a,d){return typeof l=="number"&&l>=0&&l<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[l,n,a,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[l,n,a,d]:[l,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hs(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof mr||l instanceof Dt||l instanceof cc||l instanceof In||l instanceof Un||l instanceof fr||l instanceof pr)return!0;if(Array.isArray(l)){for(let n of l)if(!hs(n))return!1;return!0}if(typeof l=="object"){for(let n in l)if(!hs(l[n]))return!1;return!0}return!1}function ln(l){if(l===null)return pt;if(typeof l=="string")return He;if(typeof l=="boolean")return Qe;if(typeof l=="number")return Ae;if(l instanceof Dt)return Et;if(l instanceof mr)return Ft;if(l instanceof cc)return Cn;if(l instanceof In)return Mo;if(l instanceof Un)return Vn;if(l instanceof fr)return dn;if(l instanceof pr)return On;if(Array.isArray(l)){let n=l.length,a;for(let d of l){let p=ln(d);if(a){if(a===p)continue;a=Xe;break}a=p}return Nr(a||Xe,n)}return ut}function Ka(l){let n=typeof l;return l===null?"":n==="string"||n==="number"||n==="boolean"?String(l):l instanceof Dt||l instanceof mr||l instanceof In||l instanceof Un||l instanceof fr||l instanceof pr?l.toString():JSON.stringify(l)}class Fi{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!hs(n[1]))return a.error("invalid value");let d=n[1],p=ln(d),y=a.expectedType;return p.kind!=="array"||p.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(p=y),new Fi(p,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}let Qi={string:He,number:Ae,boolean:Qe,object:ut};class Wr{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d,p=1,y=n[0];if(y==="array"){let b,C;if(n.length>2){let I=n[1];if(typeof I!="string"||!(I in Qi)||I==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=Qi[I],p++}else b=Xe;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);C=n[2],p++}d=Nr(b,C)}else{if(!Qi[y])throw new Error(`Types doesn't contain name = ${y}`);d=Qi[y]}let _=[];for(;p<n.length;p++){let b=a.parse(n[p],p,Xe);if(!b)return null;_.push(b)}return new Wr(d,_)}evaluate(n){for(let a=0;a<this.args.length;a++){let d=this.args[a].evaluate(n);if(!Ws(this.type,ln(d)))return d;if(a===this.args.length-1)throw new vn(`Expected value to be of type ${hn(this.type)}, but found ${hn(ln(d))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}let gd={"to-boolean":Qe,"to-color":Et,"to-number":Ae,"to-string":He};class Ji{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d=n[0];if(!gd[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&n.length!==2)return a.error("Expected one argument.");let p=gd[d],y=[];for(let _=1;_<n.length;_++){let b=a.parse(n[_],_,Xe);if(!b)return null;y.push(b)}return new Ji(p,y)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let a,d;for(let p of this.args){if(a=p.evaluate(n),d=null,a instanceof Dt)return a;if(typeof a=="string"){let y=n.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(d=a.length<3||a.length>4?`Invalid rgba value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:md(a[0],a[1],a[2],a[3]),!d))return new Dt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new vn(d||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"padding":{let a;for(let d of this.args){a=d.evaluate(n);let p=Un.parse(a);if(p)return p}throw new vn(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"variableAnchorOffsetCollection":{let a;for(let d of this.args){a=d.evaluate(n);let p=fr.parse(a);if(p)return p}throw new vn(`Could not parse variableAnchorOffsetCollection from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}case"number":{let a=null;for(let d of this.args){if(a=d.evaluate(n),a===null)return 0;let p=Number(a);if(!isNaN(p))return p}throw new vn(`Could not convert ${JSON.stringify(a)} to number.`)}case"formatted":return In.fromString(Ka(this.args[0].evaluate(n)));case"resolvedImage":return pr.fromString(Ka(this.args[0].evaluate(n)));case"projectionDefinition":return this.args[0].evaluate(n);default:return Ka(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}let uc=["Unknown","Point","LineString","Polygon"];class cn{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?uc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=Dt.parse(n)),a}}class Ys{constructor(n,a,d=[],p,y=new at,_=[]){this.registry=n,this.path=d,this.key=d.map(b=>`[${b}]`).join(""),this.scope=y,this.errors=_,this.expectedType=p,this._isConstant=a}parse(n,a,d,p,y={}){return a?this.concat(a,d,p)._parse(n,y):this._parse(n,y)}_parse(n,a){function d(p,y,_){return _==="assert"?new Wr(y,[p]):_==="coerce"?new Ji(y,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let p=n[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let y=this.registry[p];if(y){let _=y.parse(n,this);if(!_)return null;if(this.expectedType){let b=this.expectedType,C=_.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||C.kind!=="value")if(b.kind!=="projectionDefinition"||C.kind!=="string"&&C.kind!=="array")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string")if(b.kind!=="padding"||C.kind!=="value"&&C.kind!=="number"&&C.kind!=="array")if(b.kind!=="variableAnchorOffsetCollection"||C.kind!=="value"&&C.kind!=="array"){if(this.checkSubtype(b,C))return null}else _=d(_,b,a.typeAnnotation||"coerce");else _=d(_,b,a.typeAnnotation||"coerce");else _=d(_,b,a.typeAnnotation||"coerce");else _=d(_,b,a.typeAnnotation||"coerce");else _=d(_,b,a.typeAnnotation||"assert")}if(!(_ instanceof Fi)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){let b=new cn;try{_=new Fi(_.type,_.evaluate(b))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,d){let p=typeof n=="number"?this.path.concat(n):this.path,y=d?this.scope.concat(d):this.scope;return new Ys(this.registry,this._isConstant,p,a||null,y,this.errors)}error(n,...a){let d=`${this.key}${a.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ve(d,n))}checkSubtype(n,a){let d=Ws(n,a);return d&&this.error(d),d}}class Ot{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(let a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);let d=[];for(let y=1;y<n.length-1;y+=2){let _=n[y];if(typeof _!="string")return a.error(`Expected string, but found ${typeof _} instead.`,y);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);let b=a.parse(n[y+1],y+1);if(!b)return null;d.push([_,b])}let p=a.parse(n[n.length-1],n.length-1,a.expectedType,d);return p?new Ot(d,p):null}outputDefined(){return this.result.outputDefined()}}class vt{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");let d=n[1];return a.scope.has(d)?new vt(d,a.scope.get(d)):a.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Qa{constructor(n,a,d){this.type=n,this.index=a,this.input=d}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let d=a.parse(n[1],1,Ae),p=a.parse(n[2],2,Nr(a.expectedType||Xe));return d&&p?new Qa(p.type.itemType,d,p):null}evaluate(n){let a=this.index.evaluate(n),d=this.input.evaluate(n);if(a<0)throw new vn(`Array index out of bounds: ${a} < 0.`);if(a>=d.length)throw new vn(`Array index out of bounds: ${a} > ${d.length-1}.`);if(a!==Math.floor(a))throw new vn(`Array index must be an integer, but found ${a} instead.`);return d[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class zt{constructor(n,a){this.type=Qe,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);let d=a.parse(n[1],1,Xe),p=a.parse(n[2],2,Xe);return d&&p?ld(d.type,[Qe,He,Ae,pt,Xe])?new zt(d,p):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(d.type)} instead`):null}evaluate(n){let a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!d)return!1;if(!as(a,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(ln(a))} instead.`);if(!as(d,["string","array"]))throw new vn(`Expected second argument to be of type array or string, but found ${hn(ln(d))} instead.`);return d.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class Ks{constructor(n,a,d){this.type=Ae,this.needle=n,this.haystack=a,this.fromIndex=d}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let d=a.parse(n[1],1,Xe),p=a.parse(n[2],2,Xe);if(!d||!p)return null;if(!ld(d.type,[Qe,He,Ae,pt,Xe]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${hn(d.type)} instead`);if(n.length===4){let y=a.parse(n[3],3,Ae);return y?new Ks(d,p,y):null}return new Ks(d,p)}evaluate(n){let a=this.needle.evaluate(n),d=this.haystack.evaluate(n);if(!as(a,["boolean","string","number","null"]))throw new vn(`Expected first argument to be of type boolean, string, number or null, but found ${hn(ln(a))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(n)),as(d,["string"])){let y=d.indexOf(a,p);return y===-1?-1:[...d.slice(0,y)].length}if(as(d,["array"]))return d.indexOf(a,p);throw new vn(`Expected second argument to be of type array or string, but found ${hn(ln(d))} instead.`)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class mi{constructor(n,a,d,p,y,_){this.inputType=n,this.type=a,this.input=d,this.cases=p,this.outputs=y,this.otherwise=_}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let d,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);let y={},_=[];for(let I=2;I<n.length-1;I+=2){let D=n[I],P=n[I+1];Array.isArray(D)||(D=[D]);let k=a.concat(I);if(D.length===0)return k.error("Expected at least one branch label.");for(let F of D){if(typeof F!="number"&&typeof F!="string")return k.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return k.error("Numeric branch labels must be integer values.");if(d){if(k.checkSubtype(d,ln(F)))return null}else d=ln(F);if(y[String(F)]!==void 0)return k.error("Branch labels must be unique.");y[String(F)]=_.length}let L=a.parse(P,I,p);if(!L)return null;p=p||L.type,_.push(L)}let b=a.parse(n[1],1,Xe);if(!b)return null;let C=a.parse(n[n.length-1],n.length-1,p);return C?b.type.kind!=="value"&&a.concat(1).checkSubtype(d,b.type)?null:new mi(d,p,b,y,_,C):null}evaluate(n){let a=this.input.evaluate(n);return(ln(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class Ja{constructor(n,a,d){this.type=n,this.branches=a,this.otherwise=d}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);let p=[];for(let _=1;_<n.length-1;_+=2){let b=a.parse(n[_],_,Qe);if(!b)return null;let C=a.parse(n[_+1],_+1,d);if(!C)return null;p.push([b,C]),d=d||C.type}let y=a.parse(n[n.length-1],n.length-1,d);if(!y)return null;if(!d)throw new Error("Can't infer output type");return new Ja(d,p,y)}evaluate(n){for(let[a,d]of this.branches)if(a.evaluate(n))return d.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(let[a,d]of this.branches)n(a),n(d);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class el{constructor(n,a,d,p){this.type=n,this.input=a,this.beginIndex=d,this.endIndex=p}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);let d=a.parse(n[1],1,Xe),p=a.parse(n[2],2,Ae);if(!d||!p)return null;if(!ld(d.type,[Nr(Xe),He,Xe]))return a.error(`Expected first argument to be of type array or string, but found ${hn(d.type)} instead`);if(n.length===4){let y=a.parse(n[3],3,Ae);return y?new el(d.type,d,p,y):null}return new el(d.type,d,p)}evaluate(n){let a=this.input.evaluate(n),d=this.beginIndex.evaluate(n),p;if(this.endIndex&&(p=this.endIndex.evaluate(n)),as(a,["string"]))return[...a].slice(d,p).join("");if(as(a,["array"]))return a.slice(d,p);throw new vn(`Expected first argument to be of type array or string, but found ${hn(ln(a))} instead.`)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function tl(l,n){let a=l.length-1,d,p,y=0,_=a,b=0;for(;y<=_;)if(b=Math.floor((y+_)/2),d=l[b],p=l[b+1],d<=n){if(b===a||n<p)return b;y=b+1}else{if(!(d>n))throw new vn("Input is not a number.");_=b-1}return 0}class fs{constructor(n,a,d){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(let[p,y]of d)this.labels.push(p),this.outputs.push(y)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");let d=a.parse(n[1],1,Ae);if(!d)return null;let p=[],y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let _=1;_<n.length;_+=2){let b=_===1?-1/0:n[_],C=n[_+1],I=_,D=_+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);let P=a.parse(C,D,y);if(!P)return null;y=y||P.type,p.push([b,P])}return new fs(y,d,p)}evaluate(n){let a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);let p=this.input.evaluate(n);if(p<=a[0])return d[0].evaluate(n);let y=a.length;return p>=a[y-1]?d[y-1].evaluate(n):d[tl(a,p)].evaluate(n)}eachChild(n){n(this.input);for(let a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Hf(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var yd,_d,Gf=function(){if(_d)return yd;function l(n,a,d,p){this.cx=3*n,this.bx=3*(d-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=d,this.p2y=p}return _d=1,yd=l,l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var d=n,p=0;p<8;p++){var y=this.sampleCurveX(d)-n;if(Math.abs(y)<a)return d;var _=this.sampleCurveDerivativeX(d);if(Math.abs(_)<1e-6)break;d-=y/_}var b=0,C=1;for(d=n,p=0;p<20&&(y=this.sampleCurveX(d),!(Math.abs(y-n)<a));p++)n>y?b=d:C=d,d=.5*(C-b)+b;return d},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},yd}(),nl=Hf(Gf);class nn{constructor(n,a,d,p,y){this.type=n,this.operator=a,this.interpolation=d,this.input=p,this.labels=[],this.outputs=[];for(let[_,b]of y)this.labels.push(_),this.outputs.push(b)}static interpolationFactor(n,a,d,p){let y=0;if(n.name==="exponential")y=Qs(a,n.base,d,p);else if(n.name==="linear")y=Qs(a,1,d,p);else if(n.name==="cubic-bezier"){let _=n.controlPoints;y=new nl(_[0],_[1],_[2],_[3]).solve(Qs(a,1,d,p))}return y}static parse(n,a){let[d,p,y,..._]=n;if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){let I=p[1];if(typeof I!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:I}}else{if(p[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(p[0])}`,1,0);{let I=p.slice(1);if(I.length!==4||I.some(D=>typeof D!="number"||D<0||D>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:I}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,Ae),!y)return null;let b=[],C=null;d==="interpolate-hcl"||d==="interpolate-lab"?C=Et:a.expectedType&&a.expectedType.kind!=="value"&&(C=a.expectedType);for(let I=0;I<_.length;I+=2){let D=_[I],P=_[I+1],k=I+3,L=I+4;if(typeof D!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(b.length&&b[b.length-1][0]>=D)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);let F=a.parse(P,L,C);if(!F)return null;C=C||F.type,b.push([D,F])}return ls(C,Ae)||ls(C,Ft)||ls(C,Et)||ls(C,Vn)||ls(C,dn)||ls(C,Nr(Ae))?new nn(C,d,p,y,b):a.error(`Type ${hn(C)} is not interpolatable.`)}evaluate(n){let a=this.labels,d=this.outputs;if(a.length===1)return d[0].evaluate(n);let p=this.input.evaluate(n);if(p<=a[0])return d[0].evaluate(n);let y=a.length;if(p>=a[y-1])return d[y-1].evaluate(n);let _=tl(a,p),b=nn.interpolationFactor(this.interpolation,p,a[_],a[_+1]),C=d[_].evaluate(n),I=d[_+1].evaluate(n);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return It(C,I,b);case"color":return Dt.interpolate(C,I,b);case"padding":return Un.interpolate(C,I,b);case"variableAnchorOffsetCollection":return fr.interpolate(C,I,b);case"array":return Li(C,I,b);case"projectionDefinition":return mr.interpolate(C,I,b)}case"interpolate-hcl":return Dt.interpolate(C,I,b,"hcl");case"interpolate-lab":return Dt.interpolate(C,I,b,"lab")}}eachChild(n){n(this.input);for(let a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Qs(l,n,a,d){let p=d-a,y=l-a;return p===0?0:n===1?y/p:(Math.pow(n,y)-1)/(Math.pow(n,p)-1)}let gi={color:Dt.interpolate,number:It,padding:Un.interpolate,variableAnchorOffsetCollection:fr.interpolate,array:Li};class ps{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d=null,p=a.expectedType;p&&p.kind!=="value"&&(d=p);let y=[];for(let b of n.slice(1)){let C=a.parse(b,1+y.length,d,void 0,{typeAnnotation:"omit"});if(!C)return null;d=d||C.type,y.push(C)}if(!d)throw new Error("No output type");let _=p&&y.some(b=>Ws(p,b.type));return new ps(_?Xe:d,y)}evaluate(n){let a,d=null,p=0;for(let y of this.args)if(p++,d=y.evaluate(n),d&&d instanceof pr&&!d.available&&(a||(a=d.name),d=null,p===this.args.length&&(d=a)),d!==null)break;return d}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}function $n(l,n){return l==="=="||l==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function vd(l,n,a,d){return d.compare(n,a)===0}function Do(l,n,a){let d=l!=="=="&&l!=="!=";return class fS{constructor(y,_,b){this.type=Qe,this.lhs=y,this.rhs=_,this.collator=b,this.hasUntypedArgument=y.type.kind==="value"||_.type.kind==="value"}static parse(y,_){if(y.length!==3&&y.length!==4)return _.error("Expected two or three arguments.");let b=y[0],C=_.parse(y[1],1,Xe);if(!C)return null;if(!$n(b,C.type))return _.concat(1).error(`"${b}" comparisons are not supported for type '${hn(C.type)}'.`);let I=_.parse(y[2],2,Xe);if(!I)return null;if(!$n(b,I.type))return _.concat(2).error(`"${b}" comparisons are not supported for type '${hn(I.type)}'.`);if(C.type.kind!==I.type.kind&&C.type.kind!=="value"&&I.type.kind!=="value")return _.error(`Cannot compare types '${hn(C.type)}' and '${hn(I.type)}'.`);d&&(C.type.kind==="value"&&I.type.kind!=="value"?C=new Wr(I.type,[C]):C.type.kind!=="value"&&I.type.kind==="value"&&(I=new Wr(C.type,[I])));let D=null;if(y.length===4){if(C.type.kind!=="string"&&I.type.kind!=="string"&&C.type.kind!=="value"&&I.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(D=_.parse(y[3],3,Cn),!D)return null}return new fS(C,I,D)}evaluate(y){let _=this.lhs.evaluate(y),b=this.rhs.evaluate(y);if(d&&this.hasUntypedArgument){let C=ln(_),I=ln(b);if(C.kind!==I.kind||C.kind!=="string"&&C.kind!=="number")throw new vn(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${C.kind}, ${I.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){let C=ln(_),I=ln(b);if(C.kind!=="string"||I.kind!=="string")return n(y,_,b)}return this.collator?a(y,_,b,this.collator.evaluate(y)):n(y,_,b)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}let qf=Do("==",function(l,n,a){return n===a},vd),Hy=Do("!=",function(l,n,a){return n!==a},function(l,n,a,d){return!vd(0,n,a,d)}),dc=Do("<",function(l,n,a){return n<a},function(l,n,a,d){return d.compare(n,a)<0}),bd=Do(">",function(l,n,a){return n>a},function(l,n,a,d){return d.compare(n,a)>0}),Gy=Do("<=",function(l,n,a){return n<=a},function(l,n,a,d){return d.compare(n,a)<=0}),hc=Do(">=",function(l,n,a){return n>=a},function(l,n,a,d){return d.compare(n,a)>=0});class ms{constructor(n,a,d){this.type=Cn,this.locale=d,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");let d=n[1];if(typeof d!="object"||Array.isArray(d))return a.error("Collator options argument must be an object.");let p=a.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Qe);if(!p)return null;let y=a.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Qe);if(!y)return null;let _=null;return d.locale&&(_=a.parse(d.locale,1,He),!_)?null:new ms(p,y,_)}evaluate(n){return new cc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}class Lr{constructor(n,a,d,p,y){this.type=He,this.number=n,this.locale=a,this.currency=d,this.minFractionDigits=p,this.maxFractionDigits=y}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");let d=a.parse(n[1],1,Ae);if(!d)return null;let p=n[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=a.parse(p.locale,1,He),!y))return null;let _=null;if(p.currency&&(_=a.parse(p.currency,1,He),!_))return null;let b=null;if(p["min-fraction-digits"]&&(b=a.parse(p["min-fraction-digits"],1,Ae),!b))return null;let C=null;return p["max-fraction-digits"]&&(C=a.parse(p["max-fraction-digits"],1,Ae),!C)?null:new Lr(d,y,_,b,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class rl{constructor(n){this.type=Mo,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let d=n[1];if(!Array.isArray(d)&&typeof d=="object")return a.error("First argument must be an image or text section.");let p=[],y=!1;for(let _=1;_<=n.length-1;++_){let b=n[_];if(y&&typeof b=="object"&&!Array.isArray(b)){y=!1;let C=null;if(b["font-scale"]&&(C=a.parse(b["font-scale"],1,Ae),!C))return null;let I=null;if(b["text-font"]&&(I=a.parse(b["text-font"],1,Nr(He)),!I))return null;let D=null;if(b["text-color"]&&(D=a.parse(b["text-color"],1,Et),!D))return null;let P=null;if(b["vertical-align"]){if(typeof b["vertical-align"]=="string"&&!$f.includes(b["vertical-align"]))return a.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${b["vertical-align"]}' instead.`);if(P=a.parse(b["vertical-align"],1,He),!P)return null}let k=p[p.length-1];k.scale=C,k.font=I,k.textColor=D,k.verticalAlign=P}else{let C=a.parse(n[_],1,Xe);if(!C)return null;let I=C.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new rl(p)}evaluate(n){return new In(this.sections.map(a=>{let d=a.content.evaluate(n);return ln(d)===On?new Ya("",d,null,null,null,a.verticalAlign?a.verticalAlign.evaluate(n):null):new Ya(Ka(d),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null,a.verticalAlign?a.verticalAlign.evaluate(n):null)}))}eachChild(n){for(let a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor),a.verticalAlign&&n(a.verticalAlign)}outputDefined(){return!1}}class Js{constructor(n){this.type=On,this.input=n}static parse(n,a){if(n.length!==2)return a.error("Expected two arguments.");let d=a.parse(n[1],1,He);return d?new Js(d):a.error("No image name provided.")}evaluate(n){let a=this.input.evaluate(n),d=pr.fromString(a);return d&&n.availableImages&&(d.available=n.availableImages.indexOf(a)>-1),d}eachChild(n){n(this.input)}outputDefined(){return!1}}class xd{constructor(n){this.type=Ae,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);let d=a.parse(n[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${hn(d.type)} instead.`):new xd(d):null}evaluate(n){let a=this.input.evaluate(n);if(typeof a=="string")return[...a].length;if(Array.isArray(a))return a.length;throw new vn(`Expected value to be of type string or array, but found ${hn(ln(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}let Xr=8192;function qy(l,n){let a=(180+l[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(a*p*Xr),Math.round(d*p*Xr)]}function wd(l,n){let a=Math.pow(2,n.z);return[(p=(l[0]/Xr+n.x)/a,360*p-180),(d=(l[1]/Xr+n.y)/a,360/Math.PI*Math.atan(Math.exp((180-360*d)*Math.PI/180))-90)];var d,p}function il(l,n){l[0]=Math.min(l[0],n[0]),l[1]=Math.min(l[1],n[1]),l[2]=Math.max(l[2],n[0]),l[3]=Math.max(l[3],n[1])}function ol(l,n){return!(l[0]<=n[0]||l[2]>=n[2]||l[1]<=n[1]||l[3]>=n[3])}function fc(l,n,a){let d=l[0]-n[0],p=l[1]-n[1],y=l[0]-a[0],_=l[1]-a[1];return d*_-y*p==0&&d*y<=0&&p*_<=0}function pc(l,n,a,d){return(p=[d[0]-a[0],d[1]-a[1]])[0]*(y=[n[0]-l[0],n[1]-l[1]])[1]-p[1]*y[0]!=0&&!(!Wf(l,n,a,d)||!Wf(a,d,l,n));var p,y}function Zf(l,n,a){for(let d of a)for(let p=0;p<d.length-1;++p)if(pc(l,n,d[p],d[p+1]))return!0;return!1}function gs(l,n,a=!1){let d=!1;for(let b of n)for(let C=0;C<b.length-1;C++){if(fc(l,b[C],b[C+1]))return a;(y=b[C])[1]>(p=l)[1]!=(_=b[C+1])[1]>p[1]&&p[0]<(_[0]-y[0])*(p[1]-y[1])/(_[1]-y[1])+y[0]&&(d=!d)}var p,y,_;return d}function Zy(l,n){for(let a of n)if(gs(l,a))return!0;return!1}function Cd(l,n){for(let a of l)if(!gs(a,n))return!1;for(let a=0;a<l.length-1;++a)if(Zf(l[a],l[a+1],n))return!1;return!0}function Wy(l,n){for(let a of n)if(Cd(l,a))return!0;return!1}function Wf(l,n,a,d){let p=d[0]-a[0],y=d[1]-a[1],_=(l[0]-a[0])*y-p*(l[1]-a[1]),b=(n[0]-a[0])*y-p*(n[1]-a[1]);return _>0&&b<0||_<0&&b>0}function Ed(l,n,a){let d=[];for(let p=0;p<l.length;p++){let y=[];for(let _=0;_<l[p].length;_++){let b=qy(l[p][_],a);il(n,b),y.push(b)}d.push(y)}return d}function Xf(l,n,a){let d=[];for(let p=0;p<l.length;p++){let y=Ed(l[p],n,a);d.push(y)}return d}function Yf(l,n,a,d){if(l[0]<a[0]||l[0]>a[2]){let p=.5*d,y=l[0]-a[0]>p?-d:a[0]-l[0]>p?d:0;y===0&&(y=l[0]-a[2]>p?-d:a[2]-l[0]>p?d:0),l[0]+=y}il(n,l)}function Id(l,n,a,d){let p=Math.pow(2,d.z)*Xr,y=[d.x*Xr,d.y*Xr],_=[];for(let b of l)for(let C of b){let I=[C.x+y[0],C.y+y[1]];Yf(I,n,a,p),_.push(I)}return _}function Td(l,n,a,d){let p=Math.pow(2,d.z)*Xr,y=[d.x*Xr,d.y*Xr],_=[];for(let C of l){let I=[];for(let D of C){let P=[D.x+y[0],D.y+y[1]];il(n,P),I.push(P)}_.push(I)}if(n[2]-n[0]<=p/2){(b=n)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(let C of _)for(let I of C)Yf(I,n,a,p)}var b;return _}class So{constructor(n,a){this.type=Qe,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(hs(n[1])){let d=n[1];if(d.type==="FeatureCollection"){let p=[];for(let y of d.features){let{type:_,coordinates:b}=y.geometry;_==="Polygon"&&p.push(b),_==="MultiPolygon"&&p.push(...b)}if(p.length)return new So(d,{type:"MultiPolygon",coordinates:p})}else if(d.type==="Feature"){let p=d.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new So(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new So(d,d)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,d){let p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(d.type==="Polygon"){let b=Ed(d.coordinates,y,_),C=Id(a.geometry(),p,y,_);if(!ol(p,y))return!1;for(let I of C)if(!gs(I,b))return!1}if(d.type==="MultiPolygon"){let b=Xf(d.coordinates,y,_),C=Id(a.geometry(),p,y,_);if(!ol(p,y))return!1;for(let I of C)if(!Zy(I,b))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,d){let p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(d.type==="Polygon"){let b=Ed(d.coordinates,y,_),C=Td(a.geometry(),p,y,_);if(!ol(p,y))return!1;for(let I of C)if(!Cd(I,b))return!1}if(d.type==="MultiPolygon"){let b=Xf(d.coordinates,y,_),C=Td(a.geometry(),p,y,_);if(!ol(p,y))return!1;for(let I of C)if(!Wy(I,b))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Kf=class{constructor(l=[],n=(a,d)=>a<d?-1:a>d?1:0){if(this.data=l,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;let l=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),l}peek(){return this.data[0]}_up(l){let{data:n,compare:a}=this,d=n[l];for(;l>0;){let p=l-1>>1,y=n[p];if(a(d,y)>=0)break;n[l]=y,l=p}n[l]=d}_down(l){let{data:n,compare:a}=this,d=this.length>>1,p=n[l];for(;l<d;){let y=1+(l<<1),_=y+1;if(_<this.length&&a(n[_],n[y])<0&&(y=_),a(n[y],p)>=0)break;n[l]=n[y],l=y}n[l]=p}};function Qf(l,n,a=0,d=l.length-1,p=Md){for(;d>a;){if(d-a>600){let C=d-a+1,I=n-a+1,D=Math.log(C),P=.5*Math.exp(2*D/3),k=.5*Math.sqrt(D*P*(C-P)/C)*(I-C/2<0?-1:1);Qf(l,n,Math.max(a,Math.floor(n-I*P/C+k)),Math.min(d,Math.floor(n+(C-I)*P/C+k)),p)}let y=l[n],_=a,b=d;for(sl(l,a,n),p(l[d],y)>0&&sl(l,a,d);_<b;){for(sl(l,_,b),_++,b--;p(l[_],y)<0;)_++;for(;p(l[b],y)>0;)b--}p(l[a],y)===0?sl(l,a,b):(b++,sl(l,b,d)),b<=n&&(a=b+1),n<=b&&(d=b-1)}}function sl(l,n,a){let d=l[n];l[n]=l[a],l[a]=d}function Md(l,n){return l<n?-1:l>n?1:0}function mc(l,n){if(l.length<=1)return[l];let a=[],d,p;for(let y of l){let _=Yy(y);_!==0&&(y.area=Math.abs(_),p===void 0&&(p=_<0),p===_<0?(d&&a.push(d),d=[y]):d.push(y))}if(d&&a.push(d),n>1)for(let y=0;y<a.length;y++)a[y].length<=n||(Qf(a[y],n,1,a[y].length-1,Xy),a[y]=a[y].slice(0,n));return a}function Xy(l,n){return n.area-l.area}function Yy(l){let n=0;for(let a,d,p=0,y=l.length,_=y-1;p<y;_=p++)a=l[p],d=l[_],n+=(d.x-a.x)*(a.y+d.y);return n}let Dd=1/298.257223563,Sd=Dd*(2-Dd),Jf=Math.PI/180;class Pd{constructor(n){let a=6378.137*Jf*1e3,d=Math.cos(n*Jf),p=1/(1-Sd*(1-d*d)),y=Math.sqrt(p);this.kx=a*y*d,this.ky=a*y*p*(1-Sd)}distance(n,a){let d=this.wrap(n[0]-a[0])*this.kx,p=(n[1]-a[1])*this.ky;return Math.sqrt(d*d+p*p)}pointOnLine(n,a){let d,p,y,_,b=1/0;for(let C=0;C<n.length-1;C++){let I=n[C][0],D=n[C][1],P=this.wrap(n[C+1][0]-I)*this.kx,k=(n[C+1][1]-D)*this.ky,L=0;P===0&&k===0||(L=(this.wrap(a[0]-I)*this.kx*P+(a[1]-D)*this.ky*k)/(P*P+k*k),L>1?(I=n[C+1][0],D=n[C+1][1]):L>0&&(I+=P/this.kx*L,D+=k/this.ky*L)),P=this.wrap(a[0]-I)*this.kx,k=(a[1]-D)*this.ky;let F=P*P+k*k;F<b&&(b=F,d=I,p=D,y=C,_=L)}return{point:[d,p],index:y,t:Math.max(0,Math.min(1,_))}}wrap(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}}function Ad(l,n){return n[0]-l[0]}function al(l){return l[1]-l[0]+1}function eo(l,n){return l[1]>=l[0]&&l[1]<n}function Rd(l,n){if(l[0]>l[1])return[null,null];let a=al(l);if(n){if(a===2)return[l,null];let p=Math.floor(a/2);return[[l[0],l[0]+p],[l[0]+p,l[1]]]}if(a===1)return[l,null];let d=Math.floor(a/2)-1;return[[l[0],l[0]+d],[l[0]+d+1,l[1]]]}function kd(l,n){if(!eo(n,l.length))return[1/0,1/0,-1/0,-1/0];let a=[1/0,1/0,-1/0,-1/0];for(let d=n[0];d<=n[1];++d)il(a,l[d]);return a}function gc(l){let n=[1/0,1/0,-1/0,-1/0];for(let a of l)for(let d of a)il(n,d);return n}function ep(l){return l[0]!==-1/0&&l[1]!==-1/0&&l[2]!==1/0&&l[3]!==1/0}function Od(l,n,a){if(!ep(l)||!ep(n))return NaN;let d=0,p=0;return l[2]<n[0]&&(d=n[0]-l[2]),l[0]>n[2]&&(d=l[0]-n[2]),l[1]>n[3]&&(p=l[1]-n[3]),l[3]<n[1]&&(p=n[1]-l[3]),a.distance([0,0],[d,p])}function ys(l,n,a){let d=a.pointOnLine(n,l);return a.distance(l,d.point)}function Nd(l,n,a,d,p){let y=Math.min(ys(l,[a,d],p),ys(n,[a,d],p)),_=Math.min(ys(a,[l,n],p),ys(d,[l,n],p));return Math.min(y,_)}function Ut(l,n,a,d,p){if(!eo(n,l.length)||!eo(d,a.length))return 1/0;let y=1/0;for(let _=n[0];_<n[1];++_){let b=l[_],C=l[_+1];for(let I=d[0];I<d[1];++I){let D=a[I],P=a[I+1];if(pc(b,C,D,P))return 0;y=Math.min(y,Nd(b,C,D,P,p))}}return y}function Ky(l,n,a,d,p){if(!eo(n,l.length)||!eo(d,a.length))return NaN;let y=1/0;for(let _=n[0];_<=n[1];++_)for(let b=d[0];b<=d[1];++b)if(y=Math.min(y,p.distance(l[_],a[b])),y===0)return y;return y}function Qy(l,n,a){if(gs(l,n,!0))return 0;let d=1/0;for(let p of n){let y=p[0],_=p[p.length-1];if(y!==_&&(d=Math.min(d,ys(l,[_,y],a)),d===0))return d;let b=a.pointOnLine(p,l);if(d=Math.min(d,a.distance(l,b.point)),d===0)return d}return d}function Jy(l,n,a,d){if(!eo(n,l.length))return NaN;for(let y=n[0];y<=n[1];++y)if(gs(l[y],a,!0))return 0;let p=1/0;for(let y=n[0];y<n[1];++y){let _=l[y],b=l[y+1];for(let C of a)for(let I=0,D=C.length,P=D-1;I<D;P=I++){let k=C[P],L=C[I];if(pc(_,b,k,L))return 0;p=Math.min(p,Nd(_,b,k,L,d))}}return p}function tp(l,n){for(let a of l)for(let d of a)if(gs(d,n,!0))return!0;return!1}function e_(l,n,a,d=1/0){let p=gc(l),y=gc(n);if(d!==1/0&&Od(p,y,a)>=d)return d;if(ol(p,y)){if(tp(l,n))return 0}else if(tp(n,l))return 0;let _=1/0;for(let b of l)for(let C=0,I=b.length,D=I-1;C<I;D=C++){let P=b[D],k=b[C];for(let L of n)for(let F=0,j=L.length,Z=j-1;F<j;Z=F++){let J=L[Z],ue=L[F];if(pc(P,k,J,ue))return 0;_=Math.min(_,Nd(P,k,J,ue,a))}}return _}function np(l,n,a,d,p,y){if(!y)return;let _=Od(kd(d,y),p,a);_<n&&l.push([_,y,[0,0]])}function yc(l,n,a,d,p,y,_){if(!y||!_)return;let b=Od(kd(d,y),kd(p,_),a);b<n&&l.push([b,y,_])}function _c(l,n,a,d,p=1/0){let y=Math.min(d.distance(l[0],a[0][0]),p);if(y===0)return y;let _=new Kf([[0,[0,l.length-1],[0,0]]],Ad),b=gc(a);for(;_.length>0;){let C=_.pop();if(C[0]>=y)continue;let I=C[1],D=n?50:100;if(al(I)<=D){if(!eo(I,l.length))return NaN;if(n){let P=Jy(l,I,a,d);if(isNaN(P)||P===0)return P;y=Math.min(y,P)}else for(let P=I[0];P<=I[1];++P){let k=Qy(l[P],a,d);if(y=Math.min(y,k),y===0)return 0}}else{let P=Rd(I,n);np(_,y,d,l,b,P[0]),np(_,y,d,l,b,P[1])}}return y}function vc(l,n,a,d,p,y=1/0){let _=Math.min(y,p.distance(l[0],a[0]));if(_===0)return _;let b=new Kf([[0,[0,l.length-1],[0,a.length-1]]],Ad);for(;b.length>0;){let C=b.pop();if(C[0]>=_)continue;let I=C[1],D=C[2],P=n?50:100,k=d?50:100;if(al(I)<=P&&al(D)<=k){if(!eo(I,l.length)&&eo(D,a.length))return NaN;let L;if(n&&d)L=Ut(l,I,a,D,p),_=Math.min(_,L);else if(n&&!d){let F=l.slice(I[0],I[1]+1);for(let j=D[0];j<=D[1];++j)if(L=ys(a[j],F,p),_=Math.min(_,L),_===0)return _}else if(!n&&d){let F=a.slice(D[0],D[1]+1);for(let j=I[0];j<=I[1];++j)if(L=ys(l[j],F,p),_=Math.min(_,L),_===0)return _}else L=Ky(l,I,a,D,p),_=Math.min(_,L)}else{let L=Rd(I,n),F=Rd(D,d);yc(b,_,p,l,a,L[0],F[0]),yc(b,_,p,l,a,L[0],F[1]),yc(b,_,p,l,a,L[1],F[0]),yc(b,_,p,l,a,L[1],F[1])}}return _}function Ld(l){return l.type==="MultiPolygon"?l.coordinates.map(n=>({type:"Polygon",coordinates:n})):l.type==="MultiLineString"?l.coordinates.map(n=>({type:"LineString",coordinates:n})):l.type==="MultiPoint"?l.coordinates.map(n=>({type:"Point",coordinates:n})):[l]}class _s{constructor(n,a){this.type=Ae,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires exactly one argument, but found ${n.length-1} instead.`);if(hs(n[1])){let d=n[1];if(d.type==="FeatureCollection")return new _s(d,d.features.map(p=>Ld(p.geometry)).flat());if(d.type==="Feature")return new _s(d,Ld(d.geometry));if("type"in d&&"coordinates"in d)return new _s(d,Ld(d))}return a.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,d){let p=a.geometry(),y=p.flat().map(C=>wd([C.x,C.y],a.canonical));if(p.length===0)return NaN;let _=new Pd(y[0][1]),b=1/0;for(let C of d){switch(C.type){case"Point":b=Math.min(b,vc(y,!1,[C.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,vc(y,!1,C.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,_c(y,!1,C.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,d){let p=a.geometry(),y=p.flat().map(C=>wd([C.x,C.y],a.canonical));if(p.length===0)return NaN;let _=new Pd(y[0][1]),b=1/0;for(let C of d){switch(C.type){case"Point":b=Math.min(b,vc(y,!0,[C.coordinates],!1,_,b));break;case"LineString":b=Math.min(b,vc(y,!0,C.coordinates,!0,_,b));break;case"Polygon":b=Math.min(b,_c(y,!0,C.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries);if(n.geometryType()==="Polygon")return function(a,d){let p=a.geometry();if(p.length===0||p[0].length===0)return NaN;let y=mc(p,0).map(C=>C.map(I=>I.map(D=>wd([D.x,D.y],a.canonical)))),_=new Pd(y[0][0][0][1]),b=1/0;for(let C of d)for(let I of y){switch(C.type){case"Point":b=Math.min(b,_c([C.coordinates],!1,I,_,b));break;case"LineString":b=Math.min(b,_c(C.coordinates,!0,I,_,b));break;case"Polygon":b=Math.min(b,e_(I,C.coordinates,_,b))}if(b===0)return b}return b}(n,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}let ea={"==":qf,"!=":Hy,">":bd,"<":dc,">=":hc,"<=":Gy,array:Wr,at:Qa,boolean:Wr,case:Ja,coalesce:ps,collator:ms,format:rl,image:Js,in:zt,"index-of":Ks,interpolate:nn,"interpolate-hcl":nn,"interpolate-lab":nn,length:xd,let:Ot,literal:Fi,match:mi,number:Wr,"number-format":Lr,object:Wr,slice:el,step:fs,string:Wr,"to-boolean":Ji,"to-color":Ji,"to-number":Ji,"to-string":Ji,var:vt,within:So,distance:_s};class Yr{constructor(n,a,d,p){this.name=n,this.type=a,this._evaluate=d,this.args=p}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,a){let d=n[0],p=Yr.definitions[d];if(!p)return a.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);let y=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,b=_.filter(([I])=>!Array.isArray(I)||I.length===n.length-1),C=null;for(let[I,D]of b){C=new Ys(a.registry,bc,a.path,null,a.scope);let P=[],k=!1;for(let L=1;L<n.length;L++){let F=n[L],j=Array.isArray(I)?I[L-1]:I.type,Z=C.parse(F,1+P.length,j);if(!Z){k=!0;break}P.push(Z)}if(!k)if(Array.isArray(I)&&I.length!==P.length)C.error(`Expected ${I.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){let F=Array.isArray(I)?I[L]:I.type,j=P[L];C.concat(L+1).checkSubtype(F,j.type)}if(C.errors.length===0)return new Yr(d,y,D,P)}}if(b.length===1)a.errors.push(...C.errors);else{let I=(b.length?b:_).map(([P])=>{return k=P,Array.isArray(k)?`(${k.map(hn).join(", ")})`:`(${hn(k.type)}...)`;var k}).join(" | "),D=[];for(let P=1;P<n.length;P++){let k=a.parse(n[P],1+D.length);if(!k)return null;D.push(hn(k.type))}a.error(`Expected arguments of type ${I}, but found (${D.join(", ")}) instead.`)}return null}static register(n,a){Yr.definitions=a;for(let d in a)n[d]=Yr}}function rp(l,[n,a,d,p]){n=n.evaluate(l),a=a.evaluate(l),d=d.evaluate(l);let y=p?p.evaluate(l):1,_=md(n,a,d,y);if(_)throw new vn(_);return new Dt(n/255,a/255,d/255,y,!1)}function ip(l,n){return l in n}function Fd(l,n){let a=n[l];return a===void 0?null:a}function vs(l){return{type:l}}function bc(l){if(l instanceof vt)return bc(l.boundExpression);if(l instanceof Yr&&l.name==="error"||l instanceof ms||l instanceof So||l instanceof _s)return!1;let n=l instanceof Ji||l instanceof Wr,a=!0;return l.eachChild(d=>{a=n?a&&bc(d):a&&d instanceof Fi}),!!a&&xc(l)&&wc(l,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function xc(l){if(l instanceof Yr&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof So||l instanceof _s)return!1;let n=!0;return l.eachChild(a=>{n&&!xc(a)&&(n=!1)}),n}function ll(l){if(l instanceof Yr&&l.name==="feature-state")return!1;let n=!0;return l.eachChild(a=>{n&&!ll(a)&&(n=!1)}),n}function wc(l,n){if(l instanceof Yr&&n.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(d=>{a&&!wc(d,n)&&(a=!1)}),a}function op(l){return{result:"success",value:l}}function ta(l){return{result:"error",value:l}}function na(l){return l["property-type"]==="data-driven"||l["property-type"]==="cross-faded-data-driven"}function sp(l){return!!l.expression&&l.expression.parameters.indexOf("zoom")>-1}function zd(l){return!!l.expression&&l.expression.interpolated}function jt(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}function Cc(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function t_(l){return l}function ap(l,n){let a=n.type==="color",d=l.stops&&typeof l.stops[0][0]=="object",p=d||!(d||l.property!==void 0),y=l.type||(zd(n)?"exponential":"interval");if(a||n.type==="padding"){let D=a?Dt.parse:Un.parse;(l=$e({},l)).stops&&(l.stops=l.stops.map(P=>[P[0],D(P[1])])),l.default=D(l.default?l.default:n.default)}if(l.colorSpace&&(_=l.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${l.colorSpace}"`);var _;let b,C,I;if(y==="exponential")b=lp;else if(y==="interval")b=n_;else if(y==="categorical"){b=Bd,C=Object.create(null);for(let D of l.stops)C[D[0]]=D[1];I=typeof l.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);b=r_}if(d){let D={},P=[];for(let F=0;F<l.stops.length;F++){let j=l.stops[F],Z=j[0].zoom;D[Z]===void 0&&(D[Z]={zoom:Z,type:l.type,property:l.property,default:l.default,stops:[]},P.push(Z)),D[Z].stops.push([j[0].value,j[1]])}let k=[];for(let F of P)k.push([D[F].zoom,ap(D[F],n)]);let L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:nn.interpolationFactor.bind(void 0,L),zoomStops:k.map(F=>F[0]),evaluate:({zoom:F},j)=>lp({stops:k,base:l.base},n,F).evaluate(F,j)}}if(p){let D=y==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:nn.interpolationFactor.bind(void 0,D),zoomStops:l.stops.map(P=>P[0]),evaluate:({zoom:P})=>b(l,n,P,C,I)}}return{kind:"source",evaluate(D,P){let k=P&&P.properties?P.properties[l.property]:void 0;return k===void 0?cl(l.default,n.default):b(l,n,k,C,I)}}}function cl(l,n,a){return l!==void 0?l:n!==void 0?n:a!==void 0?a:void 0}function Bd(l,n,a,d,p){return cl(typeof a===p?d[a]:void 0,l.default,n.default)}function n_(l,n,a){if(jt(a)!=="number")return cl(l.default,n.default);let d=l.stops.length;if(d===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[d-1][0])return l.stops[d-1][1];let p=tl(l.stops.map(y=>y[0]),a);return l.stops[p][1]}function lp(l,n,a){let d=l.base!==void 0?l.base:1;if(jt(a)!=="number")return cl(l.default,n.default);let p=l.stops.length;if(p===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[p-1][0])return l.stops[p-1][1];let y=tl(l.stops.map(D=>D[0]),a),_=function(D,P,k,L){let F=L-k,j=D-k;return F===0?0:P===1?j/F:(Math.pow(P,j)-1)/(Math.pow(P,F)-1)}(a,d,l.stops[y][0],l.stops[y+1][0]),b=l.stops[y][1],C=l.stops[y+1][1],I=gi[n.type]||t_;return typeof b.evaluate=="function"?{evaluate(...D){let P=b.evaluate.apply(void 0,D),k=C.evaluate.apply(void 0,D);if(P!==void 0&&k!==void 0)return I(P,k,_,l.colorSpace)}}:I(b,C,_,l.colorSpace)}function r_(l,n,a){switch(n.type){case"color":a=Dt.parse(a);break;case"formatted":a=In.fromString(a.toString());break;case"resolvedImage":a=pr.fromString(a.toString());break;case"padding":a=Un.parse(a);break;default:jt(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0)}return cl(a,l.default,n.default)}Yr.register(ea,{error:[{kind:"error"},[He],(l,[n])=>{throw new vn(n.evaluate(l))}],typeof:[He,[Xe],(l,[n])=>hn(ln(n.evaluate(l)))],"to-rgba":[Nr(Ae,4),[Et],(l,[n])=>{let[a,d,p,y]=n.evaluate(l).rgb;return[255*a,255*d,255*p,y]}],rgb:[Et,[Ae,Ae,Ae],rp],rgba:[Et,[Ae,Ae,Ae,Ae],rp],has:{type:Qe,overloads:[[[He],(l,[n])=>ip(n.evaluate(l),l.properties())],[[He,ut],(l,[n,a])=>ip(n.evaluate(l),a.evaluate(l))]]},get:{type:Xe,overloads:[[[He],(l,[n])=>Fd(n.evaluate(l),l.properties())],[[He,ut],(l,[n,a])=>Fd(n.evaluate(l),a.evaluate(l))]]},"feature-state":[Xe,[He],(l,[n])=>Fd(n.evaluate(l),l.featureState||{})],properties:[ut,[],l=>l.properties()],"geometry-type":[He,[],l=>l.geometryType()],id:[Xe,[],l=>l.id()],zoom:[Ae,[],l=>l.globals.zoom],"heatmap-density":[Ae,[],l=>l.globals.heatmapDensity||0],"line-progress":[Ae,[],l=>l.globals.lineProgress||0],accumulated:[Xe,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[Ae,vs(Ae),(l,n)=>{let a=0;for(let d of n)a+=d.evaluate(l);return a}],"*":[Ae,vs(Ae),(l,n)=>{let a=1;for(let d of n)a*=d.evaluate(l);return a}],"-":{type:Ae,overloads:[[[Ae,Ae],(l,[n,a])=>n.evaluate(l)-a.evaluate(l)],[[Ae],(l,[n])=>-n.evaluate(l)]]},"/":[Ae,[Ae,Ae],(l,[n,a])=>n.evaluate(l)/a.evaluate(l)],"%":[Ae,[Ae,Ae],(l,[n,a])=>n.evaluate(l)%a.evaluate(l)],ln2:[Ae,[],()=>Math.LN2],pi:[Ae,[],()=>Math.PI],e:[Ae,[],()=>Math.E],"^":[Ae,[Ae,Ae],(l,[n,a])=>Math.pow(n.evaluate(l),a.evaluate(l))],sqrt:[Ae,[Ae],(l,[n])=>Math.sqrt(n.evaluate(l))],log10:[Ae,[Ae],(l,[n])=>Math.log(n.evaluate(l))/Math.LN10],ln:[Ae,[Ae],(l,[n])=>Math.log(n.evaluate(l))],log2:[Ae,[Ae],(l,[n])=>Math.log(n.evaluate(l))/Math.LN2],sin:[Ae,[Ae],(l,[n])=>Math.sin(n.evaluate(l))],cos:[Ae,[Ae],(l,[n])=>Math.cos(n.evaluate(l))],tan:[Ae,[Ae],(l,[n])=>Math.tan(n.evaluate(l))],asin:[Ae,[Ae],(l,[n])=>Math.asin(n.evaluate(l))],acos:[Ae,[Ae],(l,[n])=>Math.acos(n.evaluate(l))],atan:[Ae,[Ae],(l,[n])=>Math.atan(n.evaluate(l))],min:[Ae,vs(Ae),(l,n)=>Math.min(...n.map(a=>a.evaluate(l)))],max:[Ae,vs(Ae),(l,n)=>Math.max(...n.map(a=>a.evaluate(l)))],abs:[Ae,[Ae],(l,[n])=>Math.abs(n.evaluate(l))],round:[Ae,[Ae],(l,[n])=>{let a=n.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[Ae,[Ae],(l,[n])=>Math.floor(n.evaluate(l))],ceil:[Ae,[Ae],(l,[n])=>Math.ceil(n.evaluate(l))],"filter-==":[Qe,[He,Xe],(l,[n,a])=>l.properties()[n.value]===a.value],"filter-id-==":[Qe,[Xe],(l,[n])=>l.id()===n.value],"filter-type-==":[Qe,[He],(l,[n])=>l.geometryType()===n.value],"filter-<":[Qe,[He,Xe],(l,[n,a])=>{let d=l.properties()[n.value],p=a.value;return typeof d==typeof p&&d<p}],"filter-id-<":[Qe,[Xe],(l,[n])=>{let a=l.id(),d=n.value;return typeof a==typeof d&&a<d}],"filter->":[Qe,[He,Xe],(l,[n,a])=>{let d=l.properties()[n.value],p=a.value;return typeof d==typeof p&&d>p}],"filter-id->":[Qe,[Xe],(l,[n])=>{let a=l.id(),d=n.value;return typeof a==typeof d&&a>d}],"filter-<=":[Qe,[He,Xe],(l,[n,a])=>{let d=l.properties()[n.value],p=a.value;return typeof d==typeof p&&d<=p}],"filter-id-<=":[Qe,[Xe],(l,[n])=>{let a=l.id(),d=n.value;return typeof a==typeof d&&a<=d}],"filter->=":[Qe,[He,Xe],(l,[n,a])=>{let d=l.properties()[n.value],p=a.value;return typeof d==typeof p&&d>=p}],"filter-id->=":[Qe,[Xe],(l,[n])=>{let a=l.id(),d=n.value;return typeof a==typeof d&&a>=d}],"filter-has":[Qe,[Xe],(l,[n])=>n.value in l.properties()],"filter-has-id":[Qe,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[Qe,[Nr(He)],(l,[n])=>n.value.indexOf(l.geometryType())>=0],"filter-id-in":[Qe,[Nr(Xe)],(l,[n])=>n.value.indexOf(l.id())>=0],"filter-in-small":[Qe,[He,Nr(Xe)],(l,[n,a])=>a.value.indexOf(l.properties()[n.value])>=0],"filter-in-large":[Qe,[He,Nr(Xe)],(l,[n,a])=>function(d,p,y,_){for(;y<=_;){let b=y+_>>1;if(p[b]===d)return!0;p[b]>d?_=b-1:y=b+1}return!1}(l.properties()[n.value],a.value,0,a.value.length-1)],all:{type:Qe,overloads:[[[Qe,Qe],(l,[n,a])=>n.evaluate(l)&&a.evaluate(l)],[vs(Qe),(l,n)=>{for(let a of n)if(!a.evaluate(l))return!1;return!0}]]},any:{type:Qe,overloads:[[[Qe,Qe],(l,[n,a])=>n.evaluate(l)||a.evaluate(l)],[vs(Qe),(l,n)=>{for(let a of n)if(a.evaluate(l))return!0;return!1}]]},"!":[Qe,[Qe],(l,[n])=>!n.evaluate(l)],"is-supported-script":[Qe,[He],(l,[n])=>{let a=l.globals&&l.globals.isSupportedScript;return!a||a(n.evaluate(l))}],upcase:[He,[He],(l,[n])=>n.evaluate(l).toUpperCase()],downcase:[He,[He],(l,[n])=>n.evaluate(l).toLowerCase()],concat:[He,vs(Xe),(l,n)=>n.map(a=>Ka(a.evaluate(l))).join("")],"resolved-locale":[He,[Cn],(l,[n])=>n.evaluate(l).resolvedLocale()]});class Ec{constructor(n,a){var d;this.expression=n,this._warningHistory={},this._evaluator=new cn,this._defaultValue=a?(d=a).type==="color"&&Cc(d.default)?new Dt(0,0,0,0):d.type==="color"?Dt.parse(d.default)||null:d.type==="padding"?Un.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?fr.parse(d.default)||null:d.type==="projectionDefinition"?mr.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(n,a,d,p,y,_){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=d,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(n,a,d,p,y,_){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=d||null,this._evaluator.canonical=p,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=_||null;try{let b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new vn(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(b.message)),this._defaultValue}}}function Ic(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in ea}function Tc(l,n){let a=new Ys(ea,bc,[],n?function(p){let y={color:Et,string:He,number:Ae,enum:He,boolean:Qe,formatted:Mo,padding:Vn,projectionDefinition:Ft,resolvedImage:On,variableAnchorOffsetCollection:dn};return p.type==="array"?Nr(y[p.value]||Xe,p.length):y[p.type]}(n):void 0),d=a.parse(l,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?op(new Ec(d,n)):ta(a.errors)}class ra{constructor(n,a){this.kind=n,this._styleExpression=a,this.isStateDependent=n!=="constant"&&!ll(a.expression)}evaluateWithoutErrorHandling(n,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,p,y,_)}evaluate(n,a,d,p,y,_){return this._styleExpression.evaluate(n,a,d,p,y,_)}}class Mc{constructor(n,a,d,p){this.kind=n,this.zoomStops=d,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!ll(a.expression),this.interpolationType=p}evaluateWithoutErrorHandling(n,a,d,p,y,_){return this._styleExpression.evaluateWithoutErrorHandling(n,a,d,p,y,_)}evaluate(n,a,d,p,y,_){return this._styleExpression.evaluate(n,a,d,p,y,_)}interpolationFactor(n,a,d){return this.interpolationType?nn.interpolationFactor(this.interpolationType,n,a,d):0}}function cp(l,n){let a=Tc(l,n);if(a.result==="error")return a;let d=a.value.expression,p=xc(d);if(!p&&!na(n))return ta([new Ve("","data expressions not supported")]);let y=wc(d,["zoom"]);if(!y&&!sp(n))return ta([new Ve("","zoom expressions not supported")]);let _=Sc(d);return _||y?_ instanceof Ve?ta([_]):_ instanceof nn&&!zd(n)?ta([new Ve("",'"interpolate" expressions cannot be used with this property')]):op(_?new Mc(p?"camera":"composite",a.value,_.labels,_ instanceof nn?_.interpolation:void 0):new ra(p?"constant":"source",a.value)):ta([new Ve("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Dc{constructor(n,a){this._parameters=n,this._specification=a,$e(this,ap(this._parameters,this._specification))}static deserialize(n){return new Dc(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Sc(l){let n=null;if(l instanceof Ot)n=Sc(l.result);else if(l instanceof ps){for(let a of l.args)if(n=Sc(a),n)break}else(l instanceof fs||l instanceof nn)&&l.input instanceof Yr&&l.input.name==="zoom"&&(n=l);return n instanceof Ve||l.eachChild(a=>{let d=Sc(a);d instanceof Ve?n=d:!n&&d?n=new Ve("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&d&&n!==d&&(n=new Ve("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function jd(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(let n of l.slice(1))if(!jd(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}let i_={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Pc(l){if(l==null)return{filter:()=>!0,needGeometry:!1};jd(l)||(l=Ac(l));let n=Tc(l,i_);if(n.result==="error")throw new Error(n.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,d,p)=>n.value.evaluate(a,d,{},p),needGeometry:dp(l)}}function up(l,n){return l<n?-1:l>n?1:0}function dp(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let n=1;n<l.length;n++)if(dp(l[n]))return!0;return!1}function Ac(l){if(!l)return!0;let n=l[0];return l.length<=1?n!=="any":n==="=="?Rc(l[1],l[2],"=="):n==="!="?ul(Rc(l[1],l[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Rc(l[1],l[2],n):n==="any"?(a=l.slice(1),["any"].concat(a.map(Ac))):n==="all"?["all"].concat(l.slice(1).map(Ac)):n==="none"?["all"].concat(l.slice(1).map(Ac).map(ul)):n==="in"?Vd(l[1],l.slice(2)):n==="!in"?ul(Vd(l[1],l.slice(2))):n==="has"?Ud(l[1]):n!=="!has"||ul(Ud(l[1]));var a}function Rc(l,n,a){switch(l){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,l,n]}}function Vd(l,n){if(n.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",l,["literal",n.sort(up)]]:["filter-in-small",l,["literal",n]]}}function Ud(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function ul(l){return["!",l]}function dl(l){let n=typeof l;if(n==="number"||n==="boolean"||n==="string"||l==null)return JSON.stringify(l);if(Array.isArray(l)){let p="[";for(let y of l)p+=`${dl(y)},`;return`${p}]`}let a=Object.keys(l).sort(),d="{";for(let p=0;p<a.length;p++)d+=`${JSON.stringify(a[p])}:${dl(l[a[p]])},`;return`${d}}`}function $d(l){let n="";for(let a of V)n+=`/${dl(l[a])}`;return n}function kc(l){let n=l.value;return n?[new de(l.key,n,"constants have been deprecated as of v8")]:[]}function fn(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function bs(l){if(Array.isArray(l))return l.map(bs);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){let n={};for(let a in l)n[a]=bs(l[a]);return n}return fn(l)}function Kr(l){let n=l.key,a=l.value,d=l.valueSpec||{},p=l.objectElementValidators||{},y=l.style,_=l.styleSpec,b=l.validateSpec,C=[],I=jt(a);if(I!=="object")return[new de(n,a,`object expected, ${I} found`)];for(let D in a){let P=D.split(".")[0],k=d[P]||d["*"],L;if(p[P])L=p[P];else if(d[P])L=b;else if(p["*"])L=p["*"];else{if(!d["*"]){C.push(new de(n,a[D],`unknown property "${D}"`));continue}L=b}C=C.concat(L({key:(n&&`${n}.`)+D,value:a[D],valueSpec:k,style:y,styleSpec:_,object:a,objectKey:D,validateSpec:b},a))}for(let D in d)p[D]||d[D].required&&d[D].default===void 0&&a[D]===void 0&&C.push(new de(n,a,`missing required property "${D}"`));return C}function Hd(l){let n=l.value,a=l.valueSpec,d=l.style,p=l.styleSpec,y=l.key,_=l.arrayElementValidator||l.validateSpec;if(jt(n)!=="array")return[new de(y,n,`array expected, ${jt(n)} found`)];if(a.length&&n.length!==a.length)return[new de(y,n,`array length ${a.length} expected, length ${n.length} found`)];if(a["min-length"]&&n.length<a["min-length"])return[new de(y,n,`array length at least ${a["min-length"]} expected, length ${n.length} found`)];let b={type:a.value,values:a.values};p.$version<7&&(b.function=a.function),jt(a.value)==="object"&&(b=a.value);let C=[];for(let I=0;I<n.length;I++)C=C.concat(_({array:n,arrayIndex:I,value:n[I],valueSpec:b,validateSpec:l.validateSpec,style:d,styleSpec:p,key:`${y}[${I}]`}));return C}function Gd(l){let n=l.key,a=l.value,d=l.valueSpec,p=jt(a);return p==="number"&&a!=a&&(p="NaN"),p!=="number"?[new de(n,a,`number expected, ${p} found`)]:"minimum"in d&&a<d.minimum?[new de(n,a,`${a} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&a>d.maximum?[new de(n,a,`${a} is greater than the maximum value ${d.maximum}`)]:[]}function hp(l){let n=l.valueSpec,a=fn(l.value.type),d,p,y,_={},b=a!=="categorical"&&l.value.property===void 0,C=!b,I=jt(l.value.stops)==="array"&&jt(l.value.stops[0])==="array"&&jt(l.value.stops[0][0])==="object",D=Kr({key:l.key,value:l.value,valueSpec:l.styleSpec.function,validateSpec:l.validateSpec,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(L){if(a==="identity")return[new de(L.key,L.value,'identity function may not have a "stops" property')];let F=[],j=L.value;return F=F.concat(Hd({key:L.key,value:j,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),jt(j)==="array"&&j.length===0&&F.push(new de(L.key,j,"array must have at least one stop")),F},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:n,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return a==="identity"&&b&&D.push(new de(l.key,l.value,'missing required property "property"')),a==="identity"||l.value.stops||D.push(new de(l.key,l.value,'missing required property "stops"')),a==="exponential"&&l.valueSpec.expression&&!zd(l.valueSpec)&&D.push(new de(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(C&&!na(l.valueSpec)?D.push(new de(l.key,l.value,"property functions not supported")):b&&!sp(l.valueSpec)&&D.push(new de(l.key,l.value,"zoom functions not supported"))),a!=="categorical"&&!I||l.value.property!==void 0||D.push(new de(l.key,l.value,'"property" property is required')),D;function P(L){let F=[],j=L.value,Z=L.key;if(jt(j)!=="array")return[new de(Z,j,`array expected, ${jt(j)} found`)];if(j.length!==2)return[new de(Z,j,`array length 2 expected, length ${j.length} found`)];if(I){if(jt(j[0])!=="object")return[new de(Z,j,`object expected, ${jt(j[0])} found`)];if(j[0].zoom===void 0)return[new de(Z,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new de(Z,j,"object stop key must have value")];if(y&&y>fn(j[0].zoom))return[new de(Z,j[0].zoom,"stop zoom values must appear in ascending order")];fn(j[0].zoom)!==y&&(y=fn(j[0].zoom),p=void 0,_={}),F=F.concat(Kr({key:`${Z}[0]`,value:j[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Gd,value:k}}))}else F=F.concat(k({key:`${Z}[0]`,value:j[0],valueSpec:{},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},j));return Ic(bs(j[1]))?F.concat([new de(`${Z}[1]`,j[1],"expressions are not allowed in function stops.")]):F.concat(L.validateSpec({key:`${Z}[1]`,value:j[1],valueSpec:n,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function k(L,F){let j=jt(L.value),Z=fn(L.value),J=L.value!==null?L.value:F;if(d){if(j!==d)return[new de(L.key,J,`${j} stop domain type must match previous stop domain type ${d}`)]}else d=j;if(j!=="number"&&j!=="string"&&j!=="boolean")return[new de(L.key,J,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&a!=="categorical"){let ue=`number expected, ${j} found`;return na(n)&&a===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new de(L.key,J,ue)]}return a!=="categorical"||j!=="number"||isFinite(Z)&&Math.floor(Z)===Z?a!=="categorical"&&j==="number"&&p!==void 0&&Z<p?[new de(L.key,J,"stop domain values must appear in ascending order")]:(p=Z,a==="categorical"&&Z in _?[new de(L.key,J,"stop domain values must be unique")]:(_[Z]=!0,[])):[new de(L.key,J,`integer expected, found ${Z}`)]}}function ia(l){let n=(l.expressionContext==="property"?cp:Tc)(bs(l.value),l.valueSpec);if(n.result==="error")return n.value.map(d=>new de(`${l.key}${d.key}`,l.value,d.message));let a=n.value.expression||n.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!a.outputDefined())return[new de(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!ll(a))return[new de(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter"&&!ll(a))return[new de(l.key,l.value,'"feature-state" data expressions are not supported with filters.')];if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!wc(a,["zoom","feature-state"]))return[new de(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!xc(a))return[new de(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function oa(l){let n=l.key,a=l.value,d=l.valueSpec,p=[];return Array.isArray(d.values)?d.values.indexOf(fn(a))===-1&&p.push(new de(n,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(fn(a))===-1&&p.push(new de(n,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),p}function Oc(l){return jd(bs(l.value))?ia($e({},l,{expressionContext:"filter",valueSpec:{value:"boolean"}})):hl(l)}function hl(l){let n=l.value,a=l.key;if(jt(n)!=="array")return[new de(a,n,`array expected, ${jt(n)} found`)];let d=l.styleSpec,p,y=[];if(n.length<1)return[new de(a,n,"filter array must have at least 1 element")];switch(y=y.concat(oa({key:`${a}[0]`,value:n[0],valueSpec:d.filter_operator,style:l.style,styleSpec:l.styleSpec})),fn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&fn(n[1])==="$type"&&y.push(new de(a,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&y.push(new de(a,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(p=jt(n[1]),p!=="string"&&y.push(new de(`${a}[1]`,n[1],`string expected, ${p} found`)));for(let _=2;_<n.length;_++)p=jt(n[_]),fn(n[1])==="$type"?y=y.concat(oa({key:`${a}[${_}]`,value:n[_],valueSpec:d.geometry_type,style:l.style,styleSpec:l.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&y.push(new de(`${a}[${_}]`,n[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)y=y.concat(hl({key:`${a}[${_}]`,value:n[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":p=jt(n[1]),n.length!==2?y.push(new de(a,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="string"&&y.push(new de(`${a}[1]`,n[1],`string expected, ${p} found`))}return y}function fp(l,n){let a=l.key,d=l.validateSpec,p=l.style,y=l.styleSpec,_=l.value,b=l.objectKey,C=y[`${n}_${l.layerType}`];if(!C)return[];let I=b.match(/^(.*)-transition$/);if(n==="paint"&&I&&C[I[1]]&&C[I[1]].transition)return d({key:a,value:_,valueSpec:y.transition,style:p,styleSpec:y});let D=l.valueSpec||C[b];if(!D)return[new de(a,_,`unknown property "${b}"`)];let P;if(jt(_)==="string"&&na(D)&&!D.tokens&&(P=/^{([^}]+)}$/.exec(_)))return[new de(a,_,`"${b}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];let k=[];return l.layerType==="symbol"&&(b==="text-field"&&p&&!p.glyphs&&k.push(new de(a,_,'use of "text-field" requires a style "glyphs" property')),b==="text-font"&&Cc(bs(_))&&fn(_.type)==="identity"&&k.push(new de(a,_,'"text-font" does not support identity functions'))),k.concat(d({key:l.key,value:_,valueSpec:D,style:p,styleSpec:y,expressionContext:"property",propertyType:n,propertyKey:b}))}function qd(l){return fp(l,"paint")}function Zd(l){return fp(l,"layout")}function pp(l){let n=[],a=l.value,d=l.key,p=l.style,y=l.styleSpec;a.type||a.ref||n.push(new de(d,a,'either "type" or "ref" is required'));let _=fn(a.type),b=fn(a.ref);if(a.id){let C=fn(a.id);for(let I=0;I<l.arrayIndex;I++){let D=p.layers[I];fn(D.id)===C&&n.push(new de(d,a.id,`duplicate layer id "${a.id}", previously used at line ${D.id.__line__}`))}}if("ref"in a){let C;["type","source","source-layer","filter","layout"].forEach(I=>{I in a&&n.push(new de(d,a[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{fn(I.id)===b&&(C=I)}),C?C.ref?n.push(new de(d,a.ref,"ref cannot reference another ref layer")):_=fn(C.type):n.push(new de(d,a.ref,`ref layer "${b}" not found`))}else if(_!=="background")if(a.source){let C=p.sources&&p.sources[a.source],I=C&&fn(C.type);C?I==="vector"&&_==="raster"?n.push(new de(d,a.source,`layer "${a.id}" requires a raster source`)):I!=="raster-dem"&&_==="hillshade"?n.push(new de(d,a.source,`layer "${a.id}" requires a raster-dem source`)):I==="raster"&&_!=="raster"?n.push(new de(d,a.source,`layer "${a.id}" requires a vector source`)):I!=="vector"||a["source-layer"]?I==="raster-dem"&&_!=="hillshade"?n.push(new de(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!a.paint||!a.paint["line-gradient"]||I==="geojson"&&C.lineMetrics||n.push(new de(d,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new de(d,a,`layer "${a.id}" must specify a "source-layer"`)):n.push(new de(d,a.source,`source "${a.source}" not found`))}else n.push(new de(d,a,'missing required property "source"'));return n=n.concat(Kr({key:d,value:a,valueSpec:y.layer,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,objectElementValidators:{"*":()=>[],type:()=>l.validateSpec({key:`${d}.type`,value:a.type,valueSpec:y.layer.type,style:l.style,styleSpec:l.styleSpec,validateSpec:l.validateSpec,object:a,objectKey:"type"}),filter:Oc,layout:C=>Kr({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":I=>Zd($e({layerType:_},I))}}),paint:C=>Kr({layer:a,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*":I=>qd($e({layerType:_},I))}})}})),n}function Po(l){let n=l.value,a=l.key,d=jt(n);return d!=="string"?[new de(a,n,`string expected, ${d} found`)]:[]}let Wd={promoteId:function({key:l,value:n}){if(jt(n)==="string")return Po({key:l,value:n});{let a=[];for(let d in n)a.push(...Po({key:`${l}.${d}`,value:n[d]}));return a}}};function sa(l){let n=l.value,a=l.key,d=l.styleSpec,p=l.style,y=l.validateSpec;if(!n.type)return[new de(a,n,'"type" is required')];let _=fn(n.type),b;switch(_){case"vector":case"raster":return b=Kr({key:a,value:n,valueSpec:d[`source_${_.replace("-","_")}`],style:l.style,styleSpec:d,objectElementValidators:Wd,validateSpec:y}),b;case"raster-dem":return b=function(C){var I;let D=(I=C.sourceName)!==null&&I!==void 0?I:"",P=C.value,k=C.styleSpec,L=k.source_raster_dem,F=C.style,j=[],Z=jt(P);if(P===void 0)return j;if(Z!=="object")return j.push(new de("source_raster_dem",P,`object expected, ${Z} found`)),j;let J=fn(P.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],ne=C.value.encoding?`"${C.value.encoding}"`:"Default";for(let N in P)!J&&ue.includes(N)?j.push(new de(N,P[N],`In "${D}": "${N}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):L[N]?j=j.concat(C.validateSpec({key:N,value:P[N],valueSpec:L[N],validateSpec:C.validateSpec,style:F,styleSpec:k})):j.push(new de(N,P[N],`unknown property "${N}"`));return j}({sourceName:a,value:n,style:l.style,styleSpec:d,validateSpec:y}),b;case"geojson":if(b=Kr({key:a,value:n,valueSpec:d.source_geojson,style:p,styleSpec:d,validateSpec:y,objectElementValidators:Wd}),n.cluster)for(let C in n.clusterProperties){let[I,D]=n.clusterProperties[C],P=typeof I=="string"?[I,["accumulated"],["get",C]]:I;b.push(...ia({key:`${a}.${C}.map`,value:D,validateSpec:y,expressionContext:"cluster-map"})),b.push(...ia({key:`${a}.${C}.reduce`,value:P,validateSpec:y,expressionContext:"cluster-reduce"}))}return b;case"video":return Kr({key:a,value:n,valueSpec:d.source_video,style:p,validateSpec:y,styleSpec:d});case"image":return Kr({key:a,value:n,valueSpec:d.source_image,style:p,validateSpec:y,styleSpec:d});case"canvas":return[new de(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oa({key:`${a}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,validateSpec:y,styleSpec:d})}}function mp(l){let n=l.value,a=l.styleSpec,d=a.light,p=l.style,y=[],_=jt(n);if(n===void 0)return y;if(_!=="object")return y=y.concat([new de("light",n,`object expected, ${_} found`)]),y;for(let b in n){let C=b.match(/^(.*)-transition$/);y=y.concat(C&&d[C[1]]&&d[C[1]].transition?l.validateSpec({key:b,value:n[b],valueSpec:a.transition,validateSpec:l.validateSpec,style:p,styleSpec:a}):d[b]?l.validateSpec({key:b,value:n[b],valueSpec:d[b],validateSpec:l.validateSpec,style:p,styleSpec:a}):[new de(b,n[b],`unknown property "${b}"`)])}return y}function gp(l){let n=l.value,a=l.styleSpec,d=a.sky,p=l.style,y=jt(n);if(n===void 0)return[];if(y!=="object")return[new de("sky",n,`object expected, ${y} found`)];let _=[];for(let b in n)_=_.concat(d[b]?l.validateSpec({key:b,value:n[b],valueSpec:d[b],style:p,styleSpec:a}):[new de(b,n[b],`unknown property "${b}"`)]);return _}function yp(l){let n=l.value,a=l.styleSpec,d=a.terrain,p=l.style,y=[],_=jt(n);if(n===void 0)return y;if(_!=="object")return y=y.concat([new de("terrain",n,`object expected, ${_} found`)]),y;for(let b in n)y=y.concat(d[b]?l.validateSpec({key:b,value:n[b],valueSpec:d[b],validateSpec:l.validateSpec,style:p,styleSpec:a}):[new de(b,n[b],`unknown property "${b}"`)]);return y}function _p(l){let n=[],a=l.value,d=l.key;if(Array.isArray(a)){let p=[],y=[];for(let _ in a)a[_].id&&p.includes(a[_].id)&&n.push(new de(d,a,`all the sprites' ids must be unique, but ${a[_].id} is duplicated`)),p.push(a[_].id),a[_].url&&y.includes(a[_].url)&&n.push(new de(d,a,`all the sprites' URLs must be unique, but ${a[_].url} is duplicated`)),y.push(a[_].url),n=n.concat(Kr({key:`${d}[${_}]`,value:a[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:l.validateSpec}));return n}return Po({key:d,value:a})}let vp={"*":()=>[],array:Hd,boolean:function(l){let n=l.value,a=l.key,d=jt(n);return d!=="boolean"?[new de(a,n,`boolean expected, ${d} found`)]:[]},number:Gd,color:function(l){let n=l.key,a=l.value,d=jt(a);return d!=="string"?[new de(n,a,`color expected, ${d} found`)]:Dt.parse(String(a))?[]:[new de(n,a,`color expected, "${a}" found`)]},constants:kc,enum:oa,filter:Oc,function:hp,layer:pp,object:Kr,source:sa,light:mp,sky:gp,terrain:yp,projection:function(l){let n=l.value,a=l.styleSpec,d=a.projection,p=l.style,y=jt(n);if(n===void 0)return[];if(y!=="object")return[new de("projection",n,`object expected, ${y} found`)];let _=[];for(let b in n)_=_.concat(d[b]?l.validateSpec({key:b,value:n[b],valueSpec:d[b],style:p,styleSpec:a}):[new de(b,n[b],`unknown property "${b}"`)]);return _},projectionDefinition:function(l){let n=l.key,a=l.value;a=a instanceof String?a.valueOf():a;let d=jt(a);return d!=="array"||function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"}(a)||function(p){return!!["interpolate","step","literal"].includes(p[0])}(a)?["array","string"].includes(d)?[]:[new de(n,a,`projection expected, invalid type "${d}" found`)]:[new de(n,a,`projection expected, invalid array ${JSON.stringify(a)} found`)]},string:Po,formatted:function(l){return Po(l).length===0?[]:ia(l)},resolvedImage:function(l){return Po(l).length===0?[]:ia(l)},padding:function(l){let n=l.key,a=l.value;if(jt(a)==="array"){if(a.length<1||a.length>4)return[new de(n,a,`padding requires 1 to 4 values; ${a.length} values found`)];let d={type:"number"},p=[];for(let y=0;y<a.length;y++)p=p.concat(l.validateSpec({key:`${n}[${y}]`,value:a[y],validateSpec:l.validateSpec,valueSpec:d}));return p}return Gd({key:n,value:a,valueSpec:{}})},variableAnchorOffsetCollection:function(l){let n=l.key,a=l.value,d=jt(a),p=l.styleSpec;if(d!=="array"||a.length<1||a.length%2!=0)return[new de(n,a,"variableAnchorOffsetCollection requires a non-empty array of even length")];let y=[];for(let _=0;_<a.length;_+=2)y=y.concat(oa({key:`${n}[${_}]`,value:a[_],valueSpec:p.layout_symbol["text-anchor"]})),y=y.concat(Hd({key:`${n}[${_+1}]`,value:a[_+1],valueSpec:{length:2,value:"number"},validateSpec:l.validateSpec,style:l.style,styleSpec:p}));return y},sprite:_p};function fl(l){let n=l.value,a=l.valueSpec,d=l.styleSpec;return l.validateSpec=fl,a.expression&&Cc(fn(n))?hp(l):a.expression&&Ic(bs(n))?ia(l):a.type&&vp[a.type]?vp[a.type](l):Kr($e({},l,{valueSpec:a.type?d[a.type]:a}))}function aa(l){let n=l.value,a=l.key,d=Po(l);return d.length||(n.indexOf("{fontstack}")===-1&&d.push(new de(a,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&d.push(new de(a,n,'"glyphs" url must include a "{range}" token'))),d}function Cr(l,n=X){let a=[];return a=a.concat(fl({key:"",value:l,valueSpec:n.$root,styleSpec:n,style:l,validateSpec:fl,objectElementValidators:{glyphs:aa,"*":()=>[]}})),l.constants&&(a=a.concat(kc({key:"constants",value:l.constants,style:l,styleSpec:n,validateSpec:fl}))),la(a)}function Tn(l){return function(n){return l(wn(et({},n),{validateSpec:fl}))}}function la(l){return[].concat(l).sort((n,a)=>n.line-a.line)}function yi(l){return function(...n){return la(l.apply(this,n))}}Cr.source=yi(Tn(sa)),Cr.sprite=yi(Tn(_p)),Cr.glyphs=yi(Tn(aa)),Cr.light=yi(Tn(mp)),Cr.sky=yi(Tn(gp)),Cr.terrain=yi(Tn(yp)),Cr.layer=yi(Tn(pp)),Cr.filter=yi(Tn(Oc)),Cr.paintProperty=yi(Tn(qd)),Cr.layoutProperty=yi(Tn(Zd));let ca=Cr,o_=ca.light,pl=ca.sky,bp=ca.paintProperty,Xd=ca.layoutProperty;function xp(l,n){let a=!1;if(n&&n.length)for(let d of n)l.fire(new Wa(new Error(d.message))),a=!0;return a}class xs{constructor(n,a,d){let p=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;let _=new Int32Array(this.arrayBuffer);n=_[0],this.d=(a=_[1])+2*(d=_[2]);for(let C=0;C<this.d*this.d;C++){let I=_[3+C],D=_[3+C+1];p.push(I===D?null:_.subarray(I,D))}let b=_[3+p.length+1];this.keys=_.subarray(_[3+p.length],b),this.bboxes=_.subarray(b),this.insert=this._insertReadonly}else{this.d=a+2*d;for(let _=0;_<this.d*this.d;_++)p.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=d,this.scale=a/n,this.uid=0;let y=d/a*n;this.min=-y,this.max=n+y}insert(n,a,d,p,y){this._forEachCell(a,d,p,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,a,d,p,y,_){this.cells[y].push(_)}query(n,a,d,p,y){let _=this.min,b=this.max;if(n<=_&&a<=_&&b<=d&&b<=p&&!y)return Array.prototype.slice.call(this.keys);{let C=[];return this._forEachCell(n,a,d,p,this._queryCell,C,{},y),C}}_queryCell(n,a,d,p,y,_,b,C){let I=this.cells[y];if(I!==null){let D=this.keys,P=this.bboxes;for(let k=0;k<I.length;k++){let L=I[k];if(b[L]===void 0){let F=4*L;(C?C(P[F+0],P[F+1],P[F+2],P[F+3]):n<=P[F+2]&&a<=P[F+3]&&d>=P[F+0]&&p>=P[F+1])?(b[L]=!0,_.push(D[L])):b[L]=!1}}}}_forEachCell(n,a,d,p,y,_,b,C){let I=this._convertToCellCoord(n),D=this._convertToCellCoord(a),P=this._convertToCellCoord(d),k=this._convertToCellCoord(p);for(let L=I;L<=P;L++)for(let F=D;F<=k;F++){let j=this.d*F+L;if((!C||C(this._convertFromCellCoord(L),this._convertFromCellCoord(F),this._convertFromCellCoord(L+1),this._convertFromCellCoord(F+1)))&&y.call(this,n,a,d,p,j,_,b,C))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;let n=this.cells,a=3+this.cells.length+1+1,d=0;for(let _=0;_<this.cells.length;_++)d+=this.cells[_].length;let p=new Int32Array(a+d+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let y=a;for(let _=0;_<n.length;_++){let b=n[_];p[3+_]=y,p.set(b,y),y+=b.length}return p[3+n.length]=y,p.set(this.keys,y),y+=this.keys.length,p[3+n.length+1]=y,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer}static serialize(n,a){let d=n.toArrayBuffer();return a&&a.push(d),{buffer:d}}static deserialize(n){return new xs(n.buffer)}}let to={};function We(l,n,a={}){if(to[l])throw new Error(`${l} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:l,writeable:!1}),to[l]={klass:n,omit:a.omit||[],shallow:a.shallow||[]}}We("Object",Object),We("TransferableGridIndex",xs),We("Color",Dt),We("Error",Error),We("AJAXError",Yi),We("ResolvedImage",pr),We("StylePropertyFunction",Dc),We("StyleExpression",Ec,{omit:["_evaluator"]}),We("ZoomDependentExpression",Mc),We("ZoomConstantExpression",ra),We("CompoundExpression",Yr,{omit:["_evaluate"]});for(let l in ea)ea[l]._classRegistryKey||We(`Expression_${l}`,ea[l]);function wp(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function ws(l){return l.$name||l.constructor._classRegistryKey}function Cp(l){return!function(n){if(n===null||typeof n!="object")return!1;let a=ws(n);return!(!a||a==="Object")}(l)&&(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||l instanceof Blob||l instanceof Error||wp(l)||es(l)||ArrayBuffer.isView(l)||l instanceof ImageData)}function ml(l,n){if(Cp(l))return(wp(l)||es(l))&&n&&n.push(l),ArrayBuffer.isView(l)&&n&&n.push(l.buffer),l instanceof ImageData&&n&&n.push(l.data.buffer),l;if(Array.isArray(l)){let y=[];for(let _ of l)y.push(ml(_,n));return y}if(typeof l!="object")throw new Error("can't serialize object of type "+typeof l);let a=ws(l);if(!a)throw new Error(`can't serialize object of unregistered class ${l.constructor.name}`);if(!to[a])throw new Error(`${a} is not registered.`);let{klass:d}=to[a],p=d.serialize?d.serialize(l,n):{};if(d.serialize){if(n&&p===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(let y in l){if(!l.hasOwnProperty(y)||to[a].omit.indexOf(y)>=0)continue;let _=l[y];p[y]=to[a].shallow.indexOf(y)>=0?_:ml(_,n)}l instanceof Error&&(p.message=l.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(p.$name=a),p}function Ao(l){if(Cp(l))return l;if(Array.isArray(l))return l.map(Ao);if(typeof l!="object")throw new Error("can't deserialize object of type "+typeof l);let n=ws(l)||"Object";if(!to[n])throw new Error(`can't deserialize unregistered class ${n}`);let{klass:a}=to[n];if(!a)throw new Error(`can't deserialize unregistered class ${n}`);if(a.deserialize)return a.deserialize(l);let d=Object.create(a.prototype);for(let p of Object.keys(l)){if(p==="$name")continue;let y=l[p];d[p]=to[n].shallow.indexOf(p)>=0?y:Ao(y)}return d}class Ep{constructor(){this.first=!0}update(n,a){let d=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=a),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=d,!0))}}let Pt={"Latin-1 Supplement":l=>l>=128&&l<=255,"Hangul Jamo":l=>l>=4352&&l<=4607,Khmer:l=>l>=6016&&l<=6143,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Katakana:l=>l>=12448&&l<=12543,Kanbun:l=>l>=12688&&l<=12703,"CJK Strokes":l=>l>=12736&&l<=12783,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"Private Use Area":l=>l>=57344&&l<=63743,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519};function ua(l){for(let n of l)if(Fc(n.charCodeAt(0)))return!0;return!1}function Ip(l){for(let n of l)if(!Mp(n.charCodeAt(0)))return!1;return!0}function Nc(l){let n=l.map(a=>{try{return new RegExp(`\\p{sc=${a}}`,"u").source}catch{return null}}).filter(a=>a);return new RegExp(n.join("|"),"u")}let Tp=Nc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Mp(l){return!Tp.test(String.fromCodePoint(l))}let Lc=Nc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Fc(l){return!(l!==746&&l!==747&&(l<4352||!(Pt["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||Pt["CJK Compatibility"](l)||Pt["CJK Strokes"](l)||!(!Pt["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||Pt["Enclosed CJK Letters and Months"](l)||Pt["Ideographic Description Characters"](l)||Pt.Kanbun(l)||Pt.Katakana(l)&&l!==12540||!(!Pt["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!Pt["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||Pt["Vertical Forms"](l)||Pt["Yijing Hexagram Symbols"](l)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(l))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(l))||Lc.test(String.fromCodePoint(l)))))}function Dp(l){return!(Fc(l)||function(n){return!!(Pt["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Pt["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Pt["Letterlike Symbols"](n)||Pt["Number Forms"](n)||Pt["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Pt["Control Pictures"](n)&&n!==9251||Pt["Optical Character Recognition"](n)||Pt["Enclosed Alphanumerics"](n)||Pt["Geometric Shapes"](n)||Pt["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Pt["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Pt["CJK Symbols and Punctuation"](n)||Pt.Katakana(n)||Pt["Private Use Area"](n)||Pt["CJK Compatibility Forms"](n)||Pt["Small Form Variants"](n)||Pt["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(l))}let Sp=Nc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Pp(l){return Sp.test(String.fromCodePoint(l))}function Ap(l,n){return!(!n&&Pp(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||Pt.Khmer(l))}function Rp(l){for(let n of l)if(Pp(n.charCodeAt(0)))return!0;return!1}let no=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(l){this.pluginStatus=l.pluginStatus,this.pluginURL=l.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(l){if(no.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=l.applyArabicShaping,this.processBidirectionalText=l.processBidirectionalText,this.processStyledBidirectionalText=l.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(l,n){return s(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(l.pluginStatus!=="loading")return this.setState(l),l;let a=l.pluginURL,d=new Promise(y=>{this.loadScriptResolve=y});n(a);let p=new Promise(y=>setTimeout(()=>y(),this.TIMEOUT));if(yield Promise.race([d,p]),this.isParsed()){let y={pluginStatus:"loaded",pluginURL:a};return this.setState(y),y}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${a}`)})}};class pn{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ep,this.transition={})}isSupportedScript(n){return function(a,d){for(let p of a)if(!Ap(p.charCodeAt(0),d))return!1;return!0}(n,no.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){let n=this.zoom,a=n-Math.floor(n),d=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*a}}}class zc{constructor(n,a){this.property=n,this.value=a,this.expression=function(d,p){if(Cc(d))return new Dc(d,p);if(Ic(d)){let y=cp(d,p);if(y.result==="error")throw new Error(y.value.map(_=>`${_.key}: ${_.message}`).join(", "));return y.value}{let y=d;return p.type==="color"&&typeof d=="string"?y=Dt.parse(d):p.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(d)?y=fr.parse(d):p.type==="projectionDefinition"&&typeof d=="string"&&(y=mr.parse(d)):y=Un.parse(d),{kind:"constant",evaluate:()=>y}}}(a===void 0?n.specification.default:a,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,d){return this.property.possiblyEvaluate(this,n,a,d)}}class Bc{constructor(n){this.property=n,this.value=new zc(n,void 0)}transitioned(n,a){return new Kd(this.property,this.value,a,nr({},n.transition,this.transition),n.now)}untransitioned(){return new Kd(this.property,this.value,null,{},0)}}class Yd{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return kr(this._values[n].value.value)}setValue(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Bc(this._values[n].property)),this._values[n].value=new zc(this._values[n].property,a===null?void 0:kr(a))}getTransition(n){return kr(this._values[n].transition)}setTransition(n,a){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new Bc(this._values[n].property)),this._values[n].transition=kr(a)||void 0}serialize(){let n={};for(let a of Object.keys(this._values)){let d=this.getValue(a);d!==void 0&&(n[a]=d);let p=this.getTransition(a);p!==void 0&&(n[`${a}-transition`]=p)}return n}transitioned(n,a){let d=new Qd(this._properties);for(let p of Object.keys(this._values))d._values[p]=this._values[p].transitioned(n,a._values[p]);return d}untransitioned(){let n=new Qd(this._properties);for(let a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class Kd{constructor(n,a,d,p,y){this.property=n,this.value=a,this.begin=y+p.delay||0,this.end=this.begin+p.duration||0,n.specification.transition&&(p.delay||p.duration)&&(this.prior=d)}possiblyEvaluate(n,a,d){let p=n.now||0,y=this.value.possiblyEvaluate(n,a,d),_=this.prior;if(_){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return _.possiblyEvaluate(n,a,d);{let b=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,a,d),y,Yo(b))}}return y}}class Qd{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,d){let p=new da(this._properties);for(let y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(n,a,d);return p}hasTransition(){for(let n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class jc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return kr(this._values[n].value)}setValue(n,a){this._values[n]=new zc(this._values[n].property,a===null?void 0:kr(a))}serialize(){let n={};for(let a of Object.keys(this._values)){let d=this.getValue(a);d!==void 0&&(n[a]=d)}return n}possiblyEvaluate(n,a,d){let p=new da(this._properties);for(let y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(n,a,d);return p}}class zi{constructor(n,a,d){this.property=n,this.value=a,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,d,p){return this.property.evaluate(this.value,this.parameters,n,a,d,p)}}class da{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class tt{constructor(n){this.specification=n}possiblyEvaluate(n,a){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(a)}interpolate(n,a,d){let p=gi[this.specification.type];return p?p(n,a,d):n}}class ct{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,d,p){return new zi(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},d,p)}:n.expression,a)}interpolate(n,a,d){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new zi(this,{kind:"constant",value:void 0},n.parameters);let p=gi[this.specification.type];if(p){let y=p(n.value.value,a.value.value,d);return new zi(this,{kind:"constant",value:y},n.parameters)}return n}evaluate(n,a,d,p,y,_){return n.kind==="constant"?n.value:n.evaluate(a,d,p,y,_)}}class gl extends ct{possiblyEvaluate(n,a,d,p){if(n.value===void 0)return new zi(this,{kind:"constant",value:void 0},a);if(n.expression.kind==="constant"){let y=n.expression.evaluate(a,null,{},d,p),_=n.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,b=this._calculate(_,_,_,a);return new zi(this,{kind:"constant",value:b},a)}if(n.expression.kind==="camera"){let y=this._calculate(n.expression.evaluate({zoom:a.zoom-1}),n.expression.evaluate({zoom:a.zoom}),n.expression.evaluate({zoom:a.zoom+1}),a);return new zi(this,{kind:"constant",value:y},a)}return new zi(this,n.expression,a)}evaluate(n,a,d,p,y,_){if(n.kind==="source"){let b=n.evaluate(a,d,p,y,_);return this._calculate(b,b,b,a)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(a.zoom)-1},d,p),n.evaluate({zoom:Math.floor(a.zoom)},d,p),n.evaluate({zoom:Math.floor(a.zoom)+1},d,p),a):n.value}_calculate(n,a,d,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:d,to:a}}interpolate(n){return n}}class Vc{constructor(n){this.specification=n}possiblyEvaluate(n,a,d,p){if(n.value!==void 0){if(n.expression.kind==="constant"){let y=n.expression.evaluate(a,null,{},d,p);return this._calculate(y,y,y,a)}return this._calculate(n.expression.evaluate(new pn(Math.floor(a.zoom-1),a)),n.expression.evaluate(new pn(Math.floor(a.zoom),a)),n.expression.evaluate(new pn(Math.floor(a.zoom+1),a)),a)}}_calculate(n,a,d,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:a}:{from:d,to:a}}interpolate(n){return n}}class Uc{constructor(n){this.specification=n}possiblyEvaluate(n,a,d,p){return!!n.expression.evaluate(a,null,{},d,p)}interpolate(){return!1}}class Mr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(let a in n){let d=n[a];d.specification.overridable&&this.overridableProperties.push(a);let p=this.defaultPropertyValues[a]=new zc(d,void 0),y=this.defaultTransitionablePropertyValues[a]=new Bc(d);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}}}We("DataDrivenProperty",ct),We("DataConstantProperty",tt),We("CrossFadedDataDrivenProperty",gl),We("CrossFadedProperty",Vc),We("ColorRampProperty",Uc);let kp="-transition";class Bi extends To{constructor(n,a){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),a.layout&&(this._unevaluatedLayout=new jc(a.layout)),a.paint)){this._transitionablePaint=new Yd(a.paint);for(let d in n.paint)this.setPaintProperty(d,n.paint[d],{validate:!1});for(let d in n.layout)this.setLayoutProperty(d,n.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new da(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a,d={}){a!=null&&this._validate(Xd,`layers.${this.id}.layout.${n}`,n,a,d)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,a):this.visibility=a)}getPaintProperty(n){return n.endsWith(kp)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a,d={}){if(a!=null&&this._validate(bp,`layers.${this.id}.paint.${n}`,n,a,d))return!1;if(n.endsWith(kp))return this._transitionablePaint.setTransition(n.slice(0,-11),a||void 0),!1;{let p=this._transitionablePaint._values[n],y=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),b=p.value;this._transitionablePaint.setValue(n,a),this._handleSpecialPaintPropertyUpdate(n);let C=this._transitionablePaint._values[n].value;return C.isDataDriven()||_||y||this._handleOverridablePaintPropertyUpdate(n,b,C)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,a,d){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){let n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Jo(n,(a,d)=>!(a===void 0||d==="layout"&&!Object.keys(a).length||d==="paint"&&!Object.keys(a).length))}_validate(n,a,d,p,y={}){return(!y||y.validate!==!1)&&xp(this,n.call(ca,{key:a,layerType:this.type,objectKey:d,value:p,styleSpec:X,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let n in this.paint._values){let a=this.paint.get(n);if(a instanceof zi&&na(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}let s_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yl{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){let a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Sn(l,n=1){let a=0,d=0;return{members:l.map(p=>{let y=s_[p.type].BYTES_PER_ELEMENT,_=a=Op(a,Math.max(n,y)),b=p.components||1;return d=Math.max(d,y),a+=y*b,{name:p.name,type:p.type,components:b,offset:_}}),size:Op(a,Math.max(d,n)),alignment:n}}function Op(l,n){return Math.ceil(l/n)*n}class _l extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){let d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){let p=2*n;return this.int16[p+0]=a,this.int16[p+1]=d,n}}_l.prototype.bytesPerElement=4,We("StructArrayLayout2i4",_l);class vl extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,a,d)}emplace(n,a,d,p){let y=3*n;return this.int16[y+0]=a,this.int16[y+1]=d,this.int16[y+2]=p,n}}vl.prototype.bytesPerElement=6,We("StructArrayLayout3i6",vl);class Jd extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p){let y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,p)}emplace(n,a,d,p,y){let _=4*n;return this.int16[_+0]=a,this.int16[_+1]=d,this.int16[_+2]=p,this.int16[_+3]=y,n}}Jd.prototype.bytesPerElement=8,We("StructArrayLayout4i8",Jd);class eh extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_){let b=this.length;return this.resize(b+1),this.emplace(b,n,a,d,p,y,_)}emplace(n,a,d,p,y,_,b){let C=6*n;return this.int16[C+0]=a,this.int16[C+1]=d,this.int16[C+2]=p,this.int16[C+3]=y,this.int16[C+4]=_,this.int16[C+5]=b,n}}eh.prototype.bytesPerElement=12,We("StructArrayLayout2i4i12",eh);class ro extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_){let b=this.length;return this.resize(b+1),this.emplace(b,n,a,d,p,y,_)}emplace(n,a,d,p,y,_,b){let C=4*n,I=8*n;return this.int16[C+0]=a,this.int16[C+1]=d,this.uint8[I+4]=p,this.uint8[I+5]=y,this.uint8[I+6]=_,this.uint8[I+7]=b,n}}ro.prototype.bytesPerElement=8,We("StructArrayLayout2i4ub8",ro);class ha extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){let d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){let p=2*n;return this.float32[p+0]=a,this.float32[p+1]=d,n}}ha.prototype.bytesPerElement=8,We("StructArrayLayout2f8",ha);class bl extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_,b,C,I,D){let P=this.length;return this.resize(P+1),this.emplace(P,n,a,d,p,y,_,b,C,I,D)}emplace(n,a,d,p,y,_,b,C,I,D,P){let k=10*n;return this.uint16[k+0]=a,this.uint16[k+1]=d,this.uint16[k+2]=p,this.uint16[k+3]=y,this.uint16[k+4]=_,this.uint16[k+5]=b,this.uint16[k+6]=C,this.uint16[k+7]=I,this.uint16[k+8]=D,this.uint16[k+9]=P,n}}bl.prototype.bytesPerElement=20,We("StructArrayLayout10ui20",bl);class $c extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_,b,C,I,D,P,k){let L=this.length;return this.resize(L+1),this.emplace(L,n,a,d,p,y,_,b,C,I,D,P,k)}emplace(n,a,d,p,y,_,b,C,I,D,P,k,L){let F=12*n;return this.int16[F+0]=a,this.int16[F+1]=d,this.int16[F+2]=p,this.int16[F+3]=y,this.uint16[F+4]=_,this.uint16[F+5]=b,this.uint16[F+6]=C,this.uint16[F+7]=I,this.int16[F+8]=D,this.int16[F+9]=P,this.int16[F+10]=k,this.int16[F+11]=L,n}}$c.prototype.bytesPerElement=24,We("StructArrayLayout4i4ui4i24",$c);class xl extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,a,d)}emplace(n,a,d,p){let y=3*n;return this.float32[y+0]=a,this.float32[y+1]=d,this.float32[y+2]=p,n}}xl.prototype.bytesPerElement=12,We("StructArrayLayout3f12",xl);class th extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}th.prototype.bytesPerElement=4,We("StructArrayLayout1ul4",th);class fa extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_,b,C,I){let D=this.length;return this.resize(D+1),this.emplace(D,n,a,d,p,y,_,b,C,I)}emplace(n,a,d,p,y,_,b,C,I,D){let P=10*n,k=5*n;return this.int16[P+0]=a,this.int16[P+1]=d,this.int16[P+2]=p,this.int16[P+3]=y,this.int16[P+4]=_,this.int16[P+5]=b,this.uint32[k+3]=C,this.uint16[P+8]=I,this.uint16[P+9]=D,n}}fa.prototype.bytesPerElement=20,We("StructArrayLayout6i1ul2ui20",fa);class Cs extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_){let b=this.length;return this.resize(b+1),this.emplace(b,n,a,d,p,y,_)}emplace(n,a,d,p,y,_,b){let C=6*n;return this.int16[C+0]=a,this.int16[C+1]=d,this.int16[C+2]=p,this.int16[C+3]=y,this.int16[C+4]=_,this.int16[C+5]=b,n}}Cs.prototype.bytesPerElement=12,We("StructArrayLayout2i2i2i12",Cs);class nh extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y){let _=this.length;return this.resize(_+1),this.emplace(_,n,a,d,p,y)}emplace(n,a,d,p,y,_){let b=4*n,C=8*n;return this.float32[b+0]=a,this.float32[b+1]=d,this.float32[b+2]=p,this.int16[C+6]=y,this.int16[C+7]=_,n}}nh.prototype.bytesPerElement=16,We("StructArrayLayout2f1f2i16",nh);class Hc extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_){let b=this.length;return this.resize(b+1),this.emplace(b,n,a,d,p,y,_)}emplace(n,a,d,p,y,_,b){let C=16*n,I=4*n,D=8*n;return this.uint8[C+0]=a,this.uint8[C+1]=d,this.float32[I+1]=p,this.float32[I+2]=y,this.int16[D+6]=_,this.int16[D+7]=b,n}}Hc.prototype.bytesPerElement=16,We("StructArrayLayout2ub2f2i16",Hc);class Ro extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,a,d)}emplace(n,a,d,p){let y=3*n;return this.uint16[y+0]=a,this.uint16[y+1]=d,this.uint16[y+2]=p,n}}Ro.prototype.bytesPerElement=6,We("StructArrayLayout3ui6",Ro);class rh extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J){let ue=this.length;return this.resize(ue+1),this.emplace(ue,n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J)}emplace(n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J,ue){let ne=24*n,N=12*n,q=48*n;return this.int16[ne+0]=a,this.int16[ne+1]=d,this.uint16[ne+2]=p,this.uint16[ne+3]=y,this.uint32[N+2]=_,this.uint32[N+3]=b,this.uint32[N+4]=C,this.uint16[ne+10]=I,this.uint16[ne+11]=D,this.uint16[ne+12]=P,this.float32[N+7]=k,this.float32[N+8]=L,this.uint8[q+36]=F,this.uint8[q+37]=j,this.uint8[q+38]=Z,this.uint32[N+10]=J,this.int16[ne+22]=ue,n}}rh.prototype.bytesPerElement=48,We("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",rh);class ih extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J,ue,ne,N,q,re,_e,ke,xe,Ie,Fe,Ne){let Be=this.length;return this.resize(Be+1),this.emplace(Be,n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J,ue,ne,N,q,re,_e,ke,xe,Ie,Fe,Ne)}emplace(n,a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J,ue,ne,N,q,re,_e,ke,xe,Ie,Fe,Ne,Be){let Pe=32*n,Ke=16*n;return this.int16[Pe+0]=a,this.int16[Pe+1]=d,this.int16[Pe+2]=p,this.int16[Pe+3]=y,this.int16[Pe+4]=_,this.int16[Pe+5]=b,this.int16[Pe+6]=C,this.int16[Pe+7]=I,this.uint16[Pe+8]=D,this.uint16[Pe+9]=P,this.uint16[Pe+10]=k,this.uint16[Pe+11]=L,this.uint16[Pe+12]=F,this.uint16[Pe+13]=j,this.uint16[Pe+14]=Z,this.uint16[Pe+15]=J,this.uint16[Pe+16]=ue,this.uint16[Pe+17]=ne,this.uint16[Pe+18]=N,this.uint16[Pe+19]=q,this.uint16[Pe+20]=re,this.uint16[Pe+21]=_e,this.uint16[Pe+22]=ke,this.uint32[Ke+12]=xe,this.float32[Ke+13]=Ie,this.float32[Ke+14]=Fe,this.uint16[Pe+30]=Ne,this.uint16[Pe+31]=Be,n}}ih.prototype.bytesPerElement=64,We("StructArrayLayout8i15ui1ul2f2ui64",ih);class wl extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}wl.prototype.bytesPerElement=4,We("StructArrayLayout1f4",wl);class oh extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,a,d)}emplace(n,a,d,p){let y=3*n;return this.uint16[6*n+0]=a,this.float32[y+1]=d,this.float32[y+2]=p,n}}oh.prototype.bytesPerElement=12,We("StructArrayLayout1ui2f12",oh);class m extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,d){let p=this.length;return this.resize(p+1),this.emplace(p,n,a,d)}emplace(n,a,d,p){let y=4*n;return this.uint32[2*n+0]=a,this.uint16[y+2]=d,this.uint16[y+3]=p,n}}m.prototype.bytesPerElement=8,We("StructArrayLayout1ul2ui8",m);class e extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){let d=this.length;return this.resize(d+1),this.emplace(d,n,a)}emplace(n,a,d){let p=2*n;return this.uint16[p+0]=a,this.uint16[p+1]=d,n}}e.prototype.bytesPerElement=4,We("StructArrayLayout2ui4",e);class o extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){let a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}o.prototype.bytesPerElement=2,We("StructArrayLayout1ui2",o);class h extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,d,p){let y=this.length;return this.resize(y+1),this.emplace(y,n,a,d,p)}emplace(n,a,d,p,y){let _=4*n;return this.float32[_+0]=a,this.float32[_+1]=d,this.float32[_+2]=p,this.float32[_+3]=y,n}}h.prototype.bytesPerElement=16,We("StructArrayLayout4f16",h);class f extends yl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new he(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class g extends fa{get(n){return new f(this,n)}}We("CollisionBoxArray",g);class v extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}v.prototype.size=48;class w extends rh{get(n){return new v(this,n)}}We("PlacedSymbolArray",w);class E extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}E.prototype.size=64;class T extends ih{get(n){return new E(this,n)}}We("SymbolInstanceArray",T);class A extends wl{getoffsetX(n){return this.float32[1*n+0]}}We("GlyphOffsetArray",A);class R extends vl{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}We("SymbolLineVertexArray",R);class O extends yl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}O.prototype.size=12;class z extends oh{get(n){return new O(this,n)}}We("TextAnchorOffsetArray",z);class U extends yl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}U.prototype.size=8;class K extends m{get(n){return new U(this,n)}}We("FeatureIndexArray",K);class Y extends _l{}class Q extends _l{}class ee extends _l{}class ie extends eh{}class oe extends ro{}class se extends ha{}class ce extends bl{}class le extends $c{}class ye extends xl{}class ve extends th{}class Se extends Cs{}class Re extends Hc{}class Ee extends Ro{}class Ue extends e{}let je=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Oe}=je;class Ge{constructor(n=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=n}prepareSegment(n,a,d,p){let y=this.segments[this.segments.length-1];return n>Ge.MAX_VERTEX_ARRAY_LENGTH&&hr(`Max vertices per segment is ${Ge.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Ge.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!y||y.vertexLength+n>Ge.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p?this.createNewSegment(a,d,p):y}createNewSegment(n,a,d){let p={vertexOffset:n.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0,vaos:{}};return d!==void 0&&(p.sortKey=d),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(n,a,d){return this.prepareSegment(0,n,a,d)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(let n of this.segments)for(let a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,d,p){return new Ge([{vertexOffset:n,primitiveOffset:a,vertexLength:d,primitiveLength:p,vaos:{},sortKey:0}])}}function bt(l,n){return 256*(l=fi(Math.floor(l),0,255))+fi(Math.floor(n),0,255)}Ge.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,We("SegmentVector",Ge);let Bt=Sn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var mn,Kt,gn,Qt={exports:{}},Wt={exports:{}},Jt={exports:{}},rr=function(){if(gn)return Qt.exports;gn=1;var l=(mn||(mn=1,Wt.exports=function(a,d){var p,y,_,b,C,I,D,P;for(y=a.length-(p=3&a.length),_=d,C=3432918353,I=461845907,P=0;P<y;)D=255&a.charCodeAt(P)|(255&a.charCodeAt(++P))<<8|(255&a.charCodeAt(++P))<<16|(255&a.charCodeAt(++P))<<24,++P,_=27492+(65535&(b=5*(65535&(_=(_^=D=(65535&(D=(D=(65535&D)*C+(((D>>>16)*C&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(D=0,p){case 3:D^=(255&a.charCodeAt(P+2))<<16;case 2:D^=(255&a.charCodeAt(P+1))<<8;case 1:_^=D=(65535&(D=(D=(65535&(D^=255&a.charCodeAt(P)))*C+(((D>>>16)*C&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295}return _^=a.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Wt.exports),n=(Kt||(Kt=1,Jt.exports=function(a,d){for(var p,y=a.length,_=d^y,b=0;y>=4;)p=1540483477*(65535&(p=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(p>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),y-=4,++b;switch(y){case 3:_^=(255&a.charCodeAt(b+2))<<16;case 2:_^=(255&a.charCodeAt(b+1))<<8;case 1:_=1540483477*(65535&(_^=255&a.charCodeAt(b)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Jt.exports);return Qt.exports=l,Qt.exports.murmur3=l,Qt.exports.murmur2=n,Qt.exports}(),Nn=x(rr);class Ln{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,a,d,p){this.ids.push(Er(n)),this.positions.push(a,d,p)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");let a=Er(n),d=0,p=this.ids.length-1;for(;d<p;){let _=d+p>>1;this.ids[_]>=a?p=_:d=_+1}let y=[];for(;this.ids[d]===a;)y.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return y}static serialize(n,a){let d=new Float64Array(n.ids),p=new Uint32Array(n.positions);return io(d,p,0,d.length-1),a&&a.push(d.buffer,p.buffer),{ids:d,positions:p}}static deserialize(n){let a=new Ln;return a.ids=n.ids,a.positions=n.positions,a.indexed=!0,a}}function Er(l){let n=+l;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:Nn(String(l))}function io(l,n,a,d){for(;a<d;){let p=l[a+d>>1],y=a-1,_=d+1;for(;;){do y++;while(l[y]<p);do _--;while(l[_]>p);if(y>=_)break;ji(l,y,_),ji(n,3*y,3*_),ji(n,3*y+1,3*_+1),ji(n,3*y+2,3*_+2)}_-a<d-_?(io(l,n,a,_),a=_+1):(io(l,n,_+1,d),d=_)}}function ji(l,n,a){let d=l[n];l[n]=l[a],l[a]=d}We("FeaturePositionMap",Ln);class Fr{constructor(n,a){this.gl=n.gl,this.location=a}}class oo extends Fr{constructor(n,a){super(n,a),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Cl extends Fr{constructor(n,a){super(n,a),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class El extends Fr{constructor(n,a){super(n,a),this.current=Dt.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}let pa=new Float32Array(16);function Dr(l){return[bt(255*l.r,255*l.g),bt(255*l.b,255*l.a)]}class Qr{constructor(n,a,d){this.value=n,this.uniformNames=a.map(p=>`u_${p}`),this.type=d}setUniform(n,a,d){n.set(d.constantOr(this.value))}getBinding(n,a,d){return this.type==="color"?new El(n,a):new oo(n,a)}}class Jr{constructor(n,a){this.uniformNames=a.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=n.tlbr}setUniform(n,a,d,p){let y=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&n.set(y)}getBinding(n,a,d){return d.substr(0,9)==="u_pattern"?new Cl(n,a):new oo(n,a)}}class zr{constructor(n,a,d,p){this.expression=n,this.type=d,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(n,a,d,p,y){let _=this.paintVertexArray.length,b=this.expression.evaluate(new pn(0),a,{},p,[],y);this.paintVertexArray.resize(n),this._setPaintValue(_,n,b)}updatePaintArray(n,a,d,p){let y=this.expression.evaluate({zoom:0},d,p);this._setPaintValue(n,a,y)}_setPaintValue(n,a,d){if(this.type==="color"){let p=Dr(d);for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=n;p<a;p++)this.paintVertexArray.emplace(p,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(n,a,d,p,y,_){this.expression=n,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=d,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,a,d,p,y){let _=this.expression.evaluate(new pn(this.zoom),a,{},p,[],y),b=this.expression.evaluate(new pn(this.zoom+1),a,{},p,[],y),C=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(C,n,_,b)}updatePaintArray(n,a,d,p){let y=this.expression.evaluate({zoom:this.zoom},d,p),_=this.expression.evaluate({zoom:this.zoom+1},d,p);this._setPaintValue(n,a,y,_)}_setPaintValue(n,a,d,p){if(this.type==="color"){let y=Dr(d),_=Dr(p);for(let b=n;b<a;b++)this.paintVertexArray.emplace(b,y[0],y[1],_[0],_[1])}else{for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,d,p);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a){let d=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=fi(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);n.set(p)}getBinding(n,a,d){return new oo(n,a)}}class yn{constructor(n,a,d,p,y,_){this.expression=n,this.type=a,this.useIntegerZoom=d,this.zoom=p,this.layerId=_,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(n,a,d){let p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,a.patterns&&a.patterns[this.layerId],d)}updatePaintArray(n,a,d,p,y){this._setPaintValues(n,a,d.patterns&&d.patterns[this.layerId],y)}_setPaintValues(n,a,d,p){if(!p||!d)return;let{min:y,mid:_,max:b}=d,C=p[y],I=p[_],D=p[b];if(C&&I&&D)for(let P=n;P<a;P++)this.zoomInPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],C.tl[0],C.tl[1],C.br[0],C.br[1],I.pixelRatio,C.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,I.tl[0],I.tl[1],I.br[0],I.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],I.pixelRatio,D.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,Bt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,Bt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Br{constructor(n,a,d){this.binders={},this._buffers=[];let p=[];for(let y in n.paint._values){if(!d(y))continue;let _=n.paint.get(y);if(!(_ instanceof zi&&na(_.property.specification)))continue;let b=a_(y,n.type),C=_.value,I=_.property.specification.type,D=_.property.useIntegerZoom,P=_.property.specification["property-type"],k=P==="cross-faded"||P==="cross-faded-data-driven";if(C.kind==="constant")this.binders[y]=k?new Jr(C.value,b):new Qr(C.value,b,I),p.push(`/u_${y}`);else if(C.kind==="source"||k){let L=Np(y,I,"source");this.binders[y]=k?new yn(C,I,D,a,L,n.id):new zr(C,b,I,L),p.push(`/a_${y}`)}else{let L=Np(y,I,"composite");this.binders[y]=new en(C,b,I,D,a,L),p.push(`/z_${y}`)}}this.cacheKey=p.sort().join("")}getMaxValue(n){let a=this.binders[n];return a instanceof zr||a instanceof en?a.maxValue:0}populatePaintArrays(n,a,d,p,y){for(let _ in this.binders){let b=this.binders[_];(b instanceof zr||b instanceof en||b instanceof yn)&&b.populatePaintArray(n,a,d,p,y)}}setConstantPatternPositions(n,a){for(let d in this.binders){let p=this.binders[d];p instanceof Jr&&p.setConstantPatternPositions(n,a)}}updatePaintArrays(n,a,d,p,y){let _=!1;for(let b in n){let C=a.getPositions(b);for(let I of C){let D=d.feature(I.index);for(let P in this.binders){let k=this.binders[P];if((k instanceof zr||k instanceof en||k instanceof yn)&&k.expression.isStateDependent===!0){let L=p.paint.get(P);k.expression=L.value,k.updatePaintArray(I.start,I.end,D,n[b],y),_=!0}}}}return _}defines(){let n=[];for(let a in this.binders){let d=this.binders[a];(d instanceof Qr||d instanceof Jr)&&n.push(...d.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return n}getBinderAttributes(){let n=[];for(let a in this.binders){let d=this.binders[a];if(d instanceof zr||d instanceof en)for(let p=0;p<d.paintVertexAttributes.length;p++)n.push(d.paintVertexAttributes[p].name);else if(d instanceof yn)for(let p=0;p<Bt.members.length;p++)n.push(Bt.members[p].name)}return n}getBinderUniforms(){let n=[];for(let a in this.binders){let d=this.binders[a];if(d instanceof Qr||d instanceof Jr||d instanceof en)for(let p of d.uniformNames)n.push(p)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,a){let d=[];for(let p in this.binders){let y=this.binders[p];if(y instanceof Qr||y instanceof Jr||y instanceof en){for(let _ of y.uniformNames)if(a[_]){let b=y.getBinding(n,a[_],_);d.push({name:_,property:p,binding:b})}}}return d}setUniforms(n,a,d,p){for(let{name:y,property:_,binding:b}of a)this.binders[_].setUniform(b,p,d.get(_),y)}updatePaintBuffers(n){this._buffers=[];for(let a in this.binders){let d=this.binders[a];if(n&&d instanceof yn){let p=n.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(d instanceof zr||d instanceof en)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(n){for(let a in this.binders){let d=this.binders[a];(d instanceof zr||d instanceof en||d instanceof yn)&&d.upload(n)}this.updatePaintBuffers()}destroy(){for(let n in this.binders){let a=this.binders[n];(a instanceof zr||a instanceof en||a instanceof yn)&&a.destroy()}}}class bn{constructor(n,a,d=()=>!0){this.programConfigurations={};for(let p of n)this.programConfigurations[p.id]=new Br(p,a,d);this.needsUpload=!1,this._featureMap=new Ln,this._bufferOffset=0}populatePaintArrays(n,a,d,p,y,_){for(let b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(n,a,p,y,_);a.id!==void 0&&this._featureMap.add(a.id,d,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,d,p){for(let y of d)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(n,this._featureMap,a,y,p)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(let a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(let n in this.programConfigurations)this.programConfigurations[n].destroy()}}function a_(l,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[l]||[l.replace(`${n}-`,"").replace(/-/g,"_")]}function Np(l,n,a){let d={color:{source:ha,composite:h},number:{source:wl,composite:ha}},p=function(y){return{"line-pattern":{source:ce,composite:ce},"fill-pattern":{source:ce,composite:ce},"fill-extrusion-pattern":{source:ce,composite:ce}}[y]}(l);return p&&p[a]||d[n][a]}We("ConstantBinder",Qr),We("CrossFadedConstantBinder",Jr),We("SourceExpressionBinder",zr),We("CrossFadedCompositeBinder",yn),We("CompositeExpressionBinder",en),We("ProgramConfiguration",Br,{omit:["_buffers"]}),We("ProgramConfigurationSet",bn);let sh=Math.pow(2,14)-1,Lp=-sh-1;function Es(l){let n=Zt/l.extent,a=l.loadGeometry();for(let d=0;d<a.length;d++){let p=a[d];for(let y=0;y<p.length;y++){let _=p[y],b=Math.round(_.x*n),C=Math.round(_.y*n);_.x=fi(b,Lp,sh),_.y=fi(C,Lp,sh),(b<_.x||b>_.x+1||C<_.y||C>_.y+1)&&hr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function Is(l,n){return{type:l.type,id:l.id,properties:l.properties,geometry:n?Es(l):[]}}let ko=-32768;function Fp(l,n,a,d,p){l.emplaceBack(ko+8*n+d,ko+8*a+p)}class Gc{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.indexArray=new Ee,this.segments=new Ge,this.programConfigurations=new bn(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,d){let p=this.layers[0],y=[],_=null,b=!1,C=p.type==="heatmap";if(p.type==="circle"){let D=p;_=D.layout.get("circle-sort-key"),b=!_.isConstant(),C=C||D.paint.get("circle-pitch-alignment")==="map"}let I=C?a.subdivisionGranularity.circle:1;for(let{feature:D,id:P,index:k,sourceLayerIndex:L}of n){let F=this.layers[0]._featureFilter.needGeometry,j=Is(D,F);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),j,d))continue;let Z=b?_.evaluate(j,{},d):void 0,J={id:P,properties:D.properties,type:D.type,sourceLayerIndex:L,index:k,geometry:F?j.geometry:Es(D),patterns:{},sortKey:Z};y.push(J)}b&&y.sort((D,P)=>D.sortKey-P.sortKey);for(let D of y){let{geometry:P,index:k,sourceLayerIndex:L}=D,F=n[k].feature;this.addFeature(D,P,k,d,I),a.featureIndex.insert(F,P,k,L,this.index)}}update(n,a,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Oe),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,d,p,y=1){let _;switch(y){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${y}; valid values are 1, 3, 5, 7.`)}let b=_.length;for(let C of a)for(let I of C){let D=I.x,P=I.y;if(D<0||D>=Zt||P<0||P>=Zt)continue;let k=this.segments.prepareSegment(b*b,this.layoutVertexArray,this.indexArray,n.sortKey),L=k.vertexLength;for(let F=0;F<b;F++)for(let j=0;j<b;j++)Fp(this.layoutVertexArray,D,P,_[j],_[F]);for(let F=0;F<b-1;F++)for(let j=0;j<b-1;j++){let Z=L+F*b+j,J=L+(F+1)*b+j;this.indexArray.emplaceBack(Z,J+1,Z+1),this.indexArray.emplaceBack(Z,J,J+1)}k.vertexLength+=b*b,k.primitiveLength+=(b-1)*(b-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,{},p)}}function ah(l,n){for(let a=0;a<l.length;a++)if(qc(n,l[a]))return!0;for(let a=0;a<n.length;a++)if(qc(l,n[a]))return!0;return!!l_(l,n)}function lh(l,n,a){return!!qc(l,n)||!!c_(n,l,a)}function ch(l,n){if(l.length===1)return Vx(n,l[0]);for(let a=0;a<n.length;a++){let d=n[a];for(let p=0;p<d.length;p++)if(qc(l,d[p]))return!0}for(let a=0;a<l.length;a++)if(Vx(n,l[a]))return!0;for(let a=0;a<n.length;a++)if(l_(l,n[a]))return!0;return!1}function uh(l,n,a){if(l.length>1){if(l_(l,n))return!0;for(let d=0;d<n.length;d++)if(c_(n[d],l,a))return!0}for(let d=0;d<l.length;d++)if(c_(l[d],n,a))return!0;return!1}function l_(l,n){if(l.length===0||n.length===0)return!1;for(let a=0;a<l.length-1;a++){let d=l[a],p=l[a+1];for(let y=0;y<n.length-1;y++)if(gS(d,p,n[y],n[y+1]))return!0}return!1}function gS(l,n,a,d){return jn(l,a,d)!==jn(n,a,d)&&jn(l,n,a)!==jn(l,n,d)}function c_(l,n,a){let d=a*a;if(n.length===1)return l.distSqr(n[0])<d;for(let p=1;p<n.length;p++)if(jx(l,n[p-1],n[p])<d)return!0;return!1}function jx(l,n,a){let d=n.distSqr(a);if(d===0)return l.distSqr(n);let p=((l.x-n.x)*(a.x-n.x)+(l.y-n.y)*(a.y-n.y))/d;return l.distSqr(p<0?n:p>1?a:a.sub(n)._mult(p)._add(n))}function Vx(l,n){let a,d,p,y=!1;for(let _=0;_<l.length;_++){a=l[_];for(let b=0,C=a.length-1;b<a.length;C=b++)d=a[b],p=a[C],d.y>n.y!=p.y>n.y&&n.x<(p.x-d.x)*(n.y-d.y)/(p.y-d.y)+d.x&&(y=!y)}return y}function qc(l,n){let a=!1;for(let d=0,p=l.length-1;d<l.length;p=d++){let y=l[d],_=l[p];y.y>n.y!=_.y>n.y&&n.x<(_.x-y.x)*(n.y-y.y)/(_.y-y.y)+y.x&&(a=!a)}return a}function yS(l,n,a){let d=a[0],p=a[2];if(l.x<d.x&&n.x<d.x||l.x>p.x&&n.x>p.x||l.y<d.y&&n.y<d.y||l.y>p.y&&n.y>p.y)return!1;let y=jn(l,n,a[0]);return y!==jn(l,n,a[1])||y!==jn(l,n,a[2])||y!==jn(l,n,a[3])}function dh(l,n,a){let d=n.paint.get(l).value;return d.kind==="constant"?d.value:a.programConfigurations.get(n.id).getMaxValue(l)}function zp(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function Bp(l,n,a,d,p){if(!n[0]&&!n[1])return l;let y=he.convert(n)._mult(p);a==="viewport"&&y._rotate(-d);let _=[];for(let b=0;b<l.length;b++)_.push(l[b].sub(y));return _}let Ux,$x;We("CircleBucket",Gc,{omit:["layers"]});var _S={get paint(){return $x=$x||new Mr({"circle-radius":new ct(X.paint_circle["circle-radius"]),"circle-color":new ct(X.paint_circle["circle-color"]),"circle-blur":new ct(X.paint_circle["circle-blur"]),"circle-opacity":new ct(X.paint_circle["circle-opacity"]),"circle-translate":new tt(X.paint_circle["circle-translate"]),"circle-translate-anchor":new tt(X.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new tt(X.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new tt(X.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ct(X.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ct(X.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ct(X.paint_circle["circle-stroke-opacity"])})},get layout(){return Ux=Ux||new Mr({"circle-sort-key":new ct(X.layout_circle["circle-sort-key"])})}};class vS extends Bi{constructor(n){super(n,_S)}createBucket(n){return new Gc(n)}queryRadius(n){let a=n;return dh("circle-radius",this,a)+dh("circle-stroke-width",this,a)+zp(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:d,geometry:p,transform:y,pixelsToTileUnits:_,pixelPosMatrix:b}){let C=Bp(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-y.bearingInRadians,_),I=this.paint.get("circle-radius").evaluate(a,d)+this.paint.get("circle-stroke-width").evaluate(a,d),D=this.paint.get("circle-pitch-alignment")==="map",P=D?C:function(L,F){return L.map(j=>Hx(j,F))}(C,b),k=D?I*_:I;for(let L of p)for(let F of L){let j=D?F:Hx(F,b),Z=k,J=Wi([],[F.x,F.y,0,1],b);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Z*=J[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Z*=y.cameraToCenterDistance/J[3]),lh(P,j,Z))return!0}return!1}}function Hx(l,n){let a=Wi([],[l.x,l.y,0,1],n);return new he(a[0]/a[3],a[1]/a[3])}class Gx extends Gc{}let qx;We("HeatmapBucket",Gx,{omit:["layers"]});var bS={get paint(){return qx=qx||new Mr({"heatmap-radius":new ct(X.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ct(X.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new tt(X.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Uc(X.paint_heatmap["heatmap-color"]),"heatmap-opacity":new tt(X.paint_heatmap["heatmap-opacity"])})}};function u_(l,{width:n,height:a},d,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*a*d)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${n*a*d}`)}else p=new Uint8Array(n*a*d);return l.width=n,l.height=a,l.data=p,l}function Zx(l,{width:n,height:a},d){if(n===l.width&&a===l.height)return;let p=u_({},{width:n,height:a},d);d_(l,p,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,n),height:Math.min(l.height,a)},d),l.width=n,l.height=a,l.data=p.data}function d_(l,n,a,d,p,y){if(p.width===0||p.height===0)return n;if(p.width>l.width||p.height>l.height||a.x>l.width-p.width||a.y>l.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||d.x>n.width-p.width||d.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");let _=l.data,b=n.data;if(_===b)throw new Error("srcData equals dstData, so image is already copied");for(let C=0;C<p.height;C++){let I=((a.y+C)*l.width+a.x)*y,D=((d.y+C)*n.width+d.x)*y;for(let P=0;P<p.width*y;P++)b[D+P]=_[I+P]}return n}class hh{constructor(n,a){u_(this,n,1,a)}resize(n){Zx(this,n,1)}clone(){return new hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,p,y){d_(n,a,d,p,y,1)}}class _i{constructor(n,a){u_(this,n,4,a)}resize(n){Zx(this,n,4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new _i({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,d,p,y){d_(n,a,d,p,y,4)}}function Wx(l){let n={},a=l.resolution||256,d=l.clips?l.clips.length:1,p=l.image||new _i({width:a,height:d});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);let y=(_,b,C)=>{n[l.evaluationKey]=C;let I=l.expression.evaluate(n);p.data[_+b+0]=Math.floor(255*I.r/I.a),p.data[_+b+1]=Math.floor(255*I.g/I.a),p.data[_+b+2]=Math.floor(255*I.b/I.a),p.data[_+b+3]=Math.floor(255*I.a)};if(l.clips)for(let _=0,b=0;_<d;++_,b+=4*a)for(let C=0,I=0;C<a;C++,I+=4){let D=C/(a-1),{start:P,end:k}=l.clips[_];y(b,I,P*(1-D)+k*D)}else for(let _=0,b=0;_<a;_++,b+=4)y(0,b,_/(a-1));return p}We("AlphaImage",hh),We("RGBAImage",_i);let h_="big-fb";class xS extends Bi{createBucket(n){return new Gx(n)}constructor(n){super(n,bS),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(h_)&&this.heatmapFbos.delete(h_)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Xx;var wS={get paint(){return Xx=Xx||new Mr({"hillshade-illumination-direction":new tt(X.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new tt(X.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new tt(X.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new tt(X.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new tt(X.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new tt(X.paint_hillshade["hillshade-accent-color"])})}};class CS extends Bi{constructor(n){super(n,wS)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let ES=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:IS}=ES;function f_(l,n,a){let d=a.patternDependencies,p=!1;for(let y of n){let _=y.paint.get(`${l}-pattern`);_.isConstant()||(p=!0);let b=_.constantOr(null);b&&(p=!0,d[b.to]=!0,d[b.from]=!0)}return p}function p_(l,n,a,d,p){let y=p.patternDependencies;for(let _ of n){let b=_.paint.get(`${l}-pattern`).value;if(b.kind!=="constant"){let C=b.evaluate({zoom:d-1},a,{},p.availableImages),I=b.evaluate({zoom:d},a,{},p.availableImages),D=b.evaluate({zoom:d+1},a,{},p.availableImages);C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,y[C]=!0,y[I]=!0,y[D]=!0,a.patterns[_.id]={min:C,mid:I,max:D}}}return a}function Yx(l,n,a,d,p){let y;if(p===function(_,b,C,I){let D=0;for(let P=b,k=C-I;P<C;P+=I)D+=(_[k]-_[P])*(_[P+1]+_[k+1]),k=P;return D}(l,n,a,d)>0)for(let _=n;_<a;_+=d)y=ew(_/d|0,l[_],l[_+1],y);else for(let _=a-d;_>=n;_-=d)y=ew(_/d|0,l[_],l[_+1],y);return y&&Zc(y,y.next)&&(gh(y),y=y.next),y}function Il(l,n){if(!l)return l;n||(n=l);let a,d=l;do if(a=!1,d.steiner||!Zc(d,d.next)&&Pn(d.prev,d,d.next)!==0)d=d.next;else{if(gh(d),d=n=d.prev,d===d.next)break;a=!0}while(a||d!==n);return n}function fh(l,n,a,d,p,y,_){if(!l)return;!_&&y&&function(C,I,D,P){let k=C;do k.z===0&&(k.z=m_(k.x,k.y,I,D,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==C);k.prevZ.nextZ=null,k.prevZ=null,function(L){let F,j=1;do{let Z,J=L;L=null;let ue=null;for(F=0;J;){F++;let ne=J,N=0;for(let re=0;re<j&&(N++,ne=ne.nextZ,ne);re++);let q=j;for(;N>0||q>0&&ne;)N!==0&&(q===0||!ne||J.z<=ne.z)?(Z=J,J=J.nextZ,N--):(Z=ne,ne=ne.nextZ,q--),ue?ue.nextZ=Z:L=Z,Z.prevZ=ue,ue=Z;J=ne}ue.nextZ=null,j*=2}while(F>1)}(k)}(l,d,p,y);let b=l;for(;l.prev!==l.next;){let C=l.prev,I=l.next;if(y?MS(l,d,p,y):TS(l))n.push(C.i,l.i,I.i),gh(l),l=I.next,b=I.next;else if((l=I)===b){_?_===1?fh(l=DS(Il(l),n),n,a,d,p,y,2):_===2&&SS(l,n,a,d,p,y):fh(Il(l),n,a,d,p,y,1);break}}}function TS(l){let n=l.prev,a=l,d=l.next;if(Pn(n,a,d)>=0)return!1;let p=n.x,y=a.x,_=d.x,b=n.y,C=a.y,I=d.y,D=Math.min(p,y,_),P=Math.min(b,C,I),k=Math.max(p,y,_),L=Math.max(b,C,I),F=d.next;for(;F!==n;){if(F.x>=D&&F.x<=k&&F.y>=P&&F.y<=L&&ph(p,b,y,C,_,I,F.x,F.y)&&Pn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function MS(l,n,a,d){let p=l.prev,y=l,_=l.next;if(Pn(p,y,_)>=0)return!1;let b=p.x,C=y.x,I=_.x,D=p.y,P=y.y,k=_.y,L=Math.min(b,C,I),F=Math.min(D,P,k),j=Math.max(b,C,I),Z=Math.max(D,P,k),J=m_(L,F,n,a,d),ue=m_(j,Z,n,a,d),ne=l.prevZ,N=l.nextZ;for(;ne&&ne.z>=J&&N&&N.z<=ue;){if(ne.x>=L&&ne.x<=j&&ne.y>=F&&ne.y<=Z&&ne!==p&&ne!==_&&ph(b,D,C,P,I,k,ne.x,ne.y)&&Pn(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,N.x>=L&&N.x<=j&&N.y>=F&&N.y<=Z&&N!==p&&N!==_&&ph(b,D,C,P,I,k,N.x,N.y)&&Pn(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;ne&&ne.z>=J;){if(ne.x>=L&&ne.x<=j&&ne.y>=F&&ne.y<=Z&&ne!==p&&ne!==_&&ph(b,D,C,P,I,k,ne.x,ne.y)&&Pn(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;N&&N.z<=ue;){if(N.x>=L&&N.x<=j&&N.y>=F&&N.y<=Z&&N!==p&&N!==_&&ph(b,D,C,P,I,k,N.x,N.y)&&Pn(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function DS(l,n){let a=l;do{let d=a.prev,p=a.next.next;!Zc(d,p)&&Qx(d,a,a.next,p)&&mh(d,p)&&mh(p,d)&&(n.push(d.i,a.i,p.i),gh(a),gh(a.next),a=l=p),a=a.next}while(a!==l);return Il(a)}function SS(l,n,a,d,p,y){let _=l;do{let b=_.next.next;for(;b!==_.prev;){if(_.i!==b.i&&OS(_,b)){let C=Jx(_,b);return _=Il(_,_.next),C=Il(C,C.next),fh(_,n,a,d,p,y,0),void fh(C,n,a,d,p,y,0)}b=b.next}_=_.next}while(_!==l)}function PS(l,n){let a=l.x-n.x;return a===0&&(a=l.y-n.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(n.next.y-n.y)/(n.next.x-n.x)),a}function AS(l,n){let a=function(p,y){let _=y,b=p.x,C=p.y,I,D=-1/0;if(Zc(p,_))return _;do{if(Zc(p,_.next))return _.next;if(C<=_.y&&C>=_.next.y&&_.next.y!==_.y){let j=_.x+(C-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(j<=b&&j>D&&(D=j,I=_.x<_.next.x?_:_.next,j===b))return I}_=_.next}while(_!==y);if(!I)return null;let P=I,k=I.x,L=I.y,F=1/0;_=I;do{if(b>=_.x&&_.x>=k&&b!==_.x&&Kx(C<L?b:D,C,k,L,C<L?D:b,C,_.x,_.y)){let j=Math.abs(C-_.y)/(b-_.x);mh(_,p)&&(j<F||j===F&&(_.x>I.x||_.x===I.x&&RS(I,_)))&&(I=_,F=j)}_=_.next}while(_!==P);return I}(l,n);if(!a)return n;let d=Jx(a,l);return Il(d,d.next),Il(a,a.next)}function RS(l,n){return Pn(l.prev,l,n.prev)<0&&Pn(n.next,l,l.next)<0}function m_(l,n,a,d,p){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*p|0)|l<<8))|l<<4))|l<<2))|l<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-d)*p|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function kS(l){let n=l,a=l;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==l);return a}function Kx(l,n,a,d,p,y,_,b){return(p-_)*(n-b)>=(l-_)*(y-b)&&(l-_)*(d-b)>=(a-_)*(n-b)&&(a-_)*(y-b)>=(p-_)*(d-b)}function ph(l,n,a,d,p,y,_,b){return!(l===_&&n===b)&&Kx(l,n,a,d,p,y,_,b)}function OS(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!function(a,d){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==d.i&&p.next.i!==d.i&&Qx(p,p.next,a,d))return!0;p=p.next}while(p!==a);return!1}(l,n)&&(mh(l,n)&&mh(n,l)&&function(a,d){let p=a,y=!1,_=(a.x+d.x)/2,b=(a.y+d.y)/2;do p.y>b!=p.next.y>b&&p.next.y!==p.y&&_<(p.next.x-p.x)*(b-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next;while(p!==a);return y}(l,n)&&(Pn(l.prev,l,n.prev)||Pn(l,n.prev,n))||Zc(l,n)&&Pn(l.prev,l,l.next)>0&&Pn(n.prev,n,n.next)>0)}function Pn(l,n,a){return(n.y-l.y)*(a.x-n.x)-(n.x-l.x)*(a.y-n.y)}function Zc(l,n){return l.x===n.x&&l.y===n.y}function Qx(l,n,a,d){let p=Vp(Pn(l,n,a)),y=Vp(Pn(l,n,d)),_=Vp(Pn(a,d,l)),b=Vp(Pn(a,d,n));return p!==y&&_!==b||!(p!==0||!jp(l,a,n))||!(y!==0||!jp(l,d,n))||!(_!==0||!jp(a,l,d))||!(b!==0||!jp(a,n,d))}function jp(l,n,a){return n.x<=Math.max(l.x,a.x)&&n.x>=Math.min(l.x,a.x)&&n.y<=Math.max(l.y,a.y)&&n.y>=Math.min(l.y,a.y)}function Vp(l){return l>0?1:l<0?-1:0}function mh(l,n){return Pn(l.prev,l,l.next)<0?Pn(l,n,l.next)>=0&&Pn(l,l.prev,n)>=0:Pn(l,n,l.prev)<0||Pn(l,l.next,n)<0}function Jx(l,n){let a=g_(l.i,l.x,l.y),d=g_(n.i,n.x,n.y),p=l.next,y=n.prev;return l.next=n,n.prev=l,a.next=p,p.prev=a,d.next=a,a.prev=d,y.next=d,d.prev=y,d}function ew(l,n,a,d){let p=g_(l,n,a);return d?(p.next=d.next,p.prev=d,d.next.prev=p,d.next=p):(p.prev=p,p.next=p),p}function gh(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function g_(l,n,a){return{i:l,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Wc{constructor(n,a){if(a>n)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=n,this._minGranularity=a}getGranularityForZoomLevel(n){return Math.max(Math.floor(this._baseZoomGranularity/(1<<n)),this._minGranularity,1)}}class Up{constructor(n){this.fill=n.fill,this.line=n.line,this.tile=n.tile,this.stencil=n.stencil,this.circle=n.circle}}Up.noSubdivision=new Up({fill:new Wc(0,0),line:new Wc(0,0),tile:new Wc(0,0),stencil:new Wc(0,0),circle:1}),We("SubdivisionGranularityExpression",Wc),We("SubdivisionGranularitySetting",Up);let Xc=-32768,yh=32767;class NS{constructor(n,a){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=n,this._granularityCellSize=Zt/n,this._canonical=a}_getKey(n,a){return(n+=32768)<<16|(a+=32768)<<0}_vertexToIndex(n,a){if(n<-32768||a<-32768||n>32767||a>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");let d=0|Math.round(n),p=0|Math.round(a),y=this._getKey(d,p);if(this._vertexDictionary.has(y))return this._vertexDictionary.get(y);let _=this._vertexBuffer.length/2;return this._vertexDictionary.set(y,_),this._vertexBuffer.push(d,p),_}_subdivideTrianglesScanline(n){if(this._granularity<2)return function(p,y){let _=[];for(let b=0;b<y.length;b+=3){let C=y[b],I=y[b+1],D=y[b+2],P=p[2*C],k=p[2*C+1];(p[2*I]-P)*(p[2*D+1]-k)-(p[2*I+1]-k)*(p[2*D]-P)>0?(_.push(C),_.push(D),_.push(I)):(_.push(C),_.push(I),_.push(D))}return _}(this._vertexBuffer,n);let a=[],d=n.length;for(let p=0;p<d;p+=3){let y=[n[p+0],n[p+1],n[p+2]],_=[this._vertexBuffer[2*n[p+0]+0],this._vertexBuffer[2*n[p+0]+1],this._vertexBuffer[2*n[p+1]+0],this._vertexBuffer[2*n[p+1]+1],this._vertexBuffer[2*n[p+2]+0],this._vertexBuffer[2*n[p+2]+1]],b=1/0,C=1/0,I=-1/0,D=-1/0;for(let j=0;j<3;j++){let Z=_[2*j],J=_[2*j+1];b=Math.min(b,Z),I=Math.max(I,Z),C=Math.min(C,J),D=Math.max(D,J)}if(b===I||C===D)continue;let P=Math.floor(b/this._granularityCellSize),k=Math.ceil(I/this._granularityCellSize),L=Math.floor(C/this._granularityCellSize),F=Math.ceil(D/this._granularityCellSize);if(P!==k||L!==F)for(let j=L;j<F;j++){let Z=this._scanlineGenerateVertexRingForCellRow(j,_,y);LS(this._vertexBuffer,Z,a)}else a.push(...y)}return a}_scanlineGenerateVertexRingForCellRow(n,a,d){let p=n*this._granularityCellSize,y=p+this._granularityCellSize,_=[];for(let b=0;b<3;b++){let C=a[2*b],I=a[2*b+1],D=a[2*(b+1)%6],P=a[(2*(b+1)+1)%6],k=a[2*(b+2)%6],L=a[(2*(b+2)+1)%6],F=D-C,j=P-I,Z=F===0,J=j===0,ue=(p-I)/j,ne=(y-I)/j,N=Math.min(ue,ne),q=Math.max(ue,ne);if(!J&&(N>=1||q<=0)||J&&(I<p||I>y)){P>=p&&P<=y&&_.push(d[(b+1)%3]);continue}!J&&N>0&&_.push(this._vertexToIndex(C+F*N,I+j*N));let re=C+F*Math.max(N,0),_e=C+F*Math.min(q,1);Z||this._generateIntraEdgeVertices(_,C,I,D,P,re,_e),!J&&q<1&&_.push(this._vertexToIndex(C+F*q,I+j*q)),(J||P>=p&&P<=y)&&_.push(d[(b+1)%3]),!J&&(P<=p||P>=y)&&this._generateInterEdgeVertices(_,C,I,D,P,k,L,_e,p,y)}return _}_generateIntraEdgeVertices(n,a,d,p,y,_,b){let C=p-a,I=y-d,D=I===0,P=D?Math.min(a,p):Math.min(_,b),k=D?Math.max(a,p):Math.max(_,b),L=Math.floor(P/this._granularityCellSize)+1,F=Math.ceil(k/this._granularityCellSize)-1;if(D?a<p:_<b)for(let j=L;j<=F;j++){let Z=j*this._granularityCellSize;n.push(this._vertexToIndex(Z,d+I*(Z-a)/C))}else for(let j=F;j>=L;j--){let Z=j*this._granularityCellSize;n.push(this._vertexToIndex(Z,d+I*(Z-a)/C))}}_generateInterEdgeVertices(n,a,d,p,y,_,b,C,I,D){let P=y-d,k=_-p,L=b-y,F=(I-y)/L,j=(D-y)/L,Z=Math.min(F,j),J=Math.max(F,j),ue=p+k*Z,ne=Math.floor(Math.min(ue,C)/this._granularityCellSize)+1,N=Math.ceil(Math.max(ue,C)/this._granularityCellSize)-1,q=C<ue,re=L===0;if(re&&(b===I||b===D))return;if(re||Z>=1||J<=0){let ke=d-b,xe=_+(a-_)*Math.min((I-b)/ke,(D-b)/ke);ne=Math.floor(Math.min(xe,C)/this._granularityCellSize)+1,N=Math.ceil(Math.max(xe,C)/this._granularityCellSize)-1,q=C<xe}let _e=P>0?D:I;if(q)for(let ke=ne;ke<=N;ke++)n.push(this._vertexToIndex(ke*this._granularityCellSize,_e));else for(let ke=N;ke>=ne;ke--)n.push(this._vertexToIndex(ke*this._granularityCellSize,_e))}_generateOutline(n){let a=[];for(let d of n){let p=Tl(d,this._granularity,!0),y=this._pointArrayToIndices(p),_=[];for(let b=1;b<y.length;b++)_.push(y[b-1]),_.push(y[b]);a.push(_)}return a}_handlePoles(n){let a=!1,d=!1;this._canonical&&(this._canonical.y===0&&(a=!0),this._canonical.y===(1<<this._canonical.z)-1&&(d=!0)),(a||d)&&this._fillPoles(n,a,d)}_ensureNoPoleVertices(){let n=this._vertexBuffer;for(let a=0;a<n.length;a+=2){let d=n[a+1];d===Xc&&(n[a+1]=-32767),d===yh&&(n[a+1]=32766)}}_generatePoleQuad(n,a,d,p,y,_){p>y!=(_===Xc)?(n.push(a),n.push(d),n.push(this._vertexToIndex(p,_)),n.push(d),n.push(this._vertexToIndex(y,_)),n.push(this._vertexToIndex(p,_))):(n.push(d),n.push(a),n.push(this._vertexToIndex(p,_)),n.push(this._vertexToIndex(y,_)),n.push(d),n.push(this._vertexToIndex(p,_)))}_fillPoles(n,a,d){let p=this._vertexBuffer,y=Zt,_=n.length;for(let b=2;b<_;b+=3){let C=n[b-2],I=n[b-1],D=n[b],P=p[2*C],k=p[2*C+1],L=p[2*I],F=p[2*I+1],j=p[2*D],Z=p[2*D+1];a&&(k===0&&F===0&&this._generatePoleQuad(n,C,I,P,L,Xc),F===0&&Z===0&&this._generatePoleQuad(n,I,D,L,j,Xc),Z===0&&k===0&&this._generatePoleQuad(n,D,C,j,P,Xc)),d&&(k===y&&F===y&&this._generatePoleQuad(n,C,I,P,L,yh),F===y&&Z===y&&this._generatePoleQuad(n,I,D,L,j,yh),Z===y&&k===y&&this._generatePoleQuad(n,D,C,j,P,yh))}}_initializeVertices(n){for(let a=0;a<n.length;a+=2)this._vertexToIndex(n[a],n[a+1])}subdividePolygonInternal(n,a){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;let{flattened:d,holeIndices:p}=function(b){let C=[],I=[];for(let D of b)if(D.length!==0){D!==b[0]&&C.push(I.length/2);for(let P=0;P<D.length;P++)I.push(D[P].x),I.push(D[P].y)}return{flattened:I,holeIndices:C}}(n),y;this._initializeVertices(d);try{let b=function(I,D,P=2){let k=D&&D.length,L=k?D[0]*P:I.length,F=Yx(I,0,L,P,!0),j=[];if(!F||F.next===F.prev)return j;let Z,J,ue;if(k&&(F=function(ne,N,q,re){let _e=[];for(let ke=0,xe=N.length;ke<xe;ke++){let Ie=Yx(ne,N[ke]*re,ke<xe-1?N[ke+1]*re:ne.length,re,!1);Ie===Ie.next&&(Ie.steiner=!0),_e.push(kS(Ie))}_e.sort(PS);for(let ke=0;ke<_e.length;ke++)q=AS(_e[ke],q);return q}(I,D,F,P)),I.length>80*P){Z=1/0,J=1/0;let ne=-1/0,N=-1/0;for(let q=P;q<L;q+=P){let re=I[q],_e=I[q+1];re<Z&&(Z=re),_e<J&&(J=_e),re>ne&&(ne=re),_e>N&&(N=_e)}ue=Math.max(ne-Z,N-J),ue=ue!==0?32767/ue:0}return fh(F,j,P,Z,J,ue,0),j}(d,p),C=this._convertIndices(d,b);y=this._subdivideTrianglesScanline(C)}catch(b){console.error(b)}let _=[];return a&&(_=this._generateOutline(n)),this._ensureNoPoleVertices(),this._handlePoles(y),{verticesFlattened:this._vertexBuffer,indicesTriangles:y,indicesLineList:_}}_convertIndices(n,a){let d=[];for(let p=0;p<a.length;p++)d.push(this._vertexToIndex(n[2*a[p]],n[2*a[p]+1]));return d}_pointArrayToIndices(n){let a=[];for(let d=0;d<n.length;d++){let p=n[d];a.push(this._vertexToIndex(p.x,p.y))}return a}}function tw(l,n,a,d=!0){return new NS(a,n).subdividePolygonInternal(l,d)}function Tl(l,n,a=!1){if(!l||l.length<1)return[];if(l.length<2)return[];let d=l[0],p=l[l.length-1],y=a&&(d.x!==p.x||d.y!==p.y);if(n<2)return y?[...l,l[0]]:[...l];let _=Math.floor(Zt/n),b=[];b.push(new he(l[0].x,l[0].y));let C=l.length,I=y?C:C-1;for(let D=0;D<I;D++){let P=l[D],k=D<C-1?l[D+1]:l[0],L=P.x,F=P.y,j=k.x,Z=k.y,J=L!==j,ue=F!==Z;if(!J&&!ue)continue;let ne=j-L,N=Z-F,q=Math.abs(ne),re=Math.abs(N),_e=L,ke=F;for(;;){let Ie=ne>0?(Math.floor(_e/_)+1)*_:(Math.ceil(_e/_)-1)*_,Fe=N>0?(Math.floor(ke/_)+1)*_:(Math.ceil(ke/_)-1)*_,Ne=Math.abs(_e-Ie),Be=Math.abs(ke-Fe),Pe=Math.abs(_e-j),Ke=Math.abs(ke-Z),st=J?Ne/q:Number.POSITIVE_INFINITY,rt=ue?Be/re:Number.POSITIVE_INFINITY;if((Pe<=Ne||!J)&&(Ke<=Be||!ue))break;if(st<rt&&J||!ue){_e=Ie,ke+=N*st;let Je=new he(_e,Math.round(ke));b[b.length-1].x===Je.x&&b[b.length-1].y===Je.y||b.push(Je)}else{_e+=ne*rt,ke=Fe;let Je=new he(Math.round(_e),ke);b[b.length-1].x===Je.x&&b[b.length-1].y===Je.y||b.push(Je)}}let xe=new he(j,Z);b[b.length-1].x===xe.x&&b[b.length-1].y===xe.y||b.push(xe)}return b}function LS(l,n,a){if(n.length===0)throw new Error("Subdivision vertex ring is empty.");let d=0,p=l[2*n[0]];for(let C=1;C<n.length;C++){let I=l[2*n[C]];I<p&&(p=I,d=C)}let y=n.length,_=d,b=(_+1)%y;for(;;){let C=_-1>=0?_-1:y-1,I=(b+1)%y,D=l[2*n[C]],P=l[2*n[I]],k=l[2*n[_]],L=l[2*n[_]+1],F=l[2*n[b]+1],j=!1;if(D<P)j=!0;else if(D>P)j=!1;else{let Z=F-L,J=-(l[2*n[b]]-k),ue=L<F?1:-1;((D-k)*Z+(l[2*n[C]+1]-L)*J)*ue>((P-k)*Z+(l[2*n[I]+1]-L)*J)*ue&&(j=!0)}if(j){let Z=n[C],J=n[_],ue=n[b];Z!==J&&Z!==ue&&J!==ue&&a.push(ue,J,Z),_--,_<0&&(_=y-1)}else{let Z=n[I],J=n[_],ue=n[b];Z!==J&&Z!==ue&&J!==ue&&a.push(ue,J,Z),b++,b>=y&&(b=0)}if(C===I)break}}function nw(l,n,a,d,p,y,_,b,C){let I=p.length/2,D=_&&b&&C;if(I<Ge.MAX_VERTEX_ARRAY_LENGTH){let P=n.prepareSegment(I,a,d),k=P.vertexLength;for(let j=0;j<y.length;j+=3)d.emplaceBack(k+y[j],k+y[j+1],k+y[j+2]);let L,F;P.vertexLength+=I,P.primitiveLength+=y.length/3,D&&(F=_.prepareSegment(I,a,b),L=F.vertexLength,F.vertexLength+=I);for(let j=0;j<p.length;j+=2)l(p[j],p[j+1]);if(D)for(let j=0;j<C.length;j++){let Z=C[j];for(let J=1;J<Z.length;J+=2)b.emplaceBack(L+Z[J-1],L+Z[J]);F.primitiveLength+=Z.length/2}}else(function(P,k,L,F,j,Z){let J=[];for(let re=0;re<F.length/2;re++)J.push(-1);let ue={count:0},ne=0,N=P.getOrCreateLatestSegment(k,L),q=N.vertexLength;for(let re=2;re<j.length;re+=3){let _e=j[re-2],ke=j[re-1],xe=j[re],Ie=J[_e]<ne,Fe=J[ke]<ne,Ne=J[xe]<ne;N.vertexLength+((Ie?1:0)+(Fe?1:0)+(Ne?1:0))>Ge.MAX_VERTEX_ARRAY_LENGTH&&(N=P.createNewSegment(k,L),ne=ue.count,Ie=!0,Fe=!0,Ne=!0,q=0);let Be=_h(J,F,Z,ue,_e,Ie,N),Pe=_h(J,F,Z,ue,ke,Fe,N),Ke=_h(J,F,Z,ue,xe,Ne,N);L.emplaceBack(q+Be-ne,q+Pe-ne,q+Ke-ne),N.primitiveLength++}})(n,a,d,p,y,l),D&&function(P,k,L,F,j,Z){let J=[];for(let re=0;re<F.length/2;re++)J.push(-1);let ue={count:0},ne=0,N=P.getOrCreateLatestSegment(k,L),q=N.vertexLength;for(let re=0;re<j.length;re++){let _e=j[re];for(let ke=1;ke<j[re].length;ke+=2){let xe=_e[ke-1],Ie=_e[ke],Fe=J[xe]<ne,Ne=J[Ie]<ne;N.vertexLength+((Fe?1:0)+(Ne?1:0))>Ge.MAX_VERTEX_ARRAY_LENGTH&&(N=P.createNewSegment(k,L),ne=ue.count,Fe=!0,Ne=!0,q=0);let Be=_h(J,F,Z,ue,xe,Fe,N),Pe=_h(J,F,Z,ue,Ie,Ne,N);L.emplaceBack(q+Be-ne,q+Pe-ne),N.primitiveLength++}}}(_,a,b,p,C,l),n.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function _h(l,n,a,d,p,y,_){if(y){let b=d.count;return a(n[2*p],n[2*p+1]),l[p]=d.count,d.count++,_.vertexLength++,b}return l[p]}class y_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ee,this.indexArray=new Ee,this.indexArray2=new Ue,this.programConfigurations=new bn(n.layers,n.zoom),this.segments=new Ge,this.segments2=new Ge,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,d){this.hasPattern=f_("fill",this.layers,a);let p=this.layers[0].layout.get("fill-sort-key"),y=!p.isConstant(),_=[];for(let{feature:b,id:C,index:I,sourceLayerIndex:D}of n){let P=this.layers[0]._featureFilter.needGeometry,k=Is(b,P);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),k,d))continue;let L=y?p.evaluate(k,{},d,a.availableImages):void 0,F={id:C,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:P?k.geometry:Es(b),patterns:{},sortKey:L};_.push(F)}y&&_.sort((b,C)=>b.sortKey-C.sortKey);for(let b of _){let{geometry:C,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){let P=p_("fill",this.layers,b,this.zoom,a);this.patternFeatures.push(P)}else this.addFeature(b,C,I,d,{},a.subdivisionGranularity);a.featureIndex.insert(n[I].feature,C,I,D,this.index)}}update(n,a,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,d)}addFeatures(n,a,d){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,a,d,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,IS),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,d,p,y,_){for(let b of mc(a,500)){let C=tw(b,p,_.fill.getGranularityForZoomLevel(p.z)),I=this.layoutVertexArray;nw((D,P)=>{I.emplaceBack(D,P)},this.segments,this.layoutVertexArray,this.indexArray,C.verticesFlattened,C.indicesTriangles,this.segments2,this.indexArray2,C.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,p)}}let rw,iw;We("FillBucket",y_,{omit:["layers","patternFeatures"]});var FS={get paint(){return iw=iw||new Mr({"fill-antialias":new tt(X.paint_fill["fill-antialias"]),"fill-opacity":new ct(X.paint_fill["fill-opacity"]),"fill-color":new ct(X.paint_fill["fill-color"]),"fill-outline-color":new ct(X.paint_fill["fill-outline-color"]),"fill-translate":new tt(X.paint_fill["fill-translate"]),"fill-translate-anchor":new tt(X.paint_fill["fill-translate-anchor"]),"fill-pattern":new gl(X.paint_fill["fill-pattern"])})},get layout(){return rw=rw||new Mr({"fill-sort-key":new ct(X.layout_fill["fill-sort-key"])})}};class zS extends Bi{constructor(n){super(n,FS)}recalculate(n,a){super.recalculate(n,a);let d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new y_(n)}queryRadius(){return zp(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:n,geometry:a,transform:d,pixelsToTileUnits:p}){return ch(Bp(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-d.bearingInRadians,p),a)}isTileClipped(){return!0}}let BS=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),jS=Sn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:VS}=BS;var __,ow,v_,sw,b_,aw,lw,$p={};function cw(){if(ow)return __;ow=1;var l=B();function n(p,y,_,b,C){this.properties={},this.extent=_,this.type=0,this._pbf=p,this._geometry=-1,this._keys=b,this._values=C,p.readFields(a,this,y)}function a(p,y,_){p==1?y.id=_.readVarint():p==2?function(b,C){for(var I=b.readVarint()+b.pos;b.pos<I;){var D=C._keys[b.readVarint()],P=C._values[b.readVarint()];C.properties[D]=P}}(_,y):p==3?y.type=_.readVarint():p==4&&(y._geometry=_.pos)}function d(p){for(var y,_,b=0,C=0,I=p.length,D=I-1;C<I;D=C++)b+=((_=p[D]).x-(y=p[C]).x)*(y.y+_.y);return b}return __=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var p=this._pbf;p.pos=this._geometry;for(var y,_=p.readVarint()+p.pos,b=1,C=0,I=0,D=0,P=[];p.pos<_;){if(C<=0){var k=p.readVarint();b=7&k,C=k>>3}if(C--,b===1||b===2)I+=p.readSVarint(),D+=p.readSVarint(),b===1&&(y&&P.push(y),y=[]),y.push(new l(I,D));else{if(b!==7)throw new Error("unknown command "+b);y&&y.push(y[0].clone())}}return y&&P.push(y),P},n.prototype.bbox=function(){var p=this._pbf;p.pos=this._geometry;for(var y=p.readVarint()+p.pos,_=1,b=0,C=0,I=0,D=1/0,P=-1/0,k=1/0,L=-1/0;p.pos<y;){if(b<=0){var F=p.readVarint();_=7&F,b=F>>3}if(b--,_===1||_===2)(C+=p.readSVarint())<D&&(D=C),C>P&&(P=C),(I+=p.readSVarint())<k&&(k=I),I>L&&(L=I);else if(_!==7)throw new Error("unknown command "+_)}return[D,k,P,L]},n.prototype.toGeoJSON=function(p,y,_){var b,C,I=this.extent*Math.pow(2,_),D=this.extent*p,P=this.extent*y,k=this.loadGeometry(),L=n.types[this.type];function F(J){for(var ue=0;ue<J.length;ue++){var ne=J[ue];J[ue]=[360*(ne.x+D)/I-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+P)/I)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(b=0;b<k.length;b++)j[b]=k[b][0];F(k=j);break;case 2:for(b=0;b<k.length;b++)F(k[b]);break;case 3:for(k=function(J){var ue=J.length;if(ue<=1)return[J];for(var ne,N,q=[],re=0;re<ue;re++){var _e=d(J[re]);_e!==0&&(N===void 0&&(N=_e<0),N===_e<0?(ne&&q.push(ne),ne=[J[re]]):ne.push(J[re]))}return ne&&q.push(ne),q}(k),b=0;b<k.length;b++)for(C=0;C<k[b].length;C++)F(k[b][C])}k.length===1?k=k[0]:L="Multi"+L;var Z={type:"Feature",geometry:{type:L,coordinates:k},properties:this.properties};return"id"in this&&(Z.id=this.id),Z},__}function uw(){if(sw)return v_;sw=1;var l=cw();function n(d,p){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=d,this._keys=[],this._values=[],this._features=[],d.readFields(a,this,p),this.length=this._features.length}function a(d,p,y){d===15?p.version=y.readVarint():d===1?p.name=y.readString():d===5?p.extent=y.readVarint():d===2?p._features.push(y.pos):d===3?p._keys.push(y.readString()):d===4&&p._values.push(function(_){for(var b=null,C=_.readVarint()+_.pos;_.pos<C;){var I=_.readVarint()>>3;b=I===1?_.readString():I===2?_.readFloat():I===3?_.readDouble():I===4?_.readVarint64():I===5?_.readVarint():I===6?_.readSVarint():I===7?_.readBoolean():null}return b}(y))}return v_=n,n.prototype.feature=function(d){if(d<0||d>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[d];var p=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,p,this.extent,this._keys,this._values)},v_}function dw(){return lw||(lw=1,$p.VectorTile=function(){if(aw)return b_;aw=1;var l=uw();function n(a,d,p){if(a===3){var y=new l(p,p.readVarint()+p.pos);y.length&&(d[y.name]=y)}}return b_=function(a,d){this.layers=a.readFields(n,{},d)},b_}(),$p.VectorTileFeature=cw(),$p.VectorTileLayer=uw()),$p}var vh=x(dw());let US=vh.VectorTileFeature.types,x_=Math.pow(2,13);function bh(l,n,a,d,p,y,_,b){l.emplaceBack(n,a,2*Math.floor(d*x_)+_,p*x_*2,y*x_*2,Math.round(b))}class w_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ie,this.centroidVertexArray=new Y,this.indexArray=new Ee,this.programConfigurations=new bn(n.layers,n.zoom),this.segments=new Ge,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,d){this.features=[],this.hasPattern=f_("fill-extrusion",this.layers,a);for(let{feature:p,id:y,index:_,sourceLayerIndex:b}of n){let C=this.layers[0]._featureFilter.needGeometry,I=Is(p,C);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),I,d))continue;let D={id:y,sourceLayerIndex:b,index:_,geometry:C?I.geometry:Es(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(p_("fill-extrusion",this.layers,D,this.zoom,a)):this.addFeature(D,D.geometry,_,d,{},a.subdivisionGranularity),a.featureIndex.insert(p,D.geometry,_,b,this.index,!0)}}addFeatures(n,a,d){for(let p of this.features){let{geometry:y}=p;this.addFeature(p,y,p.index,a,d,n.subdivisionGranularity)}}update(n,a,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,VS),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,jS.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,a,d,p,y,_){for(let b of mc(a,500)){let C={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(C,p,n,b,_);let D=this.layoutVertexArray.length-I,P=Math.floor(C.x/C.sampleCount),k=Math.floor(C.y/C.sampleCount);for(let L=0;L<D;L++)this.centroidVertexArray.emplaceBack(P,k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,p)}processPolygon(n,a,d,p,y){if(p.length<1||hw(p[0]))return;for(let P of p)P.length!==0&&$S(n,P);let _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},b=y.fill.getGranularityForZoomLevel(a.z),C=US[d.type]==="Polygon";for(let P of p){if(P.length===0||hw(P))continue;let k=Tl(P,b,C);this._generateSideFaces(k,_)}if(!C)return;let I=tw(p,a,b,!1),D=this.layoutVertexArray;nw((P,k)=>{bh(D,P,k,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(n,a){let d=0;for(let p=1;p<n.length;p++){let y=n[p],_=n[p-1];if(HS(y,_))continue;a.segment.vertexLength+4>Ge.MAX_VERTEX_ARRAY_LENGTH&&(a.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));let b=y.sub(_)._perp()._unit(),C=_.dist(y);d+C>32768&&(d=0),bh(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,0,d),bh(this.layoutVertexArray,y.x,y.y,b.x,b.y,0,1,d),d+=C,bh(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,0,d),bh(this.layoutVertexArray,_.x,_.y,b.x,b.y,0,1,d);let I=a.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),a.segment.vertexLength+=4,a.segment.primitiveLength+=2}}}function $S(l,n){for(let a=0;a<n.length;a++){let d=n[a];a===n.length-1&&n[0].x===d.x&&n[0].y===d.y||(l.x+=d.x,l.y+=d.y,l.sampleCount++)}}function HS(l,n){return l.x===n.x&&(l.x<0||l.x>Zt)||l.y===n.y&&(l.y<0||l.y>Zt)}function hw(l){return l.every(n=>n.x<0)||l.every(n=>n.x>Zt)||l.every(n=>n.y<0)||l.every(n=>n.y>Zt)}let fw;We("FillExtrusionBucket",w_,{omit:["layers","features"]});var GS={get paint(){return fw=fw||new Mr({"fill-extrusion-opacity":new tt(X["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ct(X["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new tt(X["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new tt(X["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new gl(X["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ct(X["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ct(X["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new tt(X["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class qS extends Bi{constructor(n){super(n,GS)}createBucket(n){return new w_(n)}queryRadius(){return zp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:d,geometry:p,transform:y,pixelsToTileUnits:_,pixelPosMatrix:b}){let C=Bp(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-y.bearingInRadians,_),I=this.paint.get("fill-extrusion-height").evaluate(a,d),D=this.paint.get("fill-extrusion-base").evaluate(a,d),P=function(L,F,j){let Z=[];for(let J of L){let ue=[J.x,J.y,0,1];Wi(ue,ue,F),Z.push(new he(ue[0]/ue[3],ue[1]/ue[3]))}return Z}(C,b),k=function(L,F,j,Z){let J=[],ue=[],ne=Z[8]*F,N=Z[9]*F,q=Z[10]*F,re=Z[11]*F,_e=Z[8]*j,ke=Z[9]*j,xe=Z[10]*j,Ie=Z[11]*j;for(let Fe of L){let Ne=[],Be=[];for(let Pe of Fe){let Ke=Pe.x,st=Pe.y,rt=Z[0]*Ke+Z[4]*st+Z[12],Je=Z[1]*Ke+Z[5]*st+Z[13],At=Z[2]*Ke+Z[6]*st+Z[14],En=Z[3]*Ke+Z[7]*st+Z[15],Gn=At+q,yr=En+re,bi=rt+_e,Vr=Je+ke,ir=At+xe,xn=En+Ie,Wn=new he((rt+ne)/yr,(Je+N)/yr);Wn.z=Gn/yr,Ne.push(Wn);let or=new he(bi/xn,Vr/xn);or.z=ir/xn,Be.push(or)}J.push(Ne),ue.push(Be)}return[J,ue]}(p,D,I,b);return function(L,F,j){let Z=1/0;ch(j,F)&&(Z=pw(j,F[0]));for(let J=0;J<F.length;J++){let ue=F[J],ne=L[J];for(let N=0;N<ue.length-1;N++){let q=ue[N],re=[q,ue[N+1],ne[N+1],ne[N],q];ah(j,re)&&(Z=Math.min(Z,pw(j,re)))}}return Z!==1/0&&Z}(k[0],k[1],P)}}function xh(l,n){return l.x*n.x+l.y*n.y}function pw(l,n){if(l.length===1){let a=0,d=n[a++],p;for(;!p||d.equals(p);)if(p=n[a++],!p)return 1/0;for(;a<n.length;a++){let y=n[a],_=l[0],b=p.sub(d),C=y.sub(d),I=_.sub(d),D=xh(b,b),P=xh(b,C),k=xh(C,C),L=xh(I,b),F=xh(I,C),j=D*k-P*P,Z=(k*L-P*F)/j,J=(D*F-P*L)/j,ue=d.z*(1-Z-J)+p.z*Z+y.z*J;if(isFinite(ue))return ue}return 1/0}{let a=1/0;for(let d of n)a=Math.min(a,d.z);return a}}let ZS=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:WS}=ZS,XS=Sn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:YS}=XS,KS=vh.VectorTileFeature.types,QS=Math.cos(Math.PI/180*37.5),mw=Math.pow(2,14)/.5;class C_{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new oe,this.layoutVertexArray2=new se,this.indexArray=new Ee,this.programConfigurations=new bn(n.layers,n.zoom),this.segments=new Ge,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(n,a,d){this.hasPattern=f_("line",this.layers,a);let p=this.layers[0].layout.get("line-sort-key"),y=!p.isConstant(),_=[];for(let{feature:b,id:C,index:I,sourceLayerIndex:D}of n){let P=this.layers[0]._featureFilter.needGeometry,k=Is(b,P);if(!this.layers[0]._featureFilter.filter(new pn(this.zoom),k,d))continue;let L=y?p.evaluate(k,{},d):void 0,F={id:C,properties:b.properties,type:b.type,sourceLayerIndex:D,index:I,geometry:P?k.geometry:Es(b),patterns:{},sortKey:L};_.push(F)}y&&_.sort((b,C)=>b.sortKey-C.sortKey);for(let b of _){let{geometry:C,index:I,sourceLayerIndex:D}=b;if(this.hasPattern){let P=p_("line",this.layers,b,this.zoom,a);this.patternFeatures.push(P)}else this.addFeature(b,C,I,d,{},a.subdivisionGranularity);a.featureIndex.insert(n[I].feature,C,I,D,this.index)}}update(n,a,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,a,this.stateDependentLayers,d)}addFeatures(n,a,d){for(let p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,a,d,n.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,YS)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,WS),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,d,p,y,_){let b=this.layers[0].layout,C=b.get("line-join").evaluate(n,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(let k of a)this.addLine(k,n,C,I,D,P,p,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,d,y,p)}addLine(n,a,d,p,y,_,b,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,n=Tl(n,b?C.line.getGranularityForZoomLevel(b.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<n.length-1;ne++)this.totalDistance+=n[ne].dist(n[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let I=KS[a.type]==="Polygon",D=n.length;for(;D>=2&&n[D-1].equals(n[D-2]);)D--;let P=0;for(;P<D-1&&n[P].equals(n[P+1]);)P++;if(D<(I?3:2))return;d==="bevel"&&(y=1.05);let k=this.overscaling<=16?15*Zt/(512*this.overscaling):0,L=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),F,j,Z,J,ue;this.e1=this.e2=-1,I&&(F=n[D-2],ue=n[P].sub(F)._unit()._perp());for(let ne=P;ne<D;ne++){if(Z=ne===D-1?I?n[P+1]:void 0:n[ne+1],Z&&n[ne].equals(Z))continue;ue&&(J=ue),F&&(j=F),F=n[ne],ue=Z?Z.sub(F)._unit()._perp():J,J=J||ue;let N=J.add(ue);N.x===0&&N.y===0||N._unit();let q=J.x*ue.x+J.y*ue.y,re=N.x*ue.x+N.y*ue.y,_e=re!==0?1/re:1/0,ke=2*Math.sqrt(2-2*re),xe=re<QS&&j&&Z,Ie=J.x*ue.y-J.y*ue.x>0;if(xe&&ne>P){let Be=F.dist(j);if(Be>2*k){let Pe=F.sub(F.sub(j)._mult(k/Be)._round());this.updateDistance(j,Pe),this.addCurrentVertex(Pe,J,0,0,L),j=Pe}}let Fe=j&&Z,Ne=Fe?d:I?"butt":p;if(Fe&&Ne==="round"&&(_e<_?Ne="miter":_e<=2&&(Ne="fakeround")),Ne==="miter"&&_e>y&&(Ne="bevel"),Ne==="bevel"&&(_e>2&&(Ne="flipbevel"),_e<y&&(Ne="miter")),j&&this.updateDistance(j,F),Ne==="miter")N._mult(_e),this.addCurrentVertex(F,N,0,0,L);else if(Ne==="flipbevel"){if(_e>100)N=ue.mult(-1);else{let Be=_e*J.add(ue).mag()/J.sub(ue).mag();N._perp()._mult(Be*(Ie?-1:1))}this.addCurrentVertex(F,N,0,0,L),this.addCurrentVertex(F,N.mult(-1),0,0,L)}else if(Ne==="bevel"||Ne==="fakeround"){let Be=-Math.sqrt(_e*_e-1),Pe=Ie?Be:0,Ke=Ie?0:Be;if(j&&this.addCurrentVertex(F,J,Pe,Ke,L),Ne==="fakeround"){let st=Math.round(180*ke/Math.PI/20);for(let rt=1;rt<st;rt++){let Je=rt/st;if(Je!==.5){let En=Je-.5;Je+=Je*En*(Je-1)*((1.0904+q*(q*(3.55645-1.43519*q)-3.2452))*En*En+(.848013+q*(.215638*q-1.06021)))}let At=ue.sub(J)._mult(Je)._add(J)._unit()._mult(Ie?-1:1);this.addHalfVertex(F,At.x,At.y,!1,Ie,0,L)}}Z&&this.addCurrentVertex(F,ue,-Pe,-Ke,L)}else if(Ne==="butt")this.addCurrentVertex(F,N,0,0,L);else if(Ne==="square"){let Be=j?1:-1;this.addCurrentVertex(F,N,Be,Be,L)}else Ne==="round"&&(j&&(this.addCurrentVertex(F,J,0,0,L),this.addCurrentVertex(F,J,1,1,L,!0)),Z&&(this.addCurrentVertex(F,ue,-1,-1,L,!0),this.addCurrentVertex(F,ue,0,0,L)));if(xe&&ne<D-1){let Be=F.dist(Z);if(Be>2*k){let Pe=F.add(Z.sub(F)._mult(k/Be)._round());this.updateDistance(F,Pe),this.addCurrentVertex(Pe,ue,0,0,L),F=Pe}}}}addCurrentVertex(n,a,d,p,y,_=!1){let b=a.y*p-a.x,C=-a.y-a.x*p;this.addHalfVertex(n,a.x+a.y*d,a.y-a.x*d,_,!1,d,y),this.addHalfVertex(n,b,C,_,!0,-p,y),this.distance>mw/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,a,d,p,y,_))}addHalfVertex({x:n,y:a},d,p,y,_,b,C){let I=.5*(this.lineClips?this.scaledDistance*(mw-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(y?1:0),(a<<1)+(_?1:0),Math.round(63*d)+128,Math.round(63*p)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);let D=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,D,this.e2),C.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,a){this.distance+=n.dist(a),this.updateScaledDistance()}}let gw,yw;We("LineBucket",C_,{omit:["layers","patternFeatures"]});var _w={get paint(){return yw=yw||new Mr({"line-opacity":new ct(X.paint_line["line-opacity"]),"line-color":new ct(X.paint_line["line-color"]),"line-translate":new tt(X.paint_line["line-translate"]),"line-translate-anchor":new tt(X.paint_line["line-translate-anchor"]),"line-width":new ct(X.paint_line["line-width"]),"line-gap-width":new ct(X.paint_line["line-gap-width"]),"line-offset":new ct(X.paint_line["line-offset"]),"line-blur":new ct(X.paint_line["line-blur"]),"line-dasharray":new Vc(X.paint_line["line-dasharray"]),"line-pattern":new gl(X.paint_line["line-pattern"]),"line-gradient":new Uc(X.paint_line["line-gradient"])})},get layout(){return gw=gw||new Mr({"line-cap":new tt(X.layout_line["line-cap"]),"line-join":new ct(X.layout_line["line-join"]),"line-miter-limit":new tt(X.layout_line["line-miter-limit"]),"line-round-limit":new tt(X.layout_line["line-round-limit"]),"line-sort-key":new ct(X.layout_line["line-sort-key"])})}};class JS extends ct{possiblyEvaluate(n,a){return a=new pn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,d,p){return a=nr({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,d,p)}}let Hp;class eP extends Bi{constructor(n){super(n,_w),this.gradientVersion=0,Hp||(Hp=new JS(_w.paint.properties["line-width"].specification),Hp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){let a=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(a)&&a._styleExpression.expression instanceof fs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,a){super.recalculate(n,a),this.paint._values["line-floorwidth"]=Hp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new C_(n)}queryRadius(n){let a=n,d=vw(dh("line-width",this,a),dh("line-gap-width",this,a)),p=dh("line-offset",this,a);return d/2+Math.abs(p)+zp(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:n,feature:a,featureState:d,geometry:p,transform:y,pixelsToTileUnits:_}){let b=Bp(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-y.bearingInRadians,_),C=_/2*vw(this.paint.get("line-width").evaluate(a,d),this.paint.get("line-gap-width").evaluate(a,d)),I=this.paint.get("line-offset").evaluate(a,d);return I&&(p=function(D,P){let k=[];for(let L=0;L<D.length;L++){let F=D[L],j=[];for(let Z=0;Z<F.length;Z++){let J=F[Z-1],ue=F[Z],ne=F[Z+1],N=Z===0?new he(0,0):ue.sub(J)._unit()._perp(),q=Z===F.length-1?new he(0,0):ne.sub(ue)._unit()._perp(),re=N._add(q)._unit(),_e=re.x*q.x+re.y*q.y;_e!==0&&re._mult(1/_e),j.push(re._mult(P)._add(ue))}k.push(j)}return k}(p,I*_)),function(D,P,k){for(let L=0;L<P.length;L++){let F=P[L];if(D.length>=3){for(let j=0;j<F.length;j++)if(qc(D,F[j]))return!0}if(uh(D,F,k))return!0}return!1}(b,p,C)}isTileClipped(){return!0}}function vw(l,n){return n>0?n+2*l:l}let tP=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nP=Sn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let rP=Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Sn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let bw=Sn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),iP=Sn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function oP(l,n,a){return l.sections.forEach(d=>{d.text=function(p,y,_){let b=y.layout.get("text-transform").evaluate(_,{});return b==="uppercase"?p=p.toLocaleUpperCase():b==="lowercase"&&(p=p.toLocaleLowerCase()),no.applyArabicShaping&&(p=no.applyArabicShaping(p)),p}(d.text,n,a)}),l}Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Sn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Sn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);let wh={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"};var xw,E_,ww,Hn=24,I_={};function sP(){return xw||(xw=1,I_.read=function(l,n,a,d,p){var y,_,b=8*p-d-1,C=(1<<b)-1,I=C>>1,D=-7,P=a?p-1:0,k=a?-1:1,L=l[n+P];for(P+=k,y=L&(1<<-D)-1,L>>=-D,D+=b;D>0;y=256*y+l[n+P],P+=k,D-=8);for(_=y&(1<<-D)-1,y>>=-D,D+=d;D>0;_=256*_+l[n+P],P+=k,D-=8);if(y===0)y=1-I;else{if(y===C)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,d),y-=I}return(L?-1:1)*_*Math.pow(2,y-d)},I_.write=function(l,n,a,d,p,y){var _,b,C,I=8*y-p-1,D=(1<<I)-1,P=D>>1,k=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=d?0:y-1,F=d?1:-1,j=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(b=isNaN(n)?1:0,_=D):(_=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-_))<1&&(_--,C*=2),(n+=_+P>=1?k/C:k*Math.pow(2,1-P))*C>=2&&(_++,C/=2),_+P>=D?(b=0,_=D):_+P>=1?(b=(n*C-1)*Math.pow(2,p),_+=P):(b=n*Math.pow(2,P-1)*Math.pow(2,p),_=0));p>=8;l[a+L]=255&b,L+=F,b/=256,p-=8);for(_=_<<p|b,I+=p;I>0;l[a+L]=255&_,L+=F,_/=256,I-=8);l[a+L-F]|=128*j}),I_}function Cw(){if(ww)return E_;ww=1,E_=n;var l=sP();function n(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,d=1/a,p=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function y(N){return N.type===n.Bytes?N.readVarint()+N.pos:N.pos+1}function _(N,q,re){return re?4294967296*q+(N>>>0):4294967296*(q>>>0)+(N>>>0)}function b(N,q,re){var _e=q<=16383?1:q<=2097151?2:q<=268435455?3:Math.floor(Math.log(q)/(7*Math.LN2));re.realloc(_e);for(var ke=re.pos-1;ke>=N;ke--)re.buf[ke+_e]=re.buf[ke]}function C(N,q){for(var re=0;re<N.length;re++)q.writeVarint(N[re])}function I(N,q){for(var re=0;re<N.length;re++)q.writeSVarint(N[re])}function D(N,q){for(var re=0;re<N.length;re++)q.writeFloat(N[re])}function P(N,q){for(var re=0;re<N.length;re++)q.writeDouble(N[re])}function k(N,q){for(var re=0;re<N.length;re++)q.writeBoolean(N[re])}function L(N,q){for(var re=0;re<N.length;re++)q.writeFixed32(N[re])}function F(N,q){for(var re=0;re<N.length;re++)q.writeSFixed32(N[re])}function j(N,q){for(var re=0;re<N.length;re++)q.writeFixed64(N[re])}function Z(N,q){for(var re=0;re<N.length;re++)q.writeSFixed64(N[re])}function J(N,q){return(N[q]|N[q+1]<<8|N[q+2]<<16)+16777216*N[q+3]}function ue(N,q,re){N[re]=q,N[re+1]=q>>>8,N[re+2]=q>>>16,N[re+3]=q>>>24}function ne(N,q){return(N[q]|N[q+1]<<8|N[q+2]<<16)+(N[q+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(N,q,re){for(re=re||this.length;this.pos<re;){var _e=this.readVarint(),ke=_e>>3,xe=this.pos;this.type=7&_e,N(ke,q,this),this.pos===xe&&this.skip(_e)}return q},readMessage:function(N,q){return this.readFields(N,q,this.readVarint()+this.pos)},readFixed32:function(){var N=J(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=ne(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=J(this.buf,this.pos)+J(this.buf,this.pos+4)*a;return this.pos+=8,N},readSFixed64:function(){var N=J(this.buf,this.pos)+ne(this.buf,this.pos+4)*a;return this.pos+=8,N},readFloat:function(){var N=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var q,re,_e=this.buf;return q=127&(re=_e[this.pos++]),re<128?q:(q|=(127&(re=_e[this.pos++]))<<7,re<128?q:(q|=(127&(re=_e[this.pos++]))<<14,re<128?q:(q|=(127&(re=_e[this.pos++]))<<21,re<128?q:function(ke,xe,Ie){var Fe,Ne,Be=Ie.buf;if(Fe=(112&(Ne=Be[Ie.pos++]))>>4,Ne<128||(Fe|=(127&(Ne=Be[Ie.pos++]))<<3,Ne<128)||(Fe|=(127&(Ne=Be[Ie.pos++]))<<10,Ne<128)||(Fe|=(127&(Ne=Be[Ie.pos++]))<<17,Ne<128)||(Fe|=(127&(Ne=Be[Ie.pos++]))<<24,Ne<128)||(Fe|=(1&(Ne=Be[Ie.pos++]))<<31,Ne<128))return _(ke,Fe,xe);throw new Error("Expected varint not more than 10 bytes")}(q|=(15&(re=_e[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,q=this.pos;return this.pos=N,N-q>=12&&p?function(re,_e,ke){return p.decode(re.subarray(_e,ke))}(this.buf,q,N):function(re,_e,ke){for(var xe="",Ie=_e;Ie<ke;){var Fe,Ne,Be,Pe=re[Ie],Ke=null,st=Pe>239?4:Pe>223?3:Pe>191?2:1;if(Ie+st>ke)break;st===1?Pe<128&&(Ke=Pe):st===2?(192&(Fe=re[Ie+1]))==128&&(Ke=(31&Pe)<<6|63&Fe)<=127&&(Ke=null):st===3?(Ne=re[Ie+2],(192&(Fe=re[Ie+1]))==128&&(192&Ne)==128&&((Ke=(15&Pe)<<12|(63&Fe)<<6|63&Ne)<=2047||Ke>=55296&&Ke<=57343)&&(Ke=null)):st===4&&(Ne=re[Ie+2],Be=re[Ie+3],(192&(Fe=re[Ie+1]))==128&&(192&Ne)==128&&(192&Be)==128&&((Ke=(15&Pe)<<18|(63&Fe)<<12|(63&Ne)<<6|63&Be)<=65535||Ke>=1114112)&&(Ke=null)),Ke===null?(Ke=65533,st=1):Ke>65535&&(Ke-=65536,xe+=String.fromCharCode(Ke>>>10&1023|55296),Ke=56320|1023&Ke),xe+=String.fromCharCode(Ke),Ie+=st}return xe}(this.buf,q,N)},readBytes:function(){var N=this.readVarint()+this.pos,q=this.buf.subarray(this.pos,N);return this.pos=N,q},readPackedVarint:function(N,q){if(this.type!==n.Bytes)return N.push(this.readVarint(q));var re=y(this);for(N=N||[];this.pos<re;)N.push(this.readVarint(q));return N},readPackedSVarint:function(N){if(this.type!==n.Bytes)return N.push(this.readSVarint());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==n.Bytes)return N.push(this.readBoolean());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==n.Bytes)return N.push(this.readFloat());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==n.Bytes)return N.push(this.readDouble());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==n.Bytes)return N.push(this.readFixed32());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==n.Bytes)return N.push(this.readSFixed32());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==n.Bytes)return N.push(this.readFixed64());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==n.Bytes)return N.push(this.readSFixed64());var q=y(this);for(N=N||[];this.pos<q;)N.push(this.readSFixed64());return N},skip:function(N){var q=7&N;if(q===n.Varint)for(;this.buf[this.pos++]>127;);else if(q===n.Bytes)this.pos=this.readVarint()+this.pos;else if(q===n.Fixed32)this.pos+=4;else{if(q!==n.Fixed64)throw new Error("Unimplemented type: "+q);this.pos+=8}},writeTag:function(N,q){this.writeVarint(N<<3|q)},realloc:function(N){for(var q=this.length||16;q<this.pos+N;)q*=2;if(q!==this.length){var re=new Uint8Array(q);re.set(this.buf),this.buf=re,this.length=q}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),ue(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),ue(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),ue(this.buf,-1&N,this.pos),ue(this.buf,Math.floor(N*d),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),ue(this.buf,-1&N,this.pos),ue(this.buf,Math.floor(N*d),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function(q,re){var _e,ke;if(q>=0?(_e=q%4294967296|0,ke=q/4294967296|0):(ke=~(-q/4294967296),4294967295^(_e=~(-q%4294967296))?_e=_e+1|0:(_e=0,ke=ke+1|0)),q>=18446744073709552e3||q<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");re.realloc(10),function(xe,Ie,Fe){Fe.buf[Fe.pos++]=127&xe|128,xe>>>=7,Fe.buf[Fe.pos++]=127&xe|128,xe>>>=7,Fe.buf[Fe.pos++]=127&xe|128,xe>>>=7,Fe.buf[Fe.pos++]=127&xe|128,Fe.buf[Fe.pos]=127&(xe>>>=7)}(_e,0,re),function(xe,Ie){var Fe=(7&xe)<<4;Ie.buf[Ie.pos++]|=Fe|((xe>>>=3)?128:0),xe&&(Ie.buf[Ie.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Ie.buf[Ie.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Ie.buf[Ie.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Ie.buf[Ie.pos++]=127&xe|((xe>>>=7)?128:0),xe&&(Ie.buf[Ie.pos++]=127&xe)))))}(ke,re)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var q=this.pos;this.pos=function(_e,ke,xe){for(var Ie,Fe,Ne=0;Ne<ke.length;Ne++){if((Ie=ke.charCodeAt(Ne))>55295&&Ie<57344){if(!Fe){Ie>56319||Ne+1===ke.length?(_e[xe++]=239,_e[xe++]=191,_e[xe++]=189):Fe=Ie;continue}if(Ie<56320){_e[xe++]=239,_e[xe++]=191,_e[xe++]=189,Fe=Ie;continue}Ie=Fe-55296<<10|Ie-56320|65536,Fe=null}else Fe&&(_e[xe++]=239,_e[xe++]=191,_e[xe++]=189,Fe=null);Ie<128?_e[xe++]=Ie:(Ie<2048?_e[xe++]=Ie>>6|192:(Ie<65536?_e[xe++]=Ie>>12|224:(_e[xe++]=Ie>>18|240,_e[xe++]=Ie>>12&63|128),_e[xe++]=Ie>>6&63|128),_e[xe++]=63&Ie|128)}return xe}(this.buf,N,this.pos);var re=this.pos-q;re>=128&&b(q,re,this),this.pos=q-1,this.writeVarint(re),this.pos+=re},writeFloat:function(N){this.realloc(4),l.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),l.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var q=N.length;this.writeVarint(q),this.realloc(q);for(var re=0;re<q;re++)this.buf[this.pos++]=N[re]},writeRawMessage:function(N,q){this.pos++;var re=this.pos;N(q,this);var _e=this.pos-re;_e>=128&&b(re,_e,this),this.pos=re-1,this.writeVarint(_e),this.pos+=_e},writeMessage:function(N,q,re){this.writeTag(N,n.Bytes),this.writeRawMessage(q,re)},writePackedVarint:function(N,q){q.length&&this.writeMessage(N,C,q)},writePackedSVarint:function(N,q){q.length&&this.writeMessage(N,I,q)},writePackedBoolean:function(N,q){q.length&&this.writeMessage(N,k,q)},writePackedFloat:function(N,q){q.length&&this.writeMessage(N,D,q)},writePackedDouble:function(N,q){q.length&&this.writeMessage(N,P,q)},writePackedFixed32:function(N,q){q.length&&this.writeMessage(N,L,q)},writePackedSFixed32:function(N,q){q.length&&this.writeMessage(N,F,q)},writePackedFixed64:function(N,q){q.length&&this.writeMessage(N,j,q)},writePackedSFixed64:function(N,q){q.length&&this.writeMessage(N,Z,q)},writeBytesField:function(N,q){this.writeTag(N,n.Bytes),this.writeBytes(q)},writeFixed32Field:function(N,q){this.writeTag(N,n.Fixed32),this.writeFixed32(q)},writeSFixed32Field:function(N,q){this.writeTag(N,n.Fixed32),this.writeSFixed32(q)},writeFixed64Field:function(N,q){this.writeTag(N,n.Fixed64),this.writeFixed64(q)},writeSFixed64Field:function(N,q){this.writeTag(N,n.Fixed64),this.writeSFixed64(q)},writeVarintField:function(N,q){this.writeTag(N,n.Varint),this.writeVarint(q)},writeSVarintField:function(N,q){this.writeTag(N,n.Varint),this.writeSVarint(q)},writeStringField:function(N,q){this.writeTag(N,n.Bytes),this.writeString(q)},writeFloatField:function(N,q){this.writeTag(N,n.Fixed32),this.writeFloat(q)},writeDoubleField:function(N,q){this.writeTag(N,n.Fixed64),this.writeDouble(q)},writeBooleanField:function(N,q){this.writeVarintField(N,!!q)}},E_}var T_=x(Cw());let M_=3;function aP(l,n,a){l===1&&a.readMessage(lP,n)}function lP(l,n,a){if(l===3){let{id:d,bitmap:p,width:y,height:_,left:b,top:C,advance:I}=a.readMessage(cP,{});n.push({id:d,bitmap:new hh({width:y+2*M_,height:_+2*M_},p),metrics:{width:y,height:_,left:b,top:C,advance:I}})}}function cP(l,n,a){l===1?n.id=a.readVarint():l===2?n.bitmap=a.readBytes():l===3?n.width=a.readVarint():l===4?n.height=a.readVarint():l===5?n.left=a.readSVarint():l===6?n.top=a.readSVarint():l===7&&(n.advance=a.readVarint())}let uP=M_;function Ew(l){let n=0,a=0;for(let _ of l)n+=_.w*_.h,a=Math.max(a,_.w);l.sort((_,b)=>b.h-_.h);let d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}],p=0,y=0;for(let _ of l)for(let b=d.length-1;b>=0;b--){let C=d[b];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,y=Math.max(y,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===C.w&&_.h===C.h){let I=d.pop();b<d.length&&(d[b]=I)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(d.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:p,h:y,fill:n/(p*y)||0}}let jr=1;class D_{constructor(n,{pixelRatio:a,version:d,stretchX:p,stretchY:y,content:_,textFitWidth:b,textFitHeight:C}){this.paddedRect=n,this.pixelRatio=a,this.stretchX=p,this.stretchY=y,this.content=_,this.version=d,this.textFitWidth=b,this.textFitHeight=C}get tl(){return[this.paddedRect.x+jr,this.paddedRect.y+jr]}get br(){return[this.paddedRect.x+this.paddedRect.w-jr,this.paddedRect.y+this.paddedRect.h-jr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*jr)/this.pixelRatio,(this.paddedRect.h-2*jr)/this.pixelRatio]}}class Iw{constructor(n,a){let d={},p={};this.haveRenderCallbacks=[];let y=[];this.addImages(n,d,y),this.addImages(a,p,y);let{w:_,h:b}=Ew(y),C=new _i({width:_||1,height:b||1});for(let I in n){let D=n[I],P=d[I].paddedRect;_i.copy(D.data,C,{x:0,y:0},{x:P.x+jr,y:P.y+jr},D.data)}for(let I in a){let D=a[I],P=p[I].paddedRect,k=P.x+jr,L=P.y+jr,F=D.data.width,j=D.data.height;_i.copy(D.data,C,{x:0,y:0},{x:k,y:L},D.data),_i.copy(D.data,C,{x:0,y:j-1},{x:k,y:L-1},{width:F,height:1}),_i.copy(D.data,C,{x:0,y:0},{x:k,y:L+j},{width:F,height:1}),_i.copy(D.data,C,{x:F-1,y:0},{x:k-1,y:L},{width:1,height:j}),_i.copy(D.data,C,{x:0,y:0},{x:k+F,y:L},{width:1,height:j})}this.image=C,this.iconPositions=d,this.patternPositions=p}addImages(n,a,d){for(let p in n){let y=n[p],_={x:0,y:0,w:y.data.width+2*jr,h:y.data.height+2*jr};d.push(_),a[p]=new D_(_,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(n,a){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(let d in n.updatedImages)this.patchUpdatedImage(this.iconPositions[d],n.getImage(d),a),this.patchUpdatedImage(this.patternPositions[d],n.getImage(d),a)}patchUpdatedImage(n,a,d){if(!n||!a||n.version===a.version)return;n.version=a.version;let[p,y]=n.tl;d.update(a.data,void 0,{x:p,y})}}var ma;We("ImagePosition",D_),We("ImageAtlas",Iw),u.ai=void 0,(ma=u.ai||(u.ai={}))[ma.none=0]="none",ma[ma.horizontal=1]="horizontal",ma[ma.vertical=2]="vertical",ma[ma.horizontalOnly=3]="horizontalOnly";let Gp=-17;class Ch{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(n,a,d){let p=new Ch;return p.scale=n||1,p.fontStack=a,p.verticalAlign=d||"bottom",p}static forImage(n,a){let d=new Ch;return d.imageName=n,d.verticalAlign=a||"bottom",d}}class Yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){let d=new Yc;for(let p=0;p<n.sections.length;p++){let y=n.sections[p];y.image?d.addImageSection(y):d.addTextSection(y,a)}return d}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let a="";for(let d=0;d<n.length;d++){let p=n.charCodeAt(d+1)||null,y=n.charCodeAt(d-1)||null;a+=p&&Dp(p)&&!wh[n[d+1]]||y&&Dp(y)&&!wh[n[d-1]]||!wh[n[d]]?n[d]:wh[n[d]]}return a}(this.text)}trim(){let n=0;for(let d=0;d<this.text.length&&Zp[this.text.charCodeAt(d)];d++)n++;let a=this.text.length;for(let d=this.text.length-1;d>=0&&d>=n&&Zp[this.text.charCodeAt(d)];d--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){let d=new Yc;return d.text=this.text.substring(n,a),d.sectionIndex=this.sectionIndex.slice(n,a),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}getMaxImageSize(n){let a=0,d=0;for(let p=0;p<this.length();p++){let y=this.getSection(p);if(y.imageName){let _=n[y.imageName];if(!_)continue;let b=_.displaySize;a=Math.max(a,b[0]),d=Math.max(d,b[1])}}return{maxImageWidth:a,maxImageHeight:d}}addTextSection(n,a){this.text+=n.text,this.sections.push(Ch.forText(n.scale,n.fontStack||a,n.verticalAlign));let d=this.sections.length-1;for(let p=0;p<n.text.length;++p)this.sectionIndex.push(d)}addImageSection(n){let a=n.image?n.image.name:"";if(a.length===0)return void hr("Can't add FormattedSection with an empty image.");let d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Ch.forImage(a,n.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):hr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qp(l,n,a,d,p,y,_,b,C,I,D,P,k,L,F){let j=Yc.fromFeature(l,p),Z;P===u.ai.vertical&&j.verticalizePunctuation();let{processBidirectionalText:J,processStyledBidirectionalText:ue}=no;if(J&&j.sections.length===1){Z=[];let q=J(j.toString(),S_(j,I,y,n,d,L));for(let re of q){let _e=new Yc;_e.text=re,_e.sections=j.sections;for(let ke=0;ke<re.length;ke++)_e.sectionIndex.push(0);Z.push(_e)}}else if(ue){Z=[];let q=ue(j.text,j.sectionIndex,S_(j,I,y,n,d,L));for(let re of q){let _e=new Yc;_e.text=re[0],_e.sectionIndex=re[1],_e.sections=j.sections,Z.push(_e)}}else Z=function(q,re){let _e=[],ke=q.text,xe=0;for(let Ie of re)_e.push(q.substring(xe,Ie)),xe=Ie;return xe<ke.length&&_e.push(q.substring(xe,ke.length)),_e}(j,S_(j,I,y,n,d,L));let ne=[],N={positionedLines:ne,text:j.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(q,re,_e,ke,xe,Ie,Fe,Ne,Be,Pe,Ke,st){let rt=0,Je=0,At=0,En=0,Gn=Ne==="right"?1:Ne==="left"?0:.5,yr=Hn/st,bi=0;for(let xn of xe){xn.trim();let Wn=xn.getMaxScale(),or={positionedGlyphs:[],lineOffset:0};q.positionedLines[bi]=or;let sr=or.positionedGlyphs,Sr=0;if(!xn.length()){Je+=Ie,++bi;continue}let xi=pP(ke,xn,yr);for(let Ur=0;Ur<xn.length();Ur++){let qn=xn.getSection(Ur),Yn=xn.getSectionIndex(Ur),Kn=xn.getCharCode(Ur),Fn=mP(Be,Ke,Kn),un;if(qn.imageName){if(q.iconsInText=!0,qn.scale=qn.scale*yr,un=yP(qn,Fn,Wn,xi,ke),!un)continue;Sr=Math.max(Sr,un.imageOffset)}else if(un=gP(qn,Kn,Fn,xi,re,_e),!un)continue;let{rect:so,metrics:eu,baselineOffset:ao}=un;sr.push({glyph:Kn,imageName:qn.imageName,x:rt,y:Je+ao+Gp,vertical:Fn,scale:qn.scale,fontStack:qn.fontStack,sectionIndex:Yn,metrics:eu,rect:so}),Fn?(q.verticalizable=!0,rt+=(qn.imageName?eu.advance:Hn)*qn.scale+Pe):rt+=eu.advance*qn.scale+Pe}sr.length!==0&&(At=Math.max(rt-Pe,At),_P(sr,0,sr.length-1,Gn)),rt=0,or.lineOffset=Math.max(Sr,(Wn-1)*Hn);let Xn=Ie*Wn+Sr;Je+=Xn,En=Math.max(Xn,En),++bi}let{horizontalAlign:Vr,verticalAlign:ir}=P_(Fe);(function(xn,Wn,or,sr,Sr,xi,Xn,Ur,qn){let Yn=(Wn-or)*Sr,Kn=0;Kn=xi!==Xn?-Ur*sr-Gp:-sr*qn*Xn+.5*Xn;for(let Fn of xn)for(let un of Fn.positionedGlyphs)un.x+=Yn,un.y+=Kn})(q.positionedLines,Gn,Vr,ir,At,En,Ie,Je,xe.length),q.top+=-ir*Je,q.bottom=q.top+Je,q.left+=-Vr*At,q.right=q.left+At}(N,n,a,d,Z,_,b,C,P,I,k,F),!function(q){for(let re of q)if(re.positionedGlyphs.length!==0)return!1;return!0}(ne)&&N}let Zp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dP={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hP={40:!0};function Tw(l,n,a,d,p,y){if(n.imageName){let _=d[n.imageName];return _?_.displaySize[0]*n.scale*Hn/y+p:0}{let _=a[n.fontStack],b=_&&_[l];return b?b.metrics.advance*n.scale+p:0}}function Mw(l,n,a,d){let p=Math.pow(l-n,2);return d?l<n?p/2:2*p:p+Math.abs(a)*a}function fP(l,n,a){let d=0;return l===10&&(d-=1e4),a&&(d+=150),l!==40&&l!==65288||(d+=50),n!==41&&n!==65289||(d+=50),d}function Dw(l,n,a,d,p,y){let _=null,b=Mw(n,a,p,y);for(let C of d){let I=Mw(n-C.x,a,p,y)+C.badness;I<=b&&(_=C,b=I)}return{index:l,x:n,priorBreak:_,badness:b}}function Sw(l){return l?Sw(l.priorBreak).concat(l.index):[]}function S_(l,n,a,d,p,y){if(!l)return[];let _=[],b=function(P,k,L,F,j,Z){let J=0;for(let ue=0;ue<P.length();ue++){let ne=P.getSection(ue);J+=Tw(P.getCharCode(ue),ne,F,j,k,Z)}return J/Math.max(1,Math.ceil(J/L))}(l,n,a,d,p,y),C=l.text.indexOf("\u200B")>=0,I=0;for(let P=0;P<l.length();P++){let k=l.getSection(P),L=l.getCharCode(P);if(Zp[L]||(I+=Tw(L,k,d,p,n,y)),P<l.length()-1){let F=!((D=L)<11904)&&(!!Pt["CJK Compatibility Forms"](D)||!!Pt["CJK Compatibility"](D)||!!Pt["CJK Strokes"](D)||!!Pt["CJK Symbols and Punctuation"](D)||!!Pt["Enclosed CJK Letters and Months"](D)||!!Pt["Halfwidth and Fullwidth Forms"](D)||!!Pt["Ideographic Description Characters"](D)||!!Pt["Vertical Forms"](D)||Lc.test(String.fromCodePoint(D)));(dP[L]||F||k.imageName||P!==l.length()-2&&hP[l.getCharCode(P+1)])&&_.push(Dw(P+1,I,b,_,fP(L,l.getCharCode(P+1),F&&C),!1))}}var D;return Sw(Dw(l.length(),I,b,_,0,!0))}function P_(l){let n=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function pP(l,n,a){let d=n.getMaxScale()*Hn,{maxImageWidth:p,maxImageHeight:y}=n.getMaxImageSize(l),_=Math.max(d,y*a);return{verticalLineContentWidth:Math.max(d,p*a),horizontalLineContentHeight:_}}function Pw(l){switch(l){case"top":return 0;case"center":return .5;default:return 1}}function mP(l,n,a){return!(l===u.ai.horizontal||!n&&!Fc(a)||n&&(Zp[a]||(d=a,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(d)))));var d}function gP(l,n,a,d,p,y){let _=y[l.fontStack],b=function(I,D,P,k){if(I&&I.rect)return I;let L=D[P.fontStack],F=L&&L[k];return F?{rect:null,metrics:F.metrics}:null}(_&&_[n],p,l,n);if(b===null)return null;let C;if(a)C=d.verticalLineContentWidth-l.scale*Hn;else{let I=Pw(l.verticalAlign);C=(d.horizontalLineContentHeight-l.scale*Hn)*I}return{rect:b.rect,metrics:b.metrics,baselineOffset:C}}function yP(l,n,a,d,p){let y=p[l.imageName];if(!y)return null;let _=y.paddedRect,b=y.displaySize,C={width:b[0],height:b[1],left:jr,top:-3,advance:n?b[1]:b[0]},I;if(n)I=d.verticalLineContentWidth-b[1]*l.scale;else{let D=Pw(l.verticalAlign);I=(d.horizontalLineContentHeight-b[1]*l.scale)*D}return{rect:_,metrics:C,baselineOffset:I,imageOffset:(n?b[0]:b[1])*l.scale-Hn*a}}function _P(l,n,a,d){if(d===0)return;let p=l[a],y=(l[a].x+p.metrics.advance*p.scale)*d;for(let _=n;_<=a;_++)l[_].x-=y}function vP(l,n,a){let{horizontalAlign:d,verticalAlign:p}=P_(a),y=n[0]-l.displaySize[0]*d,_=n[1]-l.displaySize[1]*p;return{image:l,top:_,bottom:_+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function Aw(l){var n,a;let d=l.left,p=l.top,y=l.right-d,_=l.bottom-p,b=(n=l.image.textFitWidth)!==null&&n!==void 0?n:"stretchOrShrink",C=(a=l.image.textFitHeight)!==null&&a!==void 0?a:"stretchOrShrink",I=(l.image.content[2]-l.image.content[0])/(l.image.content[3]-l.image.content[1]);if(C==="proportional"){if(b==="stretchOnly"&&y/_<I||b==="proportional"){let D=Math.ceil(_*I);d*=D/y,y=D}}else if(b==="proportional"&&C==="stretchOnly"&&I!==0&&y/_>I){let D=Math.ceil(y/I);p*=D/_,_=D}return{x1:d,y1:p,x2:d+y,y2:p+_}}function Rw(l,n,a,d,p,y){let _=l.image,b;if(_.content){let Z=_.content,J=_.pixelRatio||1;b=[Z[0]/J,Z[1]/J,_.displaySize[0]-Z[2]/J,_.displaySize[1]-Z[3]/J]}let C=n.left*y,I=n.right*y,D,P,k,L;a==="width"||a==="both"?(L=p[0]+C-d[3],P=p[0]+I+d[1]):(L=p[0]+(C+I-_.displaySize[0])/2,P=L+_.displaySize[0]);let F=n.top*y,j=n.bottom*y;return a==="height"||a==="both"?(D=p[1]+F-d[0],k=p[1]+j+d[2]):(D=p[1]+(F+j-_.displaySize[1])/2,k=D+_.displaySize[1]),{image:_,top:D,right:P,bottom:k,left:L,collisionPadding:b}}let Eh=255,Oo=128,ga=Eh*Oo;function kw(l,n){let{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new pn(l+1))};if(a.kind==="source")return{kind:"source"};{let{zoomStops:d,interpolationType:p}=a,y=0;for(;y<d.length&&d[y]<=l;)y++;y=Math.max(0,y-1);let _=y;for(;_<d.length&&d[_]<l+1;)_++;_=Math.min(d.length-1,_);let b=d[y],C=d[_];return a.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:b,maxZoom:C,minSize:a.evaluate(new pn(b)),maxSize:a.evaluate(new pn(C)),interpolationType:p}}}function A_(l,n,a){let d="never",p=l.get(n);return p?d=p:l.get(a)&&(d="always"),d}let bP=vh.VectorTileFeature.types,xP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wp(l,n,a,d,p,y,_,b,C,I,D,P,k){let L=b?Math.min(ga,Math.round(b[0])):0,F=b?Math.min(ga,Math.round(b[1])):0;l.emplaceBack(n,a,Math.round(32*d),Math.round(32*p),y,_,(L<<1)+(C?1:0),F,16*I,16*D,256*P,256*k)}function R_(l,n,a){l.emplaceBack(n.x,n.y,a),l.emplaceBack(n.x,n.y,a),l.emplaceBack(n.x,n.y,a),l.emplaceBack(n.x,n.y,a)}function wP(l){for(let n of l.sections)if(Rp(n.text))return!0;return!1}class k_{constructor(n){this.layoutVertexArray=new le,this.indexArray=new Ee,this.programConfigurations=n,this.segments=new Ge,this.dynamicLayoutVertexArray=new ye,this.opacityVertexArray=new ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new w}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,a,d,p){this.isEmpty()||(d&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,tP.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,nP.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,xP,!0),this.opacityVertexBuffer.itemSize=1),(d||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}We("SymbolBuffers",k_);class O_{constructor(n,a,d){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new d,this.segments=new Ge,this.collisionVertexArray=new Re}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,rP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}We("CollisionBuffers",O_);class Kc{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];let a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kw(this.zoom,a["text-size"]),this.iconSizeData=kw(this.zoom,a["icon-size"]);let d=this.layers[0].layout,p=d.get("symbol-sort-key"),y=d.get("symbol-z-order");this.canOverlap=A_(d,"text-overlap","text-allow-overlap")!=="never"||A_(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(_=>u.ai[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID}createArrays(){this.text=new k_(new bn(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new k_(new bn(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new A,this.lineVertexArray=new R,this.symbolInstances=new T,this.textAnchorOffsets=new z}calculateGlyphDependencies(n,a,d,p,y){for(let _=0;_<n.length;_++)if(a[n.charCodeAt(_)]=!0,(d||p)&&y){let b=wh[n.charAt(_)];b&&(a[b.charCodeAt(0)]=!0)}}populate(n,a,d){let p=this.layers[0],y=p.layout,_=y.get("text-font"),b=y.get("text-field"),C=y.get("icon-image"),I=(b.value.kind!=="constant"||b.value.value instanceof In&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),D=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,P=y.get("symbol-sort-key");if(this.features=[],!I&&!D)return;let k=a.iconDependencies,L=a.glyphDependencies,F=a.availableImages,j=new pn(this.zoom);for(let{feature:Z,id:J,index:ue,sourceLayerIndex:ne}of n){let N=p._featureFilter.needGeometry,q=Is(Z,N);if(!p._featureFilter.filter(j,q,d))continue;let re,_e;if(N||(q.geometry=Es(Z)),I){let xe=p.getValueAndResolveTokens("text-field",q,d,F),Ie=In.factory(xe),Fe=this.hasRTLText=this.hasRTLText||wP(Ie);(!Fe||no.getRTLTextPluginStatus()==="unavailable"||Fe&&no.isParsed())&&(re=oP(Ie,p,q))}if(D){let xe=p.getValueAndResolveTokens("icon-image",q,d,F);_e=xe instanceof pr?xe:pr.fromString(xe)}if(!re&&!_e)continue;let ke=this.sortFeaturesByKey?P.evaluate(q,{},d):void 0;if(this.features.push({id:J,text:re,icon:_e,index:ue,sourceLayerIndex:ne,geometry:q.geometry,properties:Z.properties,type:bP[Z.type],sortKey:ke}),_e&&(k[_e.name]=!0),re){let xe=_.evaluate(q,{},d).join(","),Ie=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ai.vertical)>=0;for(let Fe of re.sections)if(Fe.image)k[Fe.image.name]=!0;else{let Ne=ua(re.toString()),Be=Fe.fontStack||xe,Pe=L[Be]=L[Be]||{};this.calculateGlyphDependencies(Fe.text,Pe,Ie,this.allowVerticalPlacement,Ne)}}}y.get("symbol-placement")==="line"&&(this.features=function(Z){let J={},ue={},ne=[],N=0;function q(xe){ne.push(Z[xe]),N++}function re(xe,Ie,Fe){let Ne=ue[xe];return delete ue[xe],ue[Ie]=Ne,ne[Ne].geometry[0].pop(),ne[Ne].geometry[0]=ne[Ne].geometry[0].concat(Fe[0]),Ne}function _e(xe,Ie,Fe){let Ne=J[Ie];return delete J[Ie],J[xe]=Ne,ne[Ne].geometry[0].shift(),ne[Ne].geometry[0]=Fe[0].concat(ne[Ne].geometry[0]),Ne}function ke(xe,Ie,Fe){let Ne=Fe?Ie[0][Ie[0].length-1]:Ie[0][0];return`${xe}:${Ne.x}:${Ne.y}`}for(let xe=0;xe<Z.length;xe++){let Ie=Z[xe],Fe=Ie.geometry,Ne=Ie.text?Ie.text.toString():null;if(!Ne){q(xe);continue}let Be=ke(Ne,Fe),Pe=ke(Ne,Fe,!0);if(Be in ue&&Pe in J&&ue[Be]!==J[Pe]){let Ke=_e(Be,Pe,Fe),st=re(Be,Pe,ne[Ke].geometry);delete J[Be],delete ue[Pe],ue[ke(Ne,ne[st].geometry,!0)]=st,ne[Ke].geometry=null}else Be in ue?re(Be,Pe,Fe):Pe in J?_e(Be,Pe,Fe):(q(xe),J[Be]=N-1,ue[Pe]=N-1)}return ne.filter(xe=>xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Z,J)=>Z.sortKey-J.sortKey)}update(n,a,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,a,this.layers,d),this.icon.programConfigurations.updatePaintArrays(n,a,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){let d=this.lineVertexArray.length;if(n.segment!==void 0){let p=n.dist(a[n.segment+1]),y=n.dist(a[n.segment]),_={};for(let b=n.segment+1;b<a.length;b++)_[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:p},b<a.length-1&&(p+=a[b+1].dist(a[b]));for(let b=n.segment||0;b>=0;b--)_[b]={x:a[b].x,y:a[b].y,tileUnitDistanceFromAnchor:y},b>0&&(y+=a[b-1].dist(a[b]));for(let b=0;b<a.length;b++){let C=_[b];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(n,a,d,p,y,_,b,C,I,D,P,k){let L=n.indexArray,F=n.layoutVertexArray,j=n.segments.prepareSegment(4*a.length,F,L,this.canOverlap?_.sortKey:void 0),Z=this.glyphOffsetArray.length,J=j.vertexLength,ue=this.allowVerticalPlacement&&b===u.ai.vertical?Math.PI/2:0,ne=_.text&&_.text.sections;for(let N=0;N<a.length;N++){let{tl:q,tr:re,bl:_e,br:ke,tex:xe,pixelOffsetTL:Ie,pixelOffsetBR:Fe,minFontScaleX:Ne,minFontScaleY:Be,glyphOffset:Pe,isSDF:Ke,sectionIndex:st}=a[N],rt=j.vertexLength,Je=Pe[1];Wp(F,C.x,C.y,q.x,Je+q.y,xe.x,xe.y,d,Ke,Ie.x,Ie.y,Ne,Be),Wp(F,C.x,C.y,re.x,Je+re.y,xe.x+xe.w,xe.y,d,Ke,Fe.x,Ie.y,Ne,Be),Wp(F,C.x,C.y,_e.x,Je+_e.y,xe.x,xe.y+xe.h,d,Ke,Ie.x,Fe.y,Ne,Be),Wp(F,C.x,C.y,ke.x,Je+ke.y,xe.x+xe.w,xe.y+xe.h,d,Ke,Fe.x,Fe.y,Ne,Be),R_(n.dynamicLayoutVertexArray,C,ue),L.emplaceBack(rt,rt+2,rt+1),L.emplaceBack(rt+1,rt+2,rt+3),j.vertexLength+=4,j.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pe[0]),N!==a.length-1&&st===a[N+1].sectionIndex||n.programConfigurations.populatePaintArrays(F.length,_,_.index,{},k,ne&&ne[st])}n.placedSymbolArray.emplaceBack(C.x,C.y,Z,this.glyphOffsetArray.length-Z,J,I,D,C.segment,d?d[0]:0,d?d[1]:0,p[0],p[1],b,0,!1,0,P)}_addCollisionDebugVertex(n,a,d,p,y,_){return a.emplaceBack(0,0),n.emplaceBack(d.x,d.y,p,y,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(n,a,d,p,y,_,b){let C=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),I=C.vertexLength,D=y.layoutVertexArray,P=y.collisionVertexArray,k=b.anchorX,L=b.anchorY;this._addCollisionDebugVertex(D,P,_,k,L,new he(n,a)),this._addCollisionDebugVertex(D,P,_,k,L,new he(d,a)),this._addCollisionDebugVertex(D,P,_,k,L,new he(d,p)),this._addCollisionDebugVertex(D,P,_,k,L,new he(n,p)),C.vertexLength+=4;let F=y.indexArray;F.emplaceBack(I,I+1),F.emplaceBack(I+1,I+2),F.emplaceBack(I+2,I+3),F.emplaceBack(I+3,I),C.primitiveLength+=4}addDebugCollisionBoxes(n,a,d,p){for(let y=n;y<a;y++){let _=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,p?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new O_(Se,bw.members,Ue),this.iconCollisionBox=new O_(Se,bw.members,Ue);for(let n=0;n<this.symbolInstances.length;n++){let a=this.symbolInstances.get(n);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(n,a,d,p,y,_,b,C,I){let D={};for(let P=a;P<d;P++){let k=n.get(P);D.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},D.textFeatureIndex=k.featureIndex;break}for(let P=p;P<y;P++){let k=n.get(P);D.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},D.verticalTextFeatureIndex=k.featureIndex;break}for(let P=_;P<b;P++){let k=n.get(P);D.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},D.iconFeatureIndex=k.featureIndex;break}for(let P=C;P<I;P++){let k=n.get(P);D.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,anchorPointX:k.anchorPointX,anchorPointY:k.anchorPointY},D.verticalIconFeatureIndex=k.featureIndex;break}return D}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){let d=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,a){let d=n.placedSymbolArray.get(a),p=d.vertexStartIndex+4*d.numGlyphs;for(let y=d.vertexStartIndex;y<p;y+=4)n.indexArray.emplaceBack(y,y+2,y+1),n.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let a=Math.sin(n),d=Math.cos(n),p=[],y=[],_=[];for(let b=0;b<this.symbolInstances.length;++b){_.push(b);let C=this.symbolInstances.get(b);p.push(0|Math.round(a*C.anchorX+d*C.anchorY)),y.push(C.featureIndex)}return _.sort((b,C)=>p[b]-p[C]||y[C]-y[b]),_}addToSortKeyRanges(n,a){let d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===a?d.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let a of this.symbolInstanceIndexes){let d=this.symbolInstances.get(a);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((p,y,_)=>{p>=0&&_.indexOf(p)===y&&this.addIndicesForPlacedSymbol(this.text,p)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ow,Nw;We("SymbolBucket",Kc,{omit:["layers","collisionBoxArray","features","compareText"]}),Kc.MAX_GLYPHS=65535,Kc.addDynamicAttributes=R_;var N_={get paint(){return Nw=Nw||new Mr({"icon-opacity":new ct(X.paint_symbol["icon-opacity"]),"icon-color":new ct(X.paint_symbol["icon-color"]),"icon-halo-color":new ct(X.paint_symbol["icon-halo-color"]),"icon-halo-width":new ct(X.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ct(X.paint_symbol["icon-halo-blur"]),"icon-translate":new tt(X.paint_symbol["icon-translate"]),"icon-translate-anchor":new tt(X.paint_symbol["icon-translate-anchor"]),"text-opacity":new ct(X.paint_symbol["text-opacity"]),"text-color":new ct(X.paint_symbol["text-color"],{runtimeType:Et,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new ct(X.paint_symbol["text-halo-color"]),"text-halo-width":new ct(X.paint_symbol["text-halo-width"]),"text-halo-blur":new ct(X.paint_symbol["text-halo-blur"]),"text-translate":new tt(X.paint_symbol["text-translate"]),"text-translate-anchor":new tt(X.paint_symbol["text-translate-anchor"])})},get layout(){return Ow=Ow||new Mr({"symbol-placement":new tt(X.layout_symbol["symbol-placement"]),"symbol-spacing":new tt(X.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new tt(X.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ct(X.layout_symbol["symbol-sort-key"]),"symbol-z-order":new tt(X.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new tt(X.layout_symbol["icon-allow-overlap"]),"icon-overlap":new tt(X.layout_symbol["icon-overlap"]),"icon-ignore-placement":new tt(X.layout_symbol["icon-ignore-placement"]),"icon-optional":new tt(X.layout_symbol["icon-optional"]),"icon-rotation-alignment":new tt(X.layout_symbol["icon-rotation-alignment"]),"icon-size":new ct(X.layout_symbol["icon-size"]),"icon-text-fit":new tt(X.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new tt(X.layout_symbol["icon-text-fit-padding"]),"icon-image":new ct(X.layout_symbol["icon-image"]),"icon-rotate":new ct(X.layout_symbol["icon-rotate"]),"icon-padding":new ct(X.layout_symbol["icon-padding"]),"icon-keep-upright":new tt(X.layout_symbol["icon-keep-upright"]),"icon-offset":new ct(X.layout_symbol["icon-offset"]),"icon-anchor":new ct(X.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new tt(X.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new tt(X.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new tt(X.layout_symbol["text-rotation-alignment"]),"text-field":new ct(X.layout_symbol["text-field"]),"text-font":new ct(X.layout_symbol["text-font"]),"text-size":new ct(X.layout_symbol["text-size"]),"text-max-width":new ct(X.layout_symbol["text-max-width"]),"text-line-height":new tt(X.layout_symbol["text-line-height"]),"text-letter-spacing":new ct(X.layout_symbol["text-letter-spacing"]),"text-justify":new ct(X.layout_symbol["text-justify"]),"text-radial-offset":new ct(X.layout_symbol["text-radial-offset"]),"text-variable-anchor":new tt(X.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ct(X.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ct(X.layout_symbol["text-anchor"]),"text-max-angle":new tt(X.layout_symbol["text-max-angle"]),"text-writing-mode":new tt(X.layout_symbol["text-writing-mode"]),"text-rotate":new ct(X.layout_symbol["text-rotate"]),"text-padding":new tt(X.layout_symbol["text-padding"]),"text-keep-upright":new tt(X.layout_symbol["text-keep-upright"]),"text-transform":new ct(X.layout_symbol["text-transform"]),"text-offset":new ct(X.layout_symbol["text-offset"]),"text-allow-overlap":new tt(X.layout_symbol["text-allow-overlap"]),"text-overlap":new tt(X.layout_symbol["text-overlap"]),"text-ignore-placement":new tt(X.layout_symbol["text-ignore-placement"]),"text-optional":new tt(X.layout_symbol["text-optional"])})}};class Lw{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:pt,this.defaultValue=n}evaluate(n){if(n.formattedSection){let a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}We("FormatSectionOverride",Lw,{omit:["defaultValue"]});class Xp extends Bi{constructor(n){super(n,N_)}recalculate(n,a){if(super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){let d=this.layout.get("text-writing-mode");if(d){let p=[];for(let y of d)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,a,d,p){let y=this.layout.get(n).evaluate(a,{},d,p),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Ic(_.value)||!y?y:function(b,C){return C.replace(/{([^{}]+)}/g,(I,D)=>b&&D in b?String(b[D]):"")}(a.properties,y)}createBucket(n){return new Kc(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(let n of N_.paint.overridableProperties){if(!Xp.hasPaintOverride(this.layout,n))continue;let a=this.paint.get(n),d=new Lw(a),p=new Ec(d,a.property.specification),y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new ra("source",p):new Mc("composite",p,a.value.zoomStops),this.paint._values[n]=new zi(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,d){return!(!this.layout||a.isDataDriven()||d.isDataDriven())&&Xp.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){let d=n.get("text-field"),p=N_.paint.properties[a],y=!1,_=b=>{for(let C of b)if(p.overrides&&p.overrides.hasOverride(C))return void(y=!0)};if(d.value.kind==="constant"&&d.value.value instanceof In)_(d.value.value.sections);else if(d.value.kind==="source"){let b=I=>{y||(I instanceof Fi&&ln(I.value)===Mo?_(I.value.sections):I instanceof rl?_(I.sections):I.eachChild(b))},C=d.value;C._styleExpression&&b(C._styleExpression.expression)}return y}}let Fw;var CP={get paint(){return Fw=Fw||new Mr({"background-color":new tt(X.paint_background["background-color"]),"background-pattern":new Vc(X.paint_background["background-pattern"]),"background-opacity":new tt(X.paint_background["background-opacity"])})}};class EP extends Bi{constructor(n){super(n,CP)}}let zw;var IP={get paint(){return zw=zw||new Mr({"raster-opacity":new tt(X.paint_raster["raster-opacity"]),"raster-hue-rotate":new tt(X.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new tt(X.paint_raster["raster-brightness-min"]),"raster-brightness-max":new tt(X.paint_raster["raster-brightness-max"]),"raster-saturation":new tt(X.paint_raster["raster-saturation"]),"raster-contrast":new tt(X.paint_raster["raster-contrast"]),"raster-resampling":new tt(X.paint_raster["raster-resampling"]),"raster-fade-duration":new tt(X.paint_raster["raster-fade-duration"])})}};class TP extends Bi{constructor(n){super(n,IP)}}class MP extends Bi{constructor(n){super(n,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class DP{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}let L_=63710088e-1;class ya{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ya(Zr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){let a=Math.PI/180,d=this.lat*a,p=n.lat*a,y=Math.sin(d)*Math.sin(p)+Math.cos(d)*Math.cos(p)*Math.cos((n.lng-this.lng)*a);return L_*Math.acos(Math.min(y,1))}static convert(n){if(n instanceof ya)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ya(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ya(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}let Bw=2*Math.PI*L_;function jw(l){return Bw*Math.cos(l*Math.PI/180)}function Vw(l){return(180+l)/360}function Uw(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function $w(l,n){return l/jw(n)}function F_(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Hw(l,n){return l*jw(F_(n))}class Ih{constructor(n,a,d=0){this.x=+n,this.y=+a,this.z=+d}static fromLngLat(n,a=0){let d=ya.convert(n);return new Ih(Vw(d.lng),Uw(d.lat),$w(a,d.lat))}toLngLat(){return new ya(360*this.x-180,F_(this.y))}toAltitude(){return Hw(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bw*(n=F_(this.y),1/Math.cos(n*Math.PI/180));var n}}function Gw(l,n,a){var d=2*Math.PI*6378137/256/Math.pow(2,a);return[l*d-2*Math.PI*6378137/2,n*d-2*Math.PI*6378137/2]}class z_{constructor(n,a,d){if(!function(p,y,_){return!(p<0||p>25||_<0||_>=Math.pow(2,p)||y<0||y>=Math.pow(2,p))}(n,a,d))throw new Error(`x=${a}, y=${d}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=a,this.y=d,this.key=Qc(0,n,n,a,d)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a,d){let p=(_=this.y,b=this.z,C=Gw(256*(y=this.x),256*(_=Math.pow(2,b)-_-1),b),I=Gw(256*(y+1),256*(_+1),b),C[0]+","+C[1]+","+I[0]+","+I[1]);var y,_,b,C,I;let D=function(P,k,L){let F,j="";for(let Z=P;Z>0;Z--)F=1<<Z-1,j+=(k&F?1:0)+(L&F?2:0);return j}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,p)}isChildOf(n){let a=this.z-n.z;return a>0&&n.x===this.x>>a&&n.y===this.y>>a}getTilePoint(n){let a=Math.pow(2,this.z);return new he((n.x*a-this.x)*Zt,(n.y*a-this.y)*Zt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qw{constructor(n,a){this.wrap=n,this.canonical=a,this.key=Qc(n,a.z,a.z,a.x,a.y)}}class vi{constructor(n,a,d,p,y){if(this.terrainRttPosMatrix32f=null,n<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${d}`);this.overscaledZ=n,this.wrap=a,this.canonical=new z_(d,+p,+y),this.key=Qc(a,n,d,p,y)}clone(){return new vi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);let a=this.canonical.z-n;return n>this.canonical.z?new vi(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vi(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);let d=this.canonical.z-n;return n>this.canonical.z?Qc(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y):Qc(this.wrap*+a,n,n,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(n){if(n.wrap!==this.wrap)return!1;let a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new vi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let a=this.canonical.z+1,d=2*this.canonical.x,p=2*this.canonical.y;return[new vi(a,this.wrap,a,d,p),new vi(a,this.wrap,a,d+1,p),new vi(a,this.wrap,a,d,p+1),new vi(a,this.wrap,a,d+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new vi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new vi(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Ih(n.x-this.wrap,n.y))}}function Qc(l,n,a,d,p){(l*=2)<0&&(l=-1*l-1);let y=1<<a;return(y*y*l+y*p+d).toString(36)+a.toString(36)+n.toString(36)}We("CanonicalTileID",z_),We("OverscaledTileID",vi,{omit:["terrainRttPosMatrix32f"]});class Zw{constructor(n,a,d,p=1,y=1,_=1,b=0){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void hr(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=a.height;let C=this.dim=a.height-2;switch(this.data=new Uint32Array(a.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=y,this.blueFactor=_,this.baseShift=b;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<C;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(C,I)]=this.data[this._idx(C-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,C)]=this.data[this._idx(I,C-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(C,-1)]=this.data[this._idx(C-1,0)],this.data[this._idx(-1,C)]=this.data[this._idx(0,C-1)],this.data[this._idx(C,C)]=this.data[this._idx(C-1,C-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<C;I++)for(let D=0;D<C;D++){let P=this.get(I,D);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(n,a){let d=new Uint8Array(this.data.buffer),p=4*this._idx(n,a);return this.unpack(d[p],d[p+1],d[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}unpack(n,a,d){return n*this.redFactor+a*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new _i({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,a,d){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=a*this.dim,y=a*this.dim+this.dim,_=d*this.dim,b=d*this.dim+this.dim;switch(a){case-1:p=y-1;break;case 1:y=p+1}switch(d){case-1:_=b-1;break;case 1:b=_+1}let C=-a*this.dim,I=-d*this.dim;for(let D=_;D<b;D++)for(let P=p;P<y;P++)this.data[this._idx(P,D)]=n.data[this._idx(P+C,D+I)]}}We("DEMData",Zw);class Ww{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){let d=n[a];this._stringToNumber[d]=a,this._numberToString[a]=d}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class Xw{constructor(n,a,d,p,y){this.type="Feature",this._vectorTileFeature=n,n._z=a,n._x=d,n._y=p,this.properties=n.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){let n={geometry:this.geometry};for(let a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(n[a]=this[a]);return n}}class Yw{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new xs(Zt,16,0),this.grid3D=new xs(Zt,16,0),this.featureIndexArray=new K,this.promoteId=a}insert(n,a,d,p,y,_){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,p,y);let C=_?this.grid3D:this.grid;for(let I=0;I<a.length;I++){let D=a[I],P=[1/0,1/0,-1/0,-1/0];for(let k=0;k<D.length;k++){let L=D[k];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Zt&&P[1]<Zt&&P[2]>=0&&P[3]>=0&&C.insert(b,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new vh.VectorTile(new T_(this.rawTileData)).layers,this.sourceLayerCoder=new Ww(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,a,d,p){this.loadVTLayers();let y=n.params,_=Zt/n.tileSize/n.scale,b=Pc(y.filter),C=n.queryGeometry,I=n.queryPadding*_,D=Qw(C),P=this.grid.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I),k=Qw(n.cameraQueryGeometry),L=this.grid3D.query(k.minX-I,k.minY-I,k.maxX+I,k.maxY+I,(Z,J,ue,ne)=>function(N,q,re,_e,ke){for(let Ie of N)if(q<=Ie.x&&re<=Ie.y&&_e>=Ie.x&&ke>=Ie.y)return!0;let xe=[new he(q,re),new he(q,ke),new he(_e,ke),new he(_e,re)];if(N.length>2){for(let Ie of xe)if(qc(N,Ie))return!0}for(let Ie=0;Ie<N.length-1;Ie++)if(yS(N[Ie],N[Ie+1],xe))return!0;return!1}(n.cameraQueryGeometry,Z-I,J-I,ue+I,ne+I));for(let Z of L)P.push(Z);P.sort(SP);let F={},j;for(let Z=0;Z<P.length;Z++){let J=P[Z];if(J===j)continue;j=J;let ue=this.featureIndexArray.get(J),ne=null;this.loadMatchingFeature(F,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,b,y.layers,y.availableImages,a,d,p,(N,q,re)=>(ne||(ne=Es(N)),q.queryIntersectsFeature({queryGeometry:C,feature:N,featureState:re,geometry:ne,zoom:this.z,transform:n.transform,pixelsToTileUnits:_,pixelPosMatrix:n.pixelPosMatrix})))}return F}loadMatchingFeature(n,a,d,p,y,_,b,C,I,D,P){let k=this.bucketLayerIDs[a];if(_&&!k.some(Z=>_.has(Z)))return;let L=this.sourceLayerCoder.decode(d),F=this.vtLayers[L].feature(p);if(y.needGeometry){let Z=Is(F,!0);if(!y.filter(new pn(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!y.filter(new pn(this.tileID.overscaledZ),F))return;let j=this.getId(F,L);for(let Z=0;Z<k.length;Z++){let J=k[Z];if(_&&!_.has(J))continue;let ue=C[J];if(!ue)continue;let ne={};j&&D&&(ne=D.getState(ue.sourceLayer||"_geojsonTileLayer",j));let N=nr({},I[J]);N.paint=Kw(N.paint,ue.paint,F,ne,b),N.layout=Kw(N.layout,ue.layout,F,ne,b);let q=!P||P(F,ue,ne);if(!q)continue;let re=new Xw(F,this.z,this.x,this.y,j);re.layer=N;let _e=n[J];_e===void 0&&(_e=n[J]=[]),_e.push({featureIndex:p,feature:re,intersectionZ:q})}}lookupSymbolFeatures(n,a,d,p,y,_,b,C){let I={};this.loadVTLayers();let D=Pc(y);for(let P of n)this.loadMatchingFeature(I,d,p,P,D,_,b,C,a);return I}hasLayer(n){for(let a of this.bucketLayerIDs)for(let d of a)if(n===d)return!0;return!1}getId(n,a){var d;let p=n.id;return this.promoteId&&(p=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((d=n.properties)===null||d===void 0)&&d.cluster)&&this.promoteId&&(p=Number(n.properties.cluster_id))),p}}function Kw(l,n,a,d,p){return Qo(l,(y,_)=>{let b=n instanceof da?n.get(_):null;return b&&b.evaluate?b.evaluate(a,d,p):b})}function Qw(l){let n=1/0,a=1/0,d=-1/0,p=-1/0;for(let y of l)n=Math.min(n,y.x),a=Math.min(a,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return{minX:n,minY:a,maxX:d,maxY:p}}function SP(l,n){return n-l}function Jw(l,n,a,d,p){let y=[];for(let _=0;_<l.length;_++){let b=l[_],C;for(let I=0;I<b.length-1;I++){let D=b[I],P=b[I+1];D.x<n&&P.x<n||(D.x<n?D=new he(n,D.y+(n-D.x)/(P.x-D.x)*(P.y-D.y))._round():P.x<n&&(P=new he(n,D.y+(n-D.x)/(P.x-D.x)*(P.y-D.y))._round()),D.y<a&&P.y<a||(D.y<a?D=new he(D.x+(a-D.y)/(P.y-D.y)*(P.x-D.x),a)._round():P.y<a&&(P=new he(D.x+(a-D.y)/(P.y-D.y)*(P.x-D.x),a)._round()),D.x>=d&&P.x>=d||(D.x>=d?D=new he(d,D.y+(d-D.x)/(P.x-D.x)*(P.y-D.y))._round():P.x>=d&&(P=new he(d,D.y+(d-D.x)/(P.x-D.x)*(P.y-D.y))._round()),D.y>=p&&P.y>=p||(D.y>=p?D=new he(D.x+(p-D.y)/(P.y-D.y)*(P.x-D.x),p)._round():P.y>=p&&(P=new he(D.x+(p-D.y)/(P.y-D.y)*(P.x-D.x),p)._round()),C&&D.equals(C[C.length-1])||(C=[D],y.push(C)),C.push(P)))))}}return y}We("FeatureIndex",Yw,{omit:["rawTileData","sourceLayerCoder"]});class _a extends he{constructor(n,a,d,p){super(n,a),this.angle=d,p!==void 0&&(this.segment=p)}clone(){return new _a(this.x,this.y,this.angle,this.segment)}}function e1(l,n,a,d,p){if(n.segment===void 0||a===0)return!0;let y=n,_=n.segment+1,b=0;for(;b>-a/2;){if(_--,_<0)return!1;b-=l[_].dist(y),y=l[_]}b+=l[_].dist(l[_+1]),_++;let C=[],I=0;for(;b<a/2;){let D=l[_],P=l[_+1];if(!P)return!1;let k=l[_-1].angleTo(D)-D.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:b,angleDelta:k}),I+=k;b-C[0].distance>d;)I-=C.shift().angleDelta;if(I>p)return!1;_++,b+=D.dist(P)}return!0}function t1(l){let n=0;for(let a=0;a<l.length-1;a++)n+=l[a].dist(l[a+1]);return n}function n1(l,n,a){return l?.6*n*a:0}function r1(l,n){return Math.max(l?l.right-l.left:0,n?n.right-n.left:0)}function PP(l,n,a,d,p,y){let _=n1(a,p,y),b=r1(a,d)*y,C=0,I=t1(l)/2;for(let D=0;D<l.length-1;D++){let P=l[D],k=l[D+1],L=P.dist(k);if(C+L>I){let F=(I-C)/L,j=gi.number(P.x,k.x,F),Z=gi.number(P.y,k.y,F),J=new _a(j,Z,k.angleTo(P),D);return J._round(),!_||e1(l,J,b,_,n)?J:void 0}C+=L}}function AP(l,n,a,d,p,y,_,b,C){let I=n1(d,y,_),D=r1(d,p),P=D*_,k=l[0].x===0||l[0].x===C||l[0].y===0||l[0].y===C;return n-P<n/4&&(n=P+n/4),i1(l,k?n/2*b%n:(D/2+2*y)*_*b%n,n,I,a,P,k,!1,C)}function i1(l,n,a,d,p,y,_,b,C){let I=y/2,D=t1(l),P=0,k=n-a,L=[];for(let F=0;F<l.length-1;F++){let j=l[F],Z=l[F+1],J=j.dist(Z),ue=Z.angleTo(j);for(;k+a<P+J;){k+=a;let ne=(k-P)/J,N=gi.number(j.x,Z.x,ne),q=gi.number(j.y,Z.y,ne);if(N>=0&&N<C&&q>=0&&q<C&&k-I>=0&&k+I<=D){let re=new _a(N,q,ue,F);re._round(),d&&!e1(l,re,y,d,p)||L.push(re)}}P+=J}return b||L.length||_||(L=i1(l,P/2,a,d,p,y,_,!0,C)),L}We("Anchor",_a);let Th=jr;function o1(l,n,a,d){let p=[],y=l.image,_=y.pixelRatio,b=y.paddedRect.w-2*Th,C=y.paddedRect.h-2*Th,I={x1:l.left,y1:l.top,x2:l.right,y2:l.bottom},D=y.stretchX||[[0,b]],P=y.stretchY||[[0,C]],k=(Pe,Ke)=>Pe+Ke[1]-Ke[0],L=D.reduce(k,0),F=P.reduce(k,0),j=b-L,Z=C-F,J=0,ue=L,ne=0,N=F,q=0,re=j,_e=0,ke=Z;if(y.content&&d){let Pe=y.content,Ke=Pe[2]-Pe[0],st=Pe[3]-Pe[1];(y.textFitWidth||y.textFitHeight)&&(I=Aw(l)),J=Yp(D,0,Pe[0]),ne=Yp(P,0,Pe[1]),ue=Yp(D,Pe[0],Pe[2]),N=Yp(P,Pe[1],Pe[3]),q=Pe[0]-J,_e=Pe[1]-ne,re=Ke-ue,ke=st-N}let xe=I.x1,Ie=I.y1,Fe=I.x2-xe,Ne=I.y2-Ie,Be=(Pe,Ke,st,rt)=>{let Je=Kp(Pe.stretch-J,ue,Fe,xe),At=Qp(Pe.fixed-q,re,Pe.stretch,L),En=Kp(Ke.stretch-ne,N,Ne,Ie),Gn=Qp(Ke.fixed-_e,ke,Ke.stretch,F),yr=Kp(st.stretch-J,ue,Fe,xe),bi=Qp(st.fixed-q,re,st.stretch,L),Vr=Kp(rt.stretch-ne,N,Ne,Ie),ir=Qp(rt.fixed-_e,ke,rt.stretch,F),xn=new he(Je,En),Wn=new he(yr,En),or=new he(yr,Vr),sr=new he(Je,Vr),Sr=new he(At/_,Gn/_),xi=new he(bi/_,ir/_),Xn=n*Math.PI/180;if(Xn){let Yn=Math.sin(Xn),Kn=Math.cos(Xn),Fn=[Kn,-Yn,Yn,Kn];xn._matMult(Fn),Wn._matMult(Fn),sr._matMult(Fn),or._matMult(Fn)}let Ur=Pe.stretch+Pe.fixed,qn=Ke.stretch+Ke.fixed;return{tl:xn,tr:Wn,bl:sr,br:or,tex:{x:y.paddedRect.x+Th+Ur,y:y.paddedRect.y+Th+qn,w:st.stretch+st.fixed-Ur,h:rt.stretch+rt.fixed-qn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sr,pixelOffsetBR:xi,minFontScaleX:re/_/Fe,minFontScaleY:ke/_/Ne,isSDF:a}};if(d&&(y.stretchX||y.stretchY)){let Pe=s1(D,j,L),Ke=s1(P,Z,F);for(let st=0;st<Pe.length-1;st++){let rt=Pe[st],Je=Pe[st+1];for(let At=0;At<Ke.length-1;At++)p.push(Be(rt,Ke[At],Je,Ke[At+1]))}}else p.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:C+1}));return p}function Yp(l,n,a){let d=0;for(let p of l)d+=Math.max(n,Math.min(a,p[1]))-Math.max(n,Math.min(a,p[0]));return d}function s1(l,n,a){let d=[{fixed:-1,stretch:0}];for(let[p,y]of l){let _=d[d.length-1];d.push({fixed:p-_.stretch,stretch:_.stretch}),d.push({fixed:p-_.stretch,stretch:_.stretch+(y-p)})}return d.push({fixed:n+Th,stretch:a}),d}function Kp(l,n,a,d){return l/n*a+d}function Qp(l,n,a,d){return l-n*a/d}class Jp{constructor(n,a,d,p,y,_,b,C,I,D){var P;if(this.boxStartIndex=n.length,I){let k=_.top,L=_.bottom,F=_.collisionPadding;F&&(k-=F[1],L+=F[3]);let j=L-k;j>0&&(j=Math.max(10,j),this.circleDiameter=j)}else{let k=!((P=_.image)===null||P===void 0)&&P.content&&(_.image.textFitWidth||_.image.textFitHeight)?Aw(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};k.y1=k.y1*b-C[0],k.y2=k.y2*b+C[2],k.x1=k.x1*b-C[3],k.x2=k.x2*b+C[1];let L=_.collisionPadding;if(L&&(k.x1-=L[0]*b,k.y1-=L[1]*b,k.x2+=L[2]*b,k.y2+=L[3]*b),D){let F=new he(k.x1,k.y1),j=new he(k.x2,k.y1),Z=new he(k.x1,k.y2),J=new he(k.x2,k.y2),ue=D*Math.PI/180;F._rotate(ue),j._rotate(ue),Z._rotate(ue),J._rotate(ue),k.x1=Math.min(F.x,j.x,Z.x,J.x),k.x2=Math.max(F.x,j.x,Z.x,J.x),k.y1=Math.min(F.y,j.y,Z.y,J.y),k.y2=Math.max(F.y,j.y,Z.y,J.y)}n.emplaceBack(a.x,a.y,k.x1,k.y1,k.x2,k.y2,d,p,y)}this.boxEndIndex=n.length}}class RP{constructor(n=[],a=(d,p)=>d<p?-1:d>p?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;let n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){let{data:a,compare:d}=this,p=a[n];for(;n>0;){let y=n-1>>1,_=a[y];if(d(p,_)>=0)break;a[n]=_,n=y}a[n]=p}_down(n){let{data:a,compare:d}=this,p=this.length>>1,y=a[n];for(;n<p;){let _=1+(n<<1),b=_+1;if(b<this.length&&d(a[b],a[_])<0&&(_=b),d(a[_],y)>=0)break;a[n]=a[_],n=_}a[n]=y}}function kP(l,n=1,a=!1){let d=1/0,p=1/0,y=-1/0,_=-1/0,b=l[0];for(let L=0;L<b.length;L++){let F=b[L];(!L||F.x<d)&&(d=F.x),(!L||F.y<p)&&(p=F.y),(!L||F.x>y)&&(y=F.x),(!L||F.y>_)&&(_=F.y)}let C=Math.min(y-d,_-p),I=C/2,D=new RP([],OP);if(C===0)return new he(d,p);for(let L=d;L<y;L+=C)for(let F=p;F<_;F+=C)D.push(new Jc(L+I,F+I,I,l));let P=function(L){let F=0,j=0,Z=0,J=L[0];for(let ue=0,ne=J.length,N=ne-1;ue<ne;N=ue++){let q=J[ue],re=J[N],_e=q.x*re.y-re.x*q.y;j+=(q.x+re.x)*_e,Z+=(q.y+re.y)*_e,F+=3*_e}return new Jc(j/F,Z/F,0,L)}(l),k=D.length;for(;D.length;){let L=D.pop();(L.d>P.d||!P.d)&&(P=L,a&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,k)),L.max-P.d<=n||(I=L.h/2,D.push(new Jc(L.p.x-I,L.p.y-I,I,l)),D.push(new Jc(L.p.x+I,L.p.y-I,I,l)),D.push(new Jc(L.p.x-I,L.p.y+I,I,l)),D.push(new Jc(L.p.x+I,L.p.y+I,I,l)),k+=4)}return a&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function OP(l,n){return n.max-l.max}function Jc(l,n,a,d){this.p=new he(l,n),this.h=a,this.d=function(p,y){let _=!1,b=1/0;for(let C=0;C<y.length;C++){let I=y[C];for(let D=0,P=I.length,k=P-1;D<P;k=D++){let L=I[D],F=I[k];L.y>p.y!=F.y>p.y&&p.x<(F.x-L.x)*(p.y-L.y)/(F.y-L.y)+L.x&&(_=!_),b=Math.min(b,jx(p,L,F))}}return(_?1:-1)*Math.sqrt(b)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var gr;u.av=void 0,(gr=u.av||(u.av={}))[gr.center=1]="center",gr[gr.left=2]="left",gr[gr.right=3]="right",gr[gr.top=4]="top",gr[gr.bottom=5]="bottom",gr[gr["top-left"]=6]="top-left",gr[gr["top-right"]=7]="top-right",gr[gr["bottom-left"]=8]="bottom-left",gr[gr["bottom-right"]=9]="bottom-right";let va=7,B_=Number.POSITIVE_INFINITY;function a1(l,n){return n[1]!==B_?function(a,d,p){let y=0,_=0;switch(d=Math.abs(d),p=Math.abs(p),a){case"top-right":case"top-left":case"top":_=p-va;break;case"bottom-right":case"bottom-left":case"bottom":_=-p+va}switch(a){case"top-right":case"bottom-right":case"right":y=-d;break;case"top-left":case"bottom-left":case"left":y=d}return[y,_]}(l,n[0],n[1]):function(a,d){let p=0,y=0;d<0&&(d=0);let _=d/Math.SQRT2;switch(a){case"top-right":case"top-left":y=_-va;break;case"bottom-right":case"bottom-left":y=-_+va;break;case"bottom":y=-d+va;break;case"top":y=d-va}switch(a){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=d;break;case"right":p=-d}return[p,y]}(l,n[0])}function l1(l,n,a){var d;let p=l.layout,y=(d=p.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(n,{},a);if(y){let b=y.values,C=[];for(let I=0;I<b.length;I+=2){let D=C[I]=b[I],P=b[I+1].map(k=>k*Hn);D.startsWith("top")?P[1]-=va:D.startsWith("bottom")&&(P[1]+=va),C[I+1]=P}return new fr(C)}let _=p.get("text-variable-anchor");if(_){let b;b=l._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(n,{},a)*Hn,B_]:p.get("text-offset").evaluate(n,{},a).map(I=>I*Hn);let C=[];for(let I of _)C.push(I,a1(I,b));return new fr(C)}return null}function j_(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function NP(l,n,a,d,p,y,_,b,C,I,D,P){let k=y.textMaxSize.evaluate(n,{});k===void 0&&(k=_);let L=l.layers[0].layout,F=L.get("icon-offset").evaluate(n,{},D),j=u1(a.horizontal),Z=_/24,J=l.tilePixelRatio*Z,ue=l.tilePixelRatio*k/24,ne=l.tilePixelRatio*b,N=l.tilePixelRatio*L.get("symbol-spacing"),q=L.get("text-padding")*l.tilePixelRatio,re=function(st,rt,Je,At=1){let En=st.get("icon-padding").evaluate(rt,{},Je),Gn=En&&En.values;return[Gn[0]*At,Gn[1]*At,Gn[2]*At,Gn[3]*At]}(L,n,D,l.tilePixelRatio),_e=L.get("text-max-angle")/180*Math.PI,ke=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",xe=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ie=L.get("symbol-placement"),Fe=N/2,Ne=L.get("icon-text-fit"),Be;d&&Ne!=="none"&&(l.allowVerticalPlacement&&a.vertical&&(Be=Rw(d,a.vertical,Ne,L.get("icon-text-fit-padding"),F,Z)),j&&(d=Rw(d,j,Ne,L.get("icon-text-fit-padding"),F,Z)));let Pe=D?P.line.getGranularityForZoomLevel(D.z):1,Ke=(st,rt)=>{rt.x<0||rt.x>=Zt||rt.y<0||rt.y>=Zt||function(Je,At,En,Gn,yr,bi,Vr,ir,xn,Wn,or,sr,Sr,xi,Xn,Ur,qn,Yn,Kn,Fn,un,so,eu,ao,zP){let tu=Je.addToLineVertexArray(At,En),Ml,nu,ru,iu,p1=0,m1=0,g1=0,y1=0,W_=-1,X_=-1,Ts={},_1=Nn("");if(Je.allowVerticalPlacement&&Gn.vertical){let Ir=ir.layout.get("text-rotate").evaluate(un,{},ao)+90;ru=new Jp(xn,At,Wn,or,sr,Gn.vertical,Sr,xi,Xn,Ir),Vr&&(iu=new Jp(xn,At,Wn,or,sr,Vr,qn,Yn,Xn,Ir))}if(yr){let Ir=ir.layout.get("icon-rotate").evaluate(un,{}),wi=ir.layout.get("icon-text-fit")!=="none",Dl=o1(yr,Ir,eu,wi),co=Vr?o1(Vr,Ir,eu,wi):void 0;nu=new Jp(xn,At,Wn,or,sr,yr,qn,Yn,!1,Ir),p1=4*Dl.length;let Sl=Je.iconSizeData,No=null;Sl.kind==="source"?(No=[Oo*ir.layout.get("icon-size").evaluate(un,{})],No[0]>ga&&hr(`${Je.layerIds[0]}: Value for "icon-size" is >= ${Eh}. Reduce your "icon-size".`)):Sl.kind==="composite"&&(No=[Oo*so.compositeIconSizes[0].evaluate(un,{},ao),Oo*so.compositeIconSizes[1].evaluate(un,{},ao)],(No[0]>ga||No[1]>ga)&&hr(`${Je.layerIds[0]}: Value for "icon-size" is >= ${Eh}. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,Dl,No,Fn,Kn,un,u.ai.none,At,tu.lineStartIndex,tu.lineLength,-1,ao),W_=Je.icon.placedSymbolArray.length-1,co&&(m1=4*co.length,Je.addSymbols(Je.icon,co,No,Fn,Kn,un,u.ai.vertical,At,tu.lineStartIndex,tu.lineLength,-1,ao),X_=Je.icon.placedSymbolArray.length-1)}let v1=Object.keys(Gn.horizontal);for(let Ir of v1){let wi=Gn.horizontal[Ir];if(!Ml){_1=Nn(wi.text);let co=ir.layout.get("text-rotate").evaluate(un,{},ao);Ml=new Jp(xn,At,Wn,or,sr,wi,Sr,xi,Xn,co)}let Dl=wi.positionedLines.length===1;if(g1+=c1(Je,At,wi,bi,ir,Xn,un,Ur,tu,Gn.vertical?u.ai.horizontal:u.ai.horizontalOnly,Dl?v1:[Ir],Ts,W_,so,ao),Dl)break}Gn.vertical&&(y1+=c1(Je,At,Gn.vertical,bi,ir,Xn,un,Ur,tu,u.ai.vertical,["vertical"],Ts,X_,so,ao));let BP=Ml?Ml.boxStartIndex:Je.collisionBoxArray.length,jP=Ml?Ml.boxEndIndex:Je.collisionBoxArray.length,VP=ru?ru.boxStartIndex:Je.collisionBoxArray.length,UP=ru?ru.boxEndIndex:Je.collisionBoxArray.length,$P=nu?nu.boxStartIndex:Je.collisionBoxArray.length,HP=nu?nu.boxEndIndex:Je.collisionBoxArray.length,GP=iu?iu.boxStartIndex:Je.collisionBoxArray.length,qP=iu?iu.boxEndIndex:Je.collisionBoxArray.length,lo=-1,tm=(Ir,wi)=>Ir&&Ir.circleDiameter?Math.max(Ir.circleDiameter,wi):wi;lo=tm(Ml,lo),lo=tm(ru,lo),lo=tm(nu,lo),lo=tm(iu,lo);let b1=lo>-1?1:0;b1&&(lo*=zP/Hn),Je.glyphOffsetArray.length>=Kc.MAX_GLYPHS&&hr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),un.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,un.sortKey);let ZP=l1(ir,un,ao),[WP,XP]=function(Ir,wi){let Dl=Ir.length,co=wi?.values;if(co?.length>0)for(let Sl=0;Sl<co.length;Sl+=2){let No=co[Sl+1];Ir.emplaceBack(u.av[co[Sl]],No[0],No[1])}return[Dl,Ir.length]}(Je.textAnchorOffsets,ZP);Je.symbolInstances.emplaceBack(At.x,At.y,Ts.right>=0?Ts.right:-1,Ts.center>=0?Ts.center:-1,Ts.left>=0?Ts.left:-1,Ts.vertical||-1,W_,X_,_1,BP,jP,VP,UP,$P,HP,GP,qP,Wn,g1,y1,p1,m1,b1,0,Sr,lo,WP,XP)}(l,rt,st,a,d,p,Be,l.layers[0],l.collisionBoxArray,n.index,n.sourceLayerIndex,l.index,J,[q,q,q,q],ke,C,ne,re,xe,F,n,y,I,D,_)};if(Ie==="line")for(let st of Jw(n.geometry,0,0,Zt,Zt)){let rt=Tl(st,Pe),Je=AP(rt,N,_e,a.vertical||j,d,24,ue,l.overscaling,Zt);for(let At of Je)j&&LP(l,j.text,Fe,At)||Ke(rt,At)}else if(Ie==="line-center"){for(let st of n.geometry)if(st.length>1){let rt=Tl(st,Pe),Je=PP(rt,_e,a.vertical||j,d,24,ue);Je&&Ke(rt,Je)}}else if(n.type==="Polygon")for(let st of mc(n.geometry,0)){let rt=kP(st,16);Ke(Tl(st[0],Pe,!0),new _a(rt.x,rt.y,0))}else if(n.type==="LineString")for(let st of n.geometry){let rt=Tl(st,Pe);Ke(rt,new _a(rt[0].x,rt[0].y,0))}else if(n.type==="Point")for(let st of n.geometry)for(let rt of st)Ke([rt],new _a(rt.x,rt.y,0))}function c1(l,n,a,d,p,y,_,b,C,I,D,P,k,L,F){let j=function(ue,ne,N,q,re,_e,ke,xe){let Ie=q.layout.get("text-rotate").evaluate(_e,{})*Math.PI/180,Fe=[];for(let Ne of ne.positionedLines)for(let Be of Ne.positionedGlyphs){if(!Be.rect)continue;let Pe=Be.rect||{},Ke=uP+1,st=!0,rt=1,Je=0,At=(re||xe)&&Be.vertical,En=Be.metrics.advance*Be.scale/2;if(xe&&ne.verticalizable&&(Je=Ne.lineOffset/2-(Be.imageName?-(Hn-Be.metrics.width*Be.scale)/2:(Be.scale-1)*Hn)),Be.imageName){let Yn=ke[Be.imageName];st=Yn.sdf,rt=Yn.pixelRatio,Ke=jr/rt}let Gn=re?[Be.x+En,Be.y]:[0,0],yr=re?[0,0]:[Be.x+En+N[0],Be.y+N[1]-Je],bi=[0,0];At&&(bi=yr,yr=[0,0]);let Vr=Be.metrics.isDoubleResolution?2:1,ir=(Be.metrics.left-Ke)*Be.scale-En+yr[0],xn=(-Be.metrics.top-Ke)*Be.scale+yr[1],Wn=ir+Pe.w/Vr*Be.scale/rt,or=xn+Pe.h/Vr*Be.scale/rt,sr=new he(ir,xn),Sr=new he(Wn,xn),xi=new he(ir,or),Xn=new he(Wn,or);if(At){let Yn=new he(-En,En-Gp),Kn=-Math.PI/2,Fn=Hn/2-En,un=new he(5-Gp-Fn,-(Be.imageName?Fn:0)),so=new he(...bi);sr._rotateAround(Kn,Yn)._add(un)._add(so),Sr._rotateAround(Kn,Yn)._add(un)._add(so),xi._rotateAround(Kn,Yn)._add(un)._add(so),Xn._rotateAround(Kn,Yn)._add(un)._add(so)}if(Ie){let Yn=Math.sin(Ie),Kn=Math.cos(Ie),Fn=[Kn,-Yn,Yn,Kn];sr._matMult(Fn),Sr._matMult(Fn),xi._matMult(Fn),Xn._matMult(Fn)}let Ur=new he(0,0),qn=new he(0,0);Fe.push({tl:sr,tr:Sr,bl:xi,br:Xn,tex:Pe,writingMode:ne.writingMode,glyphOffset:Gn,sectionIndex:Be.sectionIndex,isSDF:st,pixelOffsetTL:Ur,pixelOffsetBR:qn,minFontScaleX:0,minFontScaleY:0})}return Fe}(0,a,b,p,y,_,d,l.allowVerticalPlacement),Z=l.textSizeData,J=null;Z.kind==="source"?(J=[Oo*p.layout.get("text-size").evaluate(_,{})],J[0]>ga&&hr(`${l.layerIds[0]}: Value for "text-size" is >= ${Eh}. Reduce your "text-size".`)):Z.kind==="composite"&&(J=[Oo*L.compositeTextSizes[0].evaluate(_,{},F),Oo*L.compositeTextSizes[1].evaluate(_,{},F)],(J[0]>ga||J[1]>ga)&&hr(`${l.layerIds[0]}: Value for "text-size" is >= ${Eh}. Reduce your "text-size".`)),l.addSymbols(l.text,j,J,b,y,_,I,n,C.lineStartIndex,C.lineLength,k,F);for(let ue of D)P[ue]=l.text.placedSymbolArray.length-1;return 4*j.length}function u1(l){for(let n in l)return l[n];return null}function LP(l,n,a,d){let p=l.compareText;if(n in p){let y=p[n];for(let _=y.length-1;_>=0;_--)if(d.dist(y[_])<a)return!0}else p[n]=[];return p[n].push(d),!1}let d1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class V_{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[a,d]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");let p=d>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);let y=d1[15&d];if(!y)throw new Error("Unrecognized array type.");let[_]=new Uint16Array(n,2,1),[b]=new Uint32Array(n,4,1);return new V_(b,_,y,n)}constructor(n,a=64,d=Float64Array,p){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=d,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;let y=d1.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,b=n*this.IndexArrayType.BYTES_PER_ELEMENT,C=(8-b%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${d}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+C,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+b+C),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+C,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){let d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=n,this.coords[this._pos++]=a,d}finish(){let n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return U_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,d,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:y,coords:_,nodeSize:b}=this,C=[0,y.length-1,0],I=[];for(;C.length;){let D=C.pop()||0,P=C.pop()||0,k=C.pop()||0;if(P-k<=b){for(let Z=k;Z<=P;Z++){let J=_[2*Z],ue=_[2*Z+1];J>=n&&J<=d&&ue>=a&&ue<=p&&I.push(y[Z])}continue}let L=k+P>>1,F=_[2*L],j=_[2*L+1];F>=n&&F<=d&&j>=a&&j<=p&&I.push(y[L]),(D===0?n<=F:a<=j)&&(C.push(k),C.push(L-1),C.push(1-D)),(D===0?d>=F:p>=j)&&(C.push(L+1),C.push(P),C.push(1-D))}return I}within(n,a,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:p,coords:y,nodeSize:_}=this,b=[0,p.length-1,0],C=[],I=d*d;for(;b.length;){let D=b.pop()||0,P=b.pop()||0,k=b.pop()||0;if(P-k<=_){for(let Z=k;Z<=P;Z++)f1(y[2*Z],y[2*Z+1],n,a)<=I&&C.push(p[Z]);continue}let L=k+P>>1,F=y[2*L],j=y[2*L+1];f1(F,j,n,a)<=I&&C.push(p[L]),(D===0?n-d<=F:a-d<=j)&&(b.push(k),b.push(L-1),b.push(1-D)),(D===0?n+d>=F:a+d>=j)&&(b.push(L+1),b.push(P),b.push(1-D))}return C}}function U_(l,n,a,d,p,y){if(p-d<=a)return;let _=d+p>>1;h1(l,n,_,d,p,y),U_(l,n,a,d,_-1,1-y),U_(l,n,a,_+1,p,1-y)}function h1(l,n,a,d,p,y){for(;p>d;){if(p-d>600){let I=p-d+1,D=a-d+1,P=Math.log(I),k=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*k*(I-k)/I)*(D-I/2<0?-1:1);h1(l,n,a,Math.max(d,Math.floor(a-D*k/I+L)),Math.min(p,Math.floor(a+(I-D)*k/I+L)),y)}let _=n[2*a+y],b=d,C=p;for(Mh(l,n,d,a),n[2*p+y]>_&&Mh(l,n,d,p);b<C;){for(Mh(l,n,b,C),b++,C--;n[2*b+y]<_;)b++;for(;n[2*C+y]>_;)C--}n[2*d+y]===_?Mh(l,n,d,C):(C++,Mh(l,n,C,p)),C<=a&&(d=C+1),a<=C&&(p=C-1)}}function Mh(l,n,a,d){$_(l,a,d),$_(n,2*a,2*d),$_(n,2*a+1,2*d+1)}function $_(l,n,a){let d=l[n];l[n]=l[a],l[a]=d}function f1(l,n,a,d){let p=l-a,y=n-d;return p*p+y*y}var H_;u.ce=void 0,(H_=u.ce||(u.ce={})).create="create",H_.load="load",H_.fullLoad="fullLoad";let em=null,Dh=[],G_=1e3/60,q_="loadTime",Z_="fullLoadTime",FP={mark(l){performance.mark(l)},frame(l){let n=l;em!=null&&Dh.push(n-em),em=n},clearMetrics(){em=null,Dh=[],performance.clearMeasures(q_),performance.clearMeasures(Z_);for(let l in u.ce)performance.clearMarks(u.ce[l])},getPerformanceMetrics(){performance.measure(q_,u.ce.create,u.ce.load),performance.measure(Z_,u.ce.create,u.ce.fullLoad);let l=performance.getEntriesByName(q_)[0].duration,n=performance.getEntriesByName(Z_)[0].duration,a=Dh.length,d=1/(Dh.reduce((y,_)=>y+_,0)/a/1e3),p=Dh.filter(y=>y>G_).reduce((y,_)=>y+(_-G_)/G_,0);return{loadTime:l,fullLoadTime:n,fps:d,percentDroppedFrames:p/(a+p)*100,totalFrames:a}}};u.$=de,u.A=dt,u.B=pl,u.C=function(l){if(Dn==null){let n=l.navigator?l.navigator.userAgent:null;Dn=!!l.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Dn},u.D=tt,u.E=To,u.F=class{constructor(l,n){this.target=l,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new DP(()=>this.process()),this.subscription=function(a,d,p,y){return a.addEventListener(d,p,!1),{unsubscribe:()=>{a.removeEventListener(d,p,!1)}}}(this.target,"message",a=>this.receive(a)),this.globalScope=Xi(self)?l:window}registerMessageHandler(l,n){this.messageHandlers[l]=n}sendAsync(l,n){return new Promise((a,d)=>{let p=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[p]={resolve:a,reject:d},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[p];let b={id:p,type:"<cancel>",origin:location.origin,targetMapId:l.targetMapId,sourceMapId:this.mapId};this.target.postMessage(b)},{once:!0});let y=[],_=Object.assign(Object.assign({},l),{id:p,sourceMapId:this.mapId,origin:location.origin,data:ml(l.data,y)});this.target.postMessage(_,{transfer:y})})}receive(l){let n=l.data,a=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!=="resource://android"&&location.origin!=="resource://android"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[a];let d=this.abortControllers[a];return delete this.abortControllers[a],void(d&&d.abort())}if(Xi(self)||n.mustQueue)return this.tasks[a]=n,this.taskQueue.push(a),void this.invoker.trigger();this.processTask(a,n)}}process(){if(this.taskQueue.length===0)return;let l=this.taskQueue.shift(),n=this.tasks[l];delete this.tasks[l],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(l,n)}processTask(l,n){return s(this,void 0,void 0,function*(){if(n.type==="<response>"){let p=this.resolveRejects[l];return delete this.resolveRejects[l],p?void(n.error?p.reject(Ao(n.error)):p.resolve(Ao(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(l,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));let a=Ao(n.data),d=new AbortController;this.abortControllers[l]=d;try{let p=yield this.messageHandlers[n.type](n.sourceMapId,a,d);this.completeTask(l,null,p)}catch(p){this.completeTask(l,p)}})}completeTask(l,n,a){let d=[];delete this.abortControllers[l];let p={id:l,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?ml(n):null,data:ml(a,d)};this.target.postMessage(p,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=is,u.H=function(){var l=new dt(16);return dt!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l},u.I=D_,u.J=function(l,n,a){var d,p,y,_,b,C,I,D,P,k,L,F,j=a[0],Z=a[1],J=a[2];return n===l?(l[12]=n[0]*j+n[4]*Z+n[8]*J+n[12],l[13]=n[1]*j+n[5]*Z+n[9]*J+n[13],l[14]=n[2]*j+n[6]*Z+n[10]*J+n[14],l[15]=n[3]*j+n[7]*Z+n[11]*J+n[15]):(p=n[1],y=n[2],_=n[3],b=n[4],C=n[5],I=n[6],D=n[7],P=n[8],k=n[9],L=n[10],F=n[11],l[0]=d=n[0],l[1]=p,l[2]=y,l[3]=_,l[4]=b,l[5]=C,l[6]=I,l[7]=D,l[8]=P,l[9]=k,l[10]=L,l[11]=F,l[12]=d*j+b*Z+P*J+n[12],l[13]=p*j+C*Z+k*J+n[13],l[14]=y*j+I*Z+L*J+n[14],l[15]=_*j+D*Z+F*J+n[15]),l},u.K=function(l,n,a){var d=a[0],p=a[1],y=a[2];return l[0]=n[0]*d,l[1]=n[1]*d,l[2]=n[2]*d,l[3]=n[3]*d,l[4]=n[4]*p,l[5]=n[5]*p,l[6]=n[6]*p,l[7]=n[7]*p,l[8]=n[8]*y,l[9]=n[9]*y,l[10]=n[10]*y,l[11]=n[11]*y,l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l},u.L=function(l,n,a){var d=n[0],p=n[1],y=n[2],_=n[3],b=n[4],C=n[5],I=n[6],D=n[7],P=n[8],k=n[9],L=n[10],F=n[11],j=n[12],Z=n[13],J=n[14],ue=n[15],ne=a[0],N=a[1],q=a[2],re=a[3];return l[0]=ne*d+N*b+q*P+re*j,l[1]=ne*p+N*C+q*k+re*Z,l[2]=ne*y+N*I+q*L+re*J,l[3]=ne*_+N*D+q*F+re*ue,l[4]=(ne=a[4])*d+(N=a[5])*b+(q=a[6])*P+(re=a[7])*j,l[5]=ne*p+N*C+q*k+re*Z,l[6]=ne*y+N*I+q*L+re*J,l[7]=ne*_+N*D+q*F+re*ue,l[8]=(ne=a[8])*d+(N=a[9])*b+(q=a[10])*P+(re=a[11])*j,l[9]=ne*p+N*C+q*k+re*Z,l[10]=ne*y+N*I+q*L+re*J,l[11]=ne*_+N*D+q*F+re*ue,l[12]=(ne=a[12])*d+(N=a[13])*b+(q=a[14])*P+(re=a[15])*j,l[13]=ne*p+N*C+q*k+re*Z,l[14]=ne*y+N*I+q*L+re*J,l[15]=ne*_+N*D+q*F+re*ue,l},u.M=function(l,n){let a={};for(let d=0;d<n.length;d++){let p=n[d];p in l&&(a[p]=l[p])}return a},u.N=ya,u.O=Vw,u.P=he,u.Q=Uw,u.R=_i,u.S=vi,u.T=Yd,u.U=lt,u.V=gt,u.W=pi,u.X=Zt,u.Y=Ih,u.Z=z_,u._=s,u.a=Eo,u.a$=function(){return new Float64Array(16)},u.a0=l=>{let n=window.document.createElement("video");return n.muted=!0,new Promise(a=>{n.onloadstart=()=>{a(n)};for(let d of l){let p=window.document.createElement("source");ss(d)||(n.crossOrigin="Anonymous"),p.src=d,n.appendChild(p)}})},u.a1=function(){return Ko++},u.a2=g,u.a3=Kc,u.a4=Pc,u.a5=Is,u.a6=Xw,u.a7=function(l){let n={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,d,p,y)=>{let _=p||y;return n[d]=!_||_.toLowerCase(),""}),n["max-age"]){let a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n},u.a8=function(l){return Math.log(l)/Math.LN2},u.a9=function(l){var n=l[0],a=l[1];return n*n+a*a},u.aA=Sn,u.aB=Up,u.aC=Y,u.aD=Ge,u.aE=Ee,u.aF=85.051129,u.aG=function(l){return Math.pow(2,l)},u.aH=$w,u.aI=Zr,u.aJ=Or,u.aK=Hw,u.aL=function(l,n,a){return l[0]=n[0]*a,l[1]=n[1]*a,l[2]=n[2]*a,l},u.aM=function(l,n,a){return l[0]=n[0]+a[0],l[1]=n[1]+a[1],l[2]=n[2]+a[2],l},u.aN=function(l){var n=new dt(3);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n},u.aO=function(l,n,a){return l[0]=n[0]*a[0],l[1]=n[1]*a[1],l[2]=n[2]*a[2],l[3]=n[3]*a[3],l},u.aP=function(l,n,a){return l[0]=n[0]-a[0],l[1]=n[1]-a[1],l[2]=n[2]-a[2],l},u.aQ=function(l,n){var a=n[0],d=n[1],p=n[2],y=a*a+d*d+p*p;return y>0&&(y=1/Math.sqrt(y)),l[0]=n[0]*y,l[1]=n[1]*y,l[2]=n[2]*y,l},u.aR=function(l,n,a){var d=n[0],p=n[1],y=n[2],_=a[0],b=a[1],C=a[2];return l[0]=p*C-y*b,l[1]=y*_-d*C,l[2]=d*b-p*_,l},u.aS=function(l,n){return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]},u.aT=qw,u.aU=Qc,u.aV=function(l,n,a,d,p){var y,_=1/Math.tan(n/2);return l[0]=_/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=_,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,p!=null&&p!==1/0?(l[10]=(p+d)*(y=1/(d-p)),l[14]=2*p*d*y):(l[10]=-1,l[14]=-2*d),l},u.aW=function(l){var n=new dt(16);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],n[9]=l[9],n[10]=l[10],n[11]=l[11],n[12]=l[12],n[13]=l[13],n[14]=l[14],n[15]=l[15],n},u.aX=function(l,n,a){var d=Math.sin(a),p=Math.cos(a),y=n[0],_=n[1],b=n[2],C=n[3],I=n[4],D=n[5],P=n[6],k=n[7];return n!==l&&(l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=y*p+I*d,l[1]=_*p+D*d,l[2]=b*p+P*d,l[3]=C*p+k*d,l[4]=I*p-y*d,l[5]=D*p-_*d,l[6]=P*p-b*d,l[7]=k*p-C*d,l},u.aY=function(l,n,a){var d=Math.sin(a),p=Math.cos(a),y=n[4],_=n[5],b=n[6],C=n[7],I=n[8],D=n[9],P=n[10],k=n[11];return n!==l&&(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[4]=y*p+I*d,l[5]=_*p+D*d,l[6]=b*p+P*d,l[7]=C*p+k*d,l[8]=I*p-y*d,l[9]=D*p-_*d,l[10]=P*p-b*d,l[11]=k*p-C*d,l},u.aZ=function(){let l=new Float32Array(16);return ki(l),l},u.a_=function(){let l=new Float64Array(16);return ki(l),l},u.aa=function(l){return l*Math.PI/180},u.ab=fi,u.ac=function(l,n){let a=[];for(let d in l)d in n||a.push(d);return a},u.ad=dr,u.ae=function(l){return Math.hypot(l[0],l[1])},u.af=function(l){return l[0]=0,l[1]=0,l},u.ag=function(l,n,a){return l[0]=n[0]*a,l[1]=n[1]*a,l},u.ah=function(l,n){let a=0,d=0;if(l.kind==="constant")d=l.layoutSize;else if(l.kind!=="source"){let{interpolationType:p,minZoom:y,maxZoom:_}=l,b=p?fi(nn.interpolationFactor(p,n,y,_),0,1):0;l.kind==="camera"?d=gi.number(l.minSize,l.maxSize,b):a=b}return{uSizeT:a,uSize:d}},u.aj=function(l,{uSize:n,uSizeT:a},{lowerSize:d,upperSize:p}){return l.kind==="source"?d/Oo:l.kind==="composite"?gi.number(d/Oo,p/Oo,a):n},u.ak=R_,u.al=Wi,u.am=function(l,n,a,d){let p=n.y-l.y,y=n.x-l.x,_=d.y-a.y,b=d.x-a.x,C=_*y-b*p;if(C===0)return null;let I=(b*(l.y-a.y)-_*(l.x-a.x))/C;return new he(l.x+I*y,l.y+I*p)},u.an=function(l,n){var a=n[0],d=n[1],p=n[2],y=n[3],_=n[4],b=n[5],C=n[6],I=n[7],D=n[8],P=n[9],k=n[10],L=n[11],F=n[12],j=n[13],Z=n[14],J=n[15],ue=a*b-d*_,ne=a*C-p*_,N=a*I-y*_,q=d*C-p*b,re=d*I-y*b,_e=p*I-y*C,ke=D*j-P*F,xe=D*Z-k*F,Ie=D*J-L*F,Fe=P*Z-k*j,Ne=P*J-L*j,Be=k*J-L*Z,Pe=ue*Be-ne*Ne+N*Fe+q*Ie-re*xe+_e*ke;return Pe?(l[0]=(b*Be-C*Ne+I*Fe)*(Pe=1/Pe),l[1]=(p*Ne-d*Be-y*Fe)*Pe,l[2]=(j*_e-Z*re+J*q)*Pe,l[3]=(k*re-P*_e-L*q)*Pe,l[4]=(C*Ie-_*Be-I*xe)*Pe,l[5]=(a*Be-p*Ie+y*xe)*Pe,l[6]=(Z*N-F*_e-J*ne)*Pe,l[7]=(D*_e-k*N+L*ne)*Pe,l[8]=(_*Ne-b*Ie+I*ke)*Pe,l[9]=(d*Ie-a*Ne-y*ke)*Pe,l[10]=(F*re-j*N+J*ue)*Pe,l[11]=(P*N-D*re-L*ue)*Pe,l[12]=(b*xe-_*Fe-C*ke)*Pe,l[13]=(a*Fe-d*xe+p*ke)*Pe,l[14]=(j*ne-F*q-Z*ue)*Pe,l[15]=(D*q-P*ne+k*ue)*Pe,l):null},u.ao=Jw,u.ap=ah,u.aq=ki,u.ar=function(l){let n=1/0,a=1/0,d=-1/0,p=-1/0;for(let y of l)n=Math.min(n,y.x),a=Math.min(a,y.y),d=Math.max(d,y.x),p=Math.max(p,y.y);return[n,a,d,p]},u.as=Hn,u.at=Hs,u.au=function(l,n,a,d,p=!1){if(!a[0]&&!a[1])return[0,0];let y=p?d==="map"?-l.bearingInRadians:0:d==="viewport"?l.bearingInRadians:0;if(y){let _=Math.sin(y),b=Math.cos(y);a=[a[0]*b-a[1]*_,a[0]*_+a[1]*b]}return[p?a[0]:Hs(n,a[0],l.zoom),p?a[1]:Hs(n,a[1],l.zoom)]},u.aw=A_,u.ax=j_,u.ay=P_,u.az=V_,u.b=es,u.b$=l=>l.type==="line",u.b0=function(l,n,a){let d=new Float64Array(4);return function(p,y,_,b){var C=.5*Math.PI/180;y*=C,_*=C,b*=C;var I=Math.sin(y),D=Math.cos(y),P=Math.sin(_),k=Math.cos(_),L=Math.sin(b),F=Math.cos(b);p[0]=I*k*F-D*P*L,p[1]=D*P*F+I*k*L,p[2]=D*k*L-I*P*F,p[3]=D*k*F+I*P*L}(d,l,n-90,a),d},u.b1=function(l,n,a,d){var p,y,_,b,C,I=n[0],D=n[1],P=n[2],k=n[3],L=a[0],F=a[1],j=a[2],Z=a[3];return(y=I*L+D*F+P*j+k*Z)<0&&(y=-y,L=-L,F=-F,j=-j,Z=-Z),1-y>_t?(p=Math.acos(y),_=Math.sin(p),b=Math.sin((1-d)*p)/_,C=Math.sin(d*p)/_):(b=1-d,C=d),l[0]=b*I+C*L,l[1]=b*D+C*F,l[2]=b*P+C*j,l[3]=b*k+C*Z,l},u.b2=function(l){let n=new Float64Array(9);var a,d,p,y,_,b,C,I,D,P,k,L,F,j,Z,J,ue,ne;P=(p=(d=l)[0])*(C=p+p),k=(y=d[1])*C,F=(_=d[2])*C,j=_*(I=y+y),J=(b=d[3])*C,ue=b*I,ne=b*(D=_+_),(a=n)[0]=1-(L=y*I)-(Z=_*D),a[3]=k-ne,a[6]=F+ue,a[1]=k+ne,a[4]=1-P-Z,a[7]=j-J,a[2]=F-ue,a[5]=j+J,a[8]=1-P-L;let N=Or(-Math.asin(fi(n[2],-1,1))),q,re;return Math.hypot(n[5],n[8])<.001?(q=0,re=-Or(Math.atan2(n[3],n[4]))):(q=Or(n[5]===0&&n[8]===0?0:Math.atan2(n[5],n[8])),re=Or(n[1]===0&&n[0]===0?0:Math.atan2(n[1],n[0]))),{roll:q,pitch:N+90,bearing:re}},u.b3=function(l,n){return l.roll==n.roll&&l.pitch==n.pitch&&l.bearing==n.bearing},u.b4=Dt,u.b5=oo,u.b6=Xc,u.b7=yh,u.b8=Wc,u.b9=Xo,u.bA=Qo,u.bB=Jo,u.bC=class extends Fr{constructor(l,n){super(l,n),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}},u.bD=class extends Fr{constructor(l,n){super(l,n),this.current=pa}set(l){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let n=1;n<16;n++)if(l[n]!==this.current[n]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}},u.bE=Cl,u.bF=El,u.bG=class extends Fr{constructor(l,n){super(l,n),this.current=[0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2]))}},u.bH=class extends Fr{constructor(l,n){super(l,n),this.current=[0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1]))}},u.bI=Vt,u.bJ=function(l,n){var a=Math.sin(n),d=Math.cos(n);return l[0]=d,l[1]=a,l[2]=0,l[3]=-a,l[4]=d,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},u.bK=function(l,n,a){var d=n[0],p=n[1],y=n[2];return l[0]=d*a[0]+p*a[3]+y*a[6],l[1]=d*a[1]+p*a[4]+y*a[7],l[2]=d*a[2]+p*a[5]+y*a[8],l},u.bL=function(l,n,a,d,p,y,_){var b=1/(n-a),C=1/(d-p),I=1/(y-_);return l[0]=-2*b,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*C,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*I,l[11]=0,l[12]=(n+a)*b,l[13]=(p+d)*C,l[14]=(_+y)*I,l[15]=1,l},u.bM=class extends nh{},u.bN=iP,u.bO=class extends Ro{},u.bP=h_,u.bQ=function(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))},u.bR=Wx,u.bS=function(l,n,a){var d=n[0],p=n[1],y=n[2],_=a[3]*d+a[7]*p+a[11]*y+a[15];return l[0]=(a[0]*d+a[4]*p+a[8]*y+a[12])/(_=_||1),l[1]=(a[1]*d+a[5]*p+a[9]*y+a[13])/_,l[2]=(a[2]*d+a[6]*p+a[10]*y+a[14])/_,l},u.bT=class extends Jd{},u.bU=class extends o{},u.bV=function(l,n){return l[0]===n[0]&&l[1]===n[1]&&l[2]===n[2]&&l[3]===n[3]&&l[4]===n[4]&&l[5]===n[5]&&l[6]===n[6]&&l[7]===n[7]&&l[8]===n[8]&&l[9]===n[9]&&l[10]===n[10]&&l[11]===n[11]&&l[12]===n[12]&&l[13]===n[13]&&l[14]===n[14]&&l[15]===n[15]},u.bW=function(l,n){var a=l[0],d=l[1],p=l[2],y=l[3],_=l[4],b=l[5],C=l[6],I=l[7],D=l[8],P=l[9],k=l[10],L=l[11],F=l[12],j=l[13],Z=l[14],J=l[15],ue=n[0],ne=n[1],N=n[2],q=n[3],re=n[4],_e=n[5],ke=n[6],xe=n[7],Ie=n[8],Fe=n[9],Ne=n[10],Be=n[11],Pe=n[12],Ke=n[13],st=n[14],rt=n[15];return Math.abs(a-ue)<=_t*Math.max(1,Math.abs(a),Math.abs(ue))&&Math.abs(d-ne)<=_t*Math.max(1,Math.abs(d),Math.abs(ne))&&Math.abs(p-N)<=_t*Math.max(1,Math.abs(p),Math.abs(N))&&Math.abs(y-q)<=_t*Math.max(1,Math.abs(y),Math.abs(q))&&Math.abs(_-re)<=_t*Math.max(1,Math.abs(_),Math.abs(re))&&Math.abs(b-_e)<=_t*Math.max(1,Math.abs(b),Math.abs(_e))&&Math.abs(C-ke)<=_t*Math.max(1,Math.abs(C),Math.abs(ke))&&Math.abs(I-xe)<=_t*Math.max(1,Math.abs(I),Math.abs(xe))&&Math.abs(D-Ie)<=_t*Math.max(1,Math.abs(D),Math.abs(Ie))&&Math.abs(P-Fe)<=_t*Math.max(1,Math.abs(P),Math.abs(Fe))&&Math.abs(k-Ne)<=_t*Math.max(1,Math.abs(k),Math.abs(Ne))&&Math.abs(L-Be)<=_t*Math.max(1,Math.abs(L),Math.abs(Be))&&Math.abs(F-Pe)<=_t*Math.max(1,Math.abs(F),Math.abs(Pe))&&Math.abs(j-Ke)<=_t*Math.max(1,Math.abs(j),Math.abs(Ke))&&Math.abs(Z-st)<=_t*Math.max(1,Math.abs(Z),Math.abs(st))&&Math.abs(J-rt)<=_t*Math.max(1,Math.abs(J),Math.abs(rt))},u.bX=function(l,n){return l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l},u.bY=l=>l.type==="symbol",u.bZ=l=>l.type==="circle",u.b_=l=>l.type==="heatmap",u.ba=Yo,u.bb=mr,u.bc=function(l,n,a,d,p){return Xo(d,p,fi((l-n)/(a-n),0,1))},u.bd=xo,u.be=function(){return new Float64Array(4)},u.bf=function(){return new Float64Array(3)},u.bg=function(l,n,a,d){var p=[],y=[];return p[0]=n[0]-a[0],p[1]=n[1]-a[1],p[2]=n[2]-a[2],y[0]=p[0]*Math.cos(d)-p[1]*Math.sin(d),y[1]=p[0]*Math.sin(d)+p[1]*Math.cos(d),y[2]=p[2],l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},u.bh=function(l,n,a,d){var p=[],y=[];return p[0]=n[0]-a[0],p[1]=n[1]-a[1],p[2]=n[2]-a[2],y[0]=p[0],y[1]=p[1]*Math.cos(d)-p[2]*Math.sin(d),y[2]=p[1]*Math.sin(d)+p[2]*Math.cos(d),l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},u.bi=function(l,n,a,d){var p=[],y=[];return p[0]=n[0]-a[0],p[1]=n[1]-a[1],p[2]=n[2]-a[2],y[0]=p[2]*Math.sin(d)+p[0]*Math.cos(d),y[1]=p[1],y[2]=p[2]*Math.cos(d)-p[0]*Math.sin(d),l[0]=y[0]+a[0],l[1]=y[1]+a[1],l[2]=y[2]+a[2],l},u.bj=function(l,n,a){var d=Math.sin(a),p=Math.cos(a),y=n[0],_=n[1],b=n[2],C=n[3],I=n[8],D=n[9],P=n[10],k=n[11];return n!==l&&(l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=y*p-I*d,l[1]=_*p-D*d,l[2]=b*p-P*d,l[3]=C*p-k*d,l[8]=y*d+I*p,l[9]=_*d+D*p,l[10]=b*d+P*p,l[11]=C*d+k*p,l},u.bk=function(l,n){let a=xo(l,360),d=xo(n,360),p=d-a,y=d>a?p-360:p+360;return Math.abs(p)<Math.abs(y)?p:y},u.bl=function(l){return l[0]=0,l[1]=0,l[2]=0,l},u.bm=function(l,n,a,d){let p=Math.sqrt(l*l+n*n),y=Math.sqrt(a*a+d*d);l/=p,n/=p,a/=y,d/=y;let _=Math.acos(l*a+n*d);return-n*a+l*d>0?_:-_},u.bn=function(l,n){return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]+l[3]},u.bo=L_,u.bp=function(l,n){let a=xo(l,2*Math.PI),d=xo(n,2*Math.PI);return Math.min(Math.abs(a-d),Math.abs(a-d+2*Math.PI),Math.abs(a-d-2*Math.PI))},u.bq=function(l){return Math.hypot(l[0],l[1],l[2])},u.br=function(){let l={},n=X.$version;for(let a in X.$root){let d=X.$root[a];if(d.required){let p=null;p=a==="version"?n:d.type==="array"?[]:{},p!=null&&(l[a]=p)}}return l},u.bs=Ep,u.bt=os,u.bu=function(l){l=l.slice();let n=Object.create(null);for(let a=0;a<l.length;a++)n[l[a].id]=l[a];for(let a=0;a<l.length;a++)"ref"in l[a]&&(l[a]=H(l[a],n[l[a].ref]));return l},u.bv=function(l){if(l.type==="custom")return new MP(l);switch(l.type){case"background":return new EP(l);case"circle":return new vS(l);case"fill":return new zS(l);case"fill-extrusion":return new qS(l);case"heatmap":return new xS(l);case"hillshade":return new CS(l);case"line":return new eP(l);case"raster":return new TP(l);case"symbol":return new Xp(l)}},u.bw=kr,u.bx=function(l,n){if(!l)return[{command:"setStyle",args:[n]}];let a=[];try{if(!G(l.version,n.version))return[{command:"setStyle",args:[n]}];G(l.center,n.center)||a.push({command:"setCenter",args:[n.center]}),G(l.centerAltitude,n.centerAltitude)||a.push({command:"setCenterAltitude",args:[n.centerAltitude]}),G(l.zoom,n.zoom)||a.push({command:"setZoom",args:[n.zoom]}),G(l.bearing,n.bearing)||a.push({command:"setBearing",args:[n.bearing]}),G(l.pitch,n.pitch)||a.push({command:"setPitch",args:[n.pitch]}),G(l.roll,n.roll)||a.push({command:"setRoll",args:[n.roll]}),G(l.sprite,n.sprite)||a.push({command:"setSprite",args:[n.sprite]}),G(l.glyphs,n.glyphs)||a.push({command:"setGlyphs",args:[n.glyphs]}),G(l.transition,n.transition)||a.push({command:"setTransition",args:[n.transition]}),G(l.light,n.light)||a.push({command:"setLight",args:[n.light]}),G(l.terrain,n.terrain)||a.push({command:"setTerrain",args:[n.terrain]}),G(l.sky,n.sky)||a.push({command:"setSky",args:[n.sky]}),G(l.projection,n.projection)||a.push({command:"setProjection",args:[n.projection]});let d={},p=[];(function(_,b,C,I){let D;for(D in b=b||{},_=_||{})Object.prototype.hasOwnProperty.call(_,D)&&(Object.prototype.hasOwnProperty.call(b,D)||pe(D,C,I));for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&(Object.prototype.hasOwnProperty.call(_,D)?G(_[D],b[D])||(_[D].type==="geojson"&&b[D].type==="geojson"&&fe(_,b,D)?te(C,{command:"setGeoJSONSourceData",args:[D,b[D].data]}):be(D,b,C,I)):ae(D,b,C))})(l.sources,n.sources,p,d);let y=[];l.layers&&l.layers.forEach(_=>{"source"in _&&d[_.source]?a.push({command:"removeLayer",args:[_.id]}):y.push(_)}),a=a.concat(p),function(_,b,C){b=b||[];let I=(_=_||[]).map(Ce),D=b.map(Ce),P=_.reduce(me,{}),k=b.reduce(me,{}),L=I.slice(),F=Object.create(null),j,Z,J,ue,ne;for(let N=0,q=0;N<I.length;N++)j=I[N],Object.prototype.hasOwnProperty.call(k,j)?q++:(te(C,{command:"removeLayer",args:[j]}),L.splice(L.indexOf(j,q),1));for(let N=0,q=0;N<D.length;N++)j=D[D.length-1-N],L[L.length-1-N]!==j&&(Object.prototype.hasOwnProperty.call(P,j)?(te(C,{command:"removeLayer",args:[j]}),L.splice(L.lastIndexOf(j,L.length-q),1)):q++,ue=L[L.length-N],te(C,{command:"addLayer",args:[k[j],ue]}),L.splice(L.length-N,0,j),F[j]=!0);for(let N=0;N<D.length;N++)if(j=D[N],Z=P[j],J=k[j],!F[j]&&!G(Z,J))if(G(Z.source,J.source)&&G(Z["source-layer"],J["source-layer"])&&G(Z.type,J.type)){for(ne in Te(Z.layout,J.layout,C,j,null,"setLayoutProperty"),Te(Z.paint,J.paint,C,j,null,"setPaintProperty"),G(Z.filter,J.filter)||te(C,{command:"setFilter",args:[j,J.filter]}),G(Z.minzoom,J.minzoom)&&G(Z.maxzoom,J.maxzoom)||te(C,{command:"setLayerZoomRange",args:[j,J.minzoom,J.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Te(Z[ne],J[ne],C,j,ne.slice(6),"setPaintProperty"):G(Z[ne],J[ne])||te(C,{command:"setLayerProperty",args:[j,ne,J[ne]]}));for(ne in J)Object.prototype.hasOwnProperty.call(J,ne)&&!Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?Te(Z[ne],J[ne],C,j,ne.slice(6),"setPaintProperty"):G(Z[ne],J[ne])||te(C,{command:"setLayerProperty",args:[j,ne,J[ne]]}))}else te(C,{command:"removeLayer",args:[j]}),ue=L[L.lastIndexOf(j)+1],te(C,{command:"addLayer",args:[J,ue]})}(y,n.layers,a)}catch(d){console.warn("Unable to compute style diff:",d),a=[{command:"setStyle",args:[n]}]}return a},u.by=function(l){let n=[],a=l.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},u.bz=function l(n,a){if(Array.isArray(n)){if(!Array.isArray(a)||n.length!==a.length)return!1;for(let d=0;d<n.length;d++)if(!l(n[d],a[d]))return!1;return!0}if(typeof n=="object"&&n!==null&&a!==null){if(typeof a!="object"||Object.keys(n).length!==Object.keys(a).length)return!1;for(let d in n)if(!l(n[d],a[d]))return!1;return!0}return n===a},u.c=rs,u.c0=l=>l.type==="fill",u.c1=l=>l.type==="fill-extrusion",u.c2=l=>l.type==="hillshade",u.c3=l=>l.type==="raster",u.c4=l=>l.type==="background",u.c5=l=>l.type==="custom",u.c6=Gs,u.c7=function(l,n,a){let d=Ga(n.x-a.x,n.y-a.y),p=Ga(l.x-a.x,l.y-a.y);var y,_;return Or(Math.atan2(d[0]*p[1]-d[1]*p[0],(y=d)[0]*(_=p)[0]+y[1]*_[1]))},u.c8=Oi,u.c9=function(l,n,a){var d=n[0],p=n[1];return l[0]=a[0]*d+a[4]*p+a[12],l[1]=a[1]*d+a[5]*p+a[13],l},u.cA=Cw,u.cB=Tc,u.cC=no,u.ca=function(l,n){let{x:a,y:d}=Ih.fromLngLat(n);return!(l<0||l>25||d<0||d>=1||a<0||a>=1)},u.cb=function(l,n){return l[0]=n[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=n[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=n[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l},u.cc=class extends vl{},u.cd=FP,u.cf=function(l){return l.message===ns},u.cg=Yi,u.ch=function(l,n){Eo.REGISTERED_PROTOCOLS[l]=n},u.ci=function(l){delete Eo.REGISTERED_PROTOCOLS[l]},u.cj=function(l,n){let a={};for(let p=0;p<l.length;p++){let y=n&&n[l[p].id]||$d(l[p]);n&&(n[l[p].id]=y);let _=a[y];_||(_=a[y]=[]),_.push(l[p])}let d=[];for(let p in a)d.push(a[p]);return d},u.ck=We,u.cl=Ww,u.cm=Yw,u.cn=Iw,u.co=function(l){l.bucket.createArrays(),l.bucket.tilePixelRatio=Zt/(512*l.bucket.overscaling),l.bucket.compareText={},l.bucket.iconsNeedLinear=!1;let n=l.bucket.layers[0],a=n.layout,d=n._unevaluatedLayout._values,p={layoutIconSize:d["icon-size"].possiblyEvaluate(new pn(l.bucket.zoom+1),l.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new pn(l.bucket.zoom+1),l.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new pn(18))};if(l.bucket.textSizeData.kind==="composite"){let{minZoom:I,maxZoom:D}=l.bucket.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new pn(I),l.canonical),d["text-size"].possiblyEvaluate(new pn(D),l.canonical)]}if(l.bucket.iconSizeData.kind==="composite"){let{minZoom:I,maxZoom:D}=l.bucket.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new pn(I),l.canonical),d["icon-size"].possiblyEvaluate(new pn(D),l.canonical)]}let y=a.get("text-line-height")*Hn,_=a.get("text-rotation-alignment")!=="viewport"&&a.get("symbol-placement")!=="point",b=a.get("text-keep-upright"),C=a.get("text-size");for(let I of l.bucket.features){let D=a.get("text-font").evaluate(I,{},l.canonical).join(","),P=C.evaluate(I,{},l.canonical),k=p.layoutTextSize.evaluate(I,{},l.canonical),L=p.layoutIconSize.evaluate(I,{},l.canonical),F={horizontal:{},vertical:void 0},j=I.text,Z,J=[0,0];if(j){let N=j.toString(),q=a.get("text-letter-spacing").evaluate(I,{},l.canonical)*Hn,re=Ip(N)?q:0,_e=a.get("text-anchor").evaluate(I,{},l.canonical),ke=l1(n,I,l.canonical);if(!ke){let Ne=a.get("text-radial-offset").evaluate(I,{},l.canonical);J=Ne?a1(_e,[Ne*Hn,B_]):a.get("text-offset").evaluate(I,{},l.canonical).map(Be=>Be*Hn)}let xe=_?"center":a.get("text-justify").evaluate(I,{},l.canonical),Ie=a.get("symbol-placement")==="point"?a.get("text-max-width").evaluate(I,{},l.canonical)*Hn:1/0,Fe=()=>{l.bucket.allowVerticalPlacement&&ua(N)&&(F.vertical=qp(j,l.glyphMap,l.glyphPositions,l.imagePositions,D,Ie,y,_e,"left",re,J,u.ai.vertical,!0,k,P))};if(!_&&ke){let Ne=new Set;if(xe==="auto")for(let Pe=0;Pe<ke.values.length;Pe+=2)Ne.add(j_(ke.values[Pe]));else Ne.add(xe);let Be=!1;for(let Pe of Ne)if(!F.horizontal[Pe])if(Be)F.horizontal[Pe]=F.horizontal[0];else{let Ke=qp(j,l.glyphMap,l.glyphPositions,l.imagePositions,D,Ie,y,"center",Pe,re,J,u.ai.horizontal,!1,k,P);Ke&&(F.horizontal[Pe]=Ke,Be=Ke.positionedLines.length===1)}Fe()}else{xe==="auto"&&(xe=j_(_e));let Ne=qp(j,l.glyphMap,l.glyphPositions,l.imagePositions,D,Ie,y,_e,xe,re,J,u.ai.horizontal,!1,k,P);Ne&&(F.horizontal[xe]=Ne),Fe(),ua(N)&&_&&b&&(F.vertical=qp(j,l.glyphMap,l.glyphPositions,l.imagePositions,D,Ie,y,_e,xe,re,J,u.ai.vertical,!1,k,P))}}let ue=!1;if(I.icon&&I.icon.name){let N=l.imageMap[I.icon.name];N&&(Z=vP(l.imagePositions[I.icon.name],a.get("icon-offset").evaluate(I,{},l.canonical),a.get("icon-anchor").evaluate(I,{},l.canonical)),ue=!!N.sdf,l.bucket.sdfIcons===void 0?l.bucket.sdfIcons=ue:l.bucket.sdfIcons!==ue&&hr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(N.pixelRatio!==l.bucket.pixelRatio||a.get("icon-rotate").constantOr(1)!==0)&&(l.bucket.iconsNeedLinear=!0))}let ne=u1(F.horizontal)||F.vertical;l.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||Z)&&NP(l.bucket,I,F,Z,l.imageMap,p,k,L,J,ue,l.canonical,l.subdivisionGranularity)}l.showCollisionBoxes&&l.bucket.generateCollisionDebugBuffers()},u.cp=C_,u.cq=y_,u.cr=w_,u.cs=vh,u.ct=T_,u.cu=class{constructor(l){this._marks={start:[l.url,"start"].join("#"),end:[l.url,"end"].join("#"),measure:l.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let l=performance.getEntriesByName(this._marks.measure);return l.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),l=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),l}},u.cv=function(l,n,a,d,p){return s(this,void 0,void 0,function*(){if(gt())try{return yield pi(l,n,a,d,p)}catch{}return function(y,_,b,C,I){let D=y.width,P=y.height;wo&&Co||(wo=new OffscreenCanvas(D,P),Co=wo.getContext("2d",{willReadFrequently:!0})),wo.width=D,wo.height=P,Co.drawImage(y,0,0,D,P);let k=Co.getImageData(_,b,C,I);return Co.clearRect(0,0,D,P),k.data}(l,n,a,d,p)})},u.cw=Zw,u.cx=x,u.cy=B,u.cz=dw,u.d=l=>s(void 0,void 0,void 0,function*(){if(l.byteLength===0)return createImageBitmap(new ImageData(1,1));let n=new Blob([new Uint8Array(l)],{type:"image/png"});try{return createImageBitmap(n)}catch(a){throw new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=nr,u.f=l=>new Promise((n,a)=>{let d=new Image;d.onload=()=>{n(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=ts})},d.onerror=()=>a(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let p=new Blob([new Uint8Array(l)],{type:"image/png"});d.src=l.byteLength?URL.createObjectURL(p):ts}),u.g=Za,u.h=(l,n)=>Ki(nr(l,{type:"json"}),n),u.i=Xi,u.j=Wa,u.k=Zs,u.l=(l,n)=>Ki(nr(l,{type:"arrayBuffer"}),n),u.m=Ki,u.n=function(l){return new T_(l).readFields(aP,[])},u.o=hh,u.p=Ew,u.q=Mr,u.r=o_,u.s=ss,u.t=xp,u.u=ca,u.v=X,u.w=hr,u.x=function([l,n,a]){return n+=90,n*=Math.PI/180,a*=Math.PI/180,{x:l*Math.cos(n)*Math.sin(a),y:l*Math.sin(n)*Math.sin(a),z:l*Math.cos(a)}},u.y=gi,u.z=pn}),i("worker",["./shared"],function(u){"use strict";class s{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,H){for(let te of V){this._layerConfigs[te.id]=te;let ae=this._layers[te.id]=u.bv(te);ae._featureFilter=u.a4(ae.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(let te of H)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};let G=u.cj(Object.values(this._layerConfigs),this.keyCache);for(let te of G){let ae=te.map(me=>this._layers[me.id]),pe=ae[0];if(pe.visibility==="none")continue;let be=pe.source||"",fe=this.familiesBySource[be];fe||(fe=this.familiesBySource[be]={});let Te=pe.sourceLayer||"_geojsonTileLayer",Ce=fe[Te];Ce||(Ce=fe[Te]=[]),Ce.push(ae)}}}class x{constructor(V){let H={},G=[];for(let be in V){let fe=V[be],Te=H[be]={};for(let Ce in fe){let me=fe[+Ce];if(!me||me.bitmap.width===0||me.bitmap.height===0)continue;let de={x:0,y:0,w:me.bitmap.width+2,h:me.bitmap.height+2};G.push(de),Te[Ce]={rect:de,metrics:me.metrics}}}let{w:te,h:ae}=u.p(G),pe=new u.o({width:te||1,height:ae||1});for(let be in V){let fe=V[be];for(let Te in fe){let Ce=fe[+Te];if(!Ce||Ce.bitmap.width===0||Ce.bitmap.height===0)continue;let me=H[be][Te].rect;u.o.copy(Ce.bitmap,pe,{x:0,y:0},{x:me.x+1,y:me.y+1},Ce.bitmap)}}this.image=pe,this.positions=H}}u.ck("GlyphAtlas",x);class M{constructor(V){this.tileID=new u.S(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[]}parse(V,H,G,te,ae){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new u.a2;let pe=new u.cl(Object.keys(V.layers).sort()),be=new u.cm(this.tileID,this.promoteId);be.bucketLayerIDs=[];let fe={},Te={featureIndex:be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:G,subdivisionGranularity:ae},Ce=H.familiesBySource[this.source];for(let ut in Ce){let Xe=V.layers[ut];if(!Xe)continue;Xe.version===1&&u.w(`Vector tile source "${this.source}" layer "${ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Cn=pe.encode(ut),Mo=[];for(let Vn=0;Vn<Xe.length;Vn++){let On=Xe.feature(Vn),dn=be.getId(On,ut);Mo.push({feature:On,id:dn,index:Vn,sourceLayerIndex:Cn})}for(let Vn of Ce[ut]){let On=Vn[0];On.source!==this.source&&u.w(`layer.source = ${On.source} does not equal this.source = ${this.source}`),On.minzoom&&this.zoom<Math.floor(On.minzoom)||On.maxzoom&&this.zoom>=On.maxzoom||On.visibility!=="none"&&(S(Vn,this.zoom,G),(fe[On.id]=On.createBucket({index:be.bucketLayerIDs.length,layers:Vn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cn,sourceID:this.source})).populate(Mo,Te,this.tileID.canonical),be.bucketLayerIDs.push(Vn.map(dn=>dn.id)))}}let me=u.bA(Te.glyphDependencies,ut=>Object.keys(ut).map(Number));this.inFlightDependencies.forEach(ut=>ut?.abort()),this.inFlightDependencies=[];let de=Promise.resolve({});if(Object.keys(me).length){let ut=new AbortController;this.inFlightDependencies.push(ut),de=te.sendAsync({type:"GG",data:{stacks:me,source:this.source,tileID:this.tileID,type:"glyphs"}},ut)}let $e=Object.keys(Te.iconDependencies),Ve=Promise.resolve({});if($e.length){let ut=new AbortController;this.inFlightDependencies.push(ut),Ve=te.sendAsync({type:"GI",data:{icons:$e,source:this.source,tileID:this.tileID,type:"icons"}},ut)}let at=Object.keys(Te.patternDependencies),pt=Promise.resolve({});if(at.length){let ut=new AbortController;this.inFlightDependencies.push(ut),pt=te.sendAsync({type:"GI",data:{icons:at,source:this.source,tileID:this.tileID,type:"patterns"}},ut)}let[Ae,He,Qe]=yield Promise.all([de,Ve,pt]),Et=new x(Ae),Ft=new u.cn(He,Qe);for(let ut in fe){let Xe=fe[ut];Xe instanceof u.a3?(S(Xe.layers,this.zoom,G),u.co({bucket:Xe,glyphMap:Ae,glyphPositions:Et.positions,imageMap:He,imagePositions:Ft.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Te.subdivisionGranularity})):Xe.hasPattern&&(Xe instanceof u.cp||Xe instanceof u.cq||Xe instanceof u.cr)&&(S(Xe.layers,this.zoom,G),Xe.addFeatures(Te,this.tileID.canonical,Ft.patternPositions))}return this.status="done",{buckets:Object.values(fe).filter(ut=>!ut.isEmpty()),featureIndex:be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Et.image,imageAtlas:Ft,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?He:null,glyphPositions:this.returnDependencies?Et.positions:null}})}}function S(X,V,H){let G=new u.z(V);for(let te of X)te.recalculate(G,H)}class B{constructor(V,H,G){this.actor=V,this.layerIndex=H,this.availableImages=G,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,H){return u._(this,void 0,void 0,function*(){let G=yield u.l(V.request,H);try{return{vectorTile:new u.cs.VectorTile(new u.ct(G.data)),rawData:G.data,cacheControl:G.cacheControl,expires:G.expires}}catch(te){let ae=new Uint8Array(G.data),pe=`Unable to parse the tile at ${V.request.url}, `;throw pe+=ae[0]===31&&ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(pe)}})}loadTile(V){return u._(this,void 0,void 0,function*(){let H=V.uid,G=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.cu(V.request),te=new M(V);this.loading[H]=te;let ae=new AbortController;te.abort=ae;try{let pe=yield this.loadVectorTile(V,ae);if(delete this.loading[H],!pe)return null;let be=pe.rawData,fe={};pe.expires&&(fe.expires=pe.expires),pe.cacheControl&&(fe.cacheControl=pe.cacheControl);let Te={};if(G){let me=G.finish();me&&(Te.resourceTiming=JSON.parse(JSON.stringify(me)))}te.vectorTile=pe.vectorTile;let Ce=te.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[H]=te,this.fetching[H]={rawTileData:be,cacheControl:fe,resourceTiming:Te};try{let me=yield Ce;return u.e({rawTileData:be.slice(0)},me,fe,Te)}finally{delete this.fetching[H]}}catch(pe){throw delete this.loading[H],te.status="done",this.loaded[H]=te,pe}})}reloadTile(V){return u._(this,void 0,void 0,function*(){let H=V.uid;if(!this.loaded||!this.loaded[H])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");let G=this.loaded[H];if(G.showCollisionBoxes=V.showCollisionBoxes,G.status==="parsing"){let te=yield G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity),ae;if(this.fetching[H]){let{rawTileData:pe,cacheControl:be,resourceTiming:fe}=this.fetching[H];delete this.fetching[H],ae=u.e({rawTileData:pe.slice(0)},te,be,fe)}else ae=te;return ae}if(G.status==="done"&&G.vectorTile)return G.parse(G.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)})}abortTile(V){return u._(this,void 0,void 0,function*(){let H=this.loading,G=V.uid;H&&H[G]&&H[G].abort&&(H[G].abort.abort(),delete H[G])})}removeTile(V){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]})}}class W{constructor(){this.loaded={}}loadTile(V){return u._(this,void 0,void 0,function*(){let{uid:H,encoding:G,rawImageData:te,redFactor:ae,greenFactor:pe,blueFactor:be,baseShift:fe}=V,Te=te.width+2,Ce=te.height+2,me=u.b(te)?new u.R({width:Te,height:Ce},yield u.cv(te,-1,-1,Te,Ce)):te,de=new u.cw(H,me,G,ae,pe,be,fe);return this.loaded=this.loaded||{},this.loaded[H]=de,de})}removeTile(V){let H=this.loaded,G=V.uid;H&&H[G]&&delete H[G]}}var $,he,ge=function(){if(he)return $;function X(H,G){if(H.length!==0){V(H[0],G);for(var te=1;te<H.length;te++)V(H[te],!G)}}function V(H,G){for(var te=0,ae=0,pe=0,be=H.length,fe=be-1;pe<be;fe=pe++){var Te=(H[pe][0]-H[fe][0])*(H[fe][1]+H[pe][1]),Ce=te+Te;ae+=Math.abs(te)>=Math.abs(Te)?te-Ce+Te:Te-Ce+te,te=Ce}te+ae>=0!=!!G&&H.reverse()}return he=1,$=function H(G,te){var ae,pe=G&&G.type;if(pe==="FeatureCollection")for(ae=0;ae<G.features.length;ae++)H(G.features[ae],te);else if(pe==="GeometryCollection")for(ae=0;ae<G.geometries.length;ae++)H(G.geometries[ae],te);else if(pe==="Feature")H(G.geometry,te);else if(pe==="Polygon")X(G.coordinates,te);else if(pe==="MultiPolygon")for(ae=0;ae<G.coordinates.length;ae++)X(G.coordinates[ae],te);return G}}(),ze=u.cx(ge);let qe=u.cs.VectorTileFeature.prototype.toGeoJSON;class Ye{constructor(V){this._feature=V,this.extent=u.X,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){let V=[];for(let H of this._feature.geometry)V.push([new u.P(H[0],H[1])]);return V}{let V=[];for(let H of this._feature.geometry){let G=[];for(let te of H)G.push(new u.P(te[0],te[1]));V.push(G)}return V}}toGeoJSON(V,H,G){return qe.call(this,V,H,G)}}class lt{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=V.length,this._features=V}feature(V){return new Ye(this._features[V])}}var gt,ft,_t,dt={exports:{}},Vt=function(){if(_t)return dt.exports;_t=1;var X=u.cA(),V=function(){if(ft)return gt;ft=1;var Ce=u.cy(),me=u.cz().VectorTileFeature;function de(Ve,at){this.options=at||{},this.features=Ve,this.length=Ve.length}function $e(Ve,at){this.id=typeof Ve.id=="number"?Ve.id:void 0,this.type=Ve.type,this.rawGeometry=Ve.type===1?[Ve.geometry]:Ve.geometry,this.properties=Ve.tags,this.extent=at||4096}return gt=de,de.prototype.feature=function(Ve){return new $e(this.features[Ve],this.options.extent)},$e.prototype.loadGeometry=function(){var Ve=this.rawGeometry;this.geometry=[];for(var at=0;at<Ve.length;at++){for(var pt=Ve[at],Ae=[],He=0;He<pt.length;He++)Ae.push(new Ce(pt[He][0],pt[He][1]));this.geometry.push(Ae)}return this.geometry},$e.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ve=this.geometry,at=1/0,pt=-1/0,Ae=1/0,He=-1/0,Qe=0;Qe<Ve.length;Qe++)for(var Et=Ve[Qe],Ft=0;Ft<Et.length;Ft++){var ut=Et[Ft];at=Math.min(at,ut.x),pt=Math.max(pt,ut.x),Ae=Math.min(Ae,ut.y),He=Math.max(He,ut.y)}return[at,Ae,pt,He]},$e.prototype.toGeoJSON=me.prototype.toGeoJSON,gt}();function H(Ce){var me=new X;return function(de,$e){for(var Ve in de.layers)$e.writeMessage(3,G,de.layers[Ve])}(Ce,me),me.finish()}function G(Ce,me){var de;me.writeVarintField(15,Ce.version||1),me.writeStringField(1,Ce.name||""),me.writeVarintField(5,Ce.extent||4096);var $e={keys:[],values:[],keycache:{},valuecache:{}};for(de=0;de<Ce.length;de++)$e.feature=Ce.feature(de),me.writeMessage(2,te,$e);var Ve=$e.keys;for(de=0;de<Ve.length;de++)me.writeStringField(3,Ve[de]);var at=$e.values;for(de=0;de<at.length;de++)me.writeMessage(4,Te,at[de])}function te(Ce,me){var de=Ce.feature;de.id!==void 0&&me.writeVarintField(1,de.id),me.writeMessage(2,ae,Ce),me.writeVarintField(3,de.type),me.writeMessage(4,fe,de)}function ae(Ce,me){var de=Ce.feature,$e=Ce.keys,Ve=Ce.values,at=Ce.keycache,pt=Ce.valuecache;for(var Ae in de.properties){var He=de.properties[Ae],Qe=at[Ae];if(He!==null){Qe===void 0&&($e.push(Ae),at[Ae]=Qe=$e.length-1),me.writeVarint(Qe);var Et=typeof He;Et!=="string"&&Et!=="boolean"&&Et!=="number"&&(He=JSON.stringify(He));var Ft=Et+":"+He,ut=pt[Ft];ut===void 0&&(Ve.push(He),pt[Ft]=ut=Ve.length-1),me.writeVarint(ut)}}}function pe(Ce,me){return(me<<3)+(7&Ce)}function be(Ce){return Ce<<1^Ce>>31}function fe(Ce,me){for(var de=Ce.loadGeometry(),$e=Ce.type,Ve=0,at=0,pt=de.length,Ae=0;Ae<pt;Ae++){var He=de[Ae],Qe=1;$e===1&&(Qe=He.length),me.writeVarint(pe(1,Qe));for(var Et=$e===3?He.length-1:He.length,Ft=0;Ft<Et;Ft++){Ft===1&&$e!==1&&me.writeVarint(pe(2,Et-1));var ut=He[Ft].x-Ve,Xe=He[Ft].y-at;me.writeVarint(be(ut)),me.writeVarint(be(Xe)),Ve+=ut,at+=Xe}$e===3&&me.writeVarint(pe(7,1))}}function Te(Ce,me){var de=typeof Ce;de==="string"?me.writeStringField(1,Ce):de==="boolean"?me.writeBooleanField(7,Ce):de==="number"&&(Ce%1!=0?me.writeDoubleField(3,Ce):Ce<0?me.writeSVarintField(6,Ce):me.writeVarintField(5,Ce))}return dt.exports=H,dt.exports.fromVectorTileJs=H,dt.exports.fromGeojsonVt=function(Ce,me){me=me||{};var de={};for(var $e in Ce)de[$e]=new V(Ce[$e].features,me),de[$e].name=$e,de[$e].version=me.version,de[$e].extent=me.extent;return H({layers:de})},dt.exports.GeoJSONWrapper=V,dt.exports}(),ki=u.cx(Vt);let $s={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:X=>X},bo=Math.fround||(Wi=new Float32Array(1),X=>(Wi[0]=+X,Wi[0]));var Wi;let qr=3,dr=5,Ga=6;class Zt{constructor(V){this.options=Object.assign(Object.create($s),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:H,minZoom:G,maxZoom:te}=this.options;H&&console.time("total time");let ae=`prepare ${V.length} points`;H&&console.time(ae),this.points=V;let pe=[];for(let fe=0;fe<V.length;fe++){let Te=V[fe];if(!Te.geometry)continue;let[Ce,me]=Te.geometry.coordinates,de=bo(Xo(Ce)),$e=bo(Yo(me));pe.push(de,$e,1/0,fe,-1,1),this.options.reduce&&pe.push(0)}let be=this.trees[te+1]=this._createTree(pe);H&&console.timeEnd(ae);for(let fe=te;fe>=G;fe--){let Te=+Date.now();be=this.trees[fe]=this._createTree(this._cluster(be,fe)),H&&console.log("z%d: %d clusters in %dms",fe,be.numItems,+Date.now()-Te)}return H&&console.timeEnd("total time"),this}getClusters(V,H){let G=((V[0]+180)%360+360)%360-180,te=Math.max(-90,Math.min(90,V[1])),ae=V[2]===180?180:((V[2]+180)%360+360)%360-180,pe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)G=-180,ae=180;else if(G>ae){let me=this.getClusters([G,te,180,pe],H),de=this.getClusters([-180,te,ae,pe],H);return me.concat(de)}let be=this.trees[this._limitZoom(H)],fe=be.range(Xo(G),Yo(pe),Xo(ae),Yo(te)),Te=be.data,Ce=[];for(let me of fe){let de=this.stride*me;Ce.push(Te[de+dr]>1?Hs(Te,de,this.clusterProps):this.points[Te[de+qr]])}return Ce}getChildren(V){let H=this._getOriginId(V),G=this._getOriginZoom(V),te="No cluster with the specified id.",ae=this.trees[G];if(!ae)throw new Error(te);let pe=ae.data;if(H*this.stride>=pe.length)throw new Error(te);let be=this.options.radius/(this.options.extent*Math.pow(2,G-1)),fe=ae.within(pe[H*this.stride],pe[H*this.stride+1],be),Te=[];for(let Ce of fe){let me=Ce*this.stride;pe[me+4]===V&&Te.push(pe[me+dr]>1?Hs(pe,me,this.clusterProps):this.points[pe[me+qr]])}if(Te.length===0)throw new Error(te);return Te}getLeaves(V,H,G){let te=[];return this._appendLeaves(te,V,H=H||10,G=G||0,0),te}getTile(V,H,G){let te=this.trees[this._limitZoom(V)],ae=Math.pow(2,V),{extent:pe,radius:be}=this.options,fe=be/pe,Te=(G-fe)/ae,Ce=(G+1+fe)/ae,me={features:[]};return this._addTileFeatures(te.range((H-fe)/ae,Te,(H+1+fe)/ae,Ce),te.data,H,G,ae,me),H===0&&this._addTileFeatures(te.range(1-fe/ae,Te,1,Ce),te.data,ae,G,ae,me),H===ae-1&&this._addTileFeatures(te.range(0,Te,fe/ae,Ce),te.data,-1,G,ae,me),me.features.length?me:null}getClusterExpansionZoom(V){let H=this._getOriginZoom(V)-1;for(;H<=this.options.maxZoom;){let G=this.getChildren(V);if(H++,G.length!==1)break;V=G[0].properties.cluster_id}return H}_appendLeaves(V,H,G,te,ae){let pe=this.getChildren(H);for(let be of pe){let fe=be.properties;if(fe&&fe.cluster?ae+fe.point_count<=te?ae+=fe.point_count:ae=this._appendLeaves(V,fe.cluster_id,G,te,ae):ae<te?ae++:V.push(be),V.length===G)break}return ae}_createTree(V){let H=new u.az(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let G=0;G<V.length;G+=this.stride)H.add(V[G],V[G+1]);return H.finish(),H.data=V,H}_addTileFeatures(V,H,G,te,ae,pe){for(let be of V){let fe=be*this.stride,Te=H[fe+dr]>1,Ce,me,de;if(Te)Ce=xo(H,fe,this.clusterProps),me=H[fe],de=H[fe+1];else{let at=this.points[H[fe+qr]];Ce=at.properties;let[pt,Ae]=at.geometry.coordinates;me=Xo(pt),de=Yo(Ae)}let $e={type:1,geometry:[[Math.round(this.options.extent*(me*ae-G)),Math.round(this.options.extent*(de*ae-te))]],tags:Ce},Ve;Ve=Te||this.options.generateId?H[fe+qr]:this.points[H[fe+qr]].id,Ve!==void 0&&($e.id=Ve),pe.features.push($e)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,H){let{radius:G,extent:te,reduce:ae,minPoints:pe}=this.options,be=G/(te*Math.pow(2,H)),fe=V.data,Te=[],Ce=this.stride;for(let me=0;me<fe.length;me+=Ce){if(fe[me+2]<=H)continue;fe[me+2]=H;let de=fe[me],$e=fe[me+1],Ve=V.within(fe[me],fe[me+1],be),at=fe[me+dr],pt=at;for(let Ae of Ve){let He=Ae*Ce;fe[He+2]>H&&(pt+=fe[He+dr])}if(pt>at&&pt>=pe){let Ae,He=de*at,Qe=$e*at,Et=-1,Ft=((me/Ce|0)<<5)+(H+1)+this.points.length;for(let ut of Ve){let Xe=ut*Ce;if(fe[Xe+2]<=H)continue;fe[Xe+2]=H;let Cn=fe[Xe+dr];He+=fe[Xe]*Cn,Qe+=fe[Xe+1]*Cn,fe[Xe+4]=Ft,ae&&(Ae||(Ae=this._map(fe,me,!0),Et=this.clusterProps.length,this.clusterProps.push(Ae)),ae(Ae,this._map(fe,Xe)))}fe[me+4]=Ft,Te.push(He/pt,Qe/pt,1/0,Ft,-1,pt),ae&&Te.push(Et)}else{for(let Ae=0;Ae<Ce;Ae++)Te.push(fe[me+Ae]);if(pt>1)for(let Ae of Ve){let He=Ae*Ce;if(!(fe[He+2]<=H)){fe[He+2]=H;for(let Qe=0;Qe<Ce;Qe++)Te.push(fe[He+Qe])}}}}return Te}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,H,G){if(V[H+dr]>1){let pe=this.clusterProps[V[H+Ga]];return G?Object.assign({},pe):pe}let te=this.points[V[H+qr]].properties,ae=this.options.map(te);return G&&ae===te?Object.assign({},ae):ae}}function Hs(X,V,H){return{type:"Feature",id:X[V+qr],properties:xo(X,V,H),geometry:{type:"Point",coordinates:[(G=X[V],360*(G-.5)),Gs(X[V+1])]}};var G}function xo(X,V,H){let G=X[V+dr],te=G>=1e4?`${Math.round(G/1e3)}k`:G>=1e3?Math.round(G/100)/10+"k":G,ae=X[V+Ga],pe=ae===-1?{}:Object.assign({},H[ae]);return Object.assign(pe,{cluster:!0,cluster_id:X[V+qr],point_count:G,point_count_abbreviated:te})}function Xo(X){return X/360+.5}function Yo(X){let V=Math.sin(X*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function Gs(X){let V=(180-360*X)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Oi(X,V,H,G){let te=G,ae=V+(H-V>>1),pe,be=H-V,fe=X[V],Te=X[V+1],Ce=X[H],me=X[H+1];for(let de=V+3;de<H;de+=3){let $e=fi(X[de],X[de+1],fe,Te,Ce,me);if($e>te)pe=de,te=$e;else if($e===te){let Ve=Math.abs(de-ae);Ve<be&&(pe=de,be=Ve)}}te>G&&(pe-V>3&&Oi(X,V,pe,G),X[pe+2]=te,H-pe>3&&Oi(X,pe,H,G))}function fi(X,V,H,G,te,ae){let pe=te-H,be=ae-G;if(pe!==0||be!==0){let fe=((X-H)*pe+(V-G)*be)/(pe*pe+be*be);fe>1?(H=te,G=ae):fe>0&&(H+=pe*fe,G+=be*fe)}return pe=X-H,be=V-G,pe*pe+be*be}function Zr(X,V,H,G){let te={id:X??null,type:V,geometry:H,tags:G,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")nr(te,H);else if(V==="Polygon")nr(te,H[0]);else if(V==="MultiLineString")for(let ae of H)nr(te,ae);else if(V==="MultiPolygon")for(let ae of H)nr(te,ae[0]);return te}function nr(X,V){for(let H=0;H<V.length;H+=3)X.minX=Math.min(X.minX,V[H]),X.minY=Math.min(X.minY,V[H+1]),X.maxX=Math.max(X.maxX,V[H]),X.maxY=Math.max(X.maxY,V[H+1])}function Ko(X,V,H,G){if(!V.geometry)return;let te=V.geometry.coordinates;if(te&&te.length===0)return;let ae=V.geometry.type,pe=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),be=[],fe=V.id;if(H.promoteId?fe=V.properties[H.promoteId]:H.generateId&&(fe=G||0),ae==="Point")Qo(te,be);else if(ae==="MultiPoint")for(let Te of te)Qo(Te,be);else if(ae==="LineString")Jo(te,be,pe,!1);else if(ae==="MultiLineString"){if(H.lineMetrics){for(let Te of te)be=[],Jo(Te,be,pe,!1),X.push(Zr(fe,"LineString",be,V.properties));return}kr(te,be,pe,!1)}else if(ae==="Polygon")kr(te,be,pe,!0);else{if(ae!=="MultiPolygon"){if(ae==="GeometryCollection"){for(let Te of V.geometry.geometries)Ko(X,{id:fe,geometry:Te,properties:V.properties},H,G);return}throw new Error("Input data is not a valid GeoJSON object.")}for(let Te of te){let Ce=[];kr(Te,Ce,pe,!0),be.push(Ce)}}X.push(Zr(fe,ae,be,V.properties))}function Qo(X,V){V.push(qa(X[0]),hr(X[1]),0)}function Jo(X,V,H,G){let te,ae,pe=0;for(let fe=0;fe<X.length;fe++){let Te=qa(X[fe][0]),Ce=hr(X[fe][1]);V.push(Te,Ce,0),fe>0&&(pe+=G?(te*Ce-Te*ae)/2:Math.sqrt(Math.pow(Te-te,2)+Math.pow(Ce-ae,2))),te=Te,ae=Ce}let be=V.length-3;V[2]=1,Oi(V,0,be,H),V[be+2]=1,V.size=Math.abs(pe),V.start=0,V.end=V.size}function kr(X,V,H,G){for(let te=0;te<X.length;te++){let ae=[];Jo(X[te],ae,H,G),V.push(ae)}}function qa(X){return X/360+.5}function hr(X){let V=Math.sin(X*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function jn(X,V,H,G,te,ae,pe,be){if(G/=V,ae>=(H/=V)&&pe<G)return X;if(pe<H||ae>=G)return null;let fe=[];for(let Te of X){let Ce=Te.geometry,me=Te.type,de=te===0?Te.minX:Te.minY,$e=te===0?Te.maxX:Te.maxY;if(de>=H&&$e<G){fe.push(Te);continue}if($e<H||de>=G)continue;let Ve=[];if(me==="Point"||me==="MultiPoint")Xi(Ce,Ve,H,G,te);else if(me==="LineString")Dn(Ce,Ve,H,G,te,!1,be.lineMetrics);else if(me==="MultiLineString")ts(Ce,Ve,H,G,te,!1);else if(me==="Polygon")ts(Ce,Ve,H,G,te,!0);else if(me==="MultiPolygon")for(let at of Ce){let pt=[];ts(at,pt,H,G,te,!0),pt.length&&Ve.push(pt)}if(Ve.length){if(be.lineMetrics&&me==="LineString"){for(let at of Ve)fe.push(Zr(Te.id,me,at,Te.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(Ve.length===1?(me="LineString",Ve=Ve[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=Ve.length===3?"Point":"MultiPoint"),fe.push(Zr(Te.id,me,Ve,Te.tags))}}return fe.length?fe:null}function Xi(X,V,H,G,te){for(let ae=0;ae<X.length;ae+=3){let pe=X[ae+te];pe>=H&&pe<=G&&pi(V,X[ae],X[ae+1],X[ae+2])}}function Dn(X,V,H,G,te,ae,pe){let be=es(X),fe=te===0?wo:Co,Te,Ce,me=X.start;for(let pt=0;pt<X.length-3;pt+=3){let Ae=X[pt],He=X[pt+1],Qe=X[pt+2],Et=X[pt+3],Ft=X[pt+4],ut=te===0?Ae:He,Xe=te===0?Et:Ft,Cn=!1;pe&&(Te=Math.sqrt(Math.pow(Ae-Et,2)+Math.pow(He-Ft,2))),ut<H?Xe>H&&(Ce=fe(be,Ae,He,Et,Ft,H),pe&&(be.start=me+Te*Ce)):ut>G?Xe<G&&(Ce=fe(be,Ae,He,Et,Ft,G),pe&&(be.start=me+Te*Ce)):pi(be,Ae,He,Qe),Xe<H&&ut>=H&&(Ce=fe(be,Ae,He,Et,Ft,H),Cn=!0),Xe>G&&ut<=G&&(Ce=fe(be,Ae,He,Et,Ft,G),Cn=!0),!ae&&Cn&&(pe&&(be.end=me+Te*Ce),V.push(be),be=es(X)),pe&&(me+=Te)}let de=X.length-3,$e=X[de],Ve=X[de+1],at=te===0?$e:Ve;at>=H&&at<=G&&pi(be,$e,Ve,X[de+2]),de=be.length-3,ae&&de>=3&&(be[de]!==be[0]||be[de+1]!==be[1])&&pi(be,be[0],be[1],be[2]),be.length&&V.push(be)}function es(X){let V=[];return V.size=X.size,V.start=X.start,V.end=X.end,V}function ts(X,V,H,G,te,ae){for(let pe of X)Dn(pe,V,H,G,te,ae,!1)}function pi(X,V,H,G){X.push(V,H,G)}function wo(X,V,H,G,te,ae){let pe=(ae-V)/(G-V);return pi(X,ae,H+(te-H)*pe,1),pe}function Co(X,V,H,G,te,ae){let pe=(ae-H)/(te-H);return pi(X,V+(G-V)*pe,ae,1),pe}function Or(X,V){let H=[];for(let G=0;G<X.length;G++){let te=X[G],ae=te.type,pe;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")pe=ns(te.geometry,V);else if(ae==="MultiLineString"||ae==="Polygon"){pe=[];for(let be of te.geometry)pe.push(ns(be,V))}else if(ae==="MultiPolygon"){pe=[];for(let be of te.geometry){let fe=[];for(let Te of be)fe.push(ns(Te,V));pe.push(fe)}}H.push(Zr(te.id,ae,pe,te.tags))}return H}function ns(X,V){let H=[];H.size=X.size,X.start!==void 0&&(H.start=X.start,H.end=X.end);for(let G=0;G<X.length;G+=3)H.push(X[G]+V,X[G+1],X[G+2]);return H}function rs(X,V){if(X.transformed)return X;let H=1<<X.z,G=X.x,te=X.y;for(let ae of X.features){let pe=ae.geometry,be=ae.type;if(ae.geometry=[],be===1)for(let fe=0;fe<pe.length;fe+=2)ae.geometry.push(Eo(pe[fe],pe[fe+1],V,H,G,te));else for(let fe=0;fe<pe.length;fe++){let Te=[];for(let Ce=0;Ce<pe[fe].length;Ce+=2)Te.push(Eo(pe[fe][Ce],pe[fe][Ce+1],V,H,G,te));ae.geometry.push(Te)}}return X.transformed=!0,X}function Eo(X,V,H,G,te,ae){return[Math.round(H*(X*G-te)),Math.round(H*(V*G-ae))]}function Za(X,V,H,G,te){let ae=V===te.maxZoom?0:te.tolerance/((1<<V)*te.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:X.length,source:null,x:H,y:G,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(let be of X)is(pe,be,ae,te);return pe}function is(X,V,H,G){let te=V.geometry,ae=V.type,pe=[];if(X.minX=Math.min(X.minX,V.minX),X.minY=Math.min(X.minY,V.minY),X.maxX=Math.max(X.maxX,V.maxX),X.maxY=Math.max(X.maxY,V.maxY),ae==="Point"||ae==="MultiPoint")for(let be=0;be<te.length;be+=3)pe.push(te[be],te[be+1]),X.numPoints++,X.numSimplified++;else if(ae==="LineString")Yi(pe,te,X,H,!1,!1);else if(ae==="MultiLineString"||ae==="Polygon")for(let be=0;be<te.length;be++)Yi(pe,te[be],X,H,ae==="Polygon",be===0);else if(ae==="MultiPolygon")for(let be=0;be<te.length;be++){let fe=te[be];for(let Te=0;Te<fe.length;Te++)Yi(pe,fe[Te],X,H,!0,Te===0)}if(pe.length){let be=V.tags||null;if(ae==="LineString"&&G.lineMetrics){be={};for(let Te in V.tags)be[Te]=V.tags[Te];be.mapbox_clip_start=te.start/te.size,be.mapbox_clip_end=te.end/te.size}let fe={geometry:pe,type:ae==="Polygon"||ae==="MultiPolygon"?3:ae==="LineString"||ae==="MultiLineString"?2:1,tags:be};V.id!==null&&(fe.id=V.id),X.features.push(fe)}}function Yi(X,V,H,G,te,ae){let pe=G*G;if(G>0&&V.size<(te?pe:G))return void(H.numPoints+=V.length/3);let be=[];for(let fe=0;fe<V.length;fe+=3)(G===0||V[fe+2]>pe)&&(H.numSimplified++,be.push(V[fe],V[fe+1])),H.numPoints++;te&&function(fe,Te){let Ce=0;for(let me=0,de=fe.length,$e=de-2;me<de;$e=me,me+=2)Ce+=(fe[me]-fe[$e])*(fe[me+1]+fe[$e+1]);if(Ce>0===Te)for(let me=0,de=fe.length;me<de/2;me+=2){let $e=fe[me],Ve=fe[me+1];fe[me]=fe[de-2-me],fe[me+1]=fe[de-1-me],fe[de-2-me]=$e,fe[de-1-me]=Ve}}(be,ae),X.push(be)}let os={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ki{constructor(V,H){let G=(H=this.options=function(ae,pe){for(let be in pe)ae[be]=pe[be];return ae}(Object.create(os),H)).debug;if(G&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=function(ae,pe){let be=[];if(ae.type==="FeatureCollection")for(let fe=0;fe<ae.features.length;fe++)Ko(be,ae.features[fe],pe,fe);else Ko(be,ae.type==="Feature"?ae:{geometry:ae},pe);return be}(V,H);this.tiles={},this.tileCoords=[],G&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=function(ae,pe){let be=pe.buffer/pe.extent,fe=ae,Te=jn(ae,1,-1-be,be,0,-1,2,pe),Ce=jn(ae,1,1-be,2+be,0,-1,2,pe);return(Te||Ce)&&(fe=jn(ae,1,-be,1+be,0,-1,2,pe)||[],Te&&(fe=Or(Te,1).concat(fe)),Ce&&(fe=fe.concat(Or(Ce,-1)))),fe}(te,H),te.length&&this.splitTile(te,0,0,0),G&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,H,G,te,ae,pe,be){let fe=[V,H,G,te],Te=this.options,Ce=Te.debug;for(;fe.length;){te=fe.pop(),G=fe.pop(),H=fe.pop(),V=fe.pop();let me=1<<H,de=ss(H,G,te),$e=this.tiles[de];if(!$e&&(Ce>1&&console.time("creation"),$e=this.tiles[de]=Za(V,H,G,te,Te),this.tileCoords.push({z:H,x:G,y:te}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,G,te,$e.numFeatures,$e.numPoints,$e.numSimplified),console.timeEnd("creation"));let Cn=`z${H}`;this.stats[Cn]=(this.stats[Cn]||0)+1,this.total++}if($e.source=V,ae==null){if(H===Te.indexMaxZoom||$e.numPoints<=Te.indexMaxPoints)continue}else{if(H===Te.maxZoom||H===ae)continue;if(ae!=null){let Cn=ae-H;if(G!==pe>>Cn||te!==be>>Cn)continue}}if($e.source=null,V.length===0)continue;Ce>1&&console.time("clipping");let Ve=.5*Te.buffer/Te.extent,at=.5-Ve,pt=.5+Ve,Ae=1+Ve,He=null,Qe=null,Et=null,Ft=null,ut=jn(V,me,G-Ve,G+pt,0,$e.minX,$e.maxX,Te),Xe=jn(V,me,G+at,G+Ae,0,$e.minX,$e.maxX,Te);V=null,ut&&(He=jn(ut,me,te-Ve,te+pt,1,$e.minY,$e.maxY,Te),Qe=jn(ut,me,te+at,te+Ae,1,$e.minY,$e.maxY,Te),ut=null),Xe&&(Et=jn(Xe,me,te-Ve,te+pt,1,$e.minY,$e.maxY,Te),Ft=jn(Xe,me,te+at,te+Ae,1,$e.minY,$e.maxY,Te),Xe=null),Ce>1&&console.timeEnd("clipping"),fe.push(He||[],H+1,2*G,2*te),fe.push(Qe||[],H+1,2*G,2*te+1),fe.push(Et||[],H+1,2*G+1,2*te),fe.push(Ft||[],H+1,2*G+1,2*te+1)}}getTile(V,H,G){V=+V,H=+H,G=+G;let te=this.options,{extent:ae,debug:pe}=te;if(V<0||V>24)return null;let be=1<<V,fe=ss(V,H=H+be&be-1,G);if(this.tiles[fe])return rs(this.tiles[fe],ae);pe>1&&console.log("drilling down to z%d-%d-%d",V,H,G);let Te,Ce=V,me=H,de=G;for(;!Te&&Ce>0;)Ce--,me>>=1,de>>=1,Te=this.tiles[ss(Ce,me,de)];return Te&&Te.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",Ce,me,de),console.time("drilling down")),this.splitTile(Te.source,Ce,me,de,V,H,G),pe>1&&console.timeEnd("drilling down"),this.tiles[fe]?rs(this.tiles[fe],ae):null):null}}function ss(X,V,H){return 32*((1<<X)*H+V)+X}function Io(X,V){return V?X.properties[V]:X.id}function qs(X,V){if(X==null)return!0;if(X.type==="Feature")return Io(X,V)!=null;if(X.type==="FeatureCollection"){let H=new Set;for(let G of X.features){let te=Io(G,V);if(te==null||H.has(te))return!1;H.add(te)}return!0}return!1}function Zs(X,V){let H=new Map;if(X!=null)if(X.type==="Feature")H.set(Io(X,V),X);else for(let G of X.features)H.set(Io(G,V),G);return H}class Wa extends B{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,H){return u._(this,void 0,void 0,function*(){let G=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");let te=this._geoJSONIndex.getTile(G.z,G.x,G.y);if(!te)return null;let ae=new lt(te.features),pe=ki(ae);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:ae,rawData:pe.buffer}})}loadData(V){return u._(this,void 0,void 0,function*(){var H;(H=this._pendingRequest)===null||H===void 0||H.abort();let G=!!(V&&V.request&&V.request.collectResourceTiming)&&new u.cu(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest),this._geoJSONIndex=V.cluster?new Zt(function({superclusterOptions:pe,clusterProperties:be}){if(!be||!pe)return pe;let fe={},Te={},Ce={accumulated:null,zoom:0},me={properties:null},de=Object.keys(be);for(let $e of de){let[Ve,at]=be[$e],pt=u.cB(at),Ae=u.cB(typeof Ve=="string"?[Ve,["accumulated"],["get",$e]]:Ve);fe[$e]=pt.value,Te[$e]=Ae.value}return pe.map=$e=>{me.properties=$e;let Ve={};for(let at of de)Ve[at]=fe[at].evaluate(Ce,me);return Ve},pe.reduce=($e,Ve)=>{me.properties=Ve;for(let at of de)Ce.accumulated=$e[at],$e[at]=Te[at].evaluate(Ce,me)},pe}(V)).load((yield this._pendingData).features):(te=yield this._pendingData,new Ki(te,V.geojsonVtOptions)),this.loaded={};let ae={};if(G){let pe=G.finish();pe&&(ae.resourceTiming={},ae.resourceTiming[V.source]=JSON.parse(JSON.stringify(pe)))}return ae}catch(ae){if(delete this._pendingRequest,u.cf(ae))return{abandoned:!0};throw ae}var te})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(V){let H=this.loaded;return H&&H[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,H){return u._(this,void 0,void 0,function*(){let G=yield this.loadGeoJSON(V,H);if(delete this._pendingRequest,typeof G!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(ze(G,!0),V.filter){let te=u.cB(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map(pe=>`${pe.key}: ${pe.message}`).join(", "));G={type:"FeatureCollection",features:G.features.filter(pe=>te.value.evaluate({zoom:0},pe))}}return G})}loadGeoJSON(V,H){return u._(this,void 0,void 0,function*(){let{promoteId:G}=V;if(V.request){let te=yield u.h(V.request,H);return this._dataUpdateable=qs(te.data,G)?Zs(te.data,G):void 0,te.data}if(typeof V.data=="string")try{let te=JSON.parse(V.data);return this._dataUpdateable=qs(te,G)?Zs(te,G):void 0,te}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return function(te,ae,pe){var be,fe,Te,Ce;if(ae.removeAll&&te.clear(),ae.remove)for(let me of ae.remove)te.delete(me);if(ae.add)for(let me of ae.add){let de=Io(me,pe);de!=null&&te.set(de,me)}if(ae.update)for(let me of ae.update){let de=te.get(me.id);if(de==null)continue;let $e=!me.removeAllProperties&&(((be=me.removeProperties)===null||be===void 0?void 0:be.length)>0||((fe=me.addOrUpdateProperties)===null||fe===void 0?void 0:fe.length)>0);if((me.newGeometry||me.removeAllProperties||$e)&&(de=Object.assign({},de),te.set(me.id,de),$e&&(de.properties=Object.assign({},de.properties))),me.newGeometry&&(de.geometry=me.newGeometry),me.removeAllProperties)de.properties={};else if(((Te=me.removeProperties)===null||Te===void 0?void 0:Te.length)>0)for(let Ve of me.removeProperties)Object.prototype.hasOwnProperty.call(de.properties,Ve)&&delete de.properties[Ve];if(((Ce=me.addOrUpdateProperties)===null||Ce===void 0?void 0:Ce.length)>0)for(let{key:Ve,value:at}of me.addOrUpdateProperties)de.properties[Ve]=at}}(this._dataUpdateable,V.dataDiff,G),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(V){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class To{constructor(V){this.self=V,this.actor=new u.F(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(H,G)=>{if(this.externalWorkerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.externalWorkerSourceTypes[H]=G},this.self.addProtocol=u.ch,this.self.removeProtocol=u.ci,this.self.registerRTLTextPlugin=H=>{u.cC.setMethods(H)},this.actor.registerMessageHandler("LDT",(H,G)=>this._getDEMWorkerSource(H,G.source).loadTile(G)),this.actor.registerMessageHandler("RDT",(H,G)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(H,G.source).removeTile(G)})),this.actor.registerMessageHandler("GCEZ",(H,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(H,G.type,G.source).getClusterExpansionZoom(G)})),this.actor.registerMessageHandler("GCC",(H,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(H,G.type,G.source).getClusterChildren(G)})),this.actor.registerMessageHandler("GCL",(H,G)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(H,G.type,G.source).getClusterLeaves(G)})),this.actor.registerMessageHandler("LD",(H,G)=>this._getWorkerSource(H,G.type,G.source).loadData(G)),this.actor.registerMessageHandler("GD",(H,G)=>this._getWorkerSource(H,G.type,G.source).getData()),this.actor.registerMessageHandler("LT",(H,G)=>this._getWorkerSource(H,G.type,G.source).loadTile(G)),this.actor.registerMessageHandler("RT",(H,G)=>this._getWorkerSource(H,G.type,G.source).reloadTile(G)),this.actor.registerMessageHandler("AT",(H,G)=>this._getWorkerSource(H,G.type,G.source).abortTile(G)),this.actor.registerMessageHandler("RMT",(H,G)=>this._getWorkerSource(H,G.type,G.source).removeTile(G)),this.actor.registerMessageHandler("RS",(H,G)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[H]||!this.workerSources[H][G.type]||!this.workerSources[H][G.type][G.source])return;let te=this.workerSources[H][G.type][G.source];delete this.workerSources[H][G.type][G.source],te.removeSource!==void 0&&te.removeSource(G)})),this.actor.registerMessageHandler("RM",H=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H]})),this.actor.registerMessageHandler("SR",(H,G)=>u._(this,void 0,void 0,function*(){this.referrer=G})),this.actor.registerMessageHandler("SRPS",(H,G)=>this._syncRTLPluginState(H,G)),this.actor.registerMessageHandler("IS",(H,G)=>u._(this,void 0,void 0,function*(){this.self.importScripts(G)})),this.actor.registerMessageHandler("SI",(H,G)=>this._setImages(H,G)),this.actor.registerMessageHandler("UL",(H,G)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(H).update(G.layers,G.removedIds)})),this.actor.registerMessageHandler("SL",(H,G)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(H).replace(G)}))}_setImages(V,H){return u._(this,void 0,void 0,function*(){this.availableImages[V]=H;for(let G in this.workerSources[V]){let te=this.workerSources[V][G];for(let ae in te)te[ae].availableImages=H}})}_syncRTLPluginState(V,H){return u._(this,void 0,void 0,function*(){return yield u.cC.syncState(H,this.self.importScripts)})}_getAvailableImages(V){let H=this.availableImages[V];return H||(H=[]),H}_getLayerIndex(V){let H=this.layerIndexes[V];return H||(H=this.layerIndexes[V]=new s),H}_getWorkerSource(V,H,G){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][H]||(this.workerSources[V][H]={}),!this.workerSources[V][H][G]){let te={sendAsync:(ae,pe)=>(ae.targetMapId=V,this.actor.sendAsync(ae,pe))};switch(H){case"vector":this.workerSources[V][H][G]=new B(te,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][H][G]=new Wa(te,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][H][G]=new this.externalWorkerSourceTypes[H](te,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][H][G]}_getDEMWorkerSource(V,H){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][H]||(this.demWorkerSources[V][H]=new W),this.demWorkerSources[V][H]}}return u.i(self)&&(self.worker=new To(self)),To}),i("index",["exports","./shared"],function(u,s){"use strict";var x="5.1.0";function M(){var m=new s.A(4);return s.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}let S,B,W={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(m,e,o){let h=requestAnimationFrame(e);m.signal.addEventListener("abort",()=>{cancelAnimationFrame(h),o(s.c())})},frameAsync(m){return new Promise((e,o)=>{this.frame(m,e,o)})},getImageData(m,e=0){return this.getImageCanvasContext(m).getImageData(-e,-e,m.width+2*e,m.height+2*e)},getImageCanvasContext(m){let e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=m.width,e.height=m.height,o.drawImage(m,0,0,m.width,m.height),o},resolveURL:m=>(S||(S=document.createElement("a")),S.href=m,S.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(B==null&&(B=matchMedia("(prefers-reduced-motion: reduce)")),B.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in $.docStyle)return e[o];return e[0]}static create(e,o,h){let f=window.document.createElement(e);return o!==void 0&&(f.className=o),h&&h.appendChild(f),f}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,o){e.style[$.transformProp]=o}static addEventListener(e,o,h,f={}){e.addEventListener(o,h,"passive"in f?f:f.capture)}static removeEventListener(e,o,h,f={}){e.removeEventListener(o,h,"passive"in f?f:f.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",$.suppressClickInternal,!0)},0)}static getScale(e){let o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,h){let f=o.boundingClientRect;return new s.P((h.clientX-f.left)/o.x-e.clientLeft,(h.clientY-f.top)/o.y-e.clientTop)}static mousePos(e,o){let h=$.getScale(e);return $.getPoint(e,h,o)}static touchPos(e,o){let h=[],f=$.getScale(e);for(let g=0;g<o.length;g++)h.push($.getPoint(e,f,o[g]));return h}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){let o=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),h=o.querySelectorAll("script");for(let f of h)f.remove();return $.clean(o),o.innerHTML}static isPossiblyDangerous(e,o){let h=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!h.includes("javascript:")&&!h.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){let o=e.children;for(let h of o)$.removeAttributes(h),$.clean(h)}static removeAttributes(e){for(let{name:o,value:h}of e.attributes)$.isPossiblyDangerous(o,h)&&e.removeAttribute(o)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);let he={supported:!1,testSupport:function(m){!qe&&ze&&(Ye?lt(m):ge=m)}},ge,ze,qe=!1,Ye=!1;function lt(m){let e=m.createTexture();m.bindTexture(m.TEXTURE_2D,e);try{if(m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,ze),m.isContextLost())return;he.supported=!0}catch{}m.deleteTexture(e),qe=!0}var gt;typeof document<"u"&&(ze=document.createElement("img"),ze.onload=()=>{ge&&lt(ge),ge=null,Ye=!0},ze.onerror=()=>{qe=!0,ge=null},ze.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(m){let e,o,h,f;m.resetRequestQueue=()=>{e=[],o=0,h=0,f={}},m.addThrottleControl=E=>{let T=h++;return f[T]=E,T},m.removeThrottleControl=E=>{delete f[E],v()},m.getImage=(E,T,A=!0)=>new Promise((R,O)=>{he.supported&&(E.headers||(E.headers={}),E.headers.accept="image/webp,*/*"),s.e(E,{type:"image"}),e.push({abortController:T,requestParameters:E,supportImageRefresh:A,state:"queued",onError:z=>{O(z)},onSuccess:z=>{R(z)}}),v()});let g=E=>s._(this,void 0,void 0,function*(){E.state="running";let{requestParameters:T,supportImageRefresh:A,onError:R,onSuccess:O,abortController:z}=E,U=A===!1&&!s.i(self)&&!s.g(T.url)&&(!T.headers||Object.keys(T.headers).reduce((Q,ee)=>Q&&ee==="accept",!0));o++;let K=U?w(T,z):s.m(T,z);try{let Q=yield K;delete E.abortController,E.state="completed",Q.data instanceof HTMLImageElement||s.b(Q.data)?O(Q):Q.data&&O({data:yield(Y=Q.data,typeof createImageBitmap=="function"?s.d(Y):s.f(Y)),cacheControl:Q.cacheControl,expires:Q.expires})}catch(Q){delete E.abortController,R(Q)}finally{o--,v()}var Y}),v=()=>{let E=(()=>{for(let T of Object.keys(f))if(f[T]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let T=o;T<E&&e.length>0;T++){let A=e.shift();A.abortController.signal.aborted?T--:g(A)}},w=(E,T)=>new Promise((A,R)=>{let O=new Image,z=E.url,U=E.credentials;U&&U==="include"?O.crossOrigin="use-credentials":(U&&U==="same-origin"||!s.s(z))&&(O.crossOrigin="anonymous"),T.signal.addEventListener("abort",()=>{O.src="",R(s.c())}),O.fetchPriority="high",O.onload=()=>{O.onerror=O.onload=null,A({data:O})},O.onerror=()=>{O.onerror=O.onload=null,T.signal.aborted||R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},O.src=z})}(gt||(gt={})),gt.resetRequestQueue();class ft{constructor(e){this._transformRequestFn=e}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function _t(m){let e=[];if(typeof m=="string")e.push({id:"default",url:m});else if(m&&m.length>0){let o=[];for(let{id:h,url:f}of m){let g=`${h}${f}`;o.indexOf(g)===-1&&(o.push(g),e.push({id:h,url:f}))}}return e}function dt(m,e,o){try{let h=new URL(m);return h.pathname+=`${e}${o}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${m}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class Vt{constructor(e,o,h,f){this.context=e,this.format=h,this.texture=e.gl.createTexture(),this.update(o,f)}update(e,o,h){let{width:f,height:g}=e,v=!(this.size&&this.size[0]===f&&this.size[1]===g||h),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(o&&o.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!o||o.premultiply!==!1)),v)this.size=[f,g],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||s.b(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,f,g,0,this.format,E.UNSIGNED_BYTE,e.data);else{let{x:T,y:A}=h||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||s.b(e)?E.texSubImage2D(E.TEXTURE_2D,0,T,A,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,T,A,f,g,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(e,o,h){let{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),h!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(h=g.LINEAR),e!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,e),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,h||e),this.filter=e),o!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,o),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function ki(m){let{userImage:e}=m;return!!(e&&e.render&&e.render())&&(m.data.replace(new Uint8Array(e.data.buffer)),!0)}class $s extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(let{ids:o,promiseResolve:h}of this.requestors)h(this._getImagesForIds(o));this.requestors=[]}}getImage(e){let o=this.images[e];if(o&&!o.data&&o.spriteData){let h=o.spriteData;o.data=new s.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let h=!0,f=o.data||o.spriteData;return this._validateStretch(o.stretchX,f&&f.width)||(this.fire(new s.j(new Error(`Image "${e}" has invalid "stretchX" value`))),h=!1),this._validateStretch(o.stretchY,f&&f.height)||(this.fire(new s.j(new Error(`Image "${e}" has invalid "stretchY" value`))),h=!1),this._validateContent(o.content,o)||(this.fire(new s.j(new Error(`Image "${e}" has invalid "content" value`))),h=!1),h}_validateStretch(e,o){if(!e)return!0;let h=0;for(let f of e){if(f[0]<h||f[1]<f[0]||o<f[1])return!1;h=f[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;let h=o.spriteData,f=h&&h.width||o.data.width,g=h&&h.height||o.data.height;return!(e[0]<0||f<e[0]||e[1]<0||g<e[1]||e[2]<0||f<e[2]||e[3]<0||g<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,h=!0){let f=this.getImage(e);if(h&&(f.data.width!==o.data.width||f.data.height!==o.data.height))throw new Error(`size mismatch between old image (${f.data.width}x${f.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=f.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){let o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((o,h)=>{let f=!0;if(!this.isLoaded())for(let g of e)this.images[g]||(f=!1);this.isLoaded()||f?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})})}_getImagesForIds(e){let o={};for(let h of e){let f=this.getImage(h);f||(this.fire(new s.k("styleimagemissing",{id:h})),f=this.getImage(h)),f?o[h]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,textFitWidth:f.textFitWidth,textFitHeight:f.textFitHeight,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:s.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){let{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){let o=this.patterns[e],h=this.getImage(e);if(!h)return null;if(o&&o.position.version===h.version)return o.position;if(o)o.position.version=h.version;else{let f={w:h.data.width+2,h:h.data.height+2,x:0,y:0},g=new s.I(f,h);this.patterns[e]={bin:f,position:g}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){let o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Vt(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){let e=[];for(let g in this.patterns)e.push(this.patterns[g].bin);let{w:o,h}=s.p(e),f=this.atlasImage;f.resize({width:o||1,height:h||1});for(let g in this.patterns){let{bin:v}=this.patterns[g],w=v.x+1,E=v.y+1,T=this.getImage(g).data,A=T.width,R=T.height;s.R.copy(T,f,{x:0,y:0},{x:w,y:E},{width:A,height:R}),s.R.copy(T,f,{x:0,y:R-1},{x:w,y:E-1},{width:A,height:1}),s.R.copy(T,f,{x:0,y:0},{x:w,y:E+R},{width:A,height:1}),s.R.copy(T,f,{x:A-1,y:0},{x:w-1,y:E},{width:1,height:R}),s.R.copy(T,f,{x:0,y:0},{x:w+A,y:E},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(let o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;let h=this.getImage(o);h||s.w(`Image with ID: "${o}" was not found`),ki(h)&&this.updateImage(o,h)}}}let bo=1e20;function Wi(m,e,o,h,f,g,v,w,E){for(let T=e;T<e+h;T++)qr(m,o*g+T,g,f,v,w,E);for(let T=o;T<o+f;T++)qr(m,T*g+e,1,h,v,w,E)}function qr(m,e,o,h,f,g,v){g[0]=0,v[0]=-1e20,v[1]=bo,f[0]=m[e];for(let w=1,E=0,T=0;w<h;w++){f[w]=m[e+w*o];let A=w*w;do{let R=g[E];T=(f[w]-f[R]+A-R*R)/(w-R)/2}while(T<=v[E]&&--E>-1);E++,g[E]=w,v[E]=T,v[E+1]=bo}for(let w=0,E=0;w<h;w++){for(;v[E+1]<w;)E++;let T=g[E],A=w-T;m[e+w*o]=f[T]+A*A}}class dr{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return s._(this,void 0,void 0,function*(){let o=[];for(let g in e)for(let v of e[g])o.push(this._getAndCacheGlyphsPromise(g,v));let h=yield Promise.all(o),f={};for(let{stack:g,id:v,glyph:w}of h)f[g]||(f[g]={}),f[g][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return f})}_getAndCacheGlyphsPromise(e,o){return s._(this,void 0,void 0,function*(){let h=this.entries[e];h||(h=this.entries[e]={glyphs:{},requests:{},ranges:{}});let f=h.glyphs[o];if(f!==void 0)return{stack:e,id:o,glyph:f};if(f=this._tinySDF(h,e,o),f)return h.glyphs[o]=f,{stack:e,id:o,glyph:f};let g=Math.floor(o/256);if(256*g>65535)throw new Error("glyphs > 65535 not supported");if(h.ranges[g])return{stack:e,id:o,glyph:f};if(!this.url)throw new Error("glyphsUrl is not set");if(!h.requests[g]){let w=dr.loadGlyphRange(e,g,this.url,this.requestManager);h.requests[g]=w}let v=yield h.requests[g];for(let w in v)this._doesCharSupportLocalGlyph(+w)||(h.glyphs[+w]=v[+w]);return h.ranges[g]=!0,{stack:e,id:o,glyph:v[o]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,o,h){let f=this.localIdeographFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let g=e.tinySDF;if(!g){let w="400";/bold/i.test(o)?w="900":/medium/i.test(o)?w="500":/light/i.test(o)&&(w="200"),g=e.tinySDF=new dr.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:f,fontWeight:w})}let v=g.draw(String.fromCharCode(h));return{id:h,bitmap:new s.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}dr.loadGlyphRange=function(m,e,o,h){return s._(this,void 0,void 0,function*(){let f=256*e,g=f+255,v=h.transformRequest(o.replace("{fontstack}",m).replace("{range}",`${f}-${g}`),"Glyphs"),w=yield s.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${f}-${g}`);let E={};for(let T of s.n(w.data))E[T.id]=T;return E})},dr.TinySDF=class{constructor({fontSize:m=24,buffer:e=3,radius:o=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:g="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=h,this.radius=o;let w=this.size=m+4*e,E=this._createCanvas(w),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${v} ${g} ${m}px ${f}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(m){let e=document.createElement("canvas");return e.width=e.height=m,e}draw(m){let{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:g}=this.ctx.measureText(m),v=Math.ceil(o),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-f))),E=Math.min(this.size-this.buffer,v+Math.ceil(h)),T=w+2*this.buffer,A=E+2*this.buffer,R=Math.max(T*A,0),O=new Uint8ClampedArray(R),z={data:O,width:T,height:A,glyphWidth:w,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||E===0)return z;let{ctx:U,buffer:K,gridInner:Y,gridOuter:Q}=this;U.clearRect(K,K,w,E),U.fillText(m,K,K+v);let ee=U.getImageData(K,K,w,E);Q.fill(bo,0,R),Y.fill(0,0,R);for(let ie=0;ie<E;ie++)for(let oe=0;oe<w;oe++){let se=ee.data[4*(ie*w+oe)+3]/255;if(se===0)continue;let ce=(ie+K)*T+oe+K;if(se===1)Q[ce]=0,Y[ce]=bo;else{let le=.5-se;Q[ce]=le>0?le*le:0,Y[ce]=le<0?le*le:0}}Wi(Q,0,0,T,A,T,this.f,this.v,this.z),Wi(Y,K,K,w,E,T,this.f,this.v,this.z);for(let ie=0;ie<R;ie++){let oe=Math.sqrt(Q[ie])-Math.sqrt(Y[ie]);O[ie]=Math.round(255-255*(oe/this.radius+this.cutoff))}return z}};class Ga{constructor(){this.specification=s.v.light.position}possiblyEvaluate(e,o){return s.x(e.expression.evaluate(o))}interpolate(e,o,h){return{x:s.y.number(e.x,o.x,h),y:s.y.number(e.y,o.y,h),z:s.y.number(e.z,o.z,h)}}}let Zt;class Hs extends s.E{constructor(e){super(),Zt=Zt||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ga,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(Zt),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(s.r,e,o))for(let h in e){let f=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,h){return(!h||h.validate!==!1)&&s.t(this,e.call(s.u,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}let xo=new s.q({"sky-color":new s.D(s.v.sky["sky-color"]),"horizon-color":new s.D(s.v.sky["horizon-color"]),"fog-color":new s.D(s.v.sky["fog-color"]),"fog-ground-blend":new s.D(s.v.sky["fog-ground-blend"]),"horizon-fog-blend":new s.D(s.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new s.D(s.v.sky["sky-horizon-blend"]),"atmosphere-blend":new s.D(s.v.sky["atmosphere-blend"])});class Xo extends s.E{constructor(e){super(),this._transitionable=new s.T(xo),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.z(0))}setSky(e,o={}){if(!this._validate(s.B,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(let h in e){let f=e[h];h.endsWith("-transition")?this._transitionable.setTransition(h.slice(0,-11),f):this._transitionable.setValue(h,f)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,h={}){return h?.validate!==!1&&s.t(this,e.call(s.u,s.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:s.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Yo{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){let h=e.join(",")+String(o);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(e,o)),this.dashEntry[h]}getDashRanges(e,o,h){let f=[],g=e.length%2==1?-e[e.length-1]*h:0,v=e[0]*h,w=!0;f.push({left:g,right:v,isDash:w,zeroLength:e[0]===0});let E=e[0];for(let T=1;T<e.length;T++){w=!w;let A=e[T];g=E*h,E+=A,v=E*h,f.push({left:g,right:v,isDash:w,zeroLength:A===0})}return f}addRoundDash(e,o,h){let f=o/2;for(let g=-h;g<=h;g++){let v=this.width*(this.nextRow+h+g),w=0,E=e[w];for(let T=0;T<this.width;T++){T/E.right>1&&(E=e[++w]);let A=Math.abs(T-E.left),R=Math.abs(T-E.right),O=Math.min(A,R),z,U=g/h*(f+1);if(E.isDash){let K=f-Math.abs(U);z=Math.sqrt(O*O+K*K)}else z=f-Math.sqrt(O*O+U*U);this.data[v+T]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){let E=e[w],T=e[w+1];E.zeroLength?e.splice(w,1):T&&T.isDash===E.isDash&&(T.left=E.left,e.splice(w,1))}let o=e[0],h=e[e.length-1];o.isDash===h.isDash&&(o.left=h.left-this.width,h.right=o.right+this.width);let f=this.width*this.nextRow,g=0,v=e[g];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++g]);let E=Math.abs(w-v.left),T=Math.abs(w-v.right),A=Math.min(E,T);this.data[f+w]=Math.max(0,Math.min(255,(v.isDash?A:-A)+128))}}addDash(e,o){let h=o?7:0,f=2*h+1;if(this.nextRow+f>this.height)return s.w("LineAtlas out of space"),null;let g=0;for(let w=0;w<e.length;w++)g+=e[w];if(g!==0){let w=this.width/g,E=this.getDashRanges(e,this.width,w);o?this.addRoundDash(E,w,h):this.addRegularDash(E)}let v={y:(this.nextRow+h+.5)/this.height,height:2*h/this.height,width:g};return this.nextRow+=f,this.dirty=!0,v}bind(e){let o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}let Gs="maplibre_preloaded_worker_pool";class Oi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Oi.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(o=>{o.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gs]}numActive(){return Object.keys(this.active).length}}let fi=Math.floor(W.hardwareConcurrency/2),Zr,nr;function Ko(){return Zr||(Zr=new Oi),Zr}Oi.workerCount=s.C(globalThis)?Math.max(Math.min(fi,3),1):1;class Qo{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;let h=this.workerPool.acquire(o);for(let f=0;f<h.length;f++){let g=new s.F(h[f],o);g.name=`Worker ${f}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){let h=[];for(let f of this.actors)h.push(f.sendAsync({type:e,data:o}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(o=>{o.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(let h of this.actors)h.registerMessageHandler(e,o)}}function Jo(){return nr||(nr=new Qo(Ko(),s.G),nr.registerMessageHandler("GR",(m,e,o)=>s.m(e,o))),nr}function kr(m,e){let o=s.H();return s.J(o,o,[1,1,0]),s.K(o,o,[.5*m.width,.5*m.height,1]),m.calculatePosMatrix?s.L(o,o,m.calculatePosMatrix(e.toUnwrapped())):o}function qa(m,e,o,h,f,g){var v;let w=function(R,O,z){if(R)for(let U of R){let K=O[U];if(K&&K.source===z&&K.type==="fill-extrusion")return!0}else for(let U in O){let K=O[U];if(K.source===z&&K.type==="fill-extrusion")return!0}return!1}((v=f?.layers)!==null&&v!==void 0?v:null,e,m.id),E=g.maxPitchScaleFactor(),T=m.tilesIn(h,E,w);T.sort(hr);let A=[];for(let R of T)A.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,o,m._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,f,g,E,kr(m.transform,R.tileID))});return function(R,O){for(let z in R)for(let U of R[z])jn(U,O);return R}(function(R){let O={},z={};for(let U of R){let K=U.queryResults,Y=U.wrappedTileID,Q=z[Y]=z[Y]||{};for(let ee in K){let ie=K[ee],oe=Q[ee]=Q[ee]||{},se=O[ee]=O[ee]||[];for(let ce of ie)oe[ce.featureIndex]||(oe[ce.featureIndex]=!0,se.push(ce))}}return O}(A),m)}function hr(m,e){let o=m.tileID,h=e.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}function jn(m,e){let o=m.feature,h=e.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=h}function Xi(m,e,o){return s._(this,void 0,void 0,function*(){let h=m;if(m.url?h=(yield s.h(e.transformRequest(m.url,"Source"),o)).data:yield W.frameAsync(o),!h)return null;let f=s.M(s.e(h,m),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(f.vectorLayerIds=h.vector_layers.map(g=>g.id)),f})}class Dn{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof s.N?new s.N(e.lng,e.lat):s.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof s.N?new s.N(e.lng,e.lat):s.N.convert(e),this}extend(e){let o=this._sw,h=this._ne,f,g;if(e instanceof s.N)f=e,g=e;else{if(!(e instanceof Dn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Dn.convert(e)):this.extend(s.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(s.N.convert(e)):this;if(f=e._sw,g=e._ne,!f||!g)return this}return o||h?(o.lng=Math.min(f.lng,o.lng),o.lat=Math.min(f.lat,o.lat),h.lng=Math.max(g.lng,h.lng),h.lat=Math.max(g.lat,h.lat)):(this._sw=new s.N(f.lng,f.lat),this._ne=new s.N(g.lng,g.lat)),this}getCenter(){return new s.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.N(this.getWest(),this.getNorth())}getSouthEast(){return new s.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:o,lat:h}=s.N.convert(e),f=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(e){return e instanceof Dn?e:e&&new Dn(e)}static fromLngLat(e,o=0){let h=360*o/40075017,f=h/Math.cos(Math.PI/180*e.lat);return new Dn(new s.N(e.lng-f,e.lat-h),new s.N(e.lng+f,e.lat+h))}adjustAntiMeridian(){let e=new s.N(this._sw.lng,this._sw.lat),o=new s.N(this._ne.lng,this._ne.lat);return new Dn(e,e.lng>o.lng?new s.N(o.lng+360,o.lat):o)}}class es{constructor(e,o,h){this.bounds=Dn.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=h||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let o=Math.pow(2,e.z),h=Math.floor(s.O(this.bounds.getWest())*o),f=Math.floor(s.Q(this.bounds.getNorth())*o),g=Math.ceil(s.O(this.bounds.getEast())*o),v=Math.ceil(s.Q(this.bounds.getSouth())*o);return e.x>=h&&e.x<g&&e.y>=f&&e.y<v}}class ts extends s.E{constructor(e,o,h,f){if(super(),this.id=e,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.M(o,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let e=yield Xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(s.e(this,e),e.bounds&&(this.tileBounds=new es(e.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new s.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(e){return s._(this,void 0,void 0,function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};h.request.collectResourceTiming=this._collectResourceTiming;let f="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((g,v)=>{e.reloadPromise={resolve:g,reject:v}})}else e.actor=this.dispatcher.getActor(),f="LT";e.abortController=new AbortController;try{let g=yield e.actor.sendAsync({type:f,data:h},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,g)}catch(g){if(delete e.abortController,e.aborted)return;if(g&&g.status!==404)throw g;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){let h=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(h.resolve).catch(h.reject)}}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pi extends s.E{constructor(e,o,h,f){super(),this.id=e,this.dispatcher=h,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},o),s.e(this,s.M(o,["url","scheme","tileSize"]))}load(){return s._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{let o=yield Xi(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(s.e(this,o),o.bounds&&(this.tileBounds=new es(o.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(o){this._tileJSONRequest=null,this.fire(new s.j(o))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return s.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return s._(this,void 0,void 0,function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{let h=yield gt.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&h.cacheControl&&h.expires&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});let f=this.map.painter.context,g=f.gl,v=h.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new Vt(f,v,g.RGBA,{useMipmap:!0}),e.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class wo extends pi{constructor(e,o,h,f){super(e,o,h,f),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return s._(this,void 0,void 0,function*(){let o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{let f=yield gt.getImage(h,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(f&&f.data){let g=f.data;this.map._refreshExpiredTiles&&f.cacheControl&&f.expires&&e.setExpiryData({cacheControl:f.cacheControl,expires:f.expires});let v=s.b(g)&&s.U()?g:yield this.readImageNow(g),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();let E=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=E,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(f){if(delete e.abortController,e.aborted)e.state="unloaded";else if(f)throw e.state="errored",f}})}readImageNow(e){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.V()){let o=e.width+2,h=e.height+2;try{return new s.R({width:o,height:h},yield s.W(e,-1,-1,o,h))}catch{}}return W.getImageData(e,1)})}_getNeighboringTiles(e){let o=e.canonical,h=Math.pow(2,o.z),f=(o.x-1+h)%h,g=o.x===0?e.wrap-1:e.wrap,v=(o.x+1+h)%h,w=o.x+1===h?e.wrap+1:e.wrap,E={};return E[new s.S(e.overscaledZ,g,o.z,f,o.y).key]={backfilled:!1},E[new s.S(e.overscaledZ,w,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(E[new s.S(e.overscaledZ,g,o.z,f,o.y-1).key]={backfilled:!1},E[new s.S(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new s.S(e.overscaledZ,w,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<h&&(E[new s.S(e.overscaledZ,g,o.z,f,o.y+1).key]={backfilled:!1},E[new s.S(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new s.S(e.overscaledZ,w,o.z,v,o.y+1).key]={backfilled:!1}),E}unloadTile(e){return s._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Co extends s.E{constructor(e,o,h,f){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=h.getActor(),this.setEventedParent(f),this._data=o.data,this._options=s.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId,o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&s.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=s.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(o.buffer!==void 0?o.buffer:128),tolerance:this._pixelsToTileUnits(o.tolerance!==void 0?o.tolerance:.375),extent:s.X,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:s.X,radius:this._pixelsToTileUnits(o.clusterRadius||50),log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(s.X/this.tileSize)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return s._(this,void 0,void 0,function*(){let e=s.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:h}})}_updateWorkerData(e){return s._(this,void 0,void 0,function*(){let o=s.e({type:this.type},this.workerOptions);e?o.dataDiff=e:typeof this._data=="string"?(o.request=this.map._requestManager.transformRequest(W.resolveURL(this._data),"Source"),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{let h=yield this.actor.sendAsync({type:"LD",data:o});if(this._pendingLoads--,this._removed||h.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let f=null;h.resourceTiming&&h.resourceTiming[this.id]&&(f=h.resourceTiming[this.id].slice(0));let g={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&s.e(g,{resourceTiming:f}),this.fire(new s.k("data",Object.assign(Object.assign({},g),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},g),{sourceDataType:"content"})))}catch(h){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(h))}})}loaded(){return this._pendingLoads===0}loadTile(e){return s._(this,void 0,void 0,function*(){let o=e.actor?"RT":"LT";e.actor=this.actor;let h={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;let f=yield this.actor.sendAsync({type:o,data:h},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(f,this.map.painter,o==="RT")})}abortTile(e){return s._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return s._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Or extends s.E{constructor(e,o,h,f){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=h,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=o}load(e){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{let o=yield gt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new s.j(o))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;let o=e.map(s.Y.fromLngLat);var h;return this.tileID=function(f){let g=1/0,v=1/0,w=-1/0,E=-1/0;for(let O of f)g=Math.min(g,O.x),v=Math.min(v,O.y),w=Math.max(w,O.x),E=Math.max(E,O.y);let T=Math.max(w-g,E-v),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),R=Math.pow(2,A);return new s.Z(A,Math.floor((g+w)/2*R),Math.floor((v+E)/2*R))}(o),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=o.map(f=>this.tileID.getTilePoint(f)._round()),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;let e=this.map.painter.context,o=e.gl;this.texture||(this.texture=new Vt(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(let f in this.tiles){let g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,h=!0)}h&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ns extends Or{constructor(e,o,h,f){super(e,o,h,f),this.roundZoom=!0,this.type="video",this.options=o}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;let e=this.options;this.urls=[];for(let o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{let o=yield s.a0(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new s.j(o))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){let o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new s.j(new s.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let e=this.map.painter.context,o=e.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new Vt(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let h=!1;for(let f in this.tiles){let g=this.tiles[f];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture,h=!0)}h&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class rs extends Or{constructor(e,o,h,f){super(e,o,h,f),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(v=>typeof v!="number"))||this.fire(new s.j(new s.$(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.$(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new s.j(new s.$(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.$(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.$(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context,h=o.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Vt(o,this.canvas,h.RGBA,{premultiply:!0});let f=!1;for(let g in this.tiles){let v=this.tiles[g];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,f=!0)}f&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}let Eo={},Za=m=>{switch(m){case"geojson":return Co;case"image":return Or;case"raster":return pi;case"raster-dem":return wo;case"vector":return ts;case"video":return ns;case"canvas":return rs}return Eo[m]},is="RTLPluginLoaded";class Yi extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Jo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(o=>{throw this.status="error",o})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return s._(this,arguments,void 0,function*(o,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=W.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(is))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let os=null;function Ki(){return os||(os=new Yi),os}class ss{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=s.a1(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){let o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(f,g){let v={};if(!g)return v;for(let w of f){let E=w.layerIds.map(T=>g.getLayer(T)).filter(Boolean);if(E.length!==0){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(T=>E.filter(A=>A.id===T)[0]));for(let T of E)v[T.id]=w}}return v}(e.buckets,o?.style),this.hasSymbolBuckets=!1;for(let f in this.buckets){let g=this.buckets[f];if(g instanceof s.a3){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let f in this.buckets){let g=this.buckets[f];if(g instanceof s.a3&&g.hasRTLText){this.hasRTLText=!0,Ki().lazyLoad();break}}this.queryPadding=0;for(let f in this.buckets){let g=this.buckets[f];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(f).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new s.a2}unloadVectorData(){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(let h in this.buckets){let f=this.buckets[h];f.uploadPending()&&f.upload(e)}let o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vt(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vt(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,h,f,g,v,w,E,T,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:g,scale:v,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:w,queryPadding:this.queryPadding*T},e,o,h):{}}querySourceFeatures(e,o){let h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;let f=h.loadVTLayers(),g=o&&o.sourceLayer?o.sourceLayer:"",v=f._geojsonTileLayer||f[g];if(!v)return;let w=s.a4(o&&o.filter),{z:E,x:T,y:A}=this.tileID.canonical,R={z:E,x:T,y:A};for(let O=0;O<v.length;O++){let z=v.feature(O);if(w.needGeometry){let Y=s.a5(z,!0);if(!w.filter(new s.z(this.tileID.overscaledZ),Y,this.tileID.canonical))continue}else if(!w.filter(new s.z(this.tileID.overscaledZ),z))continue;let U=h.getId(z,g),K=new s.a6(z,E,T,A,U);K.tile=R,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let o=this.expirationTime;if(e.cacheControl){let h=s.a7(e.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let h=Date.now(),f=!1;if(this.expirationTime>h)f=!1;else if(o)if(this.expirationTime<o)f=!0;else{let g=this.expirationTime-o;g?this.expirationTime=h+Math.max(g,3e4):f=!0}else f=!0;f?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;let h=this.latestFeatureIndex.loadVTLayers();for(let f in this.buckets){if(!o.style.hasLayer(f))continue;let g=this.buckets[f],v=g.layers[0].sourceLayer||"_geojsonTileLayer",w=h[v],E=e[v];if(!w||!E||Object.keys(E).length===0)continue;g.update(E,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});let T=o&&o.style&&o.style.getLayer(f);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<W.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=W.now()+e}setDependencies(e,o){let h={};for(let f of o)h[f]=!0;this.dependencies[e]=h}hasDependency(e,o){for(let h of e){let f=this.dependencies[h];if(f){for(let g of o)if(f[g])return!0}}return!1}}class Io{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(let e in this.data)for(let o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,h){let f=e.wrapped().key;this.data[f]===void 0&&(this.data[f]=[]);let g={value:o,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(e,g)},h)),this.data[f].push(g),this.order.push(f),this.order.length>this.max){let v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){let o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;let h=e.wrapped().key,f=o===void 0?0:this.data[h].indexOf(o),g=this.data[h][f];return this.data[h].splice(f,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){let o=[];for(let h in this.data)for(let f of this.data[h])e(f.value)||o.push(f);for(let h of o)this.remove(h.value.tileID,h)}}class qs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,h){let f=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},s.e(this.stateChanges[e][f],h),this.deletedStates[e]===null){this.deletedStates[e]={};for(let g in this.state[e])g!==f&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][f]===null){this.deletedStates[e][f]={};for(let g in this.state[e][f])h[g]||(this.deletedStates[e][f][g]=null)}else for(let g in h)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][g]===null&&delete this.deletedStates[e][f][g]}removeFeatureState(e,o,h){if(this.deletedStates[e]===null)return;let f=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},h&&o!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][h]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(h in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][h]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}getState(e,o){let h=String(o),f=s.e({},(this.state[e]||{})[h],(this.stateChanges[e]||{})[h]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let g=this.deletedStates[e][o];if(g===null)return{};for(let v in g)delete f[v]}return f}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){let h={};for(let f in this.stateChanges){this.state[f]=this.state[f]||{};let g={};for(let v in this.stateChanges[f])this.state[f][v]||(this.state[f][v]={}),s.e(this.state[f][v],this.stateChanges[f][v]),g[v]=this.state[f][v];h[f]=g}for(let f in this.deletedStates){this.state[f]=this.state[f]||{};let g={};if(this.deletedStates[f]===null)for(let v in this.state[f])g[v]={},this.state[f][v]={};else for(let v in this.deletedStates[f]){if(this.deletedStates[f][v]===null)this.state[f][v]={};else for(let w of Object.keys(this.deletedStates[f][v]))delete this.state[f][v][w];g[v]=this.state[f][v]}h[f]=h[f]||{},s.e(h[f],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(let f in e)e[f].setFeatureState(h,o)}}function Zs(m,e,o){let h=e.intersectsFrustum(m);if(!o)return h;let f=e.intersectsPlane(o);return h===0||f===0?0:h===2&&f===2?2:1}function Wa(m,e,o,h,f){let g=m,v=Math.atan(e/o),w=Math.hypot(e,o);return g=m+s.a8(h/w/Math.max(.5,Math.cos(s.aa(f/2)))),g+=1*s.a8(Math.cos(v))/2,g+=s.ab(m-g,-0,0),g}function To(m,e){let o=(e.roundZoom?Math.round:Math.floor)(m.zoom+s.a8(m.tileSize/e.tileSize));return Math.max(0,o)}function X(m,e){let o=m.getCameraFrustum(),h=m.getClippingPlane(),f=m.screenPointToMercatorCoordinate(m.getCameraPoint()),g=s.Y.fromLngLat(m.center,m.elevation);f.z=g.z+Math.cos(m.pitchInRadians)*m.cameraToCenterDistance/m.worldSize;let v=m.getCoveringTilesDetailsProvider(),w=v.allowVariableZoom(m,e),E=To(m,e),T=e.minzoom||0,A=e.maxzoom!==void 0?e.maxzoom:m.maxZoom,R=Math.min(Math.max(0,E),A),O=Math.pow(2,R),z=[O*f.x,O*f.y,0],U=[O*g.x,O*g.y,0],K=Math.hypot(g.x-f.x,g.y-f.y),Y=Math.abs(g.z-f.z),Q=Math.hypot(K,Y),ee=se=>({zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ie=[],oe=[];if(m.renderWorldCopies&&v.allowWorldCopies())for(let se=1;se<=3;se++)ie.push(ee(-se)),ie.push(ee(se));for(ie.push(ee(0));ie.length>0;){let se=ie.pop(),ce=se.x,le=se.y,ye=se.fullyVisible,ve={x:ce,y:le,z:se.zoom},Se=v.getTileAABB(ve,se.wrap,m.elevation,e);if(!ye){let je=Zs(o,Se,h);if(je===0)continue;ye=je===2}let Re=v.distanceToTile2d(f.x,f.y,ve,Se),Ee=E;w&&(Ee=(e.calculateTileZoom||Wa)(m.zoom+s.a8(m.tileSize/e.tileSize),Re,Y,Q,m.fov)),Ee=(e.roundZoom?Math.round:Math.floor)(Ee),Ee=Math.max(0,Ee);let Ue=Math.min(Ee,A);if(se.wrap=v.getWrap(g,ve,se.wrap),se.zoom>=Ue){if(se.zoom<T)continue;let je=R-se.zoom,Oe=z[0]-.5-(ce<<je),Ge=z[1]-.5-(le<<je),bt=e.reparseOverscaled?Math.max(se.zoom,Ee):se.zoom;oe.push({tileID:new s.S(se.zoom===A?bt:se.zoom,se.wrap,se.zoom,ce,le),distanceSq:s.a9([U[0]-.5-ce,U[1]-.5-le]),tileDistanceToCamera:Math.sqrt(Oe*Oe+Ge*Ge)})}else for(let je=0;je<4;je++)ie.push({zoom:se.zoom+1,x:(ce<<1)+je%2,y:(le<<1)+(je>>1),wrap:se.wrap,fullyVisible:ye})}return oe.sort((se,ce)=>se.distanceSq-ce.distanceSq).map(se=>se.tileID)}class V extends s.E{constructor(e,o,h){super(),this.id=e,this.dispatcher=h,this.on("data",f=>this._dataHandler(f)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((f,g,v,w)=>{let E=new(Za(g.type))(f,g,v,w);if(E.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${E.id}`);return E})(e,o,h,this),this._tiles={},this._cache=new Io(0,f=>this._unloadTile(f)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new qs,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(let e in this._tiles){let o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,h){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,h)}catch(f){e.state="errored",f.status!==404?this._source.fire(new s.j(f,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new s.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let o in this._tiles){let h=this._tiles[o];h.upload(e),h.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(H).map(e=>e.key)}getRenderableIds(e){let o=[];for(let h in this._tiles)this._isIdRenderable(h,e)&&o.push(this._tiles[h]);return e?o.sort((h,f)=>{let g=h.tileID,v=f.tileID,w=new s.P(g.canonical.x,g.canonical.y)._rotate(-this.transform.bearingInRadians),E=new s.P(v.canonical.x,v.canonical.y)._rotate(-this.transform.bearingInRadians);return g.overscaledZ-v.overscaledZ||E.y-w.y||E.x-w.x}).map(h=>h.tileID.key):o.map(h=>h.tileID).sort(H).map(h=>h.key)}hasRenderableParent(e){let o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)(e||this._tiles[o].state!=="errored")&&this._reloadTile(o,"reloading")}}_reloadTile(e,o){return s._(this,void 0,void 0,function*(){let h=this._tiles[e];h&&(h.state!=="loading"&&(h.state=o),yield this._loadTile(h,e,o))})}_tileLoaded(e,o,h){e.timeAdded=W.now(),h==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){let o=this.getRenderableIds();for(let f=0;f<o.length;f++){let g=o[f];if(e.neighboringTiles&&e.neighboringTiles[g]){let v=this.getTileByID(g);h(e,v),h(v,e)}}function h(f,g){f.needsHillshadePrepare=!0,f.needsTerrainPrepare=!0;let v=g.tileID.canonical.x-f.tileID.canonical.x,w=g.tileID.canonical.y-f.tileID.canonical.y,E=Math.pow(2,f.tileID.canonical.z),T=g.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+E)===1?v+=E:Math.abs(v-E)===1&&(v-=E)),g.dem&&f.dem&&(f.dem.backfillBorder(g.dem,v,w),f.neighboringTiles&&f.neighboringTiles[T]&&(f.neighboringTiles[T].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,h,f){for(let g in this._tiles){let v=this._tiles[g];if(f[g]||!v.hasData()||v.tileID.overscaledZ<=o||v.tileID.overscaledZ>h)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>o+1;){let T=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[T.key],v&&v.hasData()&&(w=T)}let E=w;for(;E.overscaledZ>o;)if(E=E.scaledTo(E.overscaledZ-1),e[E.key]||e[E.canonical.key]){f[w.key]=w;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){let h=this._loadedParentTiles[e.key];return h&&h.tileID.overscaledZ>=o?h:null}for(let h=e.overscaledZ-1;h>=o;h--){let f=e.scaledTo(h),g=this._getLoadedTile(f);if(g)return g}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){let o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){let o=Math.ceil(e.width/this._source.tileSize)+1,h=Math.ceil(e.height/this._source.tileSize)+1,f=Math.floor(o*h*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,f):f;this._cache.setMaxSize(g)}handleWrapJump(e){let o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){let h={};for(let f in this._tiles){let g=this._tiles[f];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+o),h[g.tileID.key]=g}this._tiles=h;for(let f in this._timers)clearTimeout(this._timers[f]),delete this._timers[f];for(let f in this._tiles)this._setTileReloadTimer(f,this._tiles[f])}}_updateCoveredAndRetainedTiles(e,o,h,f,g,v){let w={},E={},T=Object.keys(e),A=W.now();for(let R of T){let O=e[R],z=this._tiles[R];if(!z||z.fadeEndTime!==0&&z.fadeEndTime<=A)continue;let U=this.findLoadedParent(O,o),K=this.findLoadedSibling(O),Y=U||K||null;Y&&(this._addTile(Y.tileID),w[Y.tileID.key]=Y.tileID),E[R]=O}this._retainLoadedChildren(E,f,h,e);for(let R in w)e[R]||(this._coveredTiles[R]=!0,e[R]=w[R]);if(v){let R={},O={};for(let z of g)this._tiles[z.key].hasData()?R[z.key]=z:O[z.key]=z;for(let z in O){let U=O[z].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(R[U[0].key]=e[U[0].key]=U[0],R[U[1].key]=e[U[1].key]=U[1],R[U[2].key]=e[U[2].key]=U[2],R[U[3].key]=e[U[3].key]=U[3],delete O[z])}for(let z in O){let U=O[z],K=this.findLoadedParent(U,this._source.minzoom),Y=this.findLoadedSibling(U),Q=K||Y||null;if(Q){R[Q.tileID.key]=e[Q.tileID.key]=Q.tileID;for(let ee in R)R[ee].isChildOf(Q.tileID)&&delete R[ee]}}for(let z in this._tiles)R[z]||(this._coveredTiles[z]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let h;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(A=>new s.S(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y)):(h=X(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter(A=>this._source.hasTile(A)))):h=[];let f=To(e,this._source),g=Math.max(f-V.maxOverzooming,this._source.minzoom),v=Math.max(f+V.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){let A={};for(let R of h)if(R.canonical.z>this._source.minzoom){let O=R.scaledTo(R.canonical.z-1);A[O.key]=O;let z=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));A[z.key]=z}h=h.concat(Object.values(A))}let w=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));let E=this._updateRetainedTiles(h,f);G(this._source.type)&&this._updateCoveredAndRetainedTiles(E,g,v,f,h,o);for(let A in E)this._tiles[A].clearFadeHold();let T=s.ac(this._tiles,E);for(let A of T){let R=this._tiles[A];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(A)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var h;let f={},g={},v=Math.max(o-V.maxOverzooming,this._source.minzoom),w=Math.max(o+V.maxUnderzooming,this._source.minzoom),E={};for(let T of e){let A=this._addTile(T);f[T.key]=T,A.hasData()||o<this._source.maxzoom&&(E[T.key]=T)}this._retainLoadedChildren(E,o,w,f);for(let T of e){let A=this._tiles[T.key];if(A.hasData())continue;if(o+1>this._source.maxzoom){let O=T.children(this._source.maxzoom)[0],z=this.getTile(O);if(z&&z.hasData()){f[O.key]=O;continue}}else{let O=T.children(this._source.maxzoom);if(f[O[0].key]&&f[O[1].key]&&f[O[2].key]&&f[O[3].key])continue}let R=A.wasRequested();for(let O=T.overscaledZ-1;O>=v;--O){let z=T.scaledTo(O);if(g[z.key])break;if(g[z.key]=!0,A=this.getTile(z),!A&&R&&(A=this._addTile(z)),A){let U=A.hasData();if((U||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||R)&&(f[z.key]=z),R=A.wasRequested(),U)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let o=[],h,f=this._tiles[e].tileID;for(;f.overscaledZ>0;){if(f.key in this._loadedParentTiles){h=this._loadedParentTiles[f.key];break}o.push(f.key);let g=f.scaledTo(f.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;f=g}for(let g of o)this._loadedParentTiles[g]=h}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(let e in this._tiles){let o=this._tiles[e].tileID,h=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=h}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));let h=o;return o||(o=new ss(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,h||this._source.fire(new s.k("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let h=o.getExpiryTimeout();h&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},h))}_removeTile(e){let o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){let o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,h){let f=[],g=this.transform;if(!g)return f;let v=h?g.getCameraQueryGeometry(e):e,w=e.map(U=>g.screenPointToMercatorCoordinate(U,this.terrain)),E=v.map(U=>g.screenPointToMercatorCoordinate(U,this.terrain)),T=this.getIds(),A=1/0,R=1/0,O=-1/0,z=-1/0;for(let U of E)A=Math.min(A,U.x),R=Math.min(R,U.y),O=Math.max(O,U.x),z=Math.max(z,U.y);for(let U=0;U<T.length;U++){let K=this._tiles[T[U]];if(K.holdingForFade())continue;let Y=K.tileID,Q=Math.pow(2,g.zoom-K.tileID.overscaledZ),ee=o*K.queryPadding*s.X/K.tileSize/Q,ie=[Y.getTilePoint(new s.Y(A,R)),Y.getTilePoint(new s.Y(O,z))];if(ie[0].x-ee<s.X&&ie[0].y-ee<s.X&&ie[1].x+ee>=0&&ie[1].y+ee>=0){let oe=w.map(ce=>Y.getTilePoint(ce)),se=E.map(ce=>Y.getTilePoint(ce));f.push({tile:K,tileID:Y,queryGeometry:oe,cameraQueryGeometry:se,scale:Q})}}return f}getVisibleCoordinates(e){let o=this.getRenderableIds(e).map(h=>this._tiles[h].tileID);return this.transform&&this.transform.populateCache(o),o}hasTransition(){if(this._source.hasTransition())return!0;if(G(this._source.type)){let e=W.now();for(let o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,h){this._state.updateState(e=e||"_geojsonTileLayer",o,h)}removeFeatureState(e,o,h){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,h)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,h){let f=this._tiles[e];f&&f.setDependencies(o,h)}reloadTilesForDependencies(e,o){for(let h in this._tiles)this._tiles[h].hasDependency(e,o)&&this._reloadTile(h,"reloading");this._cache.filter(h=>!h.hasDependency(e,o))}}function H(m,e){let o=Math.abs(2*m.wrap)-+(m.wrap<0),h=Math.abs(2*e.wrap)-+(e.wrap<0);return m.overscaledZ-e.overscaledZ||h-o||e.canonical.y-m.canonical.y||e.canonical.x-m.canonical.x}function G(m){return m==="raster"||m==="image"||m==="video"}V.maxOverzooming=10,V.maxUnderzooming=3;class te{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=s.ab(e,0,1);let o=1,h=this._distances[o],f=e*this.paddedLength+this.padding;for(;h<f&&o<this._distances.length;)h=this._distances[++o];let g=o-1,v=this._distances[g],w=h-v,E=w>0?(f-v)/w:0;return this.points[g].mult(1-E).add(this.points[o].mult(E))}}function ae(m,e){let o=!0;return m==="always"||m!=="never"&&e!=="never"||(o=!1),o}class pe{constructor(e,o,h){let f=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(e/h),this.yCellCount=Math.ceil(o/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)f.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,h,f,g){this._forEachCell(o,h,f,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(g)}insertCircle(e,o,h,f){this._forEachCell(o-f,h-f,o+f,h+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(h),this.circles.push(f)}_insertBoxCell(e,o,h,f,g,v){this.boxCells[g].push(v)}_insertCircleCell(e,o,h,f,g,v){this.circleCells[g].push(v)}_query(e,o,h,f,g,v,w){if(h<0||e>this.width||f<0||o>this.height)return[];let E=[];if(e<=0&&o<=0&&this.width<=h&&this.height<=f){if(g)return[{key:null,x1:e,y1:o,x2:h,y2:f}];for(let T=0;T<this.boxKeys.length;T++)E.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){let A=this.circles[3*T],R=this.circles[3*T+1],O=this.circles[3*T+2];E.push({key:this.circleKeys[T],x1:A-O,y1:R-O,x2:A+O,y2:R+O})}}else this._forEachCell(e,o,h,f,this._queryCell,E,{hitTest:g,overlapMode:v,seenUids:{box:{},circle:{}}},w);return E}query(e,o,h,f){return this._query(e,o,h,f,!1,null)}hitTest(e,o,h,f,g,v){return this._query(e,o,h,f,!0,g,v).length>0}hitTestCircle(e,o,h,f,g){let v=e-h,w=e+h,E=o-h,T=o+h;if(w<0||v>this.width||T<0||E>this.height)return!1;let A=[];return this._forEachCell(v,E,w,T,this._queryCellCircle,A,{hitTest:!0,overlapMode:f,circle:{x:e,y:o,radius:h},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(e,o,h,f,g,v,w,E){let{seenUids:T,hitTest:A,overlapMode:R}=w,O=this.boxCells[g];if(O!==null){let U=this.bboxes;for(let K of O)if(!T.box[K]){T.box[K]=!0;let Y=4*K,Q=this.boxKeys[K];if(e<=U[Y+2]&&o<=U[Y+3]&&h>=U[Y+0]&&f>=U[Y+1]&&(!E||E(Q))&&(!A||!ae(R,Q.overlapMode))&&(v.push({key:Q,x1:U[Y],y1:U[Y+1],x2:U[Y+2],y2:U[Y+3]}),A))return!0}}let z=this.circleCells[g];if(z!==null){let U=this.circles;for(let K of z)if(!T.circle[K]){T.circle[K]=!0;let Y=3*K,Q=this.circleKeys[K];if(this._circleAndRectCollide(U[Y],U[Y+1],U[Y+2],e,o,h,f)&&(!E||E(Q))&&(!A||!ae(R,Q.overlapMode))){let ee=U[Y],ie=U[Y+1],oe=U[Y+2];if(v.push({key:Q,x1:ee-oe,y1:ie-oe,x2:ee+oe,y2:ie+oe}),A)return!0}}}return!1}_queryCellCircle(e,o,h,f,g,v,w,E){let{circle:T,seenUids:A,overlapMode:R}=w,O=this.boxCells[g];if(O!==null){let U=this.bboxes;for(let K of O)if(!A.box[K]){A.box[K]=!0;let Y=4*K,Q=this.boxKeys[K];if(this._circleAndRectCollide(T.x,T.y,T.radius,U[Y+0],U[Y+1],U[Y+2],U[Y+3])&&(!E||E(Q))&&!ae(R,Q.overlapMode))return v.push(!0),!0}}let z=this.circleCells[g];if(z!==null){let U=this.circles;for(let K of z)if(!A.circle[K]){A.circle[K]=!0;let Y=3*K,Q=this.circleKeys[K];if(this._circlesCollide(U[Y],U[Y+1],U[Y+2],T.x,T.y,T.radius)&&(!E||E(Q))&&!ae(R,Q.overlapMode))return v.push(!0),!0}}}_forEachCell(e,o,h,f,g,v,w,E){let T=this._convertToXCellCoord(e),A=this._convertToYCellCoord(o),R=this._convertToXCellCoord(h),O=this._convertToYCellCoord(f);for(let z=T;z<=R;z++)for(let U=A;U<=O;U++)if(g.call(this,e,o,h,f,this.xCellCount*U+z,v,w,E))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,h,f,g,v){let w=f-e,E=g-o,T=h+v;return T*T>w*w+E*E}_circleAndRectCollide(e,o,h,f,g,v,w){let E=(v-f)/2,T=Math.abs(e-(f+E));if(T>E+h)return!1;let A=(w-g)/2,R=Math.abs(o-(g+A));if(R>A+h)return!1;if(T<=E||R<=A)return!0;let O=T-E,z=R-A;return O*O+z*z<=h*h}}function be(m,e,o){let h=s.H();if(!m){let{vecSouth:R,vecEast:O}=Te(e),z=M();z[0]=O[0],z[1]=O[1],z[2]=R[0],z[3]=R[1],f=z,(A=(v=(g=z)[0])*(T=g[3])-(E=g[2])*(w=g[1]))&&(f[0]=T*(A=1/A),f[1]=-w*A,f[2]=-E*A,f[3]=v*A),h[0]=z[0],h[1]=z[1],h[4]=z[2],h[5]=z[3]}var f,g,v,w,E,T,A;return s.K(h,h,[1/o,1/o,1]),h}function fe(m,e,o,h){if(m){let f=s.H();if(!e){let{vecSouth:g,vecEast:v}=Te(o);f[0]=v[0],f[1]=v[1],f[4]=g[0],f[5]=g[1]}return s.K(f,f,[h,h,1]),f}return o.pixelsToClipSpaceMatrix}function Te(m){let e=Math.cos(m.rollInRadians),o=Math.sin(m.rollInRadians),h=Math.cos(m.pitchInRadians),f=Math.cos(m.bearingInRadians),g=Math.sin(m.bearingInRadians),v=s.ad();v[0]=-f*h*o-g*e,v[1]=-g*h*o+f*e;let w=s.ae(v);w<1e-9?s.af(v):s.ag(v,v,1/w);let E=s.ad();E[0]=f*h*e-g*o,E[1]=g*h*e+f*o;let T=s.ae(E);return T<1e-9?s.af(E):s.ag(E,E,1/T),{vecEast:E,vecSouth:v}}function Ce(m,e,o,h){let f;h?(f=[m,e,h(m,e),1],s.al(f,f,o)):(f=[m,e,0,1],On(f,f,o));let g=f[3];return{point:new s.P(f[0]/g,f[1]/g),signedDistanceFromCamera:g,isOccluded:!1}}function me(m,e){return .5+m/e*.5}function de(m,e){return m.x>=-e[0]&&m.x<=e[0]&&m.y>=-e[1]&&m.y<=e[1]}function $e(m,e,o,h,f,g,v,w,E,T,A,R,O){let z=o?m.textSizeData:m.iconSizeData,U=s.ah(z,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],Y=o?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;Y.clear();let Q=m.lineVertexArray,ee=o?m.text.placedSymbolArray:m.icon.placedSymbolArray,ie=e.transform.width/e.transform.height,oe=!1;for(let se=0;se<ee.length;se++){let ce=ee.get(se);if(ce.hidden||ce.writingMode===s.ai.vertical&&!oe){Vn(ce.numGlyphs,Y);continue}oe=!1;let le=new s.P(ce.anchorX,ce.anchorY),ye={getElevation:O,pitchedLabelPlaneMatrix:h,lineVertexArray:Q,pitchWithMap:g,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:le,unwrappedTileID:E,width:T,height:A,translation:R},ve=Ft(ce.anchorX,ce.anchorY,ye);if(!de(ve.point,K)){Vn(ce.numGlyphs,Y);continue}let Se=me(e.transform.cameraToCenterDistance,ve.signedDistanceFromCamera),Re=s.aj(z,U,ce),Ee=g?Re*e.transform.getPitchedTextCorrection(ce.anchorX,ce.anchorY,E)/Se:Re*Se,Ue=pt({projectionContext:ye,pitchedLabelPlaneMatrixInverse:f,symbol:ce,fontSize:Ee,flip:!1,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:ie,rotateToLine:w});oe=Ue.useVertical,(Ue.notEnoughRoom||oe||Ue.needsFlipping&&pt({projectionContext:ye,pitchedLabelPlaneMatrixInverse:f,symbol:ce,fontSize:Ee,flip:!0,keepUpright:v,glyphOffsetArray:m.glyphOffsetArray,dynamicLayoutVertexArray:Y,aspectRatio:ie,rotateToLine:w}).notEnoughRoom)&&Vn(ce.numGlyphs,Y)}o?m.text.dynamicLayoutVertexBuffer.updateData(Y):m.icon.dynamicLayoutVertexBuffer.updateData(Y)}function Ve(m,e,o,h,f,g,v,w){let E=g.glyphStartIndex+g.numGlyphs,T=g.lineStartIndex,A=g.lineStartIndex+g.lineLength,R=e.getoffsetX(g.glyphStartIndex),O=e.getoffsetX(E-1),z=Cn(m*R,o,h,f,g.segment,T,A,w,v);if(!z)return null;let U=Cn(m*O,o,h,f,g.segment,T,A,w,v);return U?w.projectionCache.anyProjectionOccluded?null:{first:z,last:U}:null}function at(m,e,o,h){return m===s.ai.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*h?{useVertical:!0}:(m===s.ai.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function pt(m){let{projectionContext:e,pitchedLabelPlaneMatrixInverse:o,symbol:h,fontSize:f,flip:g,keepUpright:v,glyphOffsetArray:w,dynamicLayoutVertexArray:E,aspectRatio:T,rotateToLine:A}=m,R=f/24,O=h.lineOffsetX*R,z=h.lineOffsetY*R,U;if(h.numGlyphs>1){let K=h.glyphStartIndex+h.numGlyphs,Y=h.lineStartIndex,Q=h.lineStartIndex+h.lineLength,ee=Ve(R,w,O,z,g,h,A,e);if(!ee)return{notEnoughRoom:!0};let ie=Et(ee.first.point.x,ee.first.point.y,e,o),oe=Et(ee.last.point.x,ee.last.point.y,e,o);if(v&&!g){let se=at(h.writingMode,ie,oe,T);if(se)return se}U=[ee.first];for(let se=h.glyphStartIndex+1;se<K-1;se++)U.push(Cn(R*w.getoffsetX(se),O,z,g,h.segment,Y,Q,e,A));U.push(ee.last)}else{if(v&&!g){let Y=Qe(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Q=h.lineStartIndex+h.segment+1,ee=new s.P(e.lineVertexArray.getx(Q),e.lineVertexArray.gety(Q)),ie=Qe(ee.x,ee.y,e),oe=ie.signedDistanceFromCamera>0?ie.point:Ae(e.tileAnchorPoint,ee,Y,1,e),se=Et(Y.x,Y.y,e,o),ce=Et(oe.x,oe.y,e,o),le=at(h.writingMode,se,ce,T);if(le)return le}let K=Cn(R*w.getoffsetX(h.glyphStartIndex),O,z,g,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,e,A);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[K]}for(let K of U)s.ak(E,K.point,K.angle);return{}}function Ae(m,e,o,h,f){let g=m.add(m.sub(e)._unit()),v=Qe(g.x,g.y,f).point,w=o.sub(v);return o.add(w._mult(h/w.mag()))}function He(m,e,o){let h=e.projectionCache;if(h.projections[m])return h.projections[m];let f=new s.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),g=Qe(f.x,f.y,e);if(g.signedDistanceFromCamera>0)return h.projections[m]=g.point,h.anyProjectionOccluded=h.anyProjectionOccluded||g.isOccluded,g.point;let v=m-o.direction;return Ae(o.distanceFromAnchor===0?e.tileAnchorPoint:new s.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),f,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function Qe(m,e,o){let h=m+o.translation[0],f=e+o.translation[1],g;return o.pitchWithMap?(g=Ce(h,f,o.pitchedLabelPlaneMatrix,o.getElevation),g.isOccluded=!1):(g=o.transform.projectTileCoordinates(h,f,o.unwrappedTileID,o.getElevation),g.point.x=(.5*g.point.x+.5)*o.width,g.point.y=(.5*-g.point.y+.5)*o.height),g}function Et(m,e,o,h){if(o.pitchWithMap){let f=[m,e,0,1];return s.al(f,f,h),o.transform.projectTileCoordinates(f[0]/f[3],f[1]/f[3],o.unwrappedTileID,o.getElevation).point}return{x:m/o.width*2-1,y:e/o.height*2-1}}function Ft(m,e,o){return o.transform.projectTileCoordinates(m,e,o.unwrappedTileID,o.getElevation)}function ut(m,e,o){return m._unit()._perp()._mult(e*o)}function Xe(m,e,o,h,f,g,v,w,E){if(w.projectionCache.offsets[m])return w.projectionCache.offsets[m];let T=o.add(e);if(m+E.direction<h||m+E.direction>=f)return w.projectionCache.offsets[m]=T,T;let A=He(m+E.direction,w,E),R=ut(A.sub(o),v,E.direction),O=o.add(R),z=A.add(R);return w.projectionCache.offsets[m]=s.am(g,T,O,z)||T,w.projectionCache.offsets[m]}function Cn(m,e,o,h,f,g,v,w,E){let T=h?m-e:m+e,A=T>0?1:-1,R=0;h&&(A*=-1,R=Math.PI),A<0&&(R+=Math.PI);let O,z=A>0?g+f:g+f+1;w.projectionCache.cachedAnchorPoint?O=w.projectionCache.cachedAnchorPoint:(O=Qe(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=O);let U,K,Y=O,Q=O,ee=0,ie=0,oe=Math.abs(T),se=[],ce;for(;ee+ie<=oe;){if(z+=A,z<g||z>=v)return null;ee+=ie,Q=Y,K=U;let ve={absOffsetX:oe,direction:A,distanceFromAnchor:ee,previousVertex:Q};if(Y=He(z,w,ve),o===0)se.push(Q),ce=Y.sub(Q);else{let Se,Re=Y.sub(Q);Se=Re.mag()===0?ut(He(z+A,w,ve).sub(Y),o,A):ut(Re,o,A),K||(K=Q.add(Se)),U=Xe(z,Se,Y,g,v,K,o,w,ve),se.push(K),ce=U.sub(K)}ie=ce.mag()}let le=ce._mult((oe-ee)/ie)._add(K||Q),ye=R+Math.atan2(Y.y-Q.y,Y.x-Q.x);return se.push(le),{point:le,angle:E?ye:0,path:se}}let Mo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Vn(m,e){for(let o=0;o<m;o++){let h=e.length;e.resize(h+4),e.float32.set(Mo,3*h)}}function On(m,e,o){let h=e[0],f=e[1];return m[0]=o[0]*h+o[4]*f+o[12],m[1]=o[1]*h+o[5]*f+o[13],m[3]=o[3]*h+o[7]*f+o[15],m}let dn=100;class Nr{constructor(e,o=new pe(e.width+200,e.height+200,25),h=new pe(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=h,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+dn,this.screenBottomBoundary=e.height+dn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,h,f,g,v,w,E,T,A,R,O){let z=this.projectAndGetPerspectiveRatio(e.anchorPointX+E[0],e.anchorPointY+E[1],g,A,O),U=h*z.perspectiveRatio,K;if(v||w)K=this._projectCollisionBox(e,U,f,g,v,w,E,z,A,R,O);else{let ce=z.x+(R?R.x*U:0),le=z.y+(R?R.y*U:0);K={allPointsOccluded:!1,box:[ce+e.x1*U,le+e.y1*U,ce+e.x2*U,le+e.y2*U]}}let[Y,Q,ee,ie]=K.box,oe=v?K.allPointsOccluded:z.isOccluded,se=oe;return se||(se=z.perspectiveRatio<this.perspectiveRatioCutoff),se||(se=!this.isInsideGrid(Y,Q,ee,ie)),se||o!=="always"&&this.grid.hitTest(Y,Q,ee,ie,o,T)?{box:[Y,Q,ee,ie],placeable:!1,offscreen:!1,occluded:oe}:{box:[Y,Q,ee,ie],placeable:!0,offscreen:this.isOffscreen(Y,Q,ee,ie),occluded:oe}}placeCollisionCircles(e,o,h,f,g,v,w,E,T,A,R,O,z,U){let K=[],Y=new s.P(o.anchorX,o.anchorY),Q=this.getPerspectiveRatio(Y.x,Y.y,v,U),ee=(T?g*this.transform.getPitchedTextCorrection(o.anchorX,o.anchorY,v)/Q:g*Q)/s.as,ie={getElevation:U,pitchedLabelPlaneMatrix:w,lineVertexArray:h,pitchWithMap:T,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Y,unwrappedTileID:v,width:this.transform.width,height:this.transform.height,translation:z},oe=Ve(ee,f,o.lineOffsetX*ee,o.lineOffsetY*ee,!1,o,!1,ie),se=!1,ce=!1,le=!0;if(oe){let ye=.5*R*Q+O,ve=new s.P(-100,-100),Se=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new te,Ee=oe.first,Ue=oe.last,je=[];for(let bt=Ee.path.length-1;bt>=1;bt--)je.push(Ee.path[bt]);for(let bt=1;bt<Ue.path.length;bt++)je.push(Ue.path[bt]);let Oe=2.5*ye;if(T){let bt=this.projectPathToScreenSpace(je,ie);je=bt.some(Bt=>Bt.signedDistanceFromCamera<=0)?[]:bt.map(Bt=>Bt.point)}let Ge=[];if(je.length>0){let bt=je[0].clone(),Bt=je[0].clone();for(let mn=1;mn<je.length;mn++)bt.x=Math.min(bt.x,je[mn].x),bt.y=Math.min(bt.y,je[mn].y),Bt.x=Math.max(Bt.x,je[mn].x),Bt.y=Math.max(Bt.y,je[mn].y);Ge=bt.x>=ve.x&&Bt.x<=Se.x&&bt.y>=ve.y&&Bt.y<=Se.y?[je]:Bt.x<ve.x||bt.x>Se.x||Bt.y<ve.y||bt.y>Se.y?[]:s.ao([je],ve.x,ve.y,Se.x,Se.y)}for(let bt of Ge){Re.reset(bt,.25*ye);let Bt=0;Bt=Re.length<=.5*ye?1:Math.ceil(Re.paddedLength/Oe)+1;for(let mn=0;mn<Bt;mn++){let Kt=mn/Math.max(Bt-1,1),gn=Re.lerp(Kt),Qt=gn.x+dn,Wt=gn.y+dn;K.push(Qt,Wt,ye,0);let Jt=Qt-ye,rr=Wt-ye,Nn=Qt+ye,Ln=Wt+ye;if(le=le&&this.isOffscreen(Jt,rr,Nn,Ln),ce=ce||this.isInsideGrid(Jt,rr,Nn,Ln),e!=="always"&&this.grid.hitTestCircle(Qt,Wt,ye,e,A)&&(se=!0,!E))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!E&&se||!ce||Q<this.perspectiveRatioCutoff?[]:K,offscreen:le,collisionDetected:se}}projectPathToScreenSpace(e,o){let h=function(f,g){let v=s.H();return s.an(v,g.pitchedLabelPlaneMatrix),f.map(w=>{let E=Ce(w.x,w.y,v,g.getElevation),T=g.transform.projectTileCoordinates(E.point.x,E.point.y,g.unwrappedTileID,g.getElevation);return T.point.x=(.5*T.point.x+.5)*g.width,T.point.y=(.5*-T.point.y+.5)*g.height,T})}(e,o);return function(f){let g=0,v=0,w=0,E=0;for(let T=0;T<f.length;T++)f[T].isOccluded?(w=T+1,E=0):(E++,E>v&&(v=E,g=w));return f.slice(g,g+v)}(h)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let o=[],h=1/0,f=1/0,g=-1/0,v=-1/0;for(let A of e){let R=new s.P(A.x+dn,A.y+dn);h=Math.min(h,R.x),f=Math.min(f,R.y),g=Math.max(g,R.x),v=Math.max(v,R.y),o.push(R)}let w=this.grid.query(h,f,g,v).concat(this.ignoredGrid.query(h,f,g,v)),E={},T={};for(let A of w){let R=A.key;if(E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]={}),E[R.bucketInstanceId][R.featureIndex])continue;let O=[new s.P(A.x1,A.y1),new s.P(A.x2,A.y1),new s.P(A.x2,A.y2),new s.P(A.x1,A.y2)];s.ap(o,O)&&(E[R.bucketInstanceId][R.featureIndex]=!0,T[R.bucketInstanceId]===void 0&&(T[R.bucketInstanceId]=[]),T[R.bucketInstanceId].push(R.featureIndex))}return T}insertCollisionBox(e,o,h,f,g,v){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,h,f,g,v){let w=h?this.ignoredGrid:this.grid,E={bucketInstanceId:f,featureIndex:g,collisionGroupID:v,overlapMode:o};for(let T=0;T<e.length;T+=4)w.insertCircle(E,e[T],e[T+1],e[T+2])}projectAndGetPerspectiveRatio(e,o,h,f,g){if(g){let v;f?(v=[e,o,f(e,o),1],s.al(v,v,g)):(v=[e,o,0,1],On(v,v,g));let w=v[3];return{x:(v[0]/w+1)/2*this.transform.width+dn,y:(-v[1]/w+1)/2*this.transform.height+dn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}{let v=this.transform.projectTileCoordinates(e,o,h,f);return{x:(v.point.x+1)/2*this.transform.width+dn,y:(1-v.point.y)/2*this.transform.height+dn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5,isOccluded:v.isOccluded,signedDistanceFromCamera:v.signedDistanceFromCamera}}}getPerspectiveRatio(e,o,h,f){let g=this.transform.projectTileCoordinates(e,o,h,f);return .5+this.transform.cameraToCenterDistance/g.signedDistanceFromCamera*.5}isOffscreen(e,o,h,f){return h<dn||e>=this.screenRightBoundary||f<dn||o>this.screenBottomBoundary}isInsideGrid(e,o,h,f){return h>=0&&e<this.gridRightBoundary&&f>=0&&o<this.gridBottomBoundary}getViewportMatrix(){let e=s.aq([]);return s.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,h,f,g,v,w,E,T,A,R){let O=1,z=0,U=0,K=1,Y=e.anchorPointX+w[0],Q=e.anchorPointY+w[1];if(v&&!g){let je=this.projectAndGetPerspectiveRatio(Y+1,Q,f,T,R),Oe=je.x-E.x,Ge=Math.atan((je.y-E.y)/Oe)+(Oe<0?Math.PI:0),bt=Math.sin(Ge),Bt=Math.cos(Ge);O=Bt,z=bt,U=-bt,K=Bt}else if(!v&&g){let je=Te(this.transform);O=je.vecEast[0],z=je.vecEast[1],U=je.vecSouth[0],K=je.vecSouth[1]}let ee=E.x,ie=E.y,oe=o;g&&(ee=Y,ie=Q,oe=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),oe*=this.transform.getPitchedTextCorrection(Y,Q,f),A||(oe*=s.ab(.5+E.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),A&&(ee+=O*A.x*oe+U*A.y*oe,ie+=z*A.x*oe+K*A.y*oe);let se=e.x1*oe,ce=e.x2*oe,le=(se+ce)/2,ye=e.y1*oe,ve=e.y2*oe,Se=(ye+ve)/2,Re=[{offsetX:se,offsetY:ye},{offsetX:le,offsetY:ye},{offsetX:ce,offsetY:ye},{offsetX:ce,offsetY:Se},{offsetX:ce,offsetY:ve},{offsetX:le,offsetY:ve},{offsetX:se,offsetY:ve},{offsetX:se,offsetY:Se}],Ee=[];for(let{offsetX:je,offsetY:Oe}of Re)Ee.push(new s.P(ee+O*je+U*Oe,ie+z*je+K*Oe));let Ue=!1;if(g){let je=Ee.map(Oe=>this.projectAndGetPerspectiveRatio(Oe.x,Oe.y,f,T,R));Ue=je.some(Oe=>!Oe.isOccluded),Ee=je.map(Oe=>new s.P(Oe.x,Oe.y))}else Ue=!0;return{box:s.ar(Ee),allPointsOccluded:!Ue}}}class hn{constructor(e,o,h,f){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):f&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Xa{constructor(e,o,h,f,g){this.text=new hn(e?e.text:null,o,h,g),this.icon=new hn(e?e.icon:null,o,f,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ws{constructor(e,o,h){this.text=e,this.icon=o,this.skipFade=h}}class ld{constructor(e,o,h,f,g){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=h,this.bucketIndex=f,this.tileID=g}}class as{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:h=>h.collisionGroupID===o}}return this.collisionGroups[e]}}function ls(m,e,o,h,f){let{horizontalAlign:g,verticalAlign:v}=s.ay(m);return new s.P(-(g-.5)*e+h[0]*f,-(v-.5)*o+h[1]*f)}class Ff{constructor(e,o,h,f,g){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new Nr(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new as(f),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){let o=this.terrain;return o?(h,f)=>o.getElevation(e,h,f):null}getBucketParts(e,o,h,f){let g=h.getBucket(o),v=h.latestFeatureIndex;if(!g||!v||o.id!==g.layerIds[0])return;let w=h.collisionBoxArray,E=g.layers[0].layout,T=g.layers[0].paint,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),R=h.tileSize/s.X,O=h.tileID.toUnwrapped(),z=E.get("text-rotation-alignment")==="map",U=s.at(h,1,this.transform.zoom),K=s.au(this.collisionIndex.transform,h,T.get("text-translate"),T.get("text-translate-anchor")),Y=s.au(this.collisionIndex.transform,h,T.get("icon-translate"),T.get("icon-translate-anchor")),Q=be(z,this.transform,U);this.retainedQueryData[g.bucketInstanceId]=new ld(g.bucketInstanceId,v,g.sourceLayerIndex,g.index,h.tileID);let ee={bucket:g,layout:E,translationText:K,translationIcon:Y,unwrappedTileID:O,pitchedLabelPlaneMatrix:Q,scale:A,textPixelRatio:R,holdingForFade:h.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:s.ah(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(f)for(let ie of g.sortKeyRanges){let{sortKey:oe,symbolInstanceStart:se,symbolInstanceEnd:ce}=ie;e.push({sortKey:oe,symbolInstanceStart:se,symbolInstanceEnd:ce,parameters:ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(e,o,h,f,g,v,w,E,T,A,R,O,z,U,K,Y,Q,ee,ie,oe){let se=s.av[e.textAnchor],ce=[e.textOffset0,e.textOffset1],le=ls(se,h,f,ce,g),ye=this.collisionIndex.placeCollisionBox(o,O,E,T,A,w,v,Y,R.predicate,ie,le,oe);if((!ee||this.collisionIndex.placeCollisionBox(ee,O,E,T,A,w,v,Q,R.predicate,ie,le,oe).placeable)&&ye.placeable){let ve;if(this.prevPlacement&&this.prevPlacement.variableOffsets[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID]&&this.prevPlacement.placements[z.crossTileID].text&&(ve=this.prevPlacement.variableOffsets[z.crossTileID].anchor),z.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[z.crossTileID]={textOffset:ce,width:h,height:f,anchor:se,textBoxScale:g,prevAnchor:ve},this.markUsedJustification(U,se,z,K),U.allowVerticalPlacement&&(this.markUsedOrientation(U,K,z),this.placedOrientations[z.crossTileID]=K),{shift:le,placedGlyphBoxes:ye}}}placeLayerBucketPart(e,o,h){let{bucket:f,layout:g,translationText:v,translationIcon:w,unwrappedTileID:E,pitchedLabelPlaneMatrix:T,textPixelRatio:A,holdingForFade:R,collisionBoxArray:O,partiallyEvaluatedTextSize:z,collisionGroup:U}=e.parameters,K=g.get("text-optional"),Y=g.get("icon-optional"),Q=s.aw(g,"text-overlap","text-allow-overlap"),ee=Q==="always",ie=s.aw(g,"icon-overlap","icon-allow-overlap"),oe=ie==="always",se=g.get("text-rotation-alignment")==="map",ce=g.get("text-pitch-alignment")==="map",le=g.get("icon-text-fit")!=="none",ye=g.get("symbol-z-order")==="viewport-y",ve=ee&&(oe||!f.hasIconData()||Y),Se=oe&&(ee||!f.hasTextData()||K);!f.collisionArrays&&O&&f.deserializeCollisionBoxes(O);let Re=this.retainedQueryData[f.bucketInstanceId].tileID,Ee=this._getTerrainElevationFunc(Re),Ue=this.transform.getFastPathSimpleProjectionMatrix(Re),je=(Oe,Ge,bt)=>{var Bt,mn;if(o[Oe.crossTileID])return;if(R)return void(this.placements[Oe.crossTileID]=new Ws(!1,!1,!1));let Kt=!1,gn=!1,Qt=!0,Wt=null,Jt={box:null,placeable:!1,offscreen:null,occluded:!1},rr={box:null,placeable:!1,offscreen:null},Nn=null,Ln=null,Er=null,io=0,ji=0,Fr=0;Ge.textFeatureIndex?io=Ge.textFeatureIndex:Oe.useRuntimeCollisionCircles&&(io=Oe.featureIndex),Ge.verticalTextFeatureIndex&&(ji=Ge.verticalTextFeatureIndex);let oo=Ge.textBox;if(oo){let Dr=en=>{let yn=s.ai.horizontal;if(f.allowVerticalPlacement&&!en&&this.prevPlacement){let Br=this.prevPlacement.placedOrientations[Oe.crossTileID];Br&&(this.placedOrientations[Oe.crossTileID]=Br,yn=Br,this.markUsedOrientation(f,yn,Oe))}return yn},Qr=(en,yn)=>{if(f.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&Ge.verticalTextBox){for(let Br of f.writingModes)if(Br===s.ai.vertical?(Jt=yn(),rr=Jt):Jt=en(),Jt&&Jt.placeable)break}else Jt=en()},Jr=Oe.textAnchorOffsetStartIndex,zr=Oe.textAnchorOffsetEndIndex;if(zr===Jr){let en=(yn,Br)=>{let bn=this.collisionIndex.placeCollisionBox(yn,Q,A,Re,E,ce,se,v,U.predicate,Ee,void 0,Ue);return bn&&bn.placeable&&(this.markUsedOrientation(f,Br,Oe),this.placedOrientations[Oe.crossTileID]=Br),bn};Qr(()=>en(oo,s.ai.horizontal),()=>{let yn=Ge.verticalTextBox;return f.allowVerticalPlacement&&Oe.numVerticalGlyphVertices>0&&yn?en(yn,s.ai.vertical):{box:null,offscreen:null}}),Dr(Jt&&Jt.placeable)}else{let en=s.av[(mn=(Bt=this.prevPlacement)===null||Bt===void 0?void 0:Bt.variableOffsets[Oe.crossTileID])===null||mn===void 0?void 0:mn.anchor],yn=(bn,a_,Np)=>{let sh=bn.x2-bn.x1,Lp=bn.y2-bn.y1,Es=Oe.textBoxScale,Is=le&&ie==="never"?a_:null,ko=null,Fp=Q==="never"?1:2,Gc="never";en&&Fp++;for(let ah=0;ah<Fp;ah++){for(let lh=Jr;lh<zr;lh++){let ch=f.textAnchorOffsets.get(lh);if(en&&ch.textAnchor!==en)continue;let uh=this.attemptAnchorPlacement(ch,bn,sh,Lp,Es,se,ce,A,Re,E,U,Gc,Oe,f,Np,v,w,Is,Ee);if(uh&&(ko=uh.placedGlyphBoxes,ko&&ko.placeable))return Kt=!0,Wt=uh.shift,ko}en?en=null:Gc=Q}return h&&!ko&&(ko={box:this.collisionIndex.placeCollisionBox(oo,"always",A,Re,E,ce,se,v,U.predicate,Ee,void 0,Ue).box,offscreen:!1,placeable:!1,occluded:!1}),ko};Qr(()=>yn(oo,Ge.iconBox,s.ai.horizontal),()=>{let bn=Ge.verticalTextBox;return f.allowVerticalPlacement&&(!Jt||!Jt.placeable)&&Oe.numVerticalGlyphVertices>0&&bn?yn(bn,Ge.verticalIconBox,s.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Jt&&(Kt=Jt.placeable,Qt=Jt.offscreen);let Br=Dr(Jt&&Jt.placeable);if(!Kt&&this.prevPlacement){let bn=this.prevPlacement.variableOffsets[Oe.crossTileID];bn&&(this.variableOffsets[Oe.crossTileID]=bn,this.markUsedJustification(f,bn.anchor,Oe,Br))}}}if(Nn=Jt,Kt=Nn&&Nn.placeable,Qt=Nn&&Nn.offscreen,Oe.useRuntimeCollisionCircles){let Dr=f.text.placedSymbolArray.get(Oe.centerJustifiedTextSymbolIndex),Qr=s.aj(f.textSizeData,z,Dr),Jr=g.get("text-padding");Ln=this.collisionIndex.placeCollisionCircles(Q,Dr,f.lineVertexArray,f.glyphOffsetArray,Qr,E,T,h,ce,U.predicate,Oe.collisionCircleDiameter,Jr,v,Ee),Ln.circles.length&&Ln.collisionDetected&&!h&&s.w("Collisions detected, but collision boxes are not shown"),Kt=ee||Ln.circles.length>0&&!Ln.collisionDetected,Qt=Qt&&Ln.offscreen}if(Ge.iconFeatureIndex&&(Fr=Ge.iconFeatureIndex),Ge.iconBox){let Dr=Qr=>this.collisionIndex.placeCollisionBox(Qr,ie,A,Re,E,ce,se,w,U.predicate,Ee,le&&Wt?Wt:void 0,Ue);rr&&rr.placeable&&Ge.verticalIconBox?(Er=Dr(Ge.verticalIconBox),gn=Er.placeable):(Er=Dr(Ge.iconBox),gn=Er.placeable),Qt=Qt&&Er.offscreen}let Cl=K||Oe.numHorizontalGlyphVertices===0&&Oe.numVerticalGlyphVertices===0,El=Y||Oe.numIconVertices===0;Cl||El?El?Cl||(gn=gn&&Kt):Kt=gn&&Kt:gn=Kt=gn&&Kt;let pa=gn&&Er.placeable;if(Kt&&Nn.placeable&&this.collisionIndex.insertCollisionBox(Nn.box,Q,g.get("text-ignore-placement"),f.bucketInstanceId,rr&&rr.placeable&&ji?ji:io,U.ID),pa&&this.collisionIndex.insertCollisionBox(Er.box,ie,g.get("icon-ignore-placement"),f.bucketInstanceId,Fr,U.ID),Ln&&Kt&&this.collisionIndex.insertCollisionCircles(Ln.circles,Q,g.get("text-ignore-placement"),f.bucketInstanceId,io,U.ID),h&&this.storeCollisionData(f.bucketInstanceId,bt,Ge,Nn,Er,Ln),Oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(f.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Oe.crossTileID]=new Ws((Kt||ve)&&!Nn?.occluded,(gn||Se)&&!Er?.occluded,Qt||f.justReloaded),o[Oe.crossTileID]=!0};if(ye){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");let Oe=f.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ge=Oe.length-1;Ge>=0;--Ge){let bt=Oe[Ge];je(f.symbolInstances.get(bt),f.collisionArrays[bt],bt)}}else for(let Oe=e.symbolInstanceStart;Oe<e.symbolInstanceEnd;Oe++)je(f.symbolInstances.get(Oe),f.collisionArrays[Oe],Oe);f.justReloaded=!1}storeCollisionData(e,o,h,f,g,v){if(h.textBox||h.iconBox){let w,E;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(o)?E=w.get(o):(E={text:null,icon:null},w.set(o,E)),h.textBox&&(E.text=f.box),h.iconBox&&(E.icon=g.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=[]);for(let E=0;E<v.circles.length;E+=4)w.push(v.circles[E+0]-dn),w.push(v.circles[E+1]-dn),w.push(v.circles[E+2]),w.push(v.collisionDetected?1:0)}}markUsedJustification(e,o,h,f){let g;g=f===s.ai.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[s.ax(o)];let v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(let w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=g>=0&&w!==g?0:h.crossTileID)}markUsedOrientation(e,o,h){let f=o===s.ai.horizontal||o===s.ai.horizontalOnly?o:0,g=o===s.ai.vertical?o:0,v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(let w of v)e.text.placedSymbolArray.get(w).placedOrientation=f;h.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let o=this.prevPlacement,h=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;let f=o?o.symbolFadeChange(e):1,g=o?o.opacities:{},v=o?o.variableOffsets:{},w=o?o.placedOrientations:{};for(let E in this.placements){let T=this.placements[E],A=g[E];A?(this.opacities[E]=new Xa(A,f,T.text,T.icon),h=h||T.text!==A.text.placed||T.icon!==A.icon.placed):(this.opacities[E]=new Xa(null,f,T.text,T.icon,T.skipFade),h=h||T.text||T.icon)}for(let E in g){let T=g[E];if(!this.opacities[E]){let A=new Xa(T,f,!1,!1);A.isHidden()||(this.opacities[E]=A,h=h||T.text.placed||T.icon.placed)}}for(let E in v)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=v[E]);for(let E in w)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=w[E]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){let h={};for(let f of o){let g=f.getBucket(e);g&&f.latestFeatureIndex&&e.id===g.layerIds[0]&&this.updateBucketOpacities(g,f.tileID,h,f.collisionBoxArray)}}updateBucketOpacities(e,o,h,f){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let g=e.layers[0],v=g.layout,w=new Xa(null,0,!1,!1,!0),E=v.get("text-allow-overlap"),T=v.get("icon-allow-overlap"),A=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),R=v.get("text-rotation-alignment")==="map",O=v.get("text-pitch-alignment")==="map",z=v.get("icon-text-fit")!=="none",U=new Xa(null,0,E&&(T||!e.hasIconData()||v.get("icon-optional")),T&&(E||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&f&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(f);let K=(Q,ee,ie)=>{for(let oe=0;oe<ee/4;oe++)Q.opacityVertexArray.emplaceBack(ie);Q.hasVisibleVertices=Q.hasVisibleVertices||ie!==cs},Y=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Q=0;Q<e.symbolInstances.length;Q++){let ee=e.symbolInstances.get(Q),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:oe,crossTileID:se}=ee,ce=this.opacities[se];h[se]?ce=w:ce||(ce=U,this.opacities[se]=ce),h[se]=!0;let le=ee.numIconVertices>0,ye=this.placedOrientations[ee.crossTileID],ve=ye===s.ai.vertical,Se=ye===s.ai.horizontal||ye===s.ai.horizontalOnly;if(ie>0||oe>0){let Ee=ud(ce.text);K(e.text,ie,ve?cs:Ee),K(e.text,oe,Se?cs:Ee);let Ue=ce.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(Ge=>{Ge>=0&&(e.text.placedSymbolArray.get(Ge).hidden=Ue||ve?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ue||Se?1:0);let je=this.variableOffsets[ee.crossTileID];je&&this.markUsedJustification(e,je.anchor,ee,ye);let Oe=this.placedOrientations[ee.crossTileID];Oe&&(this.markUsedJustification(e,"left",ee,Oe),this.markUsedOrientation(e,Oe,ee))}if(le){let Ee=ud(ce.icon),Ue=!(z&&ee.verticalPlacedIconSymbolIndex&&ve);ee.placedIconSymbolIndex>=0&&(K(e.icon,ee.numIconVertices,Ue?Ee:cs),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ce.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ee.numVerticalIconVertices,Ue?cs:Ee),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}let Re=Y&&Y.has(Q)?Y.get(Q):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let Ee=e.collisionArrays[Q];if(Ee){let Ue=new s.P(0,0);if(Ee.textBox||Ee.verticalTextBox){let je=!0;if(A){let Oe=this.variableOffsets[se];Oe?(Ue=ls(Oe.anchor,Oe.width,Oe.height,Oe.textOffset,Oe.textBoxScale),R&&Ue._rotate(O?-this.transform.bearingInRadians:this.transform.bearingInRadians)):je=!1}if(Ee.textBox||Ee.verticalTextBox){let Oe;Ee.textBox&&(Oe=ve),Ee.verticalTextBox&&(Oe=Se),cd(e.textCollisionBox.collisionVertexArray,ce.text.placed,!je||Oe,Re.text,Ue.x,Ue.y)}}if(Ee.iconBox||Ee.verticalIconBox){let je=!!(!Se&&Ee.verticalIconBox),Oe;Ee.iconBox&&(Oe=je),Ee.verticalIconBox&&(Oe=!je),cd(e.iconCollisionBox.collisionVertexArray,ce.icon.placed,Oe,Re.icon,z?Ue.x:0,z?Ue.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){let h=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*h>e}setStale(){this.stale=!0}}function cd(m,e,o,h,f,g){h&&h.length!==0||(h=[0,0,0,0]);let v=h[0]-dn,w=h[1]-dn,E=h[2]-dn,T=h[3]-dn;m.emplaceBack(e?1:0,o?1:0,f||0,g||0,v,w),m.emplaceBack(e?1:0,o?1:0,f||0,g||0,E,w),m.emplaceBack(e?1:0,o?1:0,f||0,g||0,E,T),m.emplaceBack(e?1:0,o?1:0,f||0,g||0,v,T)}let zf=Math.pow(2,25),Xs=Math.pow(2,24),Bf=Math.pow(2,17),Vy=Math.pow(2,16),Uy=Math.pow(2,9),$y=Math.pow(2,8),jf=Math.pow(2,1);function ud(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;let e=m.placed?1:0,o=Math.floor(127*m.opacity);return o*zf+e*Xs+o*Bf+e*Vy+o*Uy+e*$y+o*jf+e}let cs=0;class dd{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,h,f,g){let v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(v,f,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<v.length;)if(o.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,g())return!0;return!1}}class Vf{constructor(e,o,h,f,g,v,w,E){this.placement=new Ff(e,o,v,w,E),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(e,o,h){let f=W.now(),g=()=>!this._forceFullPlacement&&W.now()-f>2;for(;this._currentPlacementIndex>=0;){let v=o[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new dd(v)),this._inProgressLayer.continuePlacement(h[v.source],this.placement,this._showCollisionBoxes,v,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let us=512/s.X/2;class hd{constructor(e,o,h){this.tileID=e,this.bucketInstanceId=h,this._symbolsByKey={};let f=new Map;for(let g=0;g<o.length;g++){let v=o.get(g),w=v.key,E=f.get(w);E?E.push(v):f.set(w,[v])}for(let[g,v]of f){let w={positions:v.map(E=>({x:Math.floor(E.anchorX*us),y:Math.floor(E.anchorY*us)})),crossTileIDs:v.map(E=>E.crossTileID)};if(w.positions.length>128){let E=new s.az(w.positions.length,16,Uint16Array);for(let{x:T,y:A}of w.positions)E.add(T,A);E.finish(),delete w.positions,w.index=E}this._symbolsByKey[g]=w}}getScaledCoordinates(e,o){let{x:h,y:f,z:g}=this.tileID.canonical,{x:v,y:w,z:E}=o.canonical,T=us/Math.pow(2,E-g),A=(w*s.X+e.anchorY)*T,R=f*s.X*us;return{x:Math.floor((v*s.X+e.anchorX)*T-h*s.X*us),y:Math.floor(A-R)}}findMatches(e,o,h){let f=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let g=0;g<e.length;g++){let v=e.get(g);if(v.crossTileID)continue;let w=this._symbolsByKey[v.key];if(!w)continue;let E=this.getScaledCoordinates(v,o);if(w.index){let T=w.index.range(E.x-f,E.y-f,E.x+f,E.y+f).sort();for(let A of T){let R=w.crossTileIDs[A];if(!h[R]){h[R]=!0,v.crossTileID=R;break}}}else if(w.positions)for(let T=0;T<w.positions.length;T++){let A=w.positions[T],R=w.crossTileIDs[T];if(Math.abs(A.x-E.x)<=f&&Math.abs(A.y-E.y)<=f&&!h[R]){h[R]=!0,v.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class lc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Uf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let o=Math.round((e-this.lng)/360);if(o!==0)for(let h in this.indexes){let f=this.indexes[h],g={};for(let v in f){let w=f[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+o),g[w.tileID.key]=w}this.indexes[h]=g}this.lng=e}addBucket(e,o,h){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let g=0;g<o.symbolInstances.length;g++)o.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});let f=this.usedCrossTileIDs[e.overscaledZ];for(let g in this.indexes){let v=this.indexes[g];if(Number(g)>e.overscaledZ)for(let w in v){let E=v[w];E.tileID.isChildOf(e)&&E.findMatches(o.symbolInstances,e,f)}else{let w=v[e.scaledTo(Number(g)).key];w&&w.findMatches(o.symbolInstances,e,f)}}for(let g=0;g<o.symbolInstances.length;g++){let v=o.symbolInstances.get(g);v.crossTileID||(v.crossTileID=h.generate(),f[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new hd(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(let h of o.getCrossTileIDsLists())for(let f of h)delete this.usedCrossTileIDs[e][f]}removeStaleBuckets(e){let o=!1;for(let h in this.indexes){let f=this.indexes[h];for(let g in f)e[f[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,f[g]),delete f[g],o=!0)}return o}}class ds{constructor(){this.layerIndexes={},this.crossTileIDs=new lc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,h){let f=this.layerIndexes[e.id];f===void 0&&(f=this.layerIndexes[e.id]=new Uf);let g=!1,v={};f.handleWrapJump(h);for(let w of o){let E=w.getBucket(e);E&&e.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),f.addBucket(w.tileID,E,this.crossTileIDs)&&(g=!0),v[E.bucketInstanceId]=!0)}return f.removeStaleBuckets(v)&&(g=!0),g}pruneUnusedLayers(e){let o={};e.forEach(h=>{o[h]=!0});for(let h in this.layerIndexes)o[h]||delete this.layerIndexes[h]}}var fd="void main() {fragColor=vec4(1.0);}";let Ni={prelude:It(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:It("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:It("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:It(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:It(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:It(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:It(fd,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:It(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:It(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:It("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:It("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:It("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:It(fd,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:It(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:It(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:It(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:It(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:It(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:It(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:It(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:It(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:It(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:It(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:It(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:It("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:It("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:It("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:It("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:It(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:It("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function It(m,e){let o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=e.match(/in ([\w]+) ([\w]+)/g),f=m.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=g?g.concat(f):f,w={};return{fragmentSource:m=m.replace(o,(E,T,A,R,O)=>(w[O]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${O}
in ${A} ${R} ${O};
#else
uniform ${A} ${R} u_${O};
#endif
`:`
#ifdef HAS_UNIFORM_u_${O}
    ${A} ${R} ${O} = u_${O};
#endif
`)),vertexSource:e=e.replace(o,(E,T,A,R,O)=>{let z=R==="float"?"vec2":"vec4",U=O.match(/color/)?"color":z;return w[O]?T==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${A} ${z} a_${O};
out ${A} ${R} ${O};
#else
uniform ${A} ${R} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = a_${O};
#else
    ${A} ${R} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${A} ${R} ${O} = u_${O};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${O}
uniform lowp float u_${O}_t;
in ${A} ${z} a_${O};
#else
uniform ${A} ${R} u_${O};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${O}
    ${A} ${R} ${O} = a_${O};
#else
    ${A} ${R} ${O} = u_${O};
#endif
`:`
#ifndef HAS_UNIFORM_u_${O}
    ${A} ${R} ${O} = unpack_mix_${U}(a_${O}, u_${O}_t);
#else
    ${A} ${R} ${O} = u_${O};
#endif
`}),staticAttributes:h,staticUniforms:v}}class Li{constructor(e,o,h){this.vertexBuffer=e,this.indexBuffer=o,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Dt=s.aA([{name:"a_pos",type:"Int16",components:2}]);let cc="#define PROJECTION_MERCATOR",$f="mercator";class Ya{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return $f}get shaderDefine(){return cc}get shaderPreludeCode(){return Ni.projectionMercator}get vertexShaderPreludeCode(){return Ni.projectionMercator.vertexSource}get subdivisionGranularity(){return s.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,o,h,f,g){if(this._cachedMesh)return this._cachedMesh;let v=new s.aC;v.emplaceBack(0,0),v.emplaceBack(s.X,0),v.emplaceBack(0,s.X),v.emplaceBack(s.X,s.X);let w=e.createVertexBuffer(v,Dt.members),E=s.aD.simpleSegment(0,0,4,2),T=new s.aE;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3);let A=e.createIndexBuffer(T);return this._cachedMesh=new Li(w,A,E),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}function In(m,e){let o=s.ab(e.lat,-85.051129,s.aF);return new s.P(s.O(e.lng)*m,s.Q(o)*m)}function Un(m,e){return new s.Y(e.x/m,e.y/m).toLngLat()}function vn(m){return m.cameraToCenterDistance*Math.min(.85*Math.tan(s.aa(90-m.pitch)),Math.tan(s.aa(89.25-m.pitch)))}function pd(m,e){let o=m.canonical,h=e/s.aG(o.z),f=o.x+Math.pow(2,o.z)*m.wrap,g=s.aq(new Float64Array(16));return s.J(g,g,[f*h,o.y*h,0]),s.K(g,g,[h/s.X,h/s.X,1]),g}function fr(m,e,o,h,f){let g=s.Y.fromLngLat(m,e),v=f*s.aH(1,m.lat),w=v*Math.cos(s.aa(o)),E=Math.sqrt(v*v-w*w),T=E*Math.sin(s.aa(-h)),A=E*Math.cos(s.aa(-h));return new s.Y(g.x+T,g.y+A,g.z+w)}class pr{constructor(e=0,o=0,h=0,f=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(h)||h<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=h,this.right=f}interpolate(e,o,h){return o.top!=null&&e.top!=null&&(this.top=s.y.number(e.top,o.top,h)),o.bottom!=null&&e.bottom!=null&&(this.bottom=s.y.number(e.bottom,o.bottom,h)),o.left!=null&&e.left!=null&&(this.left=s.y.number(e.left,o.left,h)),o.right!=null&&e.right!=null&&(this.right=s.y.number(e.right,o.right,h)),this}getCenter(e,o){let h=s.ab((this.left+e-this.right)/2,0,e),f=s.ab((this.top+o-this.bottom)/2,0,o);return new s.P(h,f)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new pr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mr(m,e){if(!m.renderWorldCopies||m.lngRange)return;let o=e.lng-m.center.lng;e.lng+=o>180?-360:o<-180?360:0}function md(m){return Math.max(0,Math.floor(m))}class hs{constructor(e,o,h,f,g,v){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=f??0,this._maxPitch=g??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new s.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=md(this._zoom),this._scale=s.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new pr,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,o,h){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=md(this._zoom),this._scale=s.aG(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new pr(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!h&&e.autoCalculateNearFarZ,o&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){let o=s.aI(e,-180,180)*Math.PI/180;var h,f,g,v,w,E,T,A,R;this._bearingInRadians!==o&&(this._unmodified=!1,this._bearingInRadians=o,this._calcMatrices(),this._rotationMatrix=M(),h=this._rotationMatrix,g=-this._bearingInRadians,v=(f=this._rotationMatrix)[0],w=f[1],E=f[2],T=f[3],A=Math.sin(g),R=Math.cos(g),h[0]=v*R+E*A,h[1]=w*R+T*A,h[2]=v*-A+E*R,h[3]=w*-A+T*R)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){let o=s.ab(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==o&&(this._unmodified=!1,this._pitchInRadians=o,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){let o=e/180*Math.PI;this._rollInRadians!==o&&(this._unmodified=!1,this._rollInRadians=o,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return s.aJ(this._fovInRadians)}setFov(e){e=s.ab(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=s.aa(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){let o=this.getConstrained(this._center,e).zoom;this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this._tileZoom=Math.max(0,Math.floor(o)),this._scale=s.aG(o),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,o){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=o,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,h){this._unmodified=!1,this._edgeInsets.interpolate(e,o,h),this._constrain(),this._calcMatrices()}resize(e,o,h=!0){this._width=e,this._height=o,h&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Dn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,s.aF])}getConstrained(e,o){return this._callbacks.getConstrained(e,o)}getCameraQueryGeometry(e,o){if(o.length===1)return[o[0],e];{let h=e.x,f=e.y,g=e.x,v=e.y;for(let w of o)h=Math.min(h,w.x),f=Math.min(f,w.y),g=Math.max(g,w.x),v=Math.max(v,w.y);return[new s.P(h,f),new s.P(g,f),new s.P(g,v),new s.P(h,v),new s.P(h,f)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;let e=this._unmodified,{center:o,zoom:h}=this.getConstrained(this.center,this.zoom);this.setCenter(o),this.setZoom(h),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=s.aq(new Float64Array(16));s.K(e,e,[this._width/2,-this._height/2,1]),s.J(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=s.aq(new Float64Array(16)),s.K(e,e,[1,-1,1]),s.J(e,e,[-1,-1,0]),s.K(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,o,h,f){let g=h!==void 0?h:this.bearing,v=f=f!==void 0?f:this.pitch,w=s.Y.fromLngLat(e,o),E=-Math.cos(s.aa(v)),T=Math.sin(s.aa(v)),A=T*Math.sin(s.aa(g)),R=-T*Math.cos(s.aa(g)),O=this.elevation,z=o-O,U;E*z>=0||Math.abs(E)<.1?(U=1e4,O=o+U*E):U=-z/E;let K,Y,Q=s.aK(1,w.y),ee=0;do{if(ee+=1,ee>10)break;Y=U/Q,K=new s.Y(w.x+A*Y,w.y+R*Y),Q=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(U-Y*Q)>1e-12);return{center:K.toLngLat(),elevation:O,zoom:s.a8(this.height/2/Math.tan(this.fovInRadians/2)/Y/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;let o=s.aH(1,this.center.lat)*this.worldSize,h=this.cameraToCenterDistance/o,f=s.Y.fromLngLat(this.center,this.elevation),g=fr(this.center,this.elevation,this.pitch,this.bearing,h);this._elevation=e;let v=this.calculateCenterFromCameraLngLatAlt(g.toLngLat(),s.aK(g.z,f.y),this.bearing,this.pitch);this._elevation=v.elevation,this._center=v.center,this.setZoom(v.zoom)}getCameraPoint(){let e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){let e=s.aH(1,this.center.lat)*this.worldSize;return fr(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];let o=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/o,e.canonical.y/o,1/o/s.X,1/o/s.X]}}class ln{constructor(e,o){this.min=e,this.max=o,this.center=s.aL([],s.aM([],this.min,this.max),.5)}quadrant(e){let o=[e%2==0,e<2],h=s.aN(this.min),f=s.aN(this.max);for(let g=0;g<o.length;g++)h[g]=o[g]?this.min[g]:this.center[g],f[g]=o[g]?this.center[g]:this.max[g];return f[2]=this.max[2],new ln(h,f)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let o=!0;for(let h=0;h<e.planes.length;h++){let f=this.intersectsPlane(e.planes[h]);if(f===0)return 0;f===1&&(o=!1)}return o?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let o=e[3],h=e[3];for(let f=0;f<3;f++)e[f]>0?(o+=e[f]*this.min[f],h+=e[f]*this.max[f]):(h+=e[f]*this.min[f],o+=e[f]*this.max[f]);return o>=0?2:h<0?0:1}}class Ka{distanceToTile2d(e,o,h,f){let g=f.distanceX([e,o]),v=f.distanceY([e,o]);return Math.hypot(g,v)}getWrap(e,o,h){return h}getTileAABB(e,o,h,f){var g,v;let w=h,E=h;if(f.terrain){let A=new s.S(e.z,o,e.z,e.x,e.y),R=f.terrain.getMinMaxElevation(A);w=(g=R.minElevation)!==null&&g!==void 0?g:h,E=(v=R.maxElevation)!==null&&v!==void 0?v:h}let T=1<<e.z;return new ln([o+e.x/T,e.y/T,w],[o+(e.x+1)/T,(e.y+1)/T,E])}allowVariableZoom(e,o){let h=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,f=s.ab(78.5-h/2,0,60);return!!o.terrain||e.pitch>f||e.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Fi{constructor(e,o,h){this.points=e,this.planes=o,this.aabb=h}static fromInvProjectionMatrix(e,o=1,h=0){let f=Math.pow(2,h),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{let A=1/(T=s.al([],T,e))[3]/o*f;return s.aO(T,T,[A,A,1/T[3],A])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{let A=s.aP([],g[T[0]],g[T[1]]),R=s.aP([],g[T[2]],g[T[1]]),O=s.aQ([],s.aR([],A,R)),z=-s.aS(O,g[T[1]]);return O.concat(z)}),w=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],E=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(let T of g)for(let A=0;A<3;A++)w[A]=Math.min(w[A],T[A]),E[A]=Math.max(E[A],T[A]);return new Fi(g,v,new ln(w,E))}}class Qi{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,h=!0){this._helper.resize(e,o,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,o){}constructor(e,o,h,f,g){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new hs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(v,w)=>this.getConstrained(v,w)},e,o,h,f,g),this._coveringTilesDetailsProvider=new Ka}clone(){let e=new Qi;return e.apply(this),e}apply(e,o,h){this._helper.apply(e,o,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){let o=[new s.aT(0,e)];if(this._helper._renderWorldCopies){let h=this.screenPointToMercatorCoordinate(new s.P(0,0)),f=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,0)),g=this.screenPointToMercatorCoordinate(new s.P(this._helper._width,this._helper._height)),v=this.screenPointToMercatorCoordinate(new s.P(0,this._helper._height)),w=Math.floor(Math.min(h.x,f.x,g.x,v.x)),E=Math.floor(Math.max(h.x,f.x,g.x,v.x)),T=1;for(let A=w-T;A<=E+T;A++)A!==0&&o.push(new s.aT(A,e))}return o}getCameraFrustum(){return Fi.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){let o=this.screenPointToLocation(this.centerPoint,e),h=e?e.getElevationForLngLatZoom(o,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(e,o){let h=s.aH(this.elevation,this.center.lat),f=this.screenPointToMercatorCoordinateAtZ(o,h),g=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),v=s.Y.fromLngLat(e),w=new s.Y(v.x-(f.x-g.x),v.y-(f.y-g.y));this.setCenter(w?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,o){return o?this.coordinatePoint(s.Y.fromLngLat(e),o.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(s.Y.fromLngLat(e))}screenPointToLocation(e,o){var h;return(h=this.screenPointToMercatorCoordinate(e,o))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(e,o){if(o){let h=o.pointCoordinate(e);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,o){let h=o||0,f=[e.x,e.y,0,1],g=[e.x,e.y,1,1];s.al(f,f,this._pixelMatrixInverse),s.al(g,g,this._pixelMatrixInverse);let v=f[3],w=g[3],E=f[1]/v,T=g[1]/w,A=f[2]/v,R=g[2]/w,O=A===R?0:(h-A)/(R-A);return new s.Y(s.y.number(f[0]/v,g[0]/w,O)/this.worldSize,s.y.number(E,T,O)/this.worldSize,h)}coordinatePoint(e,o=0,h=this._pixelMatrix){let f=[e.x*this.worldSize,e.y*this.worldSize,o,1];return s.al(f,f,h),new s.P(f[0]/f[3],f[1]/f[3])}getBounds(){let e=Math.max(0,this._helper._height/2-vn(this));return new Dn().extend(this.screenPointToLocation(new s.P(0,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,e))).extend(this.screenPointToLocation(new s.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new s.P(0,this._helper._height)))}isPointOnMapSurface(e,o){return o?o.pointCoordinate(e)!=null:e.y>this.height/2-vn(this)}calculatePosMatrix(e,o=!1,h){var f;let g=(f=e.key)!==null&&f!==void 0?f:s.aU(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),v=o?this._alignedPosMatrixCache:this._posMatrixCache;if(v.has(g)){let T=v.get(g);return h?T.f32:T.f64}let w=pd(e,this.worldSize);s.L(w,o?this._alignedProjMatrix:this._viewProjMatrix,w);let E={f64:w,f32:new Float32Array(w)};return v.set(g,E),h?E.f32:E.f64}calculateFogMatrix(e){let o=e.key,h=this._fogMatrixCacheF32;if(h.has(o))return h.get(o);let f=pd(e,this.worldSize);return s.L(f,this._fogMatrix,f),h.set(o,new Float32Array(f)),h.get(o)}getConstrained(e,o){o=s.ab(+o,this.minZoom,this.maxZoom);let h={center:new s.N(e.lng,e.lat),zoom:o},f=this._helper._lngRange;this._helper._renderWorldCopies||f!==null||(f=[-179.9999999999,180-1e-10]);let g=this.tileSize*s.aG(h.zoom),v=0,w=g,E=0,T=g,A=0,R=0,{x:O,y:z}=this.size;if(this._helper._latRange){let ie=this._helper._latRange;v=s.Q(ie[1])*g,w=s.Q(ie[0])*g,w-v<z&&(A=z/(w-v))}f&&(E=s.aI(s.O(f[0])*g,0,g),T=s.aI(s.O(f[1])*g,0,g),T<E&&(T+=g),T-E<O&&(R=O/(T-E)));let{x:U,y:K}=In(g,e),Y,Q,ee=Math.max(R||0,A||0);if(ee){let ie=new s.P(R?(T+E)/2:U,A?(w+v)/2:K);return h.center=Un(g,ie).wrap(),h.zoom+=s.a8(ee),h}if(this._helper._latRange){let ie=z/2;K-ie<v&&(Q=v+ie),K+ie>w&&(Q=w-ie)}if(f){let ie=(E+T)/2,oe=U;this._helper._renderWorldCopies&&(oe=s.aI(U,ie-g/2,ie+g/2));let se=O/2;oe-se<E&&(Y=E+se),oe+se>T&&(Y=T-se)}if(Y!==void 0||Q!==void 0){let ie=new s.P(Y??U,Q??K);h.center=Un(g,ie).wrap()}return h}calculateCenterFromCameraLngLatAlt(e,o,h,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,f)}_calculateNearFarZIfNeeded(e,o,h){if(!this._helper.autoCalculateNearFarZ)return;let f=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),g=e-f*this._helper._pixelPerMeter/Math.cos(o),v=f<0?g:e,w=Math.PI/2+this.pitchInRadians,E=s.aa(this.fov)*(Math.abs(Math.cos(s.aa(this.roll)))*this.height+Math.abs(Math.sin(s.aa(this.roll)))*this.width)/this.height*(.5+h.y/this.height),T=Math.sin(E)*v/Math.sin(s.ab(Math.PI-w-E,.01,Math.PI-.01)),A=vn(this),R=Math.atan(A/this._helper.cameraToCenterDistance),O=s.aa(.75),z=R>O?2*R*(.5+h.y/(2*A)):O,U=Math.sin(z)*v/Math.sin(s.ab(Math.PI-w-z,.01,Math.PI-.01)),K=Math.min(T,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-o)*K+v),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;let e=this.centerOffset,o=In(this.worldSize,this.center),h=o.x,f=o.y;this._helper._pixelPerMeter=s.aH(1,this.center.lat)*this.worldSize;let g=s.aa(Math.min(this.pitch,89.25)),v=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(g)),w;this._calculateNearFarZIfNeeded(v,g,e),w=new Float64Array(16),s.aV(w,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),s.an(this._invProjMatrix,w),w[8]=2*-e.x/this._helper._width,w[9]=2*e.y/this._helper._height,this._projectionMatrix=s.aW(w),s.K(w,w,[1,-1,1]),s.J(w,w,[0,0,-this._helper.cameraToCenterDistance]),s.aX(w,w,-this.rollInRadians),s.aY(w,w,this.pitchInRadians),s.aX(w,w,-this.bearingInRadians),s.J(w,w,[-h,-f,0]),this._mercatorMatrix=s.K([],w,[this.worldSize,this.worldSize,this.worldSize]),s.K(w,w,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=s.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,w),s.J(w,w,[0,0,-this.elevation]),this._viewProjMatrix=w,this._invViewProjMatrix=s.an([],w);let E=[0,0,-1,1];s.al(E,E,this._invViewProjMatrix),this._cameraPosition=[E[0]/E[3],E[1]/E[3],E[2]/E[3]],this._fogMatrix=new Float64Array(16),s.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,v,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,s.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),s.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),s.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),s.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),s.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),s.J(this._fogMatrix,this._fogMatrix,[-h,-f,0]),s.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),s.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=s.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,w);let T=this._helper._width%2/2,A=this._helper._height%2/2,R=Math.cos(this.bearingInRadians),O=Math.sin(-this.bearingInRadians),z=h-Math.round(h)+R*T+O*A,U=f-Math.round(f)+R*A+O*T,K=new Float64Array(w);if(s.J(K,K,[z>.5?z-1:z,U>.5?U-1:U,0]),this._alignedProjMatrix=K,w=s.an(new Float64Array(16),this._pixelMatrix),!w)throw new Error("failed to invert matrix");this._pixelMatrixInverse=w,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;let e=this.screenPointToMercatorCoordinate(new s.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return s.al(o,o,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){let e=s.aH(1,this.center.lat)*this.worldSize;return fr(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,o){let h=s.Y.fromLngLat(e),f=[h.x*this.worldSize,h.y*this.worldSize,o,1];return s.al(f,f,this._viewProjMatrix),f[2]/f[3]}getProjectionData(e){let{overscaledTileID:o,aligned:h,applyTerrainMatrix:f}=e,g=this._helper.getMercatorTileCoordinates(o),v=o?this.calculatePosMatrix(o,h,!0):null,w;return w=o&&o.terrainRttPosMatrix32f&&f?o.terrainRttPosMatrix32f:v||s.aZ(),{mainMatrix:w,tileMercatorCoords:g,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:w}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,o,h){return 1}transformLightDirection(e){return s.aN(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,o,h,f){let g=this.calculatePosMatrix(h),v;f?(v=[e,o,f(e,o),1],s.al(v,v,g)):(v=[e,o,0,1],On(v,v,g));let w=v[3];return{point:new s.P(v[0]/w,v[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}populateCache(e){for(let o of e)this.calculatePosMatrix(o)}getMatrixForModel(e,o){let h=s.Y.fromLngLat(e,o),f=h.meterInMercatorCoordinateUnits(),g=s.a_();return s.J(g,g,[h.x,h.y,h.z]),s.aX(g,g,Math.PI),s.aY(g,g,Math.PI/2),s.K(g,g,[-f,f,f]),g}getProjectionDataForCustomLayer(e=!0){let o=new s.S(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:o,applyGlobeMatrix:e}),f=pd(o,this.worldSize);s.L(f,this._viewProjMatrix,f),h.tileMercatorCoords=[0,0,1,1];let g=[s.X,s.X,this.worldSize/this._helper.pixelsPerMeter],v=s.a$();return s.K(v,f,g),h.fallbackMatrix=v,h.mainMatrix=v,h}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Wr(){s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function gd(m){if(m.useSlerp)if(m.k<1){let e=s.b0(m.startEulerAngles.roll,m.startEulerAngles.pitch,m.startEulerAngles.bearing),o=s.b0(m.endEulerAngles.roll,m.endEulerAngles.pitch,m.endEulerAngles.bearing),h=new Float64Array(4);s.b1(h,e,o,m.k);let f=s.b2(h);m.tr.setRoll(f.roll),m.tr.setPitch(f.pitch),m.tr.setBearing(f.bearing)}else m.tr.setRoll(m.endEulerAngles.roll),m.tr.setPitch(m.endEulerAngles.pitch),m.tr.setBearing(m.endEulerAngles.bearing);else m.tr.setRoll(s.y.number(m.startEulerAngles.roll,m.endEulerAngles.roll,m.k)),m.tr.setPitch(s.y.number(m.startEulerAngles.pitch,m.endEulerAngles.pitch,m.k)),m.tr.setBearing(s.y.number(m.startEulerAngles.bearing,m.endEulerAngles.bearing,m.k))}function Ji(m,e,o,h,f){let g=f.padding,v=In(f.worldSize,o.getNorthWest()),w=In(f.worldSize,o.getNorthEast()),E=In(f.worldSize,o.getSouthEast()),T=In(f.worldSize,o.getSouthWest()),A=s.aa(-h),R=v.rotate(A),O=w.rotate(A),z=E.rotate(A),U=T.rotate(A),K=new s.P(Math.max(R.x,O.x,U.x,z.x),Math.max(R.y,O.y,U.y,z.y)),Y=new s.P(Math.min(R.x,O.x,U.x,z.x),Math.min(R.y,O.y,U.y,z.y)),Q=K.sub(Y),ee=(f.width-(g.left+g.right+e.left+e.right))/Q.x,ie=(f.height-(g.top+g.bottom+e.top+e.bottom))/Q.y;if(ie<0||ee<0)return void Wr();let oe=Math.min(s.a8(f.scale*Math.min(ee,ie)),m.maxZoom),se=s.P.convert(m.offset),ce=new s.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(s.aa(h)),le=se.add(ce).mult(f.scale/s.aG(oe));return{center:Un(f.worldSize,v.add(E).div(2).sub(le)),zoom:oe,bearing:h}}class uc{get useGlobeControls(){return!1}handlePanInertia(e,o){return{easingOffset:e,easingCenter:o.center}}handleMapControlsRollPitchBearingZoom(e,o){e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta),e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta)}handleMapControlsPan(e,o,h){e.around.distSqr(o.centerPoint)<.01||o.setLocationAtPoint(h,e.around)}cameraForBoxAndBearing(e,o,h,f,g){return Ji(e,o,h,f,g)}handleJumpToCenterZoom(e,o){e.zoom!==(o.zoom!==void 0?+o.zoom:e.zoom)&&e.setZoom(+o.zoom),o.center!==void 0&&e.setCenter(s.N.convert(o.center))}handleEaseTo(e,o){let h=e.zoom,f=e.padding,g={roll:e.roll,pitch:e.pitch,bearing:e.bearing},v={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},w=o.zoom!==void 0,E=!e.isPaddingEqual(o.padding),T=!1,A=w?+o.zoom:e.zoom,R=e.centerPoint.add(o.offsetAsPoint),O=e.screenPointToLocation(R),{center:z,zoom:U}=e.getConstrained(s.N.convert(o.center||O),A??h);mr(e,z);let K=In(e.worldSize,O),Y=In(e.worldSize,z).sub(K),Q=s.aG(U-h);return T=U!==h,{easeFunc:ee=>{if(T&&e.setZoom(s.y.number(h,U,ee)),s.b3(g,v)||gd({startEulerAngles:g,endEulerAngles:v,tr:e,k:ee,useSlerp:g.roll!=v.roll}),E&&(e.interpolatePadding(f,o.padding,ee),R=e.centerPoint.add(o.offsetAsPoint)),o.around)e.setLocationAtPoint(o.around,o.aroundPoint);else{let ie=s.aG(e.zoom-h),oe=U>h?Math.min(2,Q):Math.max(.5,Q),se=Math.pow(oe,1-ee),ce=Un(e.worldSize,K.add(Y.mult(ee*se)).mult(ie));e.setLocationAtPoint(e.renderWorldCopies?ce.wrap():ce,R)}},isZooming:T,elevationCenter:z}}handleFlyTo(e,o){let h=o.zoom!==void 0,f=e.zoom,g=e.getConstrained(s.N.convert(o.center||o.locationAtOffset),h?+o.zoom:f),v=g.center,w=g.zoom;mr(e,v);let E=In(e.worldSize,o.locationAtOffset),T=In(e.worldSize,v).sub(E),A=T.mag(),R=s.aG(w-f),O;if(o.minZoom!==void 0){let z=Math.min(+o.minZoom,f,w),U=e.getConstrained(v,z).zoom;O=s.aG(U-f)}return{easeFunc:(z,U,K,Y)=>{e.setZoom(z===1?w:f+s.a8(U));let Q=z===1?v:Un(e.worldSize,E.add(T.mult(K)).mult(U));e.setLocationAtPoint(e.renderWorldCopies?Q.wrap():Q,Y)},scaleOfZoom:R,targetCenter:v,scaleOfMinZoom:O,pixelPathLength:A}}}class cn{constructor(e,o,h){this.blendFunction=e,this.blendColor=o,this.mask=h}}cn.Replace=[1,0],cn.disabled=new cn(cn.Replace,s.b4.transparent,[!1,!1,!1,!1]),cn.unblended=new cn(cn.Replace,s.b4.transparent,[!0,!0,!0,!0]),cn.alphaBlended=new cn([1,771],s.b4.transparent,[!0,!0,!0,!0]);let Ys=2305;class Ot{constructor(e,o,h){this.enable=e,this.mode=o,this.frontFace=h}}Ot.disabled=new Ot(!1,1029,Ys),Ot.backCCW=new Ot(!0,1029,Ys),Ot.frontCCW=new Ot(!0,1028,Ys);class vt{constructor(e,o,h){this.func=e,this.mask=o,this.range=h}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);let Qa=7680;class zt{constructor(e,o,h,f,g,v){this.test=e,this.ref=o,this.mask=h,this.fail=f,this.depthFail=g,this.pass=v}}zt.disabled=new zt({func:519,mask:0},0,0,Qa,Qa,Qa);let Ks=new WeakMap;function mi(m){var e;if(Ks.has(m))return Ks.get(m);{let o=(e=m.getParameter(m.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Ks.set(m,o),o}}class Ja{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;let o=e.context,h=o.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;let f=new s.aC;f.emplaceBack(-1,-1),f.emplaceBack(2,-1),f.emplaceBack(-1,2);let g=new s.aE;g.emplaceBack(0,1,2),this._fullscreenTriangle=new Li(o.createVertexBuffer(f,Dt.members),o.createIndexBuffer(g),s.aD.simpleSegment(0,0,f.length,g.length)),this._resultBuffer=new Uint8Array(4),o.activeTexture.set(h.TEXTURE1);let v=h.createTexture();h.bindTexture(h.TEXTURE_2D,v),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=o.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(v),mi(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){let e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,o){let h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,o),this._updateCount++,this._measuredError}_bindFramebuffer(){let e=this._cachedRenderContext.context,o=e.gl;e.activeTexture.set(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,o){let h=this._cachedRenderContext.context,f=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:s.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,f.TRIANGLES,vt.disabled,zt.disabled,cn.unblended,Ot.disabled,((g,v)=>({u_input:g,u_output_expected:v}))(e,o),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&mi(f)){f.bindBuffer(f.PIXEL_PACK_BUFFER,this._pbo),f.readBuffer(f.COLOR_ATTACHMENT0),f.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),f.bindBuffer(f.PIXEL_PACK_BUFFER,null);let g=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0);f.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:g}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){let e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&mi(e)){let o=e.clientWaitSync(this._readbackQueue.sync,0,0);if(o===e.WAIT_FAILED)return s.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(o===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Ja._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let o=0;return o+=e[0]/256,o+=e[1]/65536,o+=e[2]/16777216,e[3]<127&&(o=-o),o/128}}let el=s.X/128;function tl(m,e){let o=m.granularity!==void 0?Math.max(m.granularity,1):1,h=o+(m.generateBorders?2:0),f=o+(m.extendToNorthPole||m.generateBorders?1:0)+(m.extendToSouthPole||m.generateBorders?1:0),g=h+1,v=f+1,w=m.generateBorders?-1:0,E=m.generateBorders||m.extendToNorthPole?-1:0,T=o+(m.generateBorders?1:0),A=o+(m.generateBorders||m.extendToSouthPole?1:0),R=g*v,O=h*f*6,z=g*v>65536;if(z&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");let U=z||e==="32bit",K=new Int16Array(2*R),Y=0;for(let ie=E;ie<=A;ie++)for(let oe=w;oe<=T;oe++){let se=oe/o*s.X;oe===-1&&(se=-64),oe===o+1&&(se=s.X+el);let ce=ie/o*s.X;ie===-1&&(ce=m.extendToNorthPole?s.b6:-64),ie===o+1&&(ce=m.extendToSouthPole?s.b7:s.X+el),K[Y++]=se,K[Y++]=ce}let Q=U?new Uint32Array(O):new Uint16Array(O),ee=0;for(let ie=0;ie<f;ie++)for(let oe=0;oe<h;oe++){let se=oe+1+ie*g,ce=oe+(ie+1)*g,le=oe+1+(ie+1)*g;Q[ee++]=oe+ie*g,Q[ee++]=ce,Q[ee++]=se,Q[ee++]=se,Q[ee++]=ce,Q[ee++]=le}return{vertices:K.buffer.slice(0),indices:Q.buffer.slice(0),uses32bitIndices:U}}let fs=new s.aB({fill:new s.b8(128,2),line:new s.b8(512,0),tile:new s.b8(128,32),stencil:new s.b8(128,1),circle:3});class Hf{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ni.projectionGlobe}get vertexShaderPreludeCode(){return Ni.projectionMercator.vertexSource}get subdivisionGranularity(){return fs}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Ja(e));let o=s.Q(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,f=this._errorMeasurement.updateErrorLoop(o,h),g=W.now();f!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=f,this._errorMeasurementLastChangeTime=g);let v=Math.min(Math.max((g-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=s.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,s.ba(v))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,o,h,f,g){let v=(g==="stencil"?fs.stencil:fs.tile).getGranularityForZoomLevel(o.z);return this._getMesh(e,{granularity:v,generateBorders:h,extendToNorthPole:o.y===0&&f,extendToSouthPole:o.y===(1<<o.z)-1&&f})}_getMesh(e,o){let h=this._getMeshKey(o);if(h in this._tileMeshCache)return this._tileMeshCache[h];let f=function(g,v){let w=tl(v,"16bit"),E=s.aC.deserialize({arrayBuffer:w.vertices,length:w.vertices.byteLength/2/2}),T=s.aE.deserialize({arrayBuffer:w.indices,length:w.indices.byteLength/2/3});return new Li(g.createVertexBuffer(E,Dt.members),g.createIndexBuffer(T),s.aD.simpleSegment(0,0,E.length,T.length))}(e,o);return this._tileMeshCache[h]=f,f}recalculate(e){}hasTransition(){let e=W.now(),o=!1;return o=o||(e-this._errorMeasurementLastChangeTime)/1e3<.7,o=o||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,o}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}let yd=new s.q({type:new s.D(s.v.projection.type)});class _d extends s.E{constructor(e){super(),this._transitionable=new s.T(yd),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new s.z(0)),this._mercatorProjection=new Ya,this._verticalPerspectiveProjection=new Hf}get transitionState(){let e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof s.bb){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,o,h,f,g){return this.currentProjection.getMeshFromTileID(e,o,h,f,g)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Gf(m){let e=Qs(m.worldSize,m.center.lat);return 2*Math.PI*e}function nl(m,e,o,h,f){let g=1/(1<<f),v=e/s.X*g+h*g,w=s.bd((m/s.X*g+o*g)*Math.PI*2+Math.PI,2*Math.PI),E=2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI,T=Math.cos(E),A=new Float64Array(3);return A[0]=Math.sin(w)*T,A[1]=Math.sin(E),A[2]=Math.cos(w)*T,A}function nn(m){return function(e,o){let h=Math.cos(o),f=new Float64Array(3);return f[0]=Math.sin(e)*h,f[1]=Math.sin(o),f[2]=Math.cos(e)*h,f}(m.lng*Math.PI/180,m.lat*Math.PI/180)}function Qs(m,e){return m/(2*Math.PI)/Math.cos(e*Math.PI/180)}function gi(m){let e=Math.asin(m[1])/Math.PI*180,o=Math.sqrt(m[0]*m[0]+m[2]*m[2]);if(o>1e-6){let h=m[0]/o,f=Math.acos(m[2]/o),g=(h>0?f:-f)/Math.PI*180;return new s.N(s.aI(g,-180,180),e)}return new s.N(0,e)}function ps(m){return Math.cos(m*Math.PI/180)}function $n(m,e){let o=ps(m),h=ps(e);return s.a8(h/o)}function vd(m,e){let o=m.rotate(e.bearingInRadians),h=e.zoom+$n(e.center.lat,0),f=s.b9(1/ps(e.center.lat),1/ps(Math.min(Math.abs(e.center.lat),60)),s.bc(h,7,3,0,1)),g=360/Gf({worldSize:e.worldSize,center:{lat:e.center.lat}});return new s.N(e.center.lng-o.x*g*f,s.ab(e.center.lat+o.y*g,-85.051129,s.aF))}function Do(m){let e=.5*m,o=Math.sin(e),h=Math.cos(e);return Math.log(o+h)-Math.log(h-o)}function qf(m,e,o,h){let f=m.lat+o*h;if(Math.abs(o)>1){let g=(Math.sign(m.lat+o)!==Math.sign(m.lat)?-Math.abs(m.lat):Math.abs(m.lat))*Math.PI/180,v=Math.abs(m.lat+o)*Math.PI/180,w=Do(g+h*(v-g)),E=Do(g),T=Do(v);return new s.N(m.lng+e*((w-E)/(T-E)),f)}return new s.N(m.lng+e*h,f)}class Hy{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=e}recalculateCache(){if(!this._hadAnyChanges)return;let e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(e,o,h,f){let g=`${e.z}_${e.x}_${e.y}`,v=this._cache.get(g);if(v)return v;let w=this._cachePrevious.get(g);if(w)return this._cache.set(g,w),w;let E=this._aabbFactory(e,o,h,f);return this._cache.set(g,E),this._hadAnyChanges=!0,E}}function dc(m,e,o){let h=m-e;return h<0?-h:Math.max(0,h-o)}function bd(m,e,o,h,f){let g=m-o,v;return v=g<0?Math.min(-g,1+g-f):g>1?Math.min(Math.max(g-f,0),1-g):0,Math.max(v,dc(e,h,f))}class Gy{constructor(){this._aabbCache=new Hy(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(e,o,h,f){let g=1<<h.z,v=1/g,w=h.x/g,E=h.y/g,T=2;return T=Math.min(T,bd(e,o,w,E,v)),T=Math.min(T,bd(e,o,w+.5,-E-v,v)),T=Math.min(T,bd(e,o,w+.5,2-E-v,v)),T}getWrap(e,o,h){let f=1<<o.z,g=1/f,v=o.x/f,w=dc(e.x,v,g),E=dc(e.x,v-1,g),T=dc(e.x,v+1,g),A=Math.min(w,E,T);return A===T?1:A===E?-1:0}allowVariableZoom(e,o){return To(e,o)>4}allowWorldCopies(){return!1}getTileAABB(e,o,h,f){return this._aabbCache.getTileAABB(e,o,h,f)}_computeTileAABB(e,o,h,f){if(e.z<=0)return new ln([-1,-1,-1],[1,1,1]);if(e.z===1)return new ln([e.x===0?-1:0,e.y===0?0:-1,-1],[e.x===0?0:1,e.y===0?1:0,1]);{let g=[nl(0,0,e.x,e.y,e.z),nl(s.X,0,e.x,e.y,e.z),nl(s.X,s.X,e.x,e.y,e.z),nl(0,s.X,e.x,e.y,e.z)],v=[1,1,1],w=[-1,-1,-1];for(let E of g)for(let T=0;T<3;T++)v[T]=Math.min(v[T],E[T]),w[T]=Math.max(w[T],E[T]);if(e.y===0||e.y===(1<<e.z)-1){let E=[0,e.y===0?1:-1,0];for(let T=0;T<3;T++)v[T]=Math.min(v[T],E[T]),w[T]=Math.max(w[T],E[T])}return new ln(v,w)}}}class hc{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o){this._helper.resize(e,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=s.be(),this._projectionMatrix=s.a_(),this._globeViewProjMatrix32f=s.aZ(),this._globeViewProjMatrixNoCorrection=s.a_(),this._globeViewProjMatrixNoCorrectionInverted=s.a_(),this._globeProjMatrixInverted=s.a_(),this._cameraPosition=s.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new hs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._coveringTilesDetailsProvider=new Gy}clone(){let e=new hc;return e.apply(this),e}apply(e,o){this._globeLatitudeErrorCorrectionRadians=o||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){let e=s.bf();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){let{overscaledTileID:o,applyGlobeMatrix:h}=e,f=this._helper.getMercatorTileCoordinates(o);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:f,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){let o=this.pitchInRadians,h=this.cameraToCenterDistance/e,f=Math.sin(o)*h,g=Math.cos(o)*h+1,v=1/Math.sqrt(f*f+g*g)*1,w=-f,E=g,T=Math.sqrt(w*w+E*E);w/=T,E/=T;let A=[0,w,E];return s.bg(A,A,[0,0,0],-this.bearingInRadians),s.bh(A,A,[0,0,0],-1*this.center.lat*Math.PI/180),s.bi(A,A,[0,0,0],this.center.lng*Math.PI/180),s.aL(A,A,.25),[...A,.25*-v]}isLocationOccluded(e){return!this.isSurfacePointVisible(nn(e))}transformLightDirection(e){let o=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,f=Math.cos(h),g=[Math.sin(o)*f,Math.sin(h),Math.cos(o)*f],v=[g[2],0,-g[0]],w=[0,0,0];s.aR(w,v,g),s.aQ(v,v),s.aQ(w,w);let E=[0,0,0];return s.aQ(E,[v[0]*e[0]+w[0]*e[1]+g[0]*e[2],v[1]*e[0]+w[1]*e[1]+g[1]*e[2],v[2]*e[0]+w[2]*e[1]+g[2]*e[2]]),E}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,o,h){let f=function(w,E,T){let A=1/(1<<T.z);return new s.Y(w/s.X*A+T.x*A,E/s.X*A+T.y*A)}(e,o,h.canonical),g=(v=f.y,[s.bd(f.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-v*Math.PI*2))-.5*Math.PI]);var v;return this.getCircleRadiusCorrection()/Math.cos(g[1])}projectTileCoordinates(e,o,h,f){let g=h.canonical,v=nl(e,o,g.x,g.y,g.z),w=1+(f?f(e,o):0)/s.bo,E=[v[0]*w,v[1]*w,v[2]*w,1];s.al(E,E,this._globeViewProjMatrixNoCorrection);let T=this._cachedClippingPlane,A=T[0]*v[0]+T[1]*v[1]+T[2]*v[2]+T[3]<0;return{point:new s.P(E[0]/E[3],E[1]/E[3]),signedDistanceFromCamera:E[3],isOccluded:A}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;let e=Qs(this.worldSize,this.center.lat),o=s.a$(),h=s.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),s.aV(o,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);let f=this.centerOffset;o[8]=2*-f.x/this._helper._width,o[9]=2*f.y/this._helper._height,this._projectionMatrix=s.aW(o),this._globeProjMatrixInverted=s.a$(),s.an(this._globeProjMatrixInverted,o),s.J(o,o,[0,0,-this.cameraToCenterDistance]),s.aX(o,o,this.rollInRadians),s.aY(o,o,-this.pitchInRadians),s.aX(o,o,this.bearingInRadians),s.J(o,o,[0,0,-e]);let g=s.bf();g[0]=e,g[1]=e,g[2]=e,s.aY(h,o,this.center.lat*Math.PI/180),s.bj(h,h,-this.center.lng*Math.PI/180),s.K(h,h,g),this._globeViewProjMatrixNoCorrection=h,s.aY(o,o,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),s.bj(o,o,-this.center.lng*Math.PI/180),s.K(o,o,g),this._globeViewProjMatrix32f=new Float32Array(o),this._globeViewProjMatrixNoCorrectionInverted=s.a$(),s.an(this._globeViewProjMatrixNoCorrectionInverted,h);let v=s.bf();this._cameraPosition=s.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/e,s.bg(this._cameraPosition,this._cameraPosition,v,-this.rollInRadians),s.bh(this._cameraPosition,this._cameraPosition,v,this.pitchInRadians),s.bg(this._cameraPosition,this._cameraPosition,v,-this.bearingInRadians),s.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),s.bh(this._cameraPosition,this._cameraPosition,v,-this.center.lat*Math.PI/180),s.bi(this._cameraPosition,this._cameraPosition,v,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);let w=s.aW(this._globeViewProjMatrixNoCorrectionInverted);s.K(w,w,[1,1,-1]),this._cachedFrustum=Fi.fromInvProjectionMatrix(w)}calculateFogMatrix(e){s.w("calculateFogMatrix is not supported on globe projection.");let o=s.a$();return s.aq(o),o}getVisibleUnwrappedCoordinates(e){return[new s.aT(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&s.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){if(!this._globeViewProjMatrixNoCorrection)return 1;let h=nn(e);s.aL(h,h,1+o/s.bo);let f=s.be();return s.al(f,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),f[2]/f[3]}populateCache(e){}getBounds(){let e=.5*this.width,o=.5*this.height,h=[new s.P(0,0),new s.P(e,0),new s.P(this.width,0),new s.P(this.width,o),new s.P(this.width,this.height),new s.P(e,this.height),new s.P(0,this.height),new s.P(0,o)],f=[];for(let R of h)f.push(this.unprojectScreenPoint(R));let g=0,v=0,w=0,E=0,T=this.center;for(let R of f){let O=s.bk(T.lng,R.lng),z=s.bk(T.lat,R.lat);O<v&&(v=O),O>g&&(g=O),z<E&&(E=z),z>w&&(w=z)}let A=[T.lng+v,T.lat+E,T.lng+g,T.lat+w];return this.isSurfacePointOnScreen([0,1,0])&&(A[3]=90,A[0]=-180,A[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(A[1]=-90,A[0]=-180,A[2]=180),new Dn(A)}getConstrained(e,o){let h=s.ab(e.lat,-85.051129,s.aF),f=s.ab(+o,this.minZoom+$n(0,h),this.maxZoom);return{center:new s.N(e.lng,h),zoom:f}}calculateCenterFromCameraLngLatAlt(e,o,h,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,f)}setLocationAtPoint(e,o){let h=nn(this.unprojectScreenPoint(o)),f=nn(e),g=s.bf();s.bl(g);let v=s.bf();s.bi(v,h,g,-this.center.lng*Math.PI/180),s.bh(v,v,g,this.center.lat*Math.PI/180);let w=f[0]*f[0]+f[2]*f[2],E=v[0]*v[0];if(w<E)return;let T=Math.sqrt(w-E),A=-T,R=s.bm(f[0],f[2],v[0],T),O=s.bm(f[0],f[2],v[0],A),z=s.bf();s.bi(z,f,g,-R);let U=s.bm(z[1],z[2],v[1],v[2]),K=s.bf();s.bi(K,f,g,-O);let Y=s.bm(K[1],K[2],v[1],v[2]),Q=.5*Math.PI,ee=U>=-Q&&U<=Q,ie=Y>=-Q&&Y<=Q,oe,se;if(ee&&ie){let ve=this.center.lng*Math.PI/180,Se=this.center.lat*Math.PI/180;s.bp(R,ve)+s.bp(U,Se)<s.bp(O,ve)+s.bp(Y,Se)?(oe=R,se=U):(oe=O,se=Y)}else if(ee)oe=R,se=U;else{if(!ie)return;oe=O,se=Y}let ce=oe/Math.PI*180,le=se/Math.PI*180,ye=this.center.lat;this.setCenter(new s.N(ce,s.ab(le,-90,90))),this.setZoom(this.zoom+$n(ye,this.center.lat))}locationToScreenPoint(e,o){let h=nn(e);if(o){let f=o.getElevationForLngLatZoom(e,this._helper._tileZoom);s.aL(h,h,1+f/s.bo)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(e){let o=s.be();return s.al(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],new s.P((.5*o[0]+.5)*this.width,(.5*-o[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,o){if(o){let h=o.pointCoordinate(e);if(h)return h}return s.Y.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,o){var h;return(h=this.screenPointToMercatorCoordinate(e,o))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(e,o){let h=this._cameraPosition,f=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(h,f)}getRayDirectionFromPixel(e){let o=s.be();o[0]=e.x/this.width*2-1,o[1]=-1*(e.y/this.height*2-1),o[2]=1,o[3]=1,s.al(o,o,this._globeViewProjMatrixNoCorrectionInverted),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];let h=s.bf();h[0]=o[0]-this._cameraPosition[0],h[1]=o[1]-this._cameraPosition[1],h[2]=o[2]-this._cameraPosition[2];let f=s.bf();return s.aQ(f,h),f}isSurfacePointVisible(e){let o=this._cachedClippingPlane;return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;let o=s.be();return s.al(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3],o[0]>-1&&o[0]<1&&o[1]>-1&&o[1]<1&&o[2]>-1&&o[2]<1}rayPlanetIntersection(e,o){let h=s.aS(e,o),f=s.bf(),g=s.bf();s.aL(g,o,h),s.aP(f,e,g);let v=1-s.aS(f,f);if(v<0)return null;let w=s.aS(e,e)-1,E=-h+(h<0?1:-1)*Math.sqrt(v),T=w/E,A=E;return{tMin:Math.min(T,A),tMax:Math.max(T,A)}}unprojectScreenPoint(e){let o=this._cameraPosition,h=this.getRayDirectionFromPixel(e),f=this.rayPlanetIntersection(o,h);if(f){let T=s.bf();s.aM(T,o,[h[0]*f.tMin,h[1]*f.tMin,h[2]*f.tMin]);let A=s.bf();return s.aQ(A,T),gi(A)}let g=this._cachedClippingPlane[0]*h[0]+this._cachedClippingPlane[1]*h[1]+this._cachedClippingPlane[2]*h[2],v=-s.bn(this._cachedClippingPlane,o)/g,w=s.bf();if(v>0)s.aM(w,o,[h[0]*v,h[1]*v,h[2]*v]);else{let T=s.bf();s.aM(T,o,[2*h[0],2*h[1],2*h[2]]);let A=s.bn(this._cachedClippingPlane,T);s.aP(w,T,[this._cachedClippingPlane[0]*A,this._cachedClippingPlane[1]*A,this._cachedClippingPlane[2]*A])}let E=s.bf();return s.aQ(E,w),gi(E)}getMatrixForModel(e,o){let h=s.N.convert(e),f=1/s.bo,g=s.a_();return s.bj(g,g,h.lng/180*Math.PI),s.aY(g,g,-h.lat/180*Math.PI),s.J(g,g,[0,0,1+o/s.bo]),s.aY(g,g,.5*Math.PI),s.K(g,g,[f,f,f]),g}getProjectionDataForCustomLayer(e=!0){let o=this.getProjectionData({overscaledTileID:new s.S(0,0,0,0,0),applyGlobeMatrix:e});return o.tileMercatorCoords=[0,0,1,1],o}getFastPathSimpleProjectionMatrix(e){}}class ms{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,h){return this._helper.interpolatePadding(e,o,h)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,h=!0){this._helper.resize(e,o,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,o){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=o,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new hs({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._globeness=1,this._mercatorTransform=new Qi,this._verticalPerspectiveTransform=new hc}clone(){let e=new ms;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){let o=this._mercatorTransform.getProjectionData(e),h=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:o.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:o.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return s.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return s.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,o,h){let f=this._mercatorTransform.getPitchedTextCorrection(e,o,h),g=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,o,h);return s.b9(f,g,this._globeness)}projectTileCoordinates(e,o,h,f){return this.currentTransform.projectTileCoordinates(e,o,h,f)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){return this.currentTransform.lngLatToCameraDepth(e,o)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,o){return this.currentTransform.getConstrained(e,o)}calculateCenterFromCameraLngLatAlt(e,o,h,f){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,h,f)}setLocationAtPoint(e,o){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,o),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,o),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,o){return this.currentTransform.locationToScreenPoint(e,o)}screenPointToMercatorCoordinate(e,o){return this.currentTransform.screenPointToMercatorCoordinate(e,o)}screenPointToLocation(e,o){return this.currentTransform.screenPointToLocation(e,o)}isPointOnMapSurface(e,o){return this.currentTransform.isPointOnMapSurface(e,o)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,o){return this.currentTransform.getMatrixForModel(e,o)}getProjectionDataForCustomLayer(e=!0){let o=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return o;let h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return h.fallbackMatrix=o.mainMatrix,h}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Lr{get useGlobeControls(){return!0}handlePanInertia(e,o){let h=vd(e,o);return Math.abs(h.lng-o.center.lng)>180&&(h.lng=o.center.lng+179.5*Math.sign(h.lng-o.center.lng)),{easingCenter:h,easingOffset:new s.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,o){let h=e.around,f=o.screenPointToLocation(h);e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta);let g=o.zoom;e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta);let v=o.zoom-g;if(v===0)return;let w=s.bk(o.center.lng,f.lng),E=w/(Math.abs(w/180)+1),T=s.bk(o.center.lat,f.lat),A=o.getRayDirectionFromPixel(h),R=o.cameraPosition,O=-1*s.aS(R,A),z=s.bf();s.aM(z,R,[A[0]*O,A[1]*O,A[2]*O]);let U=s.bq(z)-1,K=Math.exp(.5*-Math.max(U-.3,0)),Y=Qs(o.worldSize,o.center.lat)/Math.min(o.width,o.height),Q=s.bc(Y,.9,.5,1,.25),ee=(1-s.aG(-v))*Math.min(K,Q),ie=o.center.lat,oe=o.zoom,se=new s.N(o.center.lng+E*ee,s.ab(o.center.lat+T*ee,-85.051129,s.aF));o.setLocationAtPoint(f,h);let ce=o.center,le=s.bc(Math.abs(w),45,85,0,1),ye=s.bc(Y,.75,.35,0,1),ve=Math.pow(Math.max(le,ye),.25),Se=s.bk(ce.lng,se.lng),Re=s.bk(ce.lat,se.lat);o.setCenter(new s.N(ce.lng+Se*ve,ce.lat+Re*ve).wrap()),o.setZoom(oe+$n(ie,o.center.lat))}handleMapControlsPan(e,o,h){if(!e.panDelta)return;let f=o.center.lat,g=o.zoom;o.setCenter(vd(e.panDelta,o).wrap()),o.setZoom(g+$n(f,o.center.lat))}cameraForBoxAndBearing(e,o,h,f,g){let v=Ji(e,o,h,f,g),w=o.left/g.width*2-1,E=(g.width-o.right)/g.width*2-1,T=o.top/g.height*-2+1,A=(g.height-o.bottom)/g.height*-2+1,R=s.bk(h.getWest(),h.getEast())<0,O=R?h.getEast():h.getWest(),z=R?h.getWest():h.getEast(),U=Math.max(h.getNorth(),h.getSouth()),K=Math.min(h.getNorth(),h.getSouth()),Y=O+.5*s.bk(O,z),Q=U+.5*s.bk(U,K),ee=g.clone();ee.setCenter(v.center),ee.setBearing(v.bearing),ee.setPitch(0),ee.setRoll(0),ee.setZoom(v.zoom);let ie=ee.modelViewProjectionMatrix,oe=[nn(h.getNorthWest()),nn(h.getNorthEast()),nn(h.getSouthWest()),nn(h.getSouthEast()),nn(new s.N(z,Q)),nn(new s.N(O,Q)),nn(new s.N(Y,U)),nn(new s.N(Y,K))],se=nn(v.center),ce=Number.POSITIVE_INFINITY;for(let le of oe)w<0&&(ce=Lr.getLesserNonNegativeNonNull(ce,Lr.solveVectorScale(le,se,ie,"x",w))),E>0&&(ce=Lr.getLesserNonNegativeNonNull(ce,Lr.solveVectorScale(le,se,ie,"x",E))),T>0&&(ce=Lr.getLesserNonNegativeNonNull(ce,Lr.solveVectorScale(le,se,ie,"y",T))),A<0&&(ce=Lr.getLesserNonNegativeNonNull(ce,Lr.solveVectorScale(le,se,ie,"y",A)));if(Number.isFinite(ce)&&ce!==0)return v.zoom=ee.zoom+s.a8(ce),v;Wr()}handleJumpToCenterZoom(e,o){let h=e.center.lat,f=e.getConstrained(o.center?s.N.convert(o.center):e.center,e.zoom).center;e.setCenter(f.wrap());let g=o.zoom!==void 0?+o.zoom:e.zoom+$n(h,f.lat);e.zoom!==g&&e.setZoom(g)}handleEaseTo(e,o){let h=e.zoom,f=e.center,g=e.padding,v={roll:e.roll,pitch:e.pitch,bearing:e.bearing},w={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},E=o.zoom!==void 0,T=!e.isPaddingEqual(o.padding),A=!1,R=o.center?s.N.convert(o.center):f,O=e.getConstrained(R,h).center;mr(e,O);let z=e.clone();z.setCenter(O),z.setZoom(E?+o.zoom:h+$n(f.lat,R.lat)),z.setBearing(o.bearing);let U=new s.P(s.ab(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),s.ab(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(O,U);let K=(o.offset&&o.offsetAsPoint.mag())>0?z.center:O,Y=E?+o.zoom:h+$n(f.lat,K.lat),Q=h+$n(f.lat,0),ee=Y+$n(K.lat,0),ie=s.bk(f.lng,K.lng),oe=s.bk(f.lat,K.lat),se=s.aG(ee-Q);return A=Y!==h,{easeFunc:ce=>{if(s.b3(v,w)||gd({startEulerAngles:v,endEulerAngles:w,tr:e,k:ce,useSlerp:v.roll!=w.roll}),T&&e.interpolatePadding(g,o.padding,ce),o.around)s.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(o.around,o.aroundPoint);else{let le=ee>Q?Math.min(2,se):Math.max(.5,se),ye=Math.pow(le,1-ce),ve=qf(f,ie,oe,ce*ye);e.setCenter(ve.wrap())}if(A){let le=s.y.number(Q,ee,ce)+$n(0,e.center.lat);e.setZoom(le)}},isZooming:A,elevationCenter:K}}handleFlyTo(e,o){let h=o.zoom!==void 0,f=e.center,g=e.zoom,v=!e.isPaddingEqual(o.padding),w=e.getConstrained(s.N.convert(o.center||o.locationAtOffset),g).center,E=h?+o.zoom:e.zoom+$n(e.center.lat,w.lat),T=e.clone();T.setCenter(w),v&&T.setPadding(o.padding),T.setZoom(E),T.setBearing(o.bearing);let A=new s.P(s.ab(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),s.ab(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));T.setLocationAtPoint(w,A);let R=T.center;mr(e,R);let O=function(ie,oe,se){let ce=nn(oe),le=nn(se),ye=s.aS(ce,le),ve=Math.acos(ye),Se=Gf(ie);return ve/(2*Math.PI)*Se}(e,f,R),z=g+$n(f.lat,0),U=E+$n(R.lat,0),K=s.aG(U-z),Y;if(typeof o.minZoom=="number"){let ie=+o.minZoom+$n(R.lat,0),oe=Math.min(ie,z,U)+$n(0,R.lat),se=e.getConstrained(R,oe).zoom+$n(R.lat,0);Y=s.aG(se-z)}let Q=s.bk(f.lng,R.lng),ee=s.bk(f.lat,R.lat);return{easeFunc:(ie,oe,se,ce)=>{let le=qf(f,Q,ee,se),ye=ie===1?R:le;e.setCenter(ye.wrap());let ve=z+s.a8(oe);e.setZoom(ie===1?E:ve+$n(0,ye.lat))},scaleOfZoom:K,targetCenter:R,scaleOfMinZoom:Y,pixelPathLength:O}}static solveVectorScale(e,o,h,f,g){let v=f==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],w=[h[3],h[7],h[11],h[15]],E=e[0]*v[0]+e[1]*v[1]+e[2]*v[2],T=e[0]*w[0]+e[1]*w[1]+e[2]*w[2],A=o[0]*v[0]+o[1]*v[1]+o[2]*v[2],R=o[0]*w[0]+o[1]*w[1]+o[2]*w[2];return A+g*T===E+g*R||w[3]*(E-A)+v[3]*(R-T)+E*R==A*T?null:(A+v[3]-g*R-g*w[3])/(A-E-g*R+g*T)}static getLesserNonNegativeNonNull(e,o){return o!==null&&o>=0&&o<e?o:e}}class rl{constructor(e){this._globe=e,this._mercatorCameraHelper=new uc,this._verticalPerspectiveCameraHelper=new Lr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,o){return this.currentHelper.handlePanInertia(e,o)}handleMapControlsRollPitchBearingZoom(e,o){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,o)}handleMapControlsPan(e,o,h){this.currentHelper.handleMapControlsPan(e,o,h)}cameraForBoxAndBearing(e,o,h,f,g){return this.currentHelper.cameraForBoxAndBearing(e,o,h,f,g)}handleJumpToCenterZoom(e,o){this.currentHelper.handleJumpToCenterZoom(e,o)}handleEaseTo(e,o){return this.currentHelper.handleEaseTo(e,o)}handleFlyTo(e,o){return this.currentHelper.handleFlyTo(e,o)}}let Js=(m,e)=>s.t(m,e&&e.filter(o=>o.identifier!=="source.canvas")),xd=s.br();class Xr extends s.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(let h in this.sourceCaches){let f=this.sourceCaches[h].getSource().type;f!=="vector"&&f!=="geojson"||this.sourceCaches[h].reload()}},this.map=e,this.dispatcher=new Qo(Ko(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(h,f)=>this.getGlyphs(h,f)),this.dispatcher.registerMessageHandler("GI",(h,f)=>this.getImages(h,f)),this.imageManager=new $s,this.imageManager.setEventedParent(this),this.glyphManager=new dr(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Yo(256,512),this.crossTileSymbolIndex=new ds,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.bt()),Ki().on(is,this._rtlPluginLoaded),this.on("data",h=>{if(h.dataType!=="source"||h.sourceDataType!=="metadata")return;let f=this.sourceCaches[h.sourceId];if(!f)return;let g=f.getSource();if(g&&g.vectorLayerIds)for(let v in this._layers){let w=this._layers[v];w.source===g.id&&this._validateLayer(w)}})}loadURL(e,o={},h){this.fire(new s.k("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;let f=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;let g=this._loadStyleRequest;s.h(f,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,o,h)}).catch(v=>{this._loadStyleRequest=null,v&&!g.signal.aborted&&this.fire(new s.j(v))})}loadJSON(e,o={},h){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,W.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,h)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(xd,{validate:!1})}_load(e,o,h){var f,g;let v=o.transformStyle?o.transformStyle(h,e):e;if(!o.validate||!Js(this,s.u(v))){this._loaded=!0,this.stylesheet=v;for(let w in v.sources)this.addSource(w,v.sources[w],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Hs(this.stylesheet.light),this._setProjectionInternal(((f=this.stylesheet.projection)===null||f===void 0?void 0:f.type)||"mercator"),this.sky=new Xo(this.stylesheet.sky),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){let e=s.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(o=>o.id),this._layers={},this._serializedLayers=null;for(let o of e){let h=s.bv(o);h.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=h}}_loadSprite(e,o=!1,h=void 0){let f;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(g,v,w,E){return s._(this,void 0,void 0,function*(){let T=_t(g),A=w>1?"@2x":"",R={},O={};for(let{id:z,url:U}of T){let K=v.transformRequest(dt(U,A,".json"),"SpriteJSON");R[z]=s.h(K,E);let Y=v.transformRequest(dt(U,A,".png"),"SpriteImage");O[z]=gt.getImage(Y,E)}return yield Promise.all([...Object.values(R),...Object.values(O)]),function(z,U){return s._(this,void 0,void 0,function*(){let K={};for(let Y in z){K[Y]={};let Q=W.getImageCanvasContext((yield U[Y]).data),ee=(yield z[Y]).data;for(let ie in ee){let{width:oe,height:se,x:ce,y:le,sdf:ye,pixelRatio:ve,stretchX:Se,stretchY:Re,content:Ee,textFitWidth:Ue,textFitHeight:je}=ee[ie];K[Y][ie]={data:null,pixelRatio:ve,sdf:ye,stretchX:Se,stretchY:Re,content:Ee,textFitWidth:Ue,textFitHeight:je,spriteData:{width:oe,height:se,x:ce,y:le,context:Q}}}}return K})}(R,O)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(g=>{if(this._spriteRequest=null,g)for(let v in g){this._spritesImagesIds[v]=[];let w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(E=>!(E in g)):[];for(let E of w)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(let E in g[v]){let T=v==="default"?E:`${v}:${E}`;this._spritesImagesIds[v].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,g[v][E],!1):this.imageManager.addImage(T,g[v][E]),o&&(this._changedImages[T]=!0)}}}).catch(g=>{this._spriteRequest=null,f=g,this.fire(new s.j(f))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),h&&h(f)})}_unloadSprite(){for(let e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(e){let o=this.sourceCaches[e.source];if(!o)return;let h=e.sourceLayer;if(!h)return;let f=o.getSource();(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(h)===-1)&&this.fire(new s.j(new Error(`Source layer "${h}" does not exist on source "${f.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){let h=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?s.bw(h):h);let f=[];for(let g of e)if(h[g]){let v=o?s.bw(h[g]):h[g];f.push(v)}return f}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};let o=Object.keys(this._layers);for(let h of o){let f=this._layers[h];f.type!=="custom"&&(e[h]=f.serialize())}return e}hasTransitions(){var e,o,h;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((o=this.sky)===null||o===void 0)&&o.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(let f in this.sourceCaches)if(this.sourceCaches[f].hasTransition())return!0;for(let f in this._layers)if(this._layers[f].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;let o=this._changed;if(o){let f=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(f.length||g.length)&&this._updateWorkerLayers(f,g);for(let v in this._updatedSources){let w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(let v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}let h={};for(let f in this.sourceCaches){let g=this.sourceCaches[f];h[f]=g.used,g.used=!1}for(let f of this._order){let g=this._layers[f];g.recalculate(e,this._availableImages),!g.isHidden(e.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(let f in h){let g=this.sourceCaches[f];!!h[f]!=!!g.used&&g.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:f}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,o&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=Object.keys(this._changedImages);if(e.length){for(let o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(let e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var h;this._checkLoaded();let f=this.serialize();if(e=o.transformStyle?o.transformStyle(f,e):e,((h=o.validate)===null||h===void 0||h)&&Js(this,s.u(e)))return!1;(e=s.bw(e)).layers=s.bu(e.layers);let g=s.bx(f,e),v=this._getOperationsToPerform(g);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(let w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){let o=[],h=[];for(let f of e)switch(f.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":o.push(()=>this.addLayer.apply(this,f.args));break;case"removeLayer":o.push(()=>this.removeLayer.apply(this,f.args));break;case"setPaintProperty":o.push(()=>this.setPaintProperty.apply(this,f.args));break;case"setLayoutProperty":o.push(()=>this.setLayoutProperty.apply(this,f.args));break;case"setFilter":o.push(()=>this.setFilter.apply(this,f.args));break;case"addSource":o.push(()=>this.addSource.apply(this,f.args));break;case"removeSource":o.push(()=>this.removeSource.apply(this,f.args));break;case"setLayerZoomRange":o.push(()=>this.setLayerZoomRange.apply(this,f.args));break;case"setLight":o.push(()=>this.setLight.apply(this,f.args));break;case"setGeoJSONSourceData":o.push(()=>this.setGeoJSONSourceData.apply(this,f.args));break;case"setGlyphs":o.push(()=>this.setGlyphs.apply(this,f.args));break;case"setSprite":o.push(()=>this.setSprite.apply(this,f.args));break;case"setTerrain":o.push(()=>this.map.setTerrain.apply(this,f.args));break;case"setSky":o.push(()=>this.setSky.apply(this,f.args));break;case"setProjection":this.setProjection.apply(this,f.args);break;case"setTransition":o.push(()=>{});break;default:h.push(f.command)}return{operations:o,unimplemented:h}}addImage(e,o){if(this.getImage(e))return this.fire(new s.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new s.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,h={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(s.u.source,`sources.${e}`,o,null,h))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);let f=this.sourceCaches[e]=new V(e,o,this.dispatcher);f.style=this,f.setEventedParent(this,()=>({isSourceLoaded:f.loaded(),source:f.serialize(),sourceId:e})),f.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(let h in this._layers)if(this._layers[h].source===e)return this.fire(new s.j(new Error(`Source "${e}" cannot be removed while layer "${h}" is using it.`)));let o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);let h=this.sourceCaches[e].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,h={}){this._checkLoaded();let f=e.id;if(this.getLayer(f))return void this.fire(new s.j(new Error(`Layer "${f}" already exists on this map.`)));let g;if(e.type==="custom"){if(Js(this,s.by(e)))return;g=s.bv(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(f,e.source),e=s.bw(e),e=s.e(e,{source:f})),this._validate(s.u.layer,`layers.${f}`,e,{arrayIndex:-1},h))return;g=s.bv(e),this._validateLayer(g),g.setEventedParent(this,{layer:{id:f}})}let v=o?this._order.indexOf(o):this._order.length;if(o&&v===-1)this.fire(new s.j(new Error(`Cannot add layer "${f}" before non-existing layer "${o}".`)));else{if(this._order.splice(v,0,f),this._layerOrderChanged=!0,this._layers[f]=g,this._removedLayers[f]&&g.source&&g.type!=="custom"){let w=this._removedLayers[f];delete this._removedLayers[f],w.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new s.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;let h=this._order.indexOf(e);this._order.splice(h,1);let f=o?this._order.indexOf(o):this._order.length;o&&f===-1?this.fire(new s.j(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(f,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();let o=this._layers[e];if(!o)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);let h=this._order.indexOf(e);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,h){this._checkLoaded();let f=this.getLayer(e);f?f.minzoom===o&&f.maxzoom===h||(o!=null&&(f.minzoom=o),h!=null&&(f.maxzoom=h),this._updateLayer(f)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,h={}){this._checkLoaded();let f=this.getLayer(e);if(f){if(!s.bz(f.filter,o))return o==null?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(s.u.filter,`layers.${f.id}.filter`,o,null,h)||(f.filter=s.bw(o),this._updateLayer(f)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return s.bw(this.getLayer(e).filter)}setLayoutProperty(e,o,h,f={}){this._checkLoaded();let g=this.getLayer(e);g?s.bz(g.getLayoutProperty(o),h)||(g.setLayoutProperty(o,h,f),this._updateLayer(g)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){let h=this.getLayer(e);if(h)return h.getLayoutProperty(o);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,h,f={}){this._checkLoaded();let g=this.getLayer(e);g?s.bz(g.getPaintProperty(o),h)||(g.setPaintProperty(o,h,f)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();let h=e.source,f=e.sourceLayer,g=this.sourceCaches[h];if(g===void 0)return void this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)));let v=g.getSource().type;v==="geojson"&&f?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||f?(e.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),g.setFeatureState(f,e.id,o)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();let h=e.source,f=this.sourceCaches[h];if(f===void 0)return void this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)));let g=f.getSource().type,v=g==="vector"?e.sourceLayer:void 0;g!=="vector"||v?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):f.removeFeatureState(v,e.id,o):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();let o=e.source,h=e.sourceLayer,f=this.sourceCaches[o];if(f!==void 0)return f.getSource().type!=="vector"||h?(e.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),f.getFeatureState(h,e.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;let e=s.bA(this.sourceCaches,g=>g.serialize()),o=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,f=this.stylesheet;return s.bB({version:f.version,name:f.name,metadata:f.metadata,light:f.light,sky:f.sky,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,projection:f.projection,sources:e,layers:o,terrain:h},g=>g!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){let o=v=>this._layers[v].type==="fill-extrusion",h={},f=[];for(let v=this._order.length-1;v>=0;v--){let w=this._order[v];if(o(w)){h[w]=v;for(let E of e){let T=E[w];if(T)for(let A of T)f.push(A)}}}f.sort((v,w)=>w.intersectionZ-v.intersectionZ);let g=[];for(let v=this._order.length-1;v>=0;v--){let w=this._order[v];if(o(w))for(let E=f.length-1;E>=0;E--){let T=f[E].feature;if(h[T.layer.id]<v)break;g.push(T),f.pop()}else for(let E of e){let T=E[w];if(T)for(let A of T)g.push(A.feature)}}return g}queryRenderedFeatures(e,o,h){o&&o.filter&&this._validate(s.u.filter,"queryRenderedFeatures.filter",o.filter,null,o);let f={};if(o&&o.layers){if(!(Array.isArray(o.layers)||o.layers instanceof Set))return this.fire(new s.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(let T of o.layers){let A=this._layers[T];if(!A)return this.fire(new s.j(new Error(`The layer '${T}' does not exist in the map's style and cannot be queried for features.`))),[];f[A.source]=!0}}let g=[];o.availableImages=this._availableImages;let v=this._serializedAllLayers(),w=o.layers instanceof Set?o.layers:Array.isArray(o.layers)?new Set(o.layers):null,E=Object.assign(Object.assign({},o),{layers:w});for(let T in this.sourceCaches)o.layers&&!f[T]||g.push(qa(this.sourceCaches[T],this._layers,v,e,E,h));return this.placement&&g.push(function(T,A,R,O,z,U,K){let Y={},Q=U.queryRenderedSymbols(O),ee=[];for(let ie of Object.keys(Q).map(Number))ee.push(K[ie]);ee.sort(hr);for(let ie of ee){let oe=ie.featureIndex.lookupSymbolFeatures(Q[ie.bucketInstanceId],A,ie.bucketIndex,ie.sourceLayerIndex,z.filter,z.layers,z.availableImages,T);for(let se in oe){let ce=Y[se]=Y[se]||[],le=oe[se];le.sort((ye,ve)=>{let Se=ie.featureSortOrder;if(Se){let Re=Se.indexOf(ye.featureIndex);return Se.indexOf(ve.featureIndex)-Re}return ve.featureIndex-ye.featureIndex});for(let ye of le)ce.push(ye)}}return function(ie,oe,se){for(let ce in ie)for(let le of ie[ce])jn(le,se[oe[ce].source]);return ie}(Y,T,R)}(this._layers,v,this.sourceCaches,e,E,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(e,o){o&&o.filter&&this._validate(s.u.filter,"querySourceFeatures.filter",o.filter,null,o);let h=this.sourceCaches[e];return h?function(f,g){let v=f.getRenderableIds().map(T=>f.getTileByID(T)),w=[],E={};for(let T=0;T<v.length;T++){let A=v[T],R=A.tileID.canonical.key;E[R]||(E[R]=!0,A.querySourceFeatures(w,g))}return w}(h,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();let h=this.light.getLight(),f=!1;for(let v in e)if(!s.bz(e[v],h[v])){f=!0;break}if(!f)return;let g={now:W.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(g)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){this._checkLoaded();let h=this.getSky(),f=!1;if(!e&&!h)return;if(e&&!h)f=!0;else if(!e&&h)f=!0;else for(let v in e)if(!s.bz(e[v],h[v])){f=!0;break}if(!f)return;let g={now:W.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(g)}_setProjectionInternal(e){let o=function(h){if(Array.isArray(h)){let f=new _d({type:h});return{projection:f,transform:new ms,cameraHelper:new rl(f)}}switch(h){case"mercator":return{projection:new Ya,transform:new Qi,cameraHelper:new uc};case"globe":{let f=new _d({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:f,transform:new ms,cameraHelper:new rl(f)}}case"vertical-perspective":return{projection:new Hf,transform:new hc,cameraHelper:new Lr};default:return s.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new Ya,transform:new Qi,cameraHelper:new uc}}}(e);this.projection=o.projection,this.map.migrateProjection(o.transform,o.cameraHelper);for(let h in this.sourceCaches)this.sourceCaches[h].reload()}_validate(e,o,h,f,g={}){return(!g||g.validate!==!1)&&Js(this,e.call(s.u,s.e({key:o,style:this.serialize(),value:h,styleSpec:s.v},f)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ki().off(is,this._rtlPluginLoaded);for(let o in this._layers)this._layers[o].setEventedParent(null);for(let o in this.sourceCaches){let h=this.sourceCaches[o];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(let o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(let e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,h,f,g=!1){let v=!1,w=!1,E={};for(let T of this._order){let A=this._layers[T];if(A.type!=="symbol")continue;if(!E[A.source]){let O=this.sourceCaches[A.source];E[A.source]=O.getRenderableIds(!0).map(z=>O.getTileByID(z)).sort((z,U)=>U.tileID.overscaledZ-z.tileID.overscaledZ||(z.tileID.isLessThan(U.tileID)?-1:1))}let R=this.crossTileSymbolIndex.addLayer(A,E[A.source],e.center.lng);v=v||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(W.now(),e.zoom))&&(this.pauseablePlacement=new Vf(e,this.map.terrain,this._order,g,o,h,f,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(W.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(let T of this._order){let A=this._layers[T];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(W.now())}_releaseSymbolFadeTiles(){for(let e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return s._(this,void 0,void 0,function*(){let h=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();let f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,o.icons),h})}getGlyphs(e,o){return s._(this,void 0,void 0,function*(){let h=yield this.glyphManager.getGlyphs(o.stacks),f=this.sourceCaches[o.source];return f&&f.setDependencies(o.tileID.key,o.type,[""]),h})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(s.u.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,h={},f){this._checkLoaded();let g=[{id:e,url:o}],v=[..._t(this.stylesheet.sprite),...g];this._validate(s.u.sprite,"sprite",v,null,h)||(this.stylesheet.sprite=v,this._loadSprite(g,!0,f))}removeSprite(e){this._checkLoaded();let o=_t(this.stylesheet.sprite);if(o.find(h=>h.id===e)){if(this._spritesImagesIds[e])for(let h of this._spritesImagesIds[e])this.imageManager.removeImage(h),this._changedImages[h]=!0;o.splice(o.findIndex(h=>h.id===e),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return _t(this.stylesheet.sprite)}setSprite(e,o={},h){this._checkLoaded(),e&&this._validate(s.u.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,h):(this._unloadSprite(),h&&h(null)))}}var qy=s.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class wd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,h,f,g,v,w,E,T){this.context=e;let A=this.boundPaintVertexBuffers.length!==f.length;for(let R=0;!A&&R<f.length;R++)this.boundPaintVertexBuffers[R]!==f[R]&&(A=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==h||A||this.boundIndexBuffer!==g||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==T?this.freshBind(o,h,f,g,v,w,E,T):(e.bindVertexArray.set(this.vao),w&&w.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),T&&T.bind())}freshBind(e,o,h,f,g,v,w,E){let T=e.numAttributes,A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.createVertexArray(),A.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=f,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=E,o.enableAttributes(R,e);for(let O of h)O.enableAttributes(R,e);v&&v.enableAttributes(R,e),w&&w.enableAttributes(R,e),E&&E.enableAttributes(R,e),o.bind(),o.setVertexAttribPointers(R,e,g);for(let O of h)O.bind(),O.setVertexAttribPointers(R,e,g);v&&(v.bind(),v.setVertexAttribPointers(R,e,g)),f&&f.bind(),w&&(w.bind(),w.setVertexAttribPointers(R,e,g)),E&&(E.bind(),E.setVertexAttribPointers(R,e,g)),A.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}let il=(m,e,o,h,f)=>({u_texture:0,u_ele_delta:m,u_fog_matrix:e,u_fog_color:o?o.properties.get("fog-color"):s.b4.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:f?0:o?o.calculateFogBlendOpacity(h):0,u_horizon_color:o?o.properties.get("horizon-color"):s.b4.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1,u_is_globe_mode:f?1:0}),ol={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function fc(m){let e=[];for(let o=0;o<m.length;o++){if(m[o]===null)continue;let h=m[o].split(" ");e.push(h.pop())}return e}class pc{constructor(e,o,h,f,g,v,w,E){let T=e.gl;this.program=T.createProgram();let A=fc(o.staticAttributes),R=h?h.getBinderAttributes():[],O=A.concat(R),z=Ni.prelude.staticUniforms?fc(Ni.prelude.staticUniforms):[],U=w.staticUniforms?fc(w.staticUniforms):[],K=o.staticUniforms?fc(o.staticUniforms):[],Y=h?h.getBinderUniforms():[],Q=z.concat(U).concat(K).concat(Y),ee=[];for(let ve of Q)ee.indexOf(ve)<0&&ee.push(ve);let ie=h?h.defines():[];mi(T)&&ie.unshift("#version 300 es"),g&&ie.push("#define OVERDRAW_INSPECTOR;"),v&&ie.push("#define TERRAIN3D;"),E&&ie.push(E);let oe=ie.concat(Ni.prelude.fragmentSource,w.fragmentSource,o.fragmentSource).join(`
`),se=ie.concat(Ni.prelude.vertexSource,w.vertexSource,o.vertexSource).join(`
`);mi(T)||(oe=function(ve){return ve.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(oe),se=function(ve){return ve.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(se));let ce=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(ce,oe),T.compileShader(ce),!T.getShaderParameter(ce,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(ce)}`);T.attachShader(this.program,ce);let le=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(le,se),T.compileShader(le),!T.getShaderParameter(le,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(le)}`);T.attachShader(this.program,le),this.attributes={};let ye={};this.numAttributes=O.length;for(let ve=0;ve<this.numAttributes;ve++)O[ve]&&(T.bindAttribLocation(this.program,ve,O[ve]),this.attributes[O[ve]]=ve);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(le),T.deleteShader(ce);for(let ve=0;ve<ee.length;ve++){let Se=ee[ve];if(Se&&!ye[Se]){let Re=T.getUniformLocation(this.program,Se);Re&&(ye[Se]=Re)}}this.fixedUniforms=f(e,ye),this.terrainUniforms=((ve,Se)=>({u_depth:new s.bC(ve,Se.u_depth),u_terrain:new s.bC(ve,Se.u_terrain),u_terrain_dim:new s.b5(ve,Se.u_terrain_dim),u_terrain_matrix:new s.bD(ve,Se.u_terrain_matrix),u_terrain_unpack:new s.bE(ve,Se.u_terrain_unpack),u_terrain_exaggeration:new s.b5(ve,Se.u_terrain_exaggeration)}))(e,ye),this.projectionUniforms=((ve,Se)=>({u_projection_matrix:new s.bD(ve,Se.u_projection_matrix),u_projection_tile_mercator_coords:new s.bE(ve,Se.u_projection_tile_mercator_coords),u_projection_clipping_plane:new s.bE(ve,Se.u_projection_clipping_plane),u_projection_transition:new s.b5(ve,Se.u_projection_transition),u_projection_fallback_matrix:new s.bD(ve,Se.u_projection_fallback_matrix)}))(e,ye),this.binderUniforms=h?h.getUniforms(e,ye):[]}draw(e,o,h,f,g,v,w,E,T,A,R,O,z,U,K,Y,Q,ee,ie){let oe=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(h),e.setStencilMode(f),e.setColorMode(g),e.setCullFace(v),E){e.activeTexture.set(oe.TEXTURE2),oe.bindTexture(oe.TEXTURE_2D,E.depthTexture),e.activeTexture.set(oe.TEXTURE3),oe.bindTexture(oe.TEXTURE_2D,E.texture);for(let ce in this.terrainUniforms)this.terrainUniforms[ce].set(E[ce])}if(T)for(let ce in T)this.projectionUniforms[ol[ce]].set(T[ce]);if(w)for(let ce in this.fixedUniforms)this.fixedUniforms[ce].set(w[ce]);Y&&Y.setUniforms(e,this.binderUniforms,U,{zoom:K});let se=0;switch(o){case oe.LINES:se=2;break;case oe.TRIANGLES:se=3;break;case oe.LINE_STRIP:se=1}for(let ce of z.get()){let le=ce.vaos||(ce.vaos={});(le[A]||(le[A]=new wd)).bind(e,this,R,Y?Y.getPaintVertexBuffers():[],O,ce.vertexOffset,Q,ee,ie),oe.drawElements(o,ce.primitiveLength*se,oe.UNSIGNED_SHORT,ce.primitiveOffset*se*2)}}}function Zf(m,e,o){let h=1/s.at(o,1,e.transform.tileZoom),f=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,e.transform.tileZoom)/f,v=g*(o.tileID.canonical.x+o.tileID.wrap*f),w=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}let gs=(m,e,o,h)=>{let f=m.style.light,g=f.properties.get("position"),v=[g.x,g.y,g.z],w=s.bI();f.properties.get("anchor")==="viewport"&&s.bJ(w,m.transform.bearingInRadians),s.bK(v,v,w);let E=m.transform.transformLightDirection(v),T=f.properties.get("color");return{u_lightpos:v,u_lightpos_globe:E,u_lightintensity:f.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+e,u_opacity:o,u_fill_translate:h}},Zy=(m,e,o,h,f,g,v)=>s.e(gs(m,e,o,h),Zf(g,m,v),{u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8}),Cd=(m,e,o,h)=>s.e(Zf(e,m,o),{u_fill_translate:h}),Wy=(m,e)=>({u_world:m,u_fill_translate:e}),Wf=(m,e,o,h,f)=>s.e(Cd(m,e,o,f),{u_world:h}),Ed=(m,e,o,h,f)=>{let g=m.transform,v,w,E=0;if(o.paint.get("circle-pitch-alignment")==="map"){let T=s.at(e,1,g.zoom);v=!0,w=[T,T],E=T/(s.X*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*f}else v=!1,w=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+v,u_device_pixel_ratio:m.pixelRatio,u_extrude_scale:w,u_globe_extrude_scale:E,u_translate:h}},Xf=m=>({u_pixel_extrude_scale:[1/m.width,1/m.height]}),Yf=m=>({u_viewport_size:[m.width,m.height]}),Id=(m,e=1)=>({u_color:m,u_overlay:0,u_overlay_scale:e}),Td=(m,e,o,h)=>{let f=s.at(m,1,e)/(s.X*Math.pow(2,m.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:s.at(m,1,e),u_intensity:o,u_globe_extrude_scale:f}},So=(m,e,o,h)=>{let f=s.H();s.bL(f,0,m.width,m.height,0,0,1);let g=m.context.gl;return{u_matrix:f,u_world:[g.drawingBufferWidth,g.drawingBufferHeight],u_image:o,u_color_ramp:h,u_opacity:e.paint.get("heatmap-opacity")}},Kf=(m,e,o)=>{let h=o.paint.get("hillshade-shadow-color"),f=o.paint.get("hillshade-highlight-color"),g=o.paint.get("hillshade-accent-color"),v=o.paint.get("hillshade-illumination-direction")*(Math.PI/180);return o.paint.get("hillshade-illumination-anchor")==="viewport"&&(v+=m.transform.bearingInRadians),{u_image:0,u_latrange:sl(0,e.tileID),u_light:[o.paint.get("hillshade-exaggeration"),v],u_shadow:h,u_highlight:f,u_accent:g}},Qf=(m,e)=>{let o=e.stride,h=s.H();return s.bL(h,0,s.X,-8192,0,0,1),s.J(h,h,[0,-8192,0]),{u_matrix:h,u_image:1,u_dimension:[o,o],u_zoom:m.overscaledZ,u_unpack:e.getUnpackVector()}};function sl(m,e){let o=Math.pow(2,e.canonical.z),h=e.canonical.y;return[new s.Y(0,h/o).toLngLat().lat,new s.Y(0,(h+1)/o).toLngLat().lat]}let Md=(m,e,o,h)=>{let f=m.transform;return{u_translation:Sd(m,e,o),u_ratio:h/s.at(e,1,f.zoom),u_device_pixel_ratio:m.pixelRatio,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},mc=(m,e,o,h,f)=>s.e(Md(m,e,o,h),{u_image:0,u_image_height:f}),Xy=(m,e,o,h,f)=>{let g=m.transform,v=Dd(e,g);return{u_translation:Sd(m,e,o),u_texsize:e.imageAtlasTexture.size,u_ratio:h/s.at(e,1,g.zoom),u_device_pixel_ratio:m.pixelRatio,u_image:0,u_scale:[v,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Yy=(m,e,o,h,f,g)=>{let v=m.lineAtlas,w=Dd(e,m.transform),E=o.layout.get("line-cap")==="round",T=v.getDash(f.from,E),A=v.getDash(f.to,E),R=T.width*g.fromScale,O=A.width*g.toScale;return s.e(Md(m,e,o,h),{u_patternscale_a:[w/R,-T.height/2],u_patternscale_b:[w/O,-A.height/2],u_sdfgamma:v.width/(256*Math.min(R,O)*m.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:A.y,u_mix:g.t})};function Dd(m,e){return 1/s.at(m,1,e.tileZoom)}function Sd(m,e,o){return s.au(m.transform,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}let Jf=(m,e,o,h,f)=>{return{u_tl_parent:m,u_scale_parent:e,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(v=h.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(g=h.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Pd(h.paint.get("raster-hue-rotate")),u_coords_top:[f[0].x,f[0].y,f[1].x,f[1].y],u_coords_bottom:[f[3].x,f[3].y,f[2].x,f[2].y]};var g,v};function Pd(m){m*=Math.PI/180;let e=Math.sin(m),o=Math.cos(m);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}let Ad=(m,e,o,h,f,g,v,w,E,T,A,R,O)=>{let z=v.transform;return{u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:z.cameraToCenterDistance,u_pitch:z.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:z.width/z.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_label_plane_matrix:w,u_coord_matrix:E,u_is_text:+A,u_pitch_with_map:+h,u_is_along_line:f,u_is_variable_anchor:g,u_texsize:R,u_texture:0,u_translation:T,u_pitched_scale:O}},al=(m,e,o,h,f,g,v,w,E,T,A,R,O,z)=>{let U=v.transform;return s.e(Ad(m,e,o,h,f,g,v,w,E,T,A,R,z),{u_gamma_scale:h?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},eo=(m,e,o,h,f,g,v,w,E,T,A,R,O)=>s.e(al(m,e,o,h,f,g,v,w,E,T,!0,A,0,O),{u_texsize_icon:R,u_texture_icon:1}),Rd=(m,e)=>({u_opacity:m,u_color:e}),kd=(m,e,o,h,f)=>s.e(function(g,v,w,E){let T=w.imageManager.getPattern(g.from.toString()),A=w.imageManager.getPattern(g.to.toString()),{width:R,height:O}=w.imageManager.getPixelSize(),z=Math.pow(2,E.tileID.overscaledZ),U=E.tileSize*Math.pow(2,w.transform.tileZoom)/z,K=U*(E.tileID.canonical.x+E.tileID.wrap*z),Y=U*E.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:T.tl,u_pattern_br_a:T.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[R,O],u_mix:v.t,u_pattern_size_a:T.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:v.fromScale,u_scale_b:v.toScale,u_tile_units_to_pixels:1/s.at(E,1,w.transform.tileZoom),u_pixel_coord_upper:[K>>16,Y>>16],u_pixel_coord_lower:[65535&K,65535&Y]}}(o,f,e,h),{u_opacity:m}),gc=(m,e)=>{},ep={fillExtrusion:(m,e)=>({u_lightpos:new s.bG(m,e.u_lightpos),u_lightpos_globe:new s.bG(m,e.u_lightpos_globe),u_lightintensity:new s.b5(m,e.u_lightintensity),u_lightcolor:new s.bG(m,e.u_lightcolor),u_vertical_gradient:new s.b5(m,e.u_vertical_gradient),u_opacity:new s.b5(m,e.u_opacity),u_fill_translate:new s.bH(m,e.u_fill_translate)}),fillExtrusionPattern:(m,e)=>({u_lightpos:new s.bG(m,e.u_lightpos),u_lightpos_globe:new s.bG(m,e.u_lightpos_globe),u_lightintensity:new s.b5(m,e.u_lightintensity),u_lightcolor:new s.bG(m,e.u_lightcolor),u_vertical_gradient:new s.b5(m,e.u_vertical_gradient),u_height_factor:new s.b5(m,e.u_height_factor),u_opacity:new s.b5(m,e.u_opacity),u_fill_translate:new s.bH(m,e.u_fill_translate),u_image:new s.bC(m,e.u_image),u_texsize:new s.bH(m,e.u_texsize),u_pixel_coord_upper:new s.bH(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bH(m,e.u_pixel_coord_lower),u_scale:new s.bG(m,e.u_scale),u_fade:new s.b5(m,e.u_fade)}),fill:(m,e)=>({u_fill_translate:new s.bH(m,e.u_fill_translate)}),fillPattern:(m,e)=>({u_image:new s.bC(m,e.u_image),u_texsize:new s.bH(m,e.u_texsize),u_pixel_coord_upper:new s.bH(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bH(m,e.u_pixel_coord_lower),u_scale:new s.bG(m,e.u_scale),u_fade:new s.b5(m,e.u_fade),u_fill_translate:new s.bH(m,e.u_fill_translate)}),fillOutline:(m,e)=>({u_world:new s.bH(m,e.u_world),u_fill_translate:new s.bH(m,e.u_fill_translate)}),fillOutlinePattern:(m,e)=>({u_world:new s.bH(m,e.u_world),u_image:new s.bC(m,e.u_image),u_texsize:new s.bH(m,e.u_texsize),u_pixel_coord_upper:new s.bH(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bH(m,e.u_pixel_coord_lower),u_scale:new s.bG(m,e.u_scale),u_fade:new s.b5(m,e.u_fade),u_fill_translate:new s.bH(m,e.u_fill_translate)}),circle:(m,e)=>({u_camera_to_center_distance:new s.b5(m,e.u_camera_to_center_distance),u_scale_with_map:new s.bC(m,e.u_scale_with_map),u_pitch_with_map:new s.bC(m,e.u_pitch_with_map),u_extrude_scale:new s.bH(m,e.u_extrude_scale),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_globe_extrude_scale:new s.b5(m,e.u_globe_extrude_scale),u_translate:new s.bH(m,e.u_translate)}),collisionBox:(m,e)=>({u_pixel_extrude_scale:new s.bH(m,e.u_pixel_extrude_scale)}),collisionCircle:(m,e)=>({u_viewport_size:new s.bH(m,e.u_viewport_size)}),debug:(m,e)=>({u_color:new s.bF(m,e.u_color),u_overlay:new s.bC(m,e.u_overlay),u_overlay_scale:new s.b5(m,e.u_overlay_scale)}),depth:gc,clippingMask:gc,heatmap:(m,e)=>({u_extrude_scale:new s.b5(m,e.u_extrude_scale),u_intensity:new s.b5(m,e.u_intensity),u_globe_extrude_scale:new s.b5(m,e.u_globe_extrude_scale)}),heatmapTexture:(m,e)=>({u_matrix:new s.bD(m,e.u_matrix),u_world:new s.bH(m,e.u_world),u_image:new s.bC(m,e.u_image),u_color_ramp:new s.bC(m,e.u_color_ramp),u_opacity:new s.b5(m,e.u_opacity)}),hillshade:(m,e)=>({u_image:new s.bC(m,e.u_image),u_latrange:new s.bH(m,e.u_latrange),u_light:new s.bH(m,e.u_light),u_shadow:new s.bF(m,e.u_shadow),u_highlight:new s.bF(m,e.u_highlight),u_accent:new s.bF(m,e.u_accent)}),hillshadePrepare:(m,e)=>({u_matrix:new s.bD(m,e.u_matrix),u_image:new s.bC(m,e.u_image),u_dimension:new s.bH(m,e.u_dimension),u_zoom:new s.b5(m,e.u_zoom),u_unpack:new s.bE(m,e.u_unpack)}),line:(m,e)=>({u_translation:new s.bH(m,e.u_translation),u_ratio:new s.b5(m,e.u_ratio),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bH(m,e.u_units_to_pixels)}),lineGradient:(m,e)=>({u_translation:new s.bH(m,e.u_translation),u_ratio:new s.b5(m,e.u_ratio),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bH(m,e.u_units_to_pixels),u_image:new s.bC(m,e.u_image),u_image_height:new s.b5(m,e.u_image_height)}),linePattern:(m,e)=>({u_translation:new s.bH(m,e.u_translation),u_texsize:new s.bH(m,e.u_texsize),u_ratio:new s.b5(m,e.u_ratio),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_image:new s.bC(m,e.u_image),u_units_to_pixels:new s.bH(m,e.u_units_to_pixels),u_scale:new s.bG(m,e.u_scale),u_fade:new s.b5(m,e.u_fade)}),lineSDF:(m,e)=>({u_translation:new s.bH(m,e.u_translation),u_ratio:new s.b5(m,e.u_ratio),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_units_to_pixels:new s.bH(m,e.u_units_to_pixels),u_patternscale_a:new s.bH(m,e.u_patternscale_a),u_patternscale_b:new s.bH(m,e.u_patternscale_b),u_sdfgamma:new s.b5(m,e.u_sdfgamma),u_image:new s.bC(m,e.u_image),u_tex_y_a:new s.b5(m,e.u_tex_y_a),u_tex_y_b:new s.b5(m,e.u_tex_y_b),u_mix:new s.b5(m,e.u_mix)}),raster:(m,e)=>({u_tl_parent:new s.bH(m,e.u_tl_parent),u_scale_parent:new s.b5(m,e.u_scale_parent),u_buffer_scale:new s.b5(m,e.u_buffer_scale),u_fade_t:new s.b5(m,e.u_fade_t),u_opacity:new s.b5(m,e.u_opacity),u_image0:new s.bC(m,e.u_image0),u_image1:new s.bC(m,e.u_image1),u_brightness_low:new s.b5(m,e.u_brightness_low),u_brightness_high:new s.b5(m,e.u_brightness_high),u_saturation_factor:new s.b5(m,e.u_saturation_factor),u_contrast_factor:new s.b5(m,e.u_contrast_factor),u_spin_weights:new s.bG(m,e.u_spin_weights),u_coords_top:new s.bE(m,e.u_coords_top),u_coords_bottom:new s.bE(m,e.u_coords_bottom)}),symbolIcon:(m,e)=>({u_is_size_zoom_constant:new s.bC(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bC(m,e.u_is_size_feature_constant),u_size_t:new s.b5(m,e.u_size_t),u_size:new s.b5(m,e.u_size),u_camera_to_center_distance:new s.b5(m,e.u_camera_to_center_distance),u_pitch:new s.b5(m,e.u_pitch),u_rotate_symbol:new s.bC(m,e.u_rotate_symbol),u_aspect_ratio:new s.b5(m,e.u_aspect_ratio),u_fade_change:new s.b5(m,e.u_fade_change),u_label_plane_matrix:new s.bD(m,e.u_label_plane_matrix),u_coord_matrix:new s.bD(m,e.u_coord_matrix),u_is_text:new s.bC(m,e.u_is_text),u_pitch_with_map:new s.bC(m,e.u_pitch_with_map),u_is_along_line:new s.bC(m,e.u_is_along_line),u_is_variable_anchor:new s.bC(m,e.u_is_variable_anchor),u_texsize:new s.bH(m,e.u_texsize),u_texture:new s.bC(m,e.u_texture),u_translation:new s.bH(m,e.u_translation),u_pitched_scale:new s.b5(m,e.u_pitched_scale)}),symbolSDF:(m,e)=>({u_is_size_zoom_constant:new s.bC(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bC(m,e.u_is_size_feature_constant),u_size_t:new s.b5(m,e.u_size_t),u_size:new s.b5(m,e.u_size),u_camera_to_center_distance:new s.b5(m,e.u_camera_to_center_distance),u_pitch:new s.b5(m,e.u_pitch),u_rotate_symbol:new s.bC(m,e.u_rotate_symbol),u_aspect_ratio:new s.b5(m,e.u_aspect_ratio),u_fade_change:new s.b5(m,e.u_fade_change),u_label_plane_matrix:new s.bD(m,e.u_label_plane_matrix),u_coord_matrix:new s.bD(m,e.u_coord_matrix),u_is_text:new s.bC(m,e.u_is_text),u_pitch_with_map:new s.bC(m,e.u_pitch_with_map),u_is_along_line:new s.bC(m,e.u_is_along_line),u_is_variable_anchor:new s.bC(m,e.u_is_variable_anchor),u_texsize:new s.bH(m,e.u_texsize),u_texture:new s.bC(m,e.u_texture),u_gamma_scale:new s.b5(m,e.u_gamma_scale),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_is_halo:new s.bC(m,e.u_is_halo),u_translation:new s.bH(m,e.u_translation),u_pitched_scale:new s.b5(m,e.u_pitched_scale)}),symbolTextAndIcon:(m,e)=>({u_is_size_zoom_constant:new s.bC(m,e.u_is_size_zoom_constant),u_is_size_feature_constant:new s.bC(m,e.u_is_size_feature_constant),u_size_t:new s.b5(m,e.u_size_t),u_size:new s.b5(m,e.u_size),u_camera_to_center_distance:new s.b5(m,e.u_camera_to_center_distance),u_pitch:new s.b5(m,e.u_pitch),u_rotate_symbol:new s.bC(m,e.u_rotate_symbol),u_aspect_ratio:new s.b5(m,e.u_aspect_ratio),u_fade_change:new s.b5(m,e.u_fade_change),u_label_plane_matrix:new s.bD(m,e.u_label_plane_matrix),u_coord_matrix:new s.bD(m,e.u_coord_matrix),u_is_text:new s.bC(m,e.u_is_text),u_pitch_with_map:new s.bC(m,e.u_pitch_with_map),u_is_along_line:new s.bC(m,e.u_is_along_line),u_is_variable_anchor:new s.bC(m,e.u_is_variable_anchor),u_texsize:new s.bH(m,e.u_texsize),u_texsize_icon:new s.bH(m,e.u_texsize_icon),u_texture:new s.bC(m,e.u_texture),u_texture_icon:new s.bC(m,e.u_texture_icon),u_gamma_scale:new s.b5(m,e.u_gamma_scale),u_device_pixel_ratio:new s.b5(m,e.u_device_pixel_ratio),u_is_halo:new s.bC(m,e.u_is_halo),u_translation:new s.bH(m,e.u_translation),u_pitched_scale:new s.b5(m,e.u_pitched_scale)}),background:(m,e)=>({u_opacity:new s.b5(m,e.u_opacity),u_color:new s.bF(m,e.u_color)}),backgroundPattern:(m,e)=>({u_opacity:new s.b5(m,e.u_opacity),u_image:new s.bC(m,e.u_image),u_pattern_tl_a:new s.bH(m,e.u_pattern_tl_a),u_pattern_br_a:new s.bH(m,e.u_pattern_br_a),u_pattern_tl_b:new s.bH(m,e.u_pattern_tl_b),u_pattern_br_b:new s.bH(m,e.u_pattern_br_b),u_texsize:new s.bH(m,e.u_texsize),u_mix:new s.b5(m,e.u_mix),u_pattern_size_a:new s.bH(m,e.u_pattern_size_a),u_pattern_size_b:new s.bH(m,e.u_pattern_size_b),u_scale_a:new s.b5(m,e.u_scale_a),u_scale_b:new s.b5(m,e.u_scale_b),u_pixel_coord_upper:new s.bH(m,e.u_pixel_coord_upper),u_pixel_coord_lower:new s.bH(m,e.u_pixel_coord_lower),u_tile_units_to_pixels:new s.b5(m,e.u_tile_units_to_pixels)}),terrain:(m,e)=>({u_texture:new s.bC(m,e.u_texture),u_ele_delta:new s.b5(m,e.u_ele_delta),u_fog_matrix:new s.bD(m,e.u_fog_matrix),u_fog_color:new s.bF(m,e.u_fog_color),u_fog_ground_blend:new s.b5(m,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new s.b5(m,e.u_fog_ground_blend_opacity),u_horizon_color:new s.bF(m,e.u_horizon_color),u_horizon_fog_blend:new s.b5(m,e.u_horizon_fog_blend),u_is_globe_mode:new s.b5(m,e.u_is_globe_mode)}),terrainDepth:(m,e)=>({u_ele_delta:new s.b5(m,e.u_ele_delta)}),terrainCoords:(m,e)=>({u_texture:new s.bC(m,e.u_texture),u_terrain_coords_id:new s.b5(m,e.u_terrain_coords_id),u_ele_delta:new s.b5(m,e.u_ele_delta)}),projectionErrorMeasurement:(m,e)=>({u_input:new s.b5(m,e.u_input),u_output_expected:new s.b5(m,e.u_output_expected)}),atmosphere:(m,e)=>({u_sun_pos:new s.bG(m,e.u_sun_pos),u_atmosphere_blend:new s.b5(m,e.u_atmosphere_blend),u_globe_position:new s.bG(m,e.u_globe_position),u_globe_radius:new s.b5(m,e.u_globe_radius),u_inv_proj_matrix:new s.bD(m,e.u_inv_proj_matrix)}),sky:(m,e)=>({u_sky_color:new s.bF(m,e.u_sky_color),u_horizon_color:new s.bF(m,e.u_horizon_color),u_horizon:new s.bH(m,e.u_horizon),u_horizon_normal:new s.bH(m,e.u_horizon_normal),u_sky_horizon_blend:new s.b5(m,e.u_sky_horizon_blend),u_sky_blend:new s.b5(m,e.u_sky_blend)})};class Od{constructor(e,o,h){this.context=e;let f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){let o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}let ys={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Nd{constructor(e,o,h,f){this.length=o.length,this.attributes=h,this.itemSize=o.bytesPerElement,this.dynamicDraw=f,this.context=e;let g=e.gl;this.buffer=g.createBuffer(),e.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);let o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let h=0;h<this.attributes.length;h++){let f=o.attributes[this.attributes[h].name];f!==void 0&&e.enableVertexAttribArray(f)}}setVertexAttribPointers(e,o,h){for(let f=0;f<this.attributes.length;f++){let g=this.attributes[f],v=o.attributes[g.name];v!==void 0&&e.vertexAttribPointer(v,g.components,e[ys[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ut{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ky extends Ut{getDefault(){return s.b4.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Qy extends Ut{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Jy extends Ut{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class tp extends Ut{getDefault(){return[!0,!0,!0,!0]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class e_ extends Ut{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class np extends Ut{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class yc extends Ut{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class _c extends Ut{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class vc extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ld extends Ut{getDefault(){return[0,1]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class _s extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class ea extends Ut{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Yr extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class rp extends Ut{getDefault(){let e=this.gl;return[e.ONE,e.ZERO]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ip extends Ut{getDefault(){return s.b4.transparent}set(e){let o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Fd extends Ut{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class vs extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class bc extends Ut{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class xc extends Ut{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ll extends Ut{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class wc extends Ut{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class op extends Ut{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ta extends Ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class na extends Ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class sp extends Ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class zd extends Ut{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class jt extends Ut{getDefault(){return null}set(e){let o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Cc extends Ut{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;let h=this.gl;mi(h)?h.bindVertexArray(e):(o=h.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class t_ extends Ut{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class ap extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class cl extends Ut{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Bd extends Ut{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class n_ extends Bd{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class lp extends Bd{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class r_ extends Bd{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}let Ec="Framebuffer is not complete";class Ic{constructor(e,o,h,f,g){this.context=e,this.width=o,this.height=h;let v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new n_(e,w),f)this.depthAttachment=g?new r_(e,w):new lp(e,w);else if(g)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error(Ec)}destroy(){let e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){let h=this.depthAttachment.get();h&&e.deleteRenderbuffer(h)}e.deleteFramebuffer(this.framebuffer)}}class Tc{constructor(e){var o,h;if(this.gl=e,this.clearColor=new Ky(this),this.clearDepth=new Qy(this),this.clearStencil=new Jy(this),this.colorMask=new tp(this),this.depthMask=new e_(this),this.stencilMask=new np(this),this.stencilFunc=new yc(this),this.stencilOp=new _c(this),this.stencilTest=new vc(this),this.depthRange=new Ld(this),this.depthTest=new _s(this),this.depthFunc=new ea(this),this.blend=new Yr(this),this.blendFunc=new rp(this),this.blendColor=new ip(this),this.blendEquation=new Fd(this),this.cullFace=new vs(this),this.cullFaceSide=new bc(this),this.frontFace=new xc(this),this.program=new ll(this),this.activeTexture=new wc(this),this.viewport=new op(this),this.bindFramebuffer=new ta(this),this.bindRenderbuffer=new na(this),this.bindTexture=new sp(this),this.bindVertexBuffer=new zd(this),this.bindElementBuffer=new jt(this),this.bindVertexArray=new Cc(this),this.pixelStoreUnpack=new t_(this),this.pixelStoreUnpackPremultiplyAlpha=new ap(this),this.pixelStoreUnpackFlipY=new cl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),mi(e)){this.HALF_FLOAT=e.HALF_FLOAT;let f=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:f?.RGBA16F_EXT,this.RGB16F=(h=e.RGB16F)!==null&&h!==void 0?h:f?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");let f=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=f?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Od(this,e,o)}createVertexBuffer(e,o,h){return new Nd(this,e,o,h)}createRenderbuffer(e,o,h){let f=this.gl,g=f.createRenderbuffer();return this.bindRenderbuffer.set(g),f.renderbufferStorage(f.RENDERBUFFER,e,o,h),this.bindRenderbuffer.set(null),g}createFramebuffer(e,o,h,f){return new Ic(this,e,o,h,f)}clear({color:e,depth:o,stencil:h}){let f=this.gl,g=0;e&&(g|=f.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(g|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h!==void 0&&(g|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),f.clear(g)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){s.bz(e.blendFunction,cn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return mi(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return mi(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let ra;function Mc(m,e,o,h,f){let g=m.context,v=m.transform,w=g.gl,E=m.useProgram("collisionBox"),T=[],A=0,R=0;for(let Q=0;Q<h.length;Q++){let ee=h[Q],ie=e.getTile(ee).getBucket(o);if(!ie)continue;let oe=f?ie.textCollisionBox:ie.iconCollisionBox,se=ie.collisionCircleArray;se.length>0&&(T.push({circleArray:se,circleOffset:R,coord:ee}),A+=se.length/4,R=A),oe&&E.draw(g,w.LINES,vt.disabled,zt.disabled,m.colorModeForRenderPass(),Ot.disabled,Xf(m.transform),m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),v.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),o.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,null,m.transform.zoom,null,null,oe.collisionVertexBuffer)}if(!f||!T.length)return;let O=m.useProgram("collisionCircle"),z=new s.bM;z.resize(4*A),z._trim();let U=0;for(let Q of T)for(let ee=0;ee<Q.circleArray.length/4;ee++){let ie=4*ee,oe=Q.circleArray[ie+0],se=Q.circleArray[ie+1],ce=Q.circleArray[ie+2],le=Q.circleArray[ie+3];z.emplace(U++,oe,se,ce,le,0),z.emplace(U++,oe,se,ce,le,1),z.emplace(U++,oe,se,ce,le,2),z.emplace(U++,oe,se,ce,le,3)}(!ra||ra.length<2*A)&&(ra=function(Q){let ee=2*Q,ie=new s.bO;ie.resize(ee),ie._trim();for(let oe=0;oe<ee;oe++){let se=6*oe;ie.uint16[se+0]=4*oe+0,ie.uint16[se+1]=4*oe+1,ie.uint16[se+2]=4*oe+2,ie.uint16[se+3]=4*oe+2,ie.uint16[se+4]=4*oe+3,ie.uint16[se+5]=4*oe+0}return ie}(A));let K=g.createIndexBuffer(ra,!0),Y=g.createVertexBuffer(z,s.bN.members,!0);for(let Q of T){let ee=Yf(m.transform);O.draw(g,w.TRIANGLES,vt.disabled,zt.disabled,m.colorModeForRenderPass(),Ot.disabled,ee,m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q.coord),null,o.id,Y,K,s.aD.simpleSegment(0,2*Q.circleOffset,Q.circleArray.length,Q.circleArray.length/2),null,m.transform.zoom,null,null,null)}Y.destroy(),K.destroy()}let cp=s.aq(new Float32Array(16));function Dc(m,e,o,h,f,g){let{horizontalAlign:v,verticalAlign:w}=s.ay(m);return new s.P((-(v-.5)*e/f+h[0])*g,(-(w-.5)*o/f+h[1])*g)}function Sc(m,e,o,h,f,g){let v=e.tileAnchorPoint.add(new s.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=h.mult(g);o||(w=w.rotate(-f));let E=v.add(w);return Ce(E.x,E.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(o){let w=Qe(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(m),E=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return m.add(h.rotate(E))}return m.add(h)}function jd(m,e,o,h,f,g,v,w,E,T,A,R){let O=m.text.placedSymbolArray,z=m.text.dynamicLayoutVertexArray,U=m.icon.dynamicLayoutVertexArray,K={};z.clear();for(let Y=0;Y<O.length;Y++){let Q=O.get(Y),ee=Q.hidden||!Q.crossTileID||m.allowVerticalPlacement&&!Q.placedOrientation?null:h[Q.crossTileID];if(ee){let ie=new s.P(Q.anchorX,Q.anchorY),oe={getElevation:R,width:f.width,height:f.height,pitchedLabelPlaneMatrix:g,lineVertexArray:null,pitchWithMap:o,transform:f,projectionCache:null,tileAnchorPoint:ie,translation:T,unwrappedTileID:A},se=o?Ft(ie.x,ie.y,oe):Qe(ie.x,ie.y,oe),ce=me(f.cameraToCenterDistance,se.signedDistanceFromCamera),le=s.aj(m.textSizeData,w,Q)*ce/s.as;o&&(le*=m.tilePixelRatio/v);let{width:ye,height:ve,anchor:Se,textOffset:Re,textBoxScale:Ee}=ee,Ue=Dc(Se,ye,ve,Re,Ee,le),je=f.getPitchedTextCorrection(ie.x+T[0],ie.y+T[1],A),Oe=Sc(se.point,oe,e,Ue,-f.bearingInRadians,je),Ge=m.allowVerticalPlacement&&Q.placedOrientation===s.ai.vertical?Math.PI/2:0;for(let bt=0;bt<Q.numGlyphs;bt++)s.ak(z,Oe,Ge);E&&Q.associatedIconIndex>=0&&(K[Q.associatedIconIndex]={shiftedAnchor:Oe,angle:Ge})}else Vn(Q.numGlyphs,z)}if(E){U.clear();let Y=m.icon.placedSymbolArray;for(let Q=0;Q<Y.length;Q++){let ee=Y.get(Q);if(ee.hidden)Vn(ee.numGlyphs,U);else{let ie=K[Q];if(ie)for(let oe=0;oe<ee.numGlyphs;oe++)s.ak(U,ie.shiftedAnchor,ie.angle);else Vn(ee.numGlyphs,U)}}m.icon.dynamicLayoutVertexBuffer.updateData(U)}m.text.dynamicLayoutVertexBuffer.updateData(z)}function i_(m,e,o){return o.iconsInText&&e?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Pc(m,e,o,h,f,g,v,w,E,T,A,R,O){let z=m.context,U=z.gl,K=m.transform,Y=w==="map",Q=E==="map",ee=w!=="viewport"&&o.layout.get("symbol-placement")!=="point",ie=Y&&!Q&&!ee,oe=!o.layout.get("symbol-sort-key").isConstant(),se=!1,ce=m.getDepthModeForSublayer(0,vt.ReadOnly),le=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ye=[],ve=K.getCircleRadiusCorrection();for(let Se of h){let Re=e.getTile(Se),Ee=Re.getBucket(o);if(!Ee)continue;let Ue=f?Ee.text:Ee.icon;if(!Ue||!Ue.segments.get().length||!Ue.hasVisibleVertices)continue;let je=Ue.programConfigurations.get(o.id),Oe=f||Ee.sdfIcons,Ge=f?Ee.textSizeData:Ee.iconSizeData,bt=Q||K.pitch!==0,Bt=m.useProgram(i_(Oe,f,Ee),je),mn=s.ah(Ge,K.zoom),Kt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Se),gn,Qt,Wt,Jt,rr=[0,0],Nn=null;if(f)Qt=Re.glyphAtlasTexture,Wt=U.LINEAR,gn=Re.glyphAtlasTexture.size,Ee.iconsInText&&(rr=Re.imageAtlasTexture.size,Nn=Re.imageAtlasTexture,Jt=bt||m.options.rotating||m.options.zooming||Ge.kind==="composite"||Ge.kind==="camera"?U.LINEAR:U.NEAREST);else{let en=o.layout.get("icon-size").constantOr(0)!==1||Ee.iconsNeedLinear;Qt=Re.imageAtlasTexture,Wt=Oe||m.options.rotating||m.options.zooming||en||bt?U.LINEAR:U.NEAREST,gn=Re.imageAtlasTexture.size}let Ln=s.at(Re,1,m.transform.zoom),Er=be(Y,m.transform,Ln),io=s.H();s.an(io,Er);let ji=fe(Q,Y,m.transform,Ln),Fr=s.au(K,Re,g,v),oo=K.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Cl=le&&Ee.hasTextData(),El=o.layout.get("icon-text-fit")!=="none"&&Cl&&Ee.hasIconData();if(ee){let en=m.style.map.terrain?(Br,bn)=>m.style.map.terrain.getElevation(Se,Br,bn):null,yn=o.layout.get("text-rotation-alignment")==="map";$e(Ee,m,f,Er,io,Q,T,yn,Se.toUnwrapped(),K.width,K.height,Fr,en)}let pa=f&&le||El,Dr=ee||pa?cp:Q?Er:m.transform.clipSpaceToPixelsMatrix,Qr=Oe&&o.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Jr;Jr=Oe?Ee.iconsInText?eo(Ge.kind,mn,ie,Q,ee,pa,m,Dr,ji,Fr,gn,rr,ve):al(Ge.kind,mn,ie,Q,ee,pa,m,Dr,ji,Fr,f,gn,0,ve):Ad(Ge.kind,mn,ie,Q,ee,pa,m,Dr,ji,Fr,f,gn,ve);let zr={program:Bt,buffers:Ue,uniformValues:Jr,projectionData:oo,atlasTexture:Qt,atlasTextureIcon:Nn,atlasInterpolation:Wt,atlasInterpolationIcon:Jt,isSDF:Oe,hasHalo:Qr};if(oe&&Ee.canOverlap){se=!0;let en=Ue.segments.get();for(let yn of en)ye.push({segments:new s.aD([yn]),sortKey:yn.sortKey,state:zr,terrainData:Kt})}else ye.push({segments:Ue.segments,sortKey:0,state:zr,terrainData:Kt})}se&&ye.sort((Se,Re)=>Se.sortKey-Re.sortKey);for(let Se of ye){let Re=Se.state;if(z.activeTexture.set(U.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,U.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(z.activeTexture.set(U.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Re.isSDF){let Ee=Re.uniformValues;Re.hasHalo&&(Ee.u_is_halo=1,up(Re.buffers,Se.segments,o,m,Re.program,ce,A,R,Ee,Re.projectionData,Se.terrainData)),Ee.u_is_halo=0}up(Re.buffers,Se.segments,o,m,Re.program,ce,A,R,Re.uniformValues,Re.projectionData,Se.terrainData)}}function up(m,e,o,h,f,g,v,w,E,T,A){let R=h.context;f.draw(R,R.gl.TRIANGLES,g,v,w,Ot.backCCW,E,A,T,o.id,m.layoutVertexBuffer,m.indexBuffer,e,o.paint,h.transform.zoom,m.programConfigurations.get(o.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function dp(m,e,o,h,f){let g=m.context,v=g.gl,w=zt.disabled,E=new cn([v.ONE,v.ONE],s.b4.transparent,[!0,!0,!0,!0]),T=e.getBucket(o);if(!T)return;let A=h.key,R=o.heatmapFbos.get(A);R||(R=Rc(g,e.tileSize,e.tileSize),o.heatmapFbos.set(A,R)),g.bindFramebuffer.set(R.framebuffer),g.viewport.set([0,0,e.tileSize,e.tileSize]),g.clear({color:s.b4.transparent});let O=T.programConfigurations.get(o.id),z=m.useProgram("heatmap",O,!f),U=m.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=m.style.map.terrain.getTerrainData(h);z.draw(g,v.TRIANGLES,vt.disabled,w,E,Ot.disabled,Td(e,m.transform.zoom,o.paint.get("heatmap-intensity"),1),K,U,o.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,o.paint,m.transform.zoom,O)}function Ac(m,e,o,h,f){let g=m.context,v=g.gl,w=m.transform;g.setColorMode(m.colorModeForRenderPass());let E=Vd(g,e),T=o.key,A=e.heatmapFbos.get(T);if(!A)return;g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,A.colorAttachment.get()),g.activeTexture.set(v.TEXTURE1),E.bind(v.LINEAR,v.CLAMP_TO_EDGE);let R=w.getProjectionData({overscaledTileID:o,applyTerrainMatrix:f,applyGlobeMatrix:!h});m.useProgram("heatmapTexture").draw(g,v.TRIANGLES,vt.disabled,zt.disabled,m.colorModeForRenderPass(),Ot.disabled,So(m,e,0,1),null,R,e.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments,e.paint,w.zoom),A.destroy(),e.heatmapFbos.delete(T)}function Rc(m,e,o){var h,f;let g=m.gl,v=g.createTexture();g.bindTexture(g.TEXTURE_2D,v),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);let w=(h=m.HALF_FLOAT)!==null&&h!==void 0?h:g.UNSIGNED_BYTE,E=(f=m.RGBA16F)!==null&&f!==void 0?f:g.RGBA;g.texImage2D(g.TEXTURE_2D,0,E,e,o,0,g.RGBA,w,null);let T=m.createFramebuffer(e,o,!1,!1);return T.colorAttachment.set(v),T}function Vd(m,e){return e.colorRampTexture||(e.colorRampTexture=new Vt(m,e.colorRamp,m.gl.RGBA)),e.colorRampTexture}function Ud(m,e,o,h,f){if(!o||!h||!h.imageAtlas)return;let g=h.imageAtlas.patternPositions,v=g[o.to.toString()],w=g[o.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){let E=f.getPaintProperty(e);v=g[E],w=g[E]}v&&w&&m.setConstantPatternPositions(v,w)}function ul(m,e,o,h,f,g,v,w){let E=m.context.gl,T="fill-pattern",A=o.paint.get(T),R=A&&A.constantOr(1),O=o.getCrossfadeParameters(),z,U,K,Y,Q,ee=m.transform,ie=o.paint.get("fill-translate"),oe=o.paint.get("fill-translate-anchor");v?(U=R&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",z=E.LINES):(U=R?"fillPattern":"fill",z=E.TRIANGLES);let se=A.constantOr(null);for(let ce of h){let le=e.getTile(ce);if(R&&!le.patternsLoaded())continue;let ye=le.getBucket(o);if(!ye)continue;let ve=ye.programConfigurations.get(o.id),Se=m.useProgram(U,ve),Re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ce);R&&(m.context.activeTexture.set(E.TEXTURE0),le.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ve.updatePaintBuffers(O)),Ud(ve,T,se,le,o);let Ee=ee.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),Ue=s.au(ee,le,ie,oe);if(v){Y=ye.indexBuffer2,Q=ye.segments2;let Oe=[E.drawingBufferWidth,E.drawingBufferHeight];K=U==="fillOutlinePattern"&&R?Wf(m,O,le,Oe,Ue):Wy(Oe,Ue)}else Y=ye.indexBuffer,Q=ye.segments,K=R?Cd(m,O,le,Ue):{u_fill_translate:Ue};let je;if(m.renderPass==="translucent"&&w){let[Oe]=m.getStencilConfigForOverlapAndUpdateStencilID(h);je=Oe[ce.overscaledZ]}else je=m.stencilModeForClipping(ce);Se.draw(m.context,z,f,je,g,Ot.backCCW,K,Re,Ee,o.id,ye.layoutVertexBuffer,Y,Q,o.paint,m.transform.zoom,ve)}}function dl(m,e,o,h,f,g,v,w){let E=m.context,T=E.gl,A="fill-extrusion-pattern",R=o.paint.get(A),O=R.constantOr(1),z=o.getCrossfadeParameters(),U=o.paint.get("fill-extrusion-opacity"),K=R.constantOr(null),Y=m.transform;for(let Q of h){let ee=e.getTile(Q),ie=ee.getBucket(o);if(!ie)continue;let oe=m.style.map.terrain&&m.style.map.terrain.getTerrainData(Q),se=ie.programConfigurations.get(o.id),ce=m.useProgram(O?"fillExtrusionPattern":"fillExtrusion",se);O&&(m.context.activeTexture.set(T.TEXTURE0),ee.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),se.updatePaintBuffers(z));let le=Y.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!w,applyTerrainMatrix:!0});Ud(se,A,K,ee,o);let ye=s.au(Y,ee,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ve=o.paint.get("fill-extrusion-vertical-gradient"),Se=O?Zy(m,ve,U,ye,Q,z,ee):gs(m,ve,U,ye);ce.draw(E,E.gl.TRIANGLES,f,g,v,Ot.backCCW,Se,oe,le,o.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,o.paint,m.transform.zoom,se,m.style.map.terrain&&ie.centroidVertexBuffer)}}function $d(m,e,o,h,f,g,v,w,E){var T;let A=m.style.projection,R=m.context,O=m.transform,z=R.gl,U=m.useProgram("hillshade"),K=!m.options.moving;for(let Y of h){let Q=e.getTile(Y),ee=Q.fbo;if(!ee)continue;let ie=A.getMeshFromTileID(R,Y.canonical,w,!0,"raster"),oe=(T=m.style.map.terrain)===null||T===void 0?void 0:T.getTerrainData(Y);R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,ee.colorAttachment.get());let se=O.getProjectionData({overscaledTileID:Y,aligned:K,applyGlobeMatrix:!E,applyTerrainMatrix:!0});U.draw(R,z.TRIANGLES,g,f[Y.overscaledZ],v,Ot.backCCW,Kf(m,Q,o),oe,se,o.id,ie.vertexBuffer,ie.indexBuffer,ie.segments)}}let kc=[new s.P(0,0),new s.P(s.X,0),new s.P(s.X,s.X),new s.P(0,s.X)];function fn(m,e,o,h,f,g,v,w,E=!1,T=!1){let A=h[h.length-1].overscaledZ,R=m.context,O=R.gl,z=m.useProgram("raster"),U=m.transform,K=m.style.projection,Y=m.colorModeForRenderPass(),Q=!m.options.moving;for(let ee of h){let ie=m.getDepthModeForSublayer(ee.overscaledZ-A,o.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,O.LESS),oe=e.getTile(ee);oe.registerFadeDuration(o.paint.get("raster-fade-duration"));let se=e.findLoadedParent(ee,0),ce=e.findLoadedSibling(ee),le=bs(oe,se||ce||null,e,o,m.transform,m.style.map.terrain),ye,ve,Se=o.paint.get("raster-resampling")==="nearest"?O.NEAREST:O.LINEAR;R.activeTexture.set(O.TEXTURE0),oe.texture.bind(Se,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(O.TEXTURE1),se?(se.texture.bind(Se,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),ye=Math.pow(2,se.tileID.overscaledZ-oe.tileID.overscaledZ),ve=[oe.tileID.canonical.x*ye%1,oe.tileID.canonical.y*ye%1]):oe.texture.bind(Se,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST),oe.texture.useMipmap&&R.extTextureFilterAnisotropic&&m.transform.pitch>20&&O.texParameterf(O.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax);let Re=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ee),Ee=U.getProjectionData({overscaledTileID:ee,aligned:Q,applyGlobeMatrix:!T,applyTerrainMatrix:!0}),Ue=Jf(ve||[0,0],ye||1,le,o,w),je=K.getMeshFromTileID(R,ee.canonical,g,v,"raster");z.draw(R,O.TRIANGLES,ie,f?f[ee.overscaledZ]:zt.disabled,Y,E?Ot.frontCCW:Ot.backCCW,Ue,Re,Ee,o.id,je.vertexBuffer,je.indexBuffer,je.segments)}}function bs(m,e,o,h,f,g){let v=h.paint.get("raster-fade-duration");if(!g&&v>0){let w=W.now(),E=(w-m.timeAdded)/v,T=e?(w-e.timeAdded)/v:-1,A=o.getSource(),R=To(f,{tileSize:A.tileSize,roundZoom:A.roundZoom}),O=!e||Math.abs(e.tileID.overscaledZ-R)>Math.abs(m.tileID.overscaledZ-R),z=O&&m.refreshedUponExpiration?1:s.ab(O?E:1-T,0,1);return m.refreshedUponExpiration&&E>=1&&(m.refreshedUponExpiration=!1),e?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}let Kr=new s.b4(1,0,0,1),Hd=new s.b4(0,1,0,1),Gd=new s.b4(0,0,1,1),hp=new s.b4(1,0,1,1),ia=new s.b4(0,1,1,1);function oa(m,e,o,h){hl(m,0,e+o/2,m.transform.width,o,h)}function Oc(m,e,o,h){hl(m,e-o/2,0,o,m.transform.height,h)}function hl(m,e,o,h,f,g){let v=m.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*m.pixelRatio,o*m.pixelRatio,h*m.pixelRatio,f*m.pixelRatio),v.clear({color:g}),w.disable(w.SCISSOR_TEST)}function fp(m,e,o){let h=m.context,f=h.gl,g=m.useProgram("debug"),v=vt.disabled,w=zt.disabled,E=m.colorModeForRenderPass(),T="$debug",A=m.style.map.terrain&&m.style.map.terrain.getTerrainData(o);h.activeTexture.set(f.TEXTURE0);let R=e.getTileByID(o.key).latestRawTileData,O=Math.floor((R&&R.byteLength||0)/1024),z=e.getTile(o).tileSize,U=512/Math.min(z,512)*(o.overscaledZ/m.transform.zoom)*.5,K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),function(Q,ee){Q.initDebugOverlayCanvas();let ie=Q.debugOverlayCanvas,oe=Q.context.gl,se=Q.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,ie.width,ie.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(ee,5,5),se.strokeText(ee,5,5),Q.debugOverlayTexture.update(ie),Q.debugOverlayTexture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE)}(m,`${K} ${O}kB`);let Y=m.transform.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(h,f.TRIANGLES,v,w,cn.alphaBlended,Ot.disabled,Id(s.b4.transparent,U),null,Y,T,m.debugBuffer,m.quadTriangleIndexBuffer,m.debugSegments),g.draw(h,f.LINE_STRIP,v,w,E,Ot.disabled,Id(s.b4.red),A,Y,T,m.debugBuffer,m.tileBorderIndexBuffer,m.debugSegments)}function qd(m,e,o,h){let{isRenderingGlobe:f}=h,g=m.context,v=g.gl,w=m.transform,E=m.colorModeForRenderPass(),T=m.getDepthModeFor3D(),A=m.useProgram("terrain");g.bindFramebuffer.set(null),g.viewport.set([0,0,m.width,m.height]);for(let R of o){let O=e.getTerrainMesh(R.tileID),z=m.renderToTexture.getTexture(R),U=e.getTerrainData(R.tileID);g.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,z.texture);let K=e.getMeshFrameDelta(w.zoom),Y=w.calculateFogMatrix(R.tileID.toUnwrapped()),Q=il(K,Y,m.style.sky,w.pitch,f),ee=w.getProjectionData({overscaledTileID:R.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});A.draw(g,v.TRIANGLES,T,zt.disabled,E,Ot.backCCW,Q,U,ee,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}}function Zd(m,e){if(!e.mesh){let o=new s.aC;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(1,1),o.emplaceBack(-1,1);let h=new s.aE;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),e.mesh=new Li(m.createVertexBuffer(o,Dt.members),m.createIndexBuffer(h),s.aD.simpleSegment(0,0,o.length,h.length))}return e.mesh}class pp{constructor(e,o){this.context=new Tc(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=V.maxUnderzooming+V.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ds}resize(e,o,h){if(this.width=Math.floor(e*h),this.height=Math.floor(o*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let f of this.style._order)this.style._layers[f].resize()}setup(){let e=this.context,o=new s.aC;o.emplaceBack(0,0),o.emplaceBack(s.X,0),o.emplaceBack(0,s.X),o.emplaceBack(s.X,s.X),this.tileExtentBuffer=e.createVertexBuffer(o,Dt.members),this.tileExtentSegments=s.aD.simpleSegment(0,0,4,2);let h=new s.aC;h.emplaceBack(0,0),h.emplaceBack(s.X,0),h.emplaceBack(0,s.X),h.emplaceBack(s.X,s.X),this.debugBuffer=e.createVertexBuffer(h,Dt.members),this.debugSegments=s.aD.simpleSegment(0,0,4,5);let f=new s.bT;f.emplaceBack(0,0,0,0),f.emplaceBack(s.X,0,s.X,0),f.emplaceBack(0,s.X,0,s.X),f.emplaceBack(s.X,s.X,s.X,s.X),this.rasterBoundsBuffer=e.createVertexBuffer(f,qy.members),this.rasterBoundsSegments=s.aD.simpleSegment(0,0,4,2);let g=new s.aC;g.emplaceBack(0,0),g.emplaceBack(s.X,0),g.emplaceBack(0,s.X),g.emplaceBack(s.X,s.X),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(g,Dt.members),this.rasterBoundsSegmentsPosOnly=s.aD.simpleSegment(0,0,4,5);let v=new s.aC;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(v,Dt.members),this.viewportSegments=s.aD.simpleSegment(0,0,4,2);let w=new s.bU;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(w);let E=new s.aE;E.emplaceBack(1,0,2),E.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(E);let T=this.context.gl;this.stencilClearMode=new zt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO),this.tileExtentMesh=new Li(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){let e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;let h=s.H();s.bL(h,0,this.width,this.height,0,0,1),s.K(h,h,[o.drawingBufferWidth,o.drawingBufferHeight,0]);let f={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(e,o.TRIANGLES,vt.disabled,this.stencilClearMode,cn.disabled,Ot.disabled,null,null,f,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o,h){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source,this.nextStencilID+o.length>256&&this.clearStencil();let f=this.context;f.setColorMode(cn.disabled),f.setDepthMode(vt.disabled);let g={};for(let v of o)g[v.key]=this.nextStencilID++;this._renderTileMasks(g,o,h,!0),this._renderTileMasks(g,o,h,!1),this._tileClippingMaskIDs=g}_renderTileMasks(e,o,h,f){let g=this.context,v=g.gl,w=this.style.projection,E=this.transform,T=this.useProgram("clippingMask");for(let A of o){let R=e[A.key],O=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),z=w.getMeshFromTileID(this.context,A.canonical,f,!0,"stencil"),U=E.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});T.draw(g,v.TRIANGLES,vt.disabled,new zt({func:v.ALWAYS,mask:0},R,255,v.KEEP,v.KEEP,v.REPLACE),cn.disabled,h?Ot.disabled:Ot.backCCW,null,O,U,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}_renderTilesDepthBuffer(){let e=this.context,o=e.gl,h=this.style.projection,f=this.transform,g=this.useProgram("depth"),v=this.getDepthModeFor3D(),w=X(f,{tileSize:f.tileSize});for(let E of w){let T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),A=h.getMeshFromTileID(this.context,E.canonical,!0,!0,"raster"),R=f.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!0,applyTerrainMatrix:!0});g.draw(e,o.TRIANGLES,v,zt.disabled,cn.disabled,Ot.backCCW,null,T,R,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,o=this.context.gl;return new zt({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){let o=this.context.gl;return new zt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){let o=this.context.gl,h=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),f=h[h.length-1].overscaledZ,g=h[0].overscaledZ-f+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();let v={};for(let w=0;w<g;w++)v[w+f]=new zt({func:o.GEQUAL,mask:255},w+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=g,[v,h]}return[{[f]:zt.disabled},h]}stencilConfigForOverlapTwoPass(e){let o=this.context.gl,h=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),f=h[h.length-1].overscaledZ,g=h[0].overscaledZ-f+1;if(this.clearStencil(),g>1){let v={},w={};for(let E=0;E<g;E++)v[E+f]=new zt({func:o.GREATER,mask:255},g+1+E,255,o.KEEP,o.KEEP,o.REPLACE),w[E+f]=new zt({func:o.GREATER,mask:255},1+E,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID=2*g+1,[v,w,h]}return this.nextStencilID=3,[{[f]:new zt({func:o.GREATER,mask:255},2,255,o.KEEP,o.KEEP,o.REPLACE)},{[f]:new zt({func:o.GREATER,mask:255},1,255,o.KEEP,o.KEEP,o.REPLACE)},h]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new cn([e.CONSTANT_COLOR,e.ONE],new s.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cn.unblended:cn.alphaBlended}getDepthModeForSublayer(e,o,h){if(!this.opaquePassEnabledForLayer())return vt.disabled;let f=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vt(h||this.context.gl.LEQUAL,o,[f,f])}getDepthModeFor3D(){return new vt(this.context.gl.LEQUAL,vt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){var h,f;this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(W.now()),this.imageManager.beginFrame();let g=this.style._order,v=this.style.sourceCaches,w={},E={},T={},A={isRenderingToTexture:!1,isRenderingGlobe:((h=e.projection)===null||h===void 0?void 0:h.transitionState)>0};for(let O in v){let z=v[O];z.used&&z.prepare(this.context),w[O]=z.getVisibleCoordinates(!1),E[O]=w[O].slice().reverse(),T[O]=z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<g.length;O++)if(this.style._layers[g[O]].is3D()){this.opaquePassCutoff=O;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(let O of g){let z=this.style._layers[O];if(!z.hasOffscreenPass()||z.isHidden(this.transform.zoom))continue;let U=E[z.source];(z.type==="custom"||U.length)&&this.renderLayer(this,v[z.source],z,U,A)}if((f=this.style.projection)===null||f===void 0||f.updateGPUdependent({context:this.context,useProgram:O=>this.useProgram(O)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?s.b4.black:s.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(O,z){let U=O.context,K=U.gl,Y=((ce,le,ye)=>{let ve=Math.cos(le.rollInRadians),Se=Math.sin(le.rollInRadians),Re=vn(le),Ee=le.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ce.properties.get("sky-color"),u_horizon_color:ce.properties.get("horizon-color"),u_horizon:[(le.width/2-Re*Se)*ye,(le.height/2+Re*ve)*ye],u_horizon_normal:[-Se,ve],u_sky_horizon_blend:ce.properties.get("sky-horizon-blend")*le.height/2*ye,u_sky_blend:Ee}})(z,O.style.map.transform,O.pixelRatio),Q=new vt(K.LEQUAL,vt.ReadWrite,[0,1]),ee=zt.disabled,ie=O.colorModeForRenderPass(),oe=O.useProgram("sky"),se=Zd(U,z);oe.draw(U,K.TRIANGLES,Q,ee,ie,Ot.disabled,Y,null,void 0,"sky",se.vertexBuffer,se.indexBuffer,se.segments)}(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){let O=this.style._layers[g[this.currentLayer]],z=v[O.source],U=w[O.source];this._renderTileClippingMasks(O,U,!1),this.renderLayer(this,z,O,U,A)}this.renderPass="translucent";let R=!1;for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){let O=this.style._layers[g[this.currentLayer]],z=v[O.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(O,A))continue;this.opaquePassEnabledForLayer()||R||(R=!0,A.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());let U=(O.type==="symbol"?T:E)[O.source];this._renderTileClippingMasks(O,w[O.source],!1),this.renderLayer(this,z,O,U,A)}if(A.isRenderingGlobe&&function(O,z,U){let K=O.context,Y=K.gl,Q=O.useProgram("atmosphere"),ee=new vt(Y.LEQUAL,vt.ReadOnly,[0,1]),ie=O.transform,oe=function(Ee,Ue){let je=Ee.properties.get("position"),Oe=[-je.x,-je.y,-je.z],Ge=s.aq(new Float64Array(16));return Ee.properties.get("anchor")==="map"&&(s.aX(Ge,Ge,Ue.rollInRadians),s.aY(Ge,Ge,-Ue.pitchInRadians),s.aX(Ge,Ge,Ue.bearingInRadians),s.aY(Ge,Ge,Ue.center.lat*Math.PI/180),s.bj(Ge,Ge,-Ue.center.lng*Math.PI/180)),s.bS(Oe,Oe,Ge),Oe}(U,O.transform),se=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=z.properties.get("atmosphere-blend")*se.projectionTransition;if(ce===0)return;let le=Qs(ie.worldSize,ie.center.lat),ye=ie.inverseProjectionMatrix,ve=new Float64Array(4);ve[3]=1,s.al(ve,ve,ie.modelViewProjectionMatrix),ve[0]/=ve[3],ve[1]/=ve[3],ve[2]/=ve[3],ve[3]=1,s.al(ve,ve,ye),ve[0]/=ve[3],ve[1]/=ve[3],ve[2]/=ve[3],ve[3]=1;let Se=((Ee,Ue,je,Oe,Ge)=>({u_sun_pos:Ee,u_atmosphere_blend:Ue,u_globe_position:je,u_globe_radius:Oe,u_inv_proj_matrix:Ge}))(oe,ce,[ve[0],ve[1],ve[2]],le,ye),Re=Zd(K,z);Q.draw(K,Y.TRIANGLES,ee,zt.disabled,cn.alphaBlended,Ot.disabled,Se,null,null,"atmosphere",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){let O=function(z,U){let K=null,Y=Object.values(z._layers).flatMap(oe=>oe.source&&!oe.isHidden(U)?[z.sourceCaches[oe.source]]:[]),Q=Y.filter(oe=>oe.getSource().type==="vector"),ee=Y.filter(oe=>oe.getSource().type!=="vector"),ie=oe=>{(!K||K.getSource().maxzoom<oe.getSource().maxzoom)&&(K=oe)};return Q.forEach(oe=>ie(oe)),K||ee.forEach(oe=>ie(oe)),K}(this.style,this.transform.zoom);O&&function(z,U,K){for(let Y=0;Y<K.length;Y++)fp(z,U,K[Y])}(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){let z=O.transform.padding;oa(O,O.transform.height-(z.top||0),3,Kr),oa(O,z.bottom||0,3,Hd),Oc(O,z.left||0,3,Gd),Oc(O,O.transform.width-(z.right||0),3,hp);let U=O.transform.centerPoint;(function(K,Y,Q,ee){hl(K,Y-1,Q-10,2,20,ee),hl(K,Y-10,Q-1,20,2,ee)})(O,U.x,O.transform.height-U.y,ia)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;let o=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix,f=this.terrainFacilitator.dirty;f||(f=e?!s.bV(o,h):!s.bW(o,h)),f||(f=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),f&&(s.bX(o,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(g,v){let w=g.context,E=w.gl,T=g.transform,A=cn.unblended,R=new vt(E.LEQUAL,vt.ReadWrite,[0,1]),O=v.sourceCache.getRenderableTiles(),z=g.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:s.b4.transparent,depth:1});for(let U of O){let K=v.getTerrainMesh(U.tileID),Y=v.getTerrainData(U.tileID),Q=T.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ee={u_ele_delta:v.getMeshFrameDelta(T.zoom)};z.draw(w,E.TRIANGLES,R,zt.disabled,A,Ot.backCCW,ee,Y,Q,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain),function(g,v){let w=g.context,E=w.gl,T=g.transform,A=cn.unblended,R=new vt(E.LEQUAL,vt.ReadWrite,[0,1]),O=v.getCoordsTexture(),z=v.sourceCache.getRenderableTiles(),U=g.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,g.width/devicePixelRatio,g.height/devicePixelRatio]),w.clear({color:s.b4.transparent,depth:1}),v.coordsIndex=[];for(let K of z){let Y=v.getTerrainMesh(K.tileID),Q=v.getTerrainData(K.tileID);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,O.texture);let ee={u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(T.zoom)},ie=T.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(w,E.TRIANGLES,R,zt.disabled,A,Ot.backCCW,ee,Q,ie,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),v.coordsIndex.push(K.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,g.width,g.height])}(this,this.style.map.terrain))}renderLayer(e,o,h,f,g){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(f||[]).length)&&(this.id=h.id,s.bY(h)?function(v,w,E,T,A,R){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:O}=R,z=zt.disabled,U=v.colorModeForRenderPass();(E._unevaluatedLayout.hasValue("text-variable-anchor")||E._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(K,Y,Q,ee,ie,oe,se,ce,le){let ye=Y.transform,ve=Y.style.map.terrain,Se=ie==="map",Re=oe==="map";for(let Ee of K){let Ue=ee.getTile(Ee),je=Ue.getBucket(Q);if(!je||!je.text||!je.text.segments.get().length)continue;let Oe=s.ah(je.textSizeData,ye.zoom),Ge=s.at(Ue,1,Y.transform.zoom),bt=be(Se,Y.transform,Ge),Bt=Q.layout.get("icon-text-fit")!=="none"&&je.hasIconData();{let mn=Math.pow(2,ye.zoom-Ue.tileID.overscaledZ),Kt=ve?(gn,Qt)=>ve.getElevation(Ee,gn,Qt):null;jd(je,Se,Re,le,ye,bt,mn,Oe,Bt,s.au(ye,Ue,se,ce),Ee.toUnwrapped(),Kt)}}}(T,v,E,w,E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),A),E.paint.get("icon-opacity").constantOr(1)!==0&&Pc(v,w,E,T,!1,E.paint.get("icon-translate"),E.paint.get("icon-translate-anchor"),E.layout.get("icon-rotation-alignment"),E.layout.get("icon-pitch-alignment"),E.layout.get("icon-keep-upright"),z,U,O),E.paint.get("text-opacity").constantOr(1)!==0&&Pc(v,w,E,T,!0,E.paint.get("text-translate"),E.paint.get("text-translate-anchor"),E.layout.get("text-rotation-alignment"),E.layout.get("text-pitch-alignment"),E.layout.get("text-keep-upright"),z,U,O),w.map.showCollisionBoxes&&(Mc(v,w,E,T,!0),Mc(v,w,E,T,!1))}(e,o,h,f,this.style.placement.variableOffsets,g):s.bZ(h)?function(v,w,E,T,A){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:R}=A,O=E.paint.get("circle-opacity"),z=E.paint.get("circle-stroke-width"),U=E.paint.get("circle-stroke-opacity"),K=!E.layout.get("circle-sort-key").isConstant();if(O.constantOr(1)===0&&(z.constantOr(1)===0||U.constantOr(1)===0))return;let Y=v.context,Q=Y.gl,ee=v.transform,ie=v.getDepthModeForSublayer(0,vt.ReadOnly),oe=zt.disabled,se=v.colorModeForRenderPass(),ce=[],le=ee.getCircleRadiusCorrection();for(let ye=0;ye<T.length;ye++){let ve=T[ye],Se=w.getTile(ve),Re=Se.getBucket(E);if(!Re)continue;let Ee=E.paint.get("circle-translate"),Ue=E.paint.get("circle-translate-anchor"),je=s.au(ee,Se,Ee,Ue),Oe=Re.programConfigurations.get(E.id),Ge=v.useProgram("circle",Oe),bt=Re.layoutVertexBuffer,Bt=Re.indexBuffer,mn=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ve),Kt={programConfiguration:Oe,program:Ge,layoutVertexBuffer:bt,indexBuffer:Bt,uniformValues:Ed(v,Se,E,je,le),terrainData:mn,projectionData:ee.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!R,applyTerrainMatrix:!0})};if(K){let gn=Re.segments.get();for(let Qt of gn)ce.push({segments:new s.aD([Qt]),sortKey:Qt.sortKey,state:Kt})}else ce.push({segments:Re.segments,sortKey:0,state:Kt})}K&&ce.sort((ye,ve)=>ye.sortKey-ve.sortKey);for(let ye of ce){let{programConfiguration:ve,program:Se,layoutVertexBuffer:Re,indexBuffer:Ee,uniformValues:Ue,terrainData:je,projectionData:Oe}=ye.state;Se.draw(Y,Q.TRIANGLES,ie,oe,se,Ot.backCCW,Ue,je,Oe,E.id,Re,Ee,ye.segments,E.paint,v.transform.zoom,ve)}}(e,o,h,f,g):s.b_(h)?function(v,w,E,T,A){if(E.paint.get("heatmap-opacity")===0)return;let R=v.context,{isRenderingToTexture:O,isRenderingGlobe:z}=A;if(v.style.map.terrain){for(let U of T){let K=w.getTile(U);w.hasRenderableParent(U)||(v.renderPass==="offscreen"?dp(v,K,E,U,z):v.renderPass==="translucent"&&Ac(v,E,U,O,z))}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="offscreen"?function(U,K,Y,Q){let ee=U.context,ie=ee.gl,oe=U.transform,se=zt.disabled,ce=new cn([ie.ONE,ie.ONE],s.b4.transparent,[!0,!0,!0,!0]);(function(le,ye,ve){let Se=le.gl;le.activeTexture.set(Se.TEXTURE1),le.viewport.set([0,0,ye.width/4,ye.height/4]);let Re=ve.heatmapFbos.get(s.bP);Re?(Se.bindTexture(Se.TEXTURE_2D,Re.colorAttachment.get()),le.bindFramebuffer.set(Re.framebuffer)):(Re=Rc(le,ye.width/4,ye.height/4),ve.heatmapFbos.set(s.bP,Re))})(ee,U,Y),ee.clear({color:s.b4.transparent});for(let le=0;le<Q.length;le++){let ye=Q[le];if(K.hasRenderableParent(ye))continue;let ve=K.getTile(ye),Se=ve.getBucket(Y);if(!Se)continue;let Re=Se.programConfigurations.get(Y.id),Ee=U.useProgram("heatmap",Re),Ue=oe.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),je=oe.getCircleRadiusCorrection();Ee.draw(ee,ie.TRIANGLES,vt.disabled,se,ce,Ot.backCCW,Td(ve,oe.zoom,Y.paint.get("heatmap-intensity"),je),null,Ue,Y.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,Y.paint,oe.zoom,Re)}ee.viewport.set([0,0,U.width,U.height])}(v,w,E,T):v.renderPass==="translucent"&&function(U,K){let Y=U.context,Q=Y.gl;Y.setColorMode(U.colorModeForRenderPass());let ee=K.heatmapFbos.get(s.bP);ee&&(Y.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,ee.colorAttachment.get()),Y.activeTexture.set(Q.TEXTURE1),Vd(Y,K).bind(Q.LINEAR,Q.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(Y,Q.TRIANGLES,vt.disabled,zt.disabled,U.colorModeForRenderPass(),Ot.disabled,So(U,K,0,1),null,null,K.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,K.paint,U.transform.zoom))}(v,E)}(e,o,h,f,g):s.b$(h)?function(v,w,E,T,A){if(v.renderPass!=="translucent")return;let{isRenderingToTexture:R}=A,O=E.paint.get("line-opacity"),z=E.paint.get("line-width");if(O.constantOr(1)===0||z.constantOr(1)===0)return;let U=v.getDepthModeForSublayer(0,vt.ReadOnly),K=v.colorModeForRenderPass(),Y=E.paint.get("line-dasharray"),Q=E.paint.get("line-pattern"),ee=Q.constantOr(1),ie=E.paint.get("line-gradient"),oe=E.getCrossfadeParameters(),se=ee?"linePattern":Y?"lineSDF":ie?"lineGradient":"line",ce=v.context,le=ce.gl,ye=v.transform,ve=!0;for(let Se of T){let Re=w.getTile(Se);if(ee&&!Re.patternsLoaded())continue;let Ee=Re.getBucket(E);if(!Ee)continue;let Ue=Ee.programConfigurations.get(E.id),je=v.context.program.get(),Oe=v.useProgram(se,Ue),Ge=ve||Oe.program!==je,bt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Se),Bt=Q.constantOr(null);if(Bt&&Re.imageAtlas){let Wt=Re.imageAtlas,Jt=Wt.patternPositions[Bt.to.toString()],rr=Wt.patternPositions[Bt.from.toString()];Jt&&rr&&Ue.setConstantPatternPositions(Jt,rr)}let mn=ye.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Kt=ye.getPixelScale(),gn=ee?Xy(v,Re,E,Kt,oe):Y?Yy(v,Re,E,Kt,Y,oe):ie?mc(v,Re,E,Kt,Ee.lineClipsArray.length):Md(v,Re,E,Kt);if(ee)ce.activeTexture.set(le.TEXTURE0),Re.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),Ue.updatePaintBuffers(oe);else if(Y&&(Ge||v.lineAtlas.dirty))ce.activeTexture.set(le.TEXTURE0),v.lineAtlas.bind(ce);else if(ie){let Wt=Ee.gradients[E.id],Jt=Wt.texture;if(E.gradientVersion!==Wt.version){let rr=256;if(E.stepInterpolant){let Nn=w.getSource().maxzoom,Ln=Se.canonical.z===Nn?Math.ceil(1<<v.transform.maxZoom-Se.canonical.z):1;rr=s.ab(s.bQ(Ee.maxLineLength/s.X*1024*Ln),256,ce.maxTextureSize)}Wt.gradient=s.bR({expression:E.gradientExpression(),evaluationKey:"lineProgress",resolution:rr,image:Wt.gradient||void 0,clips:Ee.lineClipsArray}),Wt.texture?Wt.texture.update(Wt.gradient):Wt.texture=new Vt(ce,Wt.gradient,le.RGBA),Wt.version=E.gradientVersion,Jt=Wt.texture}ce.activeTexture.set(le.TEXTURE0),Jt.bind(E.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}let Qt;if(R){let[Wt]=v.getStencilConfigForOverlapAndUpdateStencilID(T);Qt=Wt[Se.overscaledZ]}else Qt=v.stencilModeForClipping(Se);Oe.draw(ce,le.TRIANGLES,U,Qt,K,Ot.disabled,gn,bt,mn,E.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,E.paint,v.transform.zoom,Ue,Ee.layoutVertexBuffer2),ve=!1}}(e,o,h,f,g):s.c0(h)?function(v,w,E,T,A){let R=E.paint.get("fill-color"),O=E.paint.get("fill-opacity");if(O.constantOr(1)===0)return;let{isRenderingToTexture:z}=A,U=v.colorModeForRenderPass(),K=E.paint.get("fill-pattern"),Y=v.opaquePassEnabledForLayer()&&!K.constantOr(1)&&R.constantOr(s.b4.transparent).a===1&&O.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===Y){let Q=v.getDepthModeForSublayer(1,v.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);ul(v,w,E,T,Q,U,!1,z)}if(v.renderPass==="translucent"&&E.paint.get("fill-antialias")){let Q=v.getDepthModeForSublayer(E.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);ul(v,w,E,T,Q,U,!0,z)}}(e,o,h,f,g):s.c1(h)?function(v,w,E,T,A){let R=E.paint.get("fill-extrusion-opacity");if(R===0)return;let{isRenderingToTexture:O}=A;if(v.renderPass==="translucent"){let z=new vt(v.context.gl.LEQUAL,vt.ReadWrite,v.depthRangeFor3D);if(R!==1||E.paint.get("fill-extrusion-pattern").constantOr(1))dl(v,w,E,T,z,zt.disabled,cn.disabled,O),dl(v,w,E,T,z,v.stencilModeFor3D(),v.colorModeForRenderPass(),O);else{let U=v.colorModeForRenderPass();dl(v,w,E,T,z,zt.disabled,U,O)}}}(e,o,h,f,g):s.c2(h)?function(v,w,E,T,A){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;let{isRenderingToTexture:R}=A,O=v.context,z=v.style.projection.useSubdivision,U=v.getDepthModeForSublayer(0,vt.ReadOnly),K=v.colorModeForRenderPass();if(v.renderPass==="offscreen")(function(Y,Q,ee,ie,oe,se,ce){let le=Y.context,ye=le.gl;for(let ve of ee){let Se=Q.getTile(ve),Re=Se.dem;if(!Re||!Re.data||!Se.needsHillshadePrepare)continue;let Ee=Re.dim,Ue=Re.stride,je=Re.getPixels();if(le.activeTexture.set(ye.TEXTURE1),le.pixelStoreUnpackPremultiplyAlpha.set(!1),Se.demTexture=Se.demTexture||Y.getTileTexture(Ue),Se.demTexture){let Ge=Se.demTexture;Ge.update(je,{premultiply:!1}),Ge.bind(ye.NEAREST,ye.CLAMP_TO_EDGE)}else Se.demTexture=new Vt(le,je,ye.RGBA,{premultiply:!1}),Se.demTexture.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);le.activeTexture.set(ye.TEXTURE0);let Oe=Se.fbo;if(!Oe){let Ge=new Vt(le,{width:Ee,height:Ee,data:null},ye.RGBA);Ge.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Oe=Se.fbo=le.createFramebuffer(Ee,Ee,!0,!1),Oe.colorAttachment.set(Ge.texture)}le.bindFramebuffer.set(Oe.framebuffer),le.viewport.set([0,0,Ee,Ee]),Y.useProgram("hillshadePrepare").draw(le,ye.TRIANGLES,oe,se,ce,Ot.disabled,Qf(Se.tileID,Re),null,null,ie.id,Y.rasterBoundsBuffer,Y.quadTriangleIndexBuffer,Y.rasterBoundsSegments),Se.needsHillshadePrepare=!1}})(v,w,T,E,U,zt.disabled,K),O.viewport.set([0,0,v.width,v.height]);else if(v.renderPass==="translucent")if(z){let[Y,Q,ee]=v.stencilConfigForOverlapTwoPass(T);$d(v,w,E,ee,Y,U,K,!1,R),$d(v,w,E,ee,Q,U,K,!0,R)}else{let[Y,Q]=v.getStencilConfigForOverlapAndUpdateStencilID(T);$d(v,w,E,Q,Y,U,K,!1,R)}}(e,o,h,f,g):s.c3(h)?function(v,w,E,T,A){if(v.renderPass!=="translucent"||E.paint.get("raster-opacity")===0||!T.length)return;let{isRenderingToTexture:R}=A,O=w.getSource(),z=v.style.projection.useSubdivision;if(O instanceof Or)fn(v,w,E,T,null,!1,!1,O.tileCoords,O.flippedWindingOrder,R);else if(z){let[U,K,Y]=v.stencilConfigForOverlapTwoPass(T);fn(v,w,E,Y,U,!1,!0,kc,!1,R),fn(v,w,E,Y,K,!0,!0,kc,!1,R)}else{let[U,K]=v.getStencilConfigForOverlapAndUpdateStencilID(T);fn(v,w,E,K,U,!1,!0,kc,!1,R)}}(e,o,h,f,g):s.c4(h)?function(v,w,E,T,A){let R=E.paint.get("background-color"),O=E.paint.get("background-opacity");if(O===0)return;let{isRenderingToTexture:z}=A,U=v.context,K=U.gl,Y=v.style.projection,Q=v.transform,ee=Q.tileSize,ie=E.paint.get("background-pattern");if(v.isPatternMissing(ie))return;let oe=!ie&&R.a===1&&O===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==oe)return;let se=zt.disabled,ce=v.getDepthModeForSublayer(0,oe==="opaque"?vt.ReadWrite:vt.ReadOnly),le=v.colorModeForRenderPass(),ye=v.useProgram(ie?"backgroundPattern":"background"),ve=T||X(Q,{tileSize:ee,terrain:v.style.map.terrain});ie&&(U.activeTexture.set(K.TEXTURE0),v.imageManager.bind(v.context));let Se=E.getCrossfadeParameters();for(let Re of ve){let Ee=Q.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Ue=ie?kd(O,v,ie,{tileID:Re,tileSize:ee},Se):Rd(O,R),je=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Re),Oe=Y.getMeshFromTileID(U,Re.canonical,!1,!0,"raster");ye.draw(U,K.TRIANGLES,ce,se,le,Ot.backCCW,Ue,je,Ee,E.id,Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)}}(e,0,h,f,g):s.c5(h)&&function(v,w,E,T){let{isRenderingGlobe:A}=T,R=v.context,O=E.implementation,z=v.style.projection,U=v.transform,K=U.getProjectionDataForCustomLayer(A),Y={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:z.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${z.shaderPreludeCode.vertexSource}`,define:z.shaderDefine},defaultProjectionData:K},Q=O.renderingMode?O.renderingMode:"2d";if(v.renderPass==="offscreen"){let ee=O.prerender;ee&&(v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),ee.call(O,R.gl,Y),R.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),R.setColorMode(v.colorModeForRenderPass()),R.setStencilMode(zt.disabled);let ee=Q==="3d"?v.getDepthModeFor3D():v.getDepthModeForSublayer(0,vt.ReadOnly);R.setDepthMode(ee),O.render(R.gl,Y),R.setDirty(),v.setBaseState(),R.bindFramebuffer.set(null)}}(e,0,h,g))}saveTileTexture(e){let o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){let o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;let o=this.imageManager.getPattern(e.from.toString()),h=this.imageManager.getPattern(e.to.toString());return!o||!h}useProgram(e,o,h=!1){this.cache=this.cache||{};let f=!!this.style.map.terrain,g=this.style.projection,v=e+(o?o.cacheKey:"")+`/${h?$f:g.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(f?"/terrain":"");return this.cache[v]||(this.cache[v]=new pc(this.context,Ni[e],o,ep[e],this._showOverdrawInspector,f,h?Ni.projectionMercator:g.shaderPreludeCode,h?cc:g.shaderDefine)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Vt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){let{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}function Po(m,e){let o,h=!1,f=null,g=null,v=()=>{f=null,h&&(m.apply(g,o),f=setTimeout(v,e),h=!1)};return(...w)=>(h=!0,g=this,o=w,f||v(),f)}class Wd{constructor(e){this._getCurrentHash=()=>{let o=window.location.hash.replace("#","");if(this._hashName){let h;return o.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(h=f)}),(h&&h[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{let o=this._getCurrentHash();if(!this._isValidHash(o))return!1;let h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:h,pitch:+(o[4]||0)}),!0},this._updateHashUnthrottled=()=>{let o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{let o=this._getCurrentHash();if(o.length===0)return;let h=o.join("/"),f=h;f.split("&").length>0&&(f=f.split("&")[0]),this._hashName&&(f=`${this._hashName}=${h}`);let g=window.location.hash.replace(f,"");g.startsWith("#&")?g=g.slice(0,1)+g.slice(2):g==="#"&&(g="");let v=window.location.href.replace(/(#.+)?$/,g);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=Po(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){let o=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,f=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,f),v=Math.round(o.lng*g)/g,w=Math.round(o.lat*g)/g,E=this._map.getBearing(),T=this._map.getPitch(),A="";if(A+=e?`/${v}/${w}/${h}`:`${h}/${w}/${v}`,(E||T)&&(A+="/"+Math.round(10*E)/10),T&&(A+=`/${Math.round(T)}`),this._hashName){let R=this._hashName,O=!1,z=window.location.hash.slice(1).split("&").map(U=>{let K=U.split("=")[0];return K===R?(O=!0,`${K}=${A}`):U}).filter(U=>U);return O||z.push(`${R}=${A}`),`#${z.join("&")}`}return`#${A}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new s.N(+e[2],+e[1])}catch{return!1}let o=+e[0],h=+(e[3]||0),f=+(e[4]||0);return o>=this._map.getMinZoom()&&o<=this._map.getMaxZoom()&&h>=0&&h<=180&&f>=this._map.getMinPitch()&&f<=this._map.getMaxPitch()}}let sa={linearity:.3,easing:s.c6(0,0,.3,1)},mp=s.e({deceleration:2500,maxSpeed:1400},sa),gp=s.e({deceleration:20,maxSpeed:1400},sa),yp=s.e({deceleration:1e3,maxSpeed:360},sa),_p=s.e({deceleration:1e3,maxSpeed:90},sa),vp=s.e({deceleration:1e3,maxSpeed:360},sa);class fl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:W.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,o=W.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;let o={zoom:0,bearing:0,pitch:0,roll:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:g}of this._inertiaBuffer)o.zoom+=g.zoomDelta||0,o.bearing+=g.bearingDelta||0,o.pitch+=g.pitchDelta||0,o.roll+=g.rollDelta||0,g.panDelta&&o.pan._add(g.panDelta),g.around&&(o.around=g.around),g.pinchAround&&(o.pinchAround=g.pinchAround);let h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(o.pan.mag()){let g=Cr(o.pan.mag(),h,s.e({},mp,e||{})),v=o.pan.mult(g.amount/o.pan.mag()),w=this._map.cameraHelper.handlePanInertia(v,this._map.transform);f.center=w.easingCenter,f.offset=w.easingOffset,aa(f,g)}if(o.zoom){let g=Cr(o.zoom,h,gp);f.zoom=this._map.transform.zoom+g.amount,aa(f,g)}if(o.bearing){let g=Cr(o.bearing,h,yp);f.bearing=this._map.transform.bearing+s.ab(g.amount,-179,179),aa(f,g)}if(o.pitch){let g=Cr(o.pitch,h,_p);f.pitch=this._map.transform.pitch+g.amount,aa(f,g)}if(o.roll){let g=Cr(o.roll,h,vp);f.roll=this._map.transform.roll+s.ab(g.amount,-179,179),aa(f,g)}if(f.zoom||f.bearing){let g=o.pinchAround===void 0?o.around:o.pinchAround;f.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),s.e(f,{noMoveStart:!0})}}function aa(m,e){(!m.duration||m.duration<e.duration)&&(m.duration=e.duration,m.easing=e.easing)}function Cr(m,e,o){let{maxSpeed:h,linearity:f,deceleration:g}=o,v=s.ab(m*f/(e/1e3),-h,h),w=Math.abs(v)/(g*f);return{easing:o.easing,duration:1e3*w,amount:v*(w/2)}}class Tn extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h,f={}){let g=$.mousePos(o.getCanvas(),h),v=o.unproject(g);super(e,s.e({point:g,lngLat:v,originalEvent:h},f)),this._defaultPrevented=!1,this.target=o}}class la extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h){let f=e==="touchend"?h.changedTouches:h.touches,g=$.touchPos(o.getCanvasContainer(),f),v=g.map(E=>o.unproject(E)),w=g.reduce((E,T,A,R)=>E.add(T.div(R.length)),new s.P(0,0));super(e,{points:g,point:w,lngLats:v,lngLat:o.unproject(w),originalEvent:h}),this._defaultPrevented=!1}}class yi extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,h){super(e,{originalEvent:h}),this._defaultPrevented=!1}}class ca{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new yi(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new Tn(e.type,this._map,e))}mouseup(e){this._map.fire(new Tn(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new Tn(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Tn(e.type,this._map,e))}mouseover(e){this._map.fire(new Tn(e.type,this._map,e))}mouseout(e){this._map.fire(new Tn(e.type,this._map,e))}touchstart(e){return this._firePreventable(new la(e.type,this._map,e))}touchmove(e){this._map.fire(new la(e.type,this._map,e))}touchend(e){this._map.fire(new la(e.type,this._map,e))}touchcancel(e){this._map.fire(new la(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class o_{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Tn(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Tn(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pl{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(s.P.convert(e),this._map.terrain)}}class bp{constructor(e,o){this._map=e,this._tr=new pl(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;let h=o;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;let f=this._startPos;this._lastPos=h,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));let g=Math.min(f.x,h.x),v=Math.max(f.x,h.x),w=Math.min(f.y,h.y),E=Math.max(f.y,h.y);$.setTransform(this._box,`translate(${g}px,${w}px)`),this._box.style.width=v-g+"px",this._box.style.height=E-w+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;let h=this._startPos,f=o;if(this.reset(),$.suppressClick(),h.x!==f.x||h.y!==f.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:e})),{cameraAnimation:g=>g.fitScreenCoordinates(h,f,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new s.k(e,{originalEvent:o}))}}function Xd(m,e){if(m.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${m.length}, points ${e.length}`);let o={};for(let h=0;h<m.length;h++)o[m[h].identifier]=e[h];return o}class xp{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),h.length===this.numTouches&&(this.centroid=function(f){let g=new s.P(0,0);for(let v of f)g._add(v);return g.div(f.length)}(o),this.touches=Xd(h,o)))}touchmove(e,o,h){if(this.aborted||!this.centroid)return;let f=Xd(h,o);for(let g in this.touches){let v=f[g];(!v||v.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(e,o,h){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){let f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class xs{constructor(e){this.singleTap=new xp(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,h){this.singleTap.touchstart(e,o,h)}touchmove(e,o,h){this.singleTap.touchmove(e,o,h)}touchend(e,o,h){let f=this.singleTap.touchend(e,o,h);if(f){let g=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(f)<30;if(g&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class to{constructor(e){this._tr=new pl(e),this._zoomIn=new xs({numTouches:1,numTaps:2}),this._zoomOut=new xs({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,h){this._zoomIn.touchstart(e,o,h),this._zoomOut.touchstart(e,o,h)}touchmove(e,o,h){this._zoomIn.touchmove(e,o,h),this._zoomOut.touchmove(e,o,h)}touchend(e,o,h){let f=this._zoomIn.touchend(e,o,h),g=this._zoomOut.touchend(e,o,h),v=this._tr;return f?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(f)},{originalEvent:e})}):g?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(g)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class We{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){let o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.rollDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(o)?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;let h=this._lastPoint;if(!h)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);let f=Array.isArray(o)?o[0]:o;return!this._moved&&f.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=f,this._move(h,f))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}let wp={0:1,2:2};class ws{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){let o=$.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(o,h){let f=wp[h];return o.buttons===void 0||(o.buttons&f)!==f}(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class Cp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class ml{constructor(e=new ws({checkCorrectEvent:()=>!0}),o=new Cp){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=o}_executeRelevantHandler(e,o,h){return e instanceof MouseEvent?o(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?h(e):void 0}startMove(e){this._executeRelevantHandler(e,o=>this.mouseMoveStateManager.startMove(o),o=>this.oneFingerTouchMoveStateManager.startMove(o))}endMove(e){this._executeRelevantHandler(e,o=>this.mouseMoveStateManager.endMove(o),o=>this.oneFingerTouchMoveStateManager.endMove(o))}isValidStartEvent(e){return this._executeRelevantHandler(e,o=>this.mouseMoveStateManager.isValidStartEvent(o),o=>this.oneFingerTouchMoveStateManager.isValidStartEvent(o))}isValidMoveEvent(e){return this._executeRelevantHandler(e,o=>this.mouseMoveStateManager.isValidMoveEvent(o),o=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(o))}isValidEndEvent(e){return this._executeRelevantHandler(e,o=>this.mouseMoveStateManager.isValidEndEvent(o),o=>this.oneFingerTouchMoveStateManager.isValidEndEvent(o))}}let Ao=m=>{m.mousedown=m.dragStart,m.mousemoveWindow=m.dragMove,m.mouseup=m.dragEnd,m.contextmenu=e=>{e.preventDefault()}};class Ep{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,h){return this._calculateTransform(e,o,h)}touchmove(e,o,h){if(this._active){if(!this._shouldBePrevented(h.length))return e.preventDefault(),this._calculateTransform(e,o,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,h){this._calculateTransform(e,o,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,h){h.length>0&&(this._active=!0);let f=Xd(h,o),g=new s.P(0,0),v=new s.P(0,0),w=0;for(let T in f){let A=f[T],R=this._touches[T];R&&(g._add(A),v._add(A.sub(R)),w++,f[T]=A)}if(this._touches=f,this._shouldBePrevented(w)||!v.mag())return;let E=v.div(w);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(w),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,h){if(!this._firstTwoTouches)return;e.preventDefault();let[f,g]=this._firstTwoTouches,v=ua(h,o,f),w=ua(h,o,g);if(!v||!w)return;let E=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],E,e)}touchend(e,o,h){if(!this._firstTwoTouches)return;let[f,g]=this._firstTwoTouches,v=ua(h,o,f),w=ua(h,o,g);v&&w||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ua(m,e,o){for(let h=0;h<m.length;h++)if(m[h].identifier===o)return e[h]}function Ip(m,e){return Math.log(m/e)/Math.LN2}class Nc extends Pt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){let h=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ip(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ip(this._distance,h),pinchAround:o}}}function Tp(m,e){return 180*m.angleWith(e)/Math.PI}class Mp extends Pt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,h){let f=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tp(this._vector,f),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let o=25/(Math.PI*this._minDiameter)*360,h=Tp(e,this._startVector);return Math.abs(h)<o}}function Lc(m){return Math.abs(m.y)>Math.abs(m.x)}class Fc extends Pt{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,h){super.touchstart(e,o,h),this._currentTouchCount=h.length}_start(e){this._lastPoints=e,Lc(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;let f=e[0].sub(this._lastPoints[0]),g=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(f,g,h.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(f.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,h){if(this._valid!==void 0)return this._valid;let f=e.mag()>=2,g=o.mag()>=2;if(!f&&!g)return;if(!f||!g)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;let v=e.y>0==o.y>0;return Lc(e)&&Lc(o)&&v}}let Dp={panStep:100,bearingStep:15,pitchStep:10};class Sp{constructor(e){this._tr=new pl(e);let o=Dp;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,h=0,f=0,g=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?h=-1:(e.preventDefault(),g=-1);break;case 39:e.shiftKey?h=1:(e.preventDefault(),g=1);break;case 38:e.shiftKey?f=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?f=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,f=0),{cameraAnimation:w=>{let E=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:Pp,zoom:o?Math.round(E.zoom)+o*(e.shiftKey?2:1):E.zoom,bearing:E.bearing+h*this._bearingStep,pitch:E.pitch+f*this._pitchStep,offset:[-g*this._panStep,-v*this._panStep],center:E.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Pp(m){return m*(2-m)}let Ap=4.000244140625;class Rp{constructor(e,o){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=e,this._tr=new pl(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,h=W.now(),f=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,o!==0&&o%Ap==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(f*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let o=$.mousePos(this._map.getCanvas(),e),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(s.N.convert(h.center)):o,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){let w=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=w),typeof this._targetZoom=="number"&&(this._targetZoom+=w)}if(this._delta!==0){let w=this._type==="wheel"&&Math.abs(this._delta)>Ap?this._wheelZoomRate:this._defaultZoomRate,E=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&E!==0&&(E=1/E);let T=typeof this._targetZoom!="number"?e.scale:s.aG(this._targetZoom);this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,s.a8(T*E))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}let o=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,h=this._startZoom,f=this._easing,g,v=!1;if(this._type==="wheel"&&h&&f){let w=W.now()-this._lastWheelEventTime,E=Math.min((w+5)/200,1),T=f(E);g=s.y.number(h,o,T),E<1?this._frameId||(this._frameId=!0):v=!0}else g=o,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=g,{noInertia:!0,needsRenderFrame:!v,zoomDelta:g-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=s.c8;if(this._prevEase){let h=this._prevEase,f=(W.now()-h.start)/h.duration,g=h.easing(f+.01)-h.easing(f),v=.27/Math.sqrt(g*g+1e-4)*.01,w=Math.sqrt(.0729-v*v);o=s.c6(v,w,.25,1)}return this._prevEase={start:W.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class no{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pn{constructor(e){this._tr=new pl(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zc{constructor(){this._tap=new xs({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,h){if(!this._swipePoint)if(this._tapTime){let f=o[0],g=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(f)<30;g&&v?h.length>0&&(this._swipePoint=f,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(e,o,h)}touchmove(e,o,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;let f=o[0],g=f.y-this._swipePoint.y;return this._swipePoint=f,e.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(e,o,h)}touchend(e,o,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{let f=this._tap.touchend(e,o,h);f&&(this._tapTime=e.timeStamp,this._tapPoint=f)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bc{constructor(e,o,h){this._el=e,this._mousePan=o,this._touchPan=h}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yd{constructor(e,o,h,f){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=o,this._mousePitch=h,this._mouseRoll=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Kd{constructor(e,o,h,f){this._el=e,this._touchZoom=o,this._touchRotate=h,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Qd{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;let e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));let h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),f=document.createElement("div");f.className="maplibregl-desktop-message",f.textContent=o,this._container.appendChild(f);let g=document.createElement("div");g.className="maplibregl-mobile-message",g.textContent=h,this._container.appendChild(g),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new s.k("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}let jc=m=>m.zoom||m.drag||m.roll||m.pitch||m.rotate;class zi extends s.k{}function da(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta||m.rollDelta}class tt{constructor(e,o){this.handleWindowEvent=f=>{this.handleEvent(f,`${f.type}Window`)},this.handleEvent=(f,g)=>{if(f.type==="blur")return void this.stop(!0);this._updatingCamera=!0;let v=f.type==="renderFrame"?void 0:f,w={needsRenderFrame:!1},E={},T={},A=f.touches,R=A?this._getMapTouches(A):void 0,O=R?$.touchPos(this._map.getCanvas(),R):$.mousePos(this._map.getCanvas(),f);for(let{handlerName:K,handler:Y,allowed:Q}of this._handlers){if(!Y.isEnabled())continue;let ee;this._blockedByActive(T,Q,K)?Y.reset():Y[g||f.type]&&(ee=Y[g||f.type](f,O,R),this.mergeHandlerResult(w,E,ee,K,v),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||Y.isActive())&&(T[K]=Y)}let z={};for(let K in this._previousActiveHandlers)T[K]||(z[K]=v);this._previousActiveHandlers=T,(Object.keys(z).length||da(w))&&(this._changes.push([w,E,z]),this._triggerRenderFrame()),(Object.keys(T).length||da(w))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:U}=w;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fl(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);let h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(let[f,g,v]of this._listeners)$.addEventListener(f,g,f===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(let[e,o,h]of this._listeners)$.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(e){let o=this._map,h=o.getCanvasContainer();this._add("mapEvent",new ca(o,e));let f=o.boxZoom=new bp(o,e);this._add("boxZoom",f),e.interactive&&e.boxZoom&&f.enable();let g=o.cooperativeGestures=new Qd(o,e.cooperativeGestures);this._add("cooperativeGestures",g),e.cooperativeGestures&&g.enable();let v=new to(o),w=new pn(o);o.doubleClickZoom=new no(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();let E=new zc;this._add("tapDragZoom",E);let T=o.touchPitch=new Fc(o);this._add("touchPitch",T),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);let A=()=>o.project(o.getCenter()),R=function({enable:oe,clickTolerance:se,aroundCenter:ce=!0,minPixelCenterThreshold:le=100,rotateDegreesPerPixelMoved:ye=.8},ve){let Se=new ws({checkCorrectEvent:Re=>$.mouseButton(Re)===0&&Re.ctrlKey||$.mouseButton(Re)===2&&!Re.ctrlKey});return new We({clickTolerance:se,move:(Re,Ee)=>{let Ue=ve();if(ce&&Math.abs(Ue.y-Re.y)>le)return{bearingDelta:s.c7(new s.P(Re.x,Ee.y),Ee,Ue)};let je=(Ee.x-Re.x)*ye;return ce&&Ee.y<Ue.y&&(je=-je),{bearingDelta:je}},moveStateManager:Se,enable:oe,assignEvents:Ao})}(e,A),O=function({enable:oe,clickTolerance:se,pitchDegreesPerPixelMoved:ce=-.5}){let le=new ws({checkCorrectEvent:ye=>$.mouseButton(ye)===0&&ye.ctrlKey||$.mouseButton(ye)===2});return new We({clickTolerance:se,move:(ye,ve)=>({pitchDelta:(ve.y-ye.y)*ce}),moveStateManager:le,enable:oe,assignEvents:Ao})}(e),z=function({enable:oe,clickTolerance:se,rollDegreesPerPixelMoved:ce=.3},le){let ye=new ws({checkCorrectEvent:ve=>$.mouseButton(ve)===2&&ve.ctrlKey});return new We({clickTolerance:se,move:(ve,Se)=>{let Re=le(),Ee=(Se.x-ve.x)*ce;return Se.y<Re.y&&(Ee=-Ee),{rollDelta:Ee}},moveStateManager:ye,enable:oe,assignEvents:Ao})}(e,A);o.dragRotate=new Yd(e,R,O,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate","mouseRoll"]),this._add("mouseRoll",z,["mousePitch"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();let U=function({enable:oe,clickTolerance:se}){let ce=new ws({checkCorrectEvent:le=>$.mouseButton(le)===0&&!le.ctrlKey});return new We({clickTolerance:se,move:(le,ye)=>({around:ye,panDelta:ye.sub(le)}),activateOnStart:!0,moveStateManager:ce,enable:oe,assignEvents:Ao})}(e),K=new Ep(e,o);o.dragPan=new Bc(h,U,K),this._add("mousePan",U),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);let Y=new Mp,Q=new Nc;o.touchZoomRotate=new Kd(h,Q,Y,E),this._add("touchRotate",Y,["touchPan","touchZoom"]),this._add("touchZoom",Q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);let ee=o.scrollZoom=new Rp(o,()=>this._triggerRenderFrame());this._add("scrollZoom",ee,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);let ie=o.keyboard=new Sp(o);this._add("keyboard",ie),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new o_(o))}_add(e,o,h){this._handlers.push({handlerName:e,handler:o,allowed:h}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(let{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!jc(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,h){for(let f in e)if(f!==h&&(!o||o.indexOf(f)<0))return!0;return!1}_getMapTouches(e){let o=[];for(let h of e)this._el.contains(h.target)&&o.push(h);return o}mergeHandlerResult(e,o,h,f,g){if(!h)return;s.e(e,h);let v={handlerName:f,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(o.zoom=v),h.panDelta!==void 0&&(o.drag=v),h.rollDelta!==void 0&&(o.roll=v),h.pitchDelta!==void 0&&(o.pitch=v),h.bearingDelta!==void 0&&(o.rotate=v)}_applyChanges(){let e={},o={},h={};for(let[f,g,v]of this._changes)f.panDelta&&(e.panDelta=(e.panDelta||new s.P(0,0))._add(f.panDelta)),f.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+f.pitchDelta),f.rollDelta&&(e.rollDelta=(e.rollDelta||0)+f.rollDelta),f.around!==void 0&&(e.around=f.around),f.pinchAround!==void 0&&(e.pinchAround=f.pinchAround),f.noInertia&&(e.noInertia=f.noInertia),s.e(o,g),s.e(h,v);this._updateMapTransform(e,o,h),this._changes=[]}_updateMapTransform(e,o,h){let f=this._map,g=f._getTransformForUpdate(),v=f.terrain;if(!(da(e)||v&&this._terrainMovement))return this._fireEvents(o,h,!0);f._stop(!0);let{panDelta:w,zoomDelta:E,bearingDelta:T,pitchDelta:A,rollDelta:R,around:O,pinchAround:z}=e;z!==void 0&&(O=z),O=O||f.transform.centerPoint,v&&!g.isPointOnMapSurface(O)&&(O=g.centerPoint);let U={panDelta:w,zoomDelta:E,rollDelta:R,pitchDelta:A,bearingDelta:T,around:O};this._map.cameraHelper.useGlobeControls&&!g.isPointOnMapSurface(O)&&(O=g.centerPoint);let K=O.distSqr(g.centerPoint)<.01?g.center:g.screenPointToLocation(w?O.sub(w):O);v?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?g.setCenter(g.screenPointToLocation(g.centerPoint.sub(w))):this._map.cameraHelper.handleMapControlsPan(U,g,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(U,g,K))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,g),this._map.cameraHelper.handleMapControlsPan(U,g,K)),f._applyUpdatedTransform(g),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,h,!0)}_fireEvents(e,o,h){let f=jc(this._eventsInProgress),g=jc(e),v={};for(let R in e){let{originalEvent:O}=e[R];this._eventsInProgress[R]||(v[`${R}start`]=O),this._eventsInProgress[R]=e[R]}!f&&g&&this._fireEvent("movestart",g.originalEvent);for(let R in v)this._fireEvent(R,v[R]);g&&this._fireEvent("move",g.originalEvent);for(let R in e){let{originalEvent:O}=e[R];this._fireEvent(R,O)}let w={},E;for(let R in this._eventsInProgress){let{handlerName:O,originalEvent:z}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],E=o[O]||z,w[`${R}end`]=E)}for(let R in w)this._fireEvent(R,w[R]);let T=jc(this._eventsInProgress),A=(f||g)&&!T;if(A&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;let R=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&R.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(R)}if(h&&A){this._updatingCamera=!0;let R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;!R||!R.essential&&W.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:E})),O(this._map.getBearing())&&this._map.resetNorth()):(O(R.bearing||this._map.getBearing())&&(R.bearing=0),R.freezeElevation=!0,this._map.easeTo(R,{originalEvent:E})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new s.k(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new zi("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ct extends s.E{constructor(e,o,h){super(),this._renderFrameCallback=()=>{let f=Math.min((W.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(f)),f<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=h.bearingSnap,this.cameraHelper=o,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,o){e.apply(this.transform),this.transform=e,this.cameraHelper=o}getCenter(){return new s.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,o){return this.jumpTo({elevation:e},o),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,o,h){return e=s.P.convert(e).mult(-1),this.panTo(this.transform.center,s.e({offset:e},o),h)}panTo(e,o,h){return this.easeTo(s.e({center:e},o),h)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,h){return this.easeTo(s.e({zoom:e},o),h)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,o){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new s.k("movestart",o)).fire(new s.k("move",o)).fire(new s.k("moveend",o))),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,h){return this.easeTo(s.e({bearing:e},o),h)}resetNorth(e,o){return this.rotateTo(0,s.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(s.e({bearing:0,pitch:0,roll:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}getRoll(){return this.transform.roll}setRoll(e,o){return this.jumpTo({roll:e},o),this}cameraForBounds(e,o){e=Dn.convert(e).adjustAntiMeridian();let h=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),h,o)}_cameraForBoxAndBearing(e,o,h,f){let g={top:0,bottom:0,right:0,left:0};if(typeof(f=s.e({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},f)).padding=="number"){let T=f.padding;f.padding={top:T,bottom:T,right:T,left:T}}let v=s.e(g,f.padding);f.padding=v;let w=this.transform,E=new Dn(e,o);return this.cameraHelper.cameraForBoxAndBearing(f,v,E,h,w)}fitBounds(e,o,h){return this._fitInternal(this.cameraForBounds(e,o),o,h)}fitScreenCoordinates(e,o,h,f,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(s.P.convert(e)),this.transform.screenPointToLocation(s.P.convert(o)),h,f),f,g)}_fitInternal(e,o,h){return e?(delete(o=s.e(e,o)).padding,o.linear?this.easeTo(o,h):this.flyTo(o,h)):this}jumpTo(e,o){this.stop();let h=this._getTransformForUpdate(),f=!1,g=!1,v=!1,w=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,e);let E=h.zoom!==w;return"elevation"in e&&h.elevation!==+e.elevation&&h.setElevation(+e.elevation),"bearing"in e&&h.bearing!==+e.bearing&&(f=!0,h.setBearing(+e.bearing)),"pitch"in e&&h.pitch!==+e.pitch&&(g=!0,h.setPitch(+e.pitch)),"roll"in e&&h.roll!==+e.roll&&(v=!0,h.setRoll(+e.roll)),e.padding==null||h.isPaddingEqual(e.padding)||h.setPadding(e.padding),this._applyUpdatedTransform(h),this.fire(new s.k("movestart",o)).fire(new s.k("move",o)),E&&this.fire(new s.k("zoomstart",o)).fire(new s.k("zoom",o)).fire(new s.k("zoomend",o)),f&&this.fire(new s.k("rotatestart",o)).fire(new s.k("rotate",o)).fire(new s.k("rotateend",o)),g&&this.fire(new s.k("pitchstart",o)).fire(new s.k("pitch",o)).fire(new s.k("pitchend",o)),v&&this.fire(new s.k("rollstart",o)).fire(new s.k("roll",o)).fire(new s.k("rollend",o)),this.fire(new s.k("moveend",o))}calculateCameraOptionsFromTo(e,o,h,f=0){let g=s.Y.fromLngLat(e,o),v=s.Y.fromLngLat(h,f),w=v.x-g.x,E=v.y-g.y,T=v.z-g.z,A=Math.hypot(w,E,T);if(A===0)throw new Error("Can't calculate camera options with same From and To");let R=Math.hypot(w,E),O=s.a8(this.transform.cameraToCenterDistance/A/this.transform.tileSize),z=180*Math.atan2(w,-E)/Math.PI,U=180*Math.acos(R/A)/Math.PI;return U=T<0?90-U:90+U,{center:v.toLngLat(),elevation:f,zoom:O,pitch:U,bearing:z}}calculateCameraOptionsFromCameraLngLatAltRotation(e,o,h,f,g){let v=this.transform.calculateCenterFromCameraLngLatAlt(e,o,h,f);return{center:v.center,elevation:v.elevation,zoom:v.zoom,bearing:h,pitch:f,roll:g}}easeTo(e,o){this._stop(!1,e.easeId),((e=s.e({offset:[0,0],duration:500,easing:s.c8},e)).animate===!1||!e.essential&&W.prefersReducedMotion)&&(e.duration=0);let h=this._getTransformForUpdate(),f=this.getBearing(),g=h.pitch,v=h.roll,w="bearing"in e?this._normalizeBearing(e.bearing,f):f,E="pitch"in e?+e.pitch:g,T="roll"in e?this._normalizeBearing(e.roll,v):v,A="padding"in e?e.padding:h.padding,R=s.P.convert(e.offset),O,z;e.around&&(O=s.N.convert(e.around),z=h.locationToScreenPoint(O));let U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(h,{bearing:w,pitch:E,roll:T,padding:A,around:O,aroundPoint:z,offsetAsPoint:R,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||f!==w,this._pitching=this._pitching||E!==g,this._rolling=this._rolling||T!==v,this._padding=!h.isPaddingEqual(A),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,U),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease(Y=>{K.easeFunc(Y),this.terrain&&!e.freezeElevation&&this._updateElevation(Y),this._applyUpdatedTransform(h),this._fireMoveEvents(o)},Y=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,Y)},e),this}_prepareEase(e,o,h={}){this._moving=!0,o||h.moving||this.fire(new s.k("movestart",e)),this._zooming&&!h.zooming&&this.fire(new s.k("zoomstart",e)),this._rotating&&!h.rotating&&this.fire(new s.k("rotatestart",e)),this._pitching&&!h.pitching&&this.fire(new s.k("pitchstart",e)),this._rolling&&!h.rolling&&this.fire(new s.k("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));let o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){let h=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(h-(o-(h*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.setElevation(s.y.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};let o=e.getCameraLngLat(),h=e.getCameraAltitude(),f=this.terrain?this.terrain.getElevationForLngLatZoom(o,e.zoom):0;if(h<f){let g=this.calculateCameraOptionsFromTo(o,f,e.center,e.elevation);return{pitch:g.pitch,zoom:g.zoom}}return{}}_applyUpdatedTransform(e){let o=[];if(o.push(f=>this._elevateCameraIfInsideTerrain(f)),this.transformCameraUpdate&&o.push(f=>this.transformCameraUpdate(f)),!o.length)return;let h=e.clone();for(let f of o){let g=h.clone(),{center:v,zoom:w,roll:E,pitch:T,bearing:A,elevation:R}=f(g);v&&g.setCenter(v),R!==void 0&&g.setElevation(R),w!==void 0&&g.setZoom(w),E!==void 0&&g.setRoll(E),T!==void 0&&g.setPitch(T),A!==void 0&&g.setBearing(A),h.apply(g)}this.transform.apply(h)}_fireMoveEvents(e){this.fire(new s.k("move",e)),this._zooming&&this.fire(new s.k("zoom",e)),this._rotating&&this.fire(new s.k("rotate",e)),this._pitching&&this.fire(new s.k("pitch",e)),this._rolling&&this.fire(new s.k("roll",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;let h=this._zooming,f=this._rotating,g=this._pitching,v=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new s.k("zoomend",e)),f&&this.fire(new s.k("rotateend",e)),g&&this.fire(new s.k("pitchend",e)),v&&this.fire(new s.k("rollend",e)),this.fire(new s.k("moveend",e))}flyTo(e,o){if(!e.essential&&W.prefersReducedMotion){let Ee=s.M(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Ee,o)}this.stop(),e=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.c8},e);let h=this._getTransformForUpdate(),f=h.bearing,g=h.pitch,v=h.roll,w=h.padding,E="bearing"in e?this._normalizeBearing(e.bearing,f):f,T="pitch"in e?+e.pitch:g,A="roll"in e?this._normalizeBearing(e.roll,v):v,R="padding"in e?e.padding:h.padding,O=s.P.convert(e.offset),z=h.centerPoint.add(O),U=h.screenPointToLocation(z),K=this.cameraHelper.handleFlyTo(h,{bearing:E,pitch:T,roll:A,padding:R,locationAtOffset:U,offsetAsPoint:O,center:e.center,minZoom:e.minZoom,zoom:e.zoom}),Y=e.curve,Q=Math.max(h.width,h.height),ee=Q/K.scaleOfZoom,ie=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(Y=Math.sqrt(Q/K.scaleOfMinZoom/ie*2));let oe=Y*Y;function se(Ee){let Ue=(ee*ee-Q*Q+(Ee?-1:1)*oe*oe*ie*ie)/(2*(Ee?ee:Q)*oe*ie);return Math.log(Math.sqrt(Ue*Ue+1)-Ue)}function ce(Ee){return(Math.exp(Ee)-Math.exp(-Ee))/2}function le(Ee){return(Math.exp(Ee)+Math.exp(-Ee))/2}let ye=se(!1),ve=function(Ee){return le(ye)/le(ye+Y*Ee)},Se=function(Ee){return Q*((le(ye)*(ce(Ue=ye+Y*Ee)/le(Ue))-ce(ye))/oe)/ie;var Ue},Re=(se(!0)-ye)/Y;if(Math.abs(ie)<2e-6||!isFinite(Re)){if(Math.abs(Q-ee)<1e-6)return this.easeTo(e,o);let Ee=ee<Q?-1:1;Re=Math.abs(Math.log(ee/Q))/Y,Se=()=>0,ve=Ue=>Math.exp(Ee*Y*Ue)}return e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/Y:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=f!==E,this._pitching=T!==g,this._rolling=A!==v,this._padding=!h.isPaddingEqual(R),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease(Ee=>{let Ue=Ee*Re,je=1/ve(Ue),Oe=Se(Ue);this._rotating&&h.setBearing(s.y.number(f,E,Ee)),this._pitching&&h.setPitch(s.y.number(g,T,Ee)),this._rolling&&h.setRoll(s.y.number(v,A,Ee)),this._padding&&(h.interpolatePadding(w,R,Ee),z=h.centerPoint.add(O)),K.easeFunc(Ee,je,Oe,z),this.terrain&&!e.freezeElevation&&this._updateElevation(Ee),this._applyUpdatedTransform(h),this._fireMoveEvents(o)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){let f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,o)}return e||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(e,o,h){h.animate===!1||h.duration===0?(e(1),o()):(this._easeStart=W.now(),this._easeOptions=h,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=s.aI(e,-180,180);let h=Math.abs(e-o);return Math.abs(e-360-o)<h&&(e-=360),Math.abs(e+360-o)<h&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(s.N.convert(e),this.transform.tileZoom):null}}let gl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Vc{constructor(e=gl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(e,o){let h=this._map._getUIString(`AttributionControl.${o}`);e.title=h,e.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(f=>typeof f!="string"?"":f)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){let f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}let o=this._map.style.sourceCaches;for(let f in o){let g=o[f];if(g.used||g.usedForTerrain){let v=g.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(f=>String(f).trim()),e.sort((f,g)=>f.length-g.length),e=e.filter((f,g)=>{for(let v=g+1;v<e.length;v++)if(e[v].indexOf(f)>=0)return!1;return!0});let h=e.join(" | ");h!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=$.sanitize(h),e.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Uc{constructor(e={}){this._updateCompact=()=>{let o=this._container.children;if(o.length){let h=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");let o=$.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Mr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){let o=this._currentlyRunning,h=o?this._queue.concat(o):this._queue;for(let f of h)if(f.id===e)return void(f.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");let o=this._currentlyRunning=this._queue;this._queue=[];for(let h of o)if(!h.cancelled&&(h.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var kp=s.aA([{name:"a_pos3d",type:"Int16",components:3}]);class Bi extends s.E{constructor(e){super(),this._lastTilesetChange=W.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];let h={};for(let f of X(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))h[f.key]=!0,this._renderableTilesKeys.push(f.key),this._tiles[f.key]||(f.terrainRttPosMatrix32f=new Float64Array(16),s.bL(f.terrainRttPosMatrix32f,0,s.X,s.X,0,0,1),this._tiles[f.key]=new ss(f,this.tileSize),this._lastTilesetChange=W.now());for(let f in this._tiles)h[f]||delete this._tiles[f]}freeRtt(e){for(let o in this._tiles){let h=this._tiles[o];(!e||h.tileID.equals(e)||h.tileID.isChildOf(e)||e.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){let o={};for(let h of this._renderableTilesKeys){let f=this._tiles[h].tileID,g=e.clone(),v=s.a$();if(f.canonical.equals(e.canonical))s.bL(v,0,s.X,s.X,0,0,1);else if(f.canonical.isChildOf(e.canonical)){let w=f.canonical.z-e.canonical.z,E=f.canonical.x-(f.canonical.x>>w<<w),T=f.canonical.y-(f.canonical.y>>w<<w),A=s.X>>w;s.bL(v,0,A,A,0,0,1),s.J(v,v,[-E*A,-T*A,0])}else{if(!e.canonical.isChildOf(f.canonical))continue;{let w=e.canonical.z-f.canonical.z,E=e.canonical.x-(e.canonical.x>>w<<w),T=e.canonical.y-(e.canonical.y>>w<<w),A=s.X>>w;s.bL(v,0,s.X,s.X,0,0,1),s.J(v,v,[E*A,T*A,0]),s.K(v,v,[1/2**w,1/2**w,0])}}g.terrainRttPosMatrix32f=new Float32Array(v),o[h]=g}return o}getSourceTile(e,o){let h=this.sourceCache._source,f=e.overscaledZ-this.deltaZoom;if(f>h.maxzoom&&(f=h.maxzoom),f<h.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(f).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!g||!g.dem)&&o)for(;f>=h.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(e.scaledTo(f--).key);return g}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}}class s_{constructor(e,o,h){this._meshCache={},this.painter=e,this.sourceCache=new Bi(o),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,h,f=s.X){var g;if(!(o>=0&&o<f&&h>=0&&h<f))return 0;let v=this.getTerrainData(e),w=(g=v.tile)===null||g===void 0?void 0:g.dem;if(!w)return 0;let E=s.c9([],[o/f*s.X,h/f*s.X],v.u_terrain_matrix),T=[E[0]*w.dim,E[1]*w.dim],A=Math.floor(T[0]),R=Math.floor(T[1]),O=T[0]-A,z=T[1]-R;return w.get(A,R)*(1-O)*(1-z)+w.get(A+1,R)*O*(1-z)+w.get(A,R+1)*(1-O)*z+w.get(A+1,R+1)*O*z}getElevationForLngLatZoom(e,o){if(!s.ca(o,e.wrap()))return 0;let{tileID:h,mercatorX:f,mercatorY:g}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(h,f%s.X,g%s.X,s.X)}getElevation(e,o,h,f=s.X){return this.getDEMElevation(e,o,h,f)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){let f=this.painter.context,g=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Vt(f,g,f.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Vt(f,new s.R({width:1,height:1}),f.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.aq([])}let o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){let f=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new Vt(f,o.dem.getPixels(),f.gl.RGBA,{premultiply:!1}),o.demTexture.bind(f.gl.NEAREST,f.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}let h=o&&o+o.tileID.key+e.key;if(h&&!this._demMatrixCache[h]){let f=this.sourceCache.sourceCache._source.maxzoom,g=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=f?g=e.canonical.z-f:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));let v=e.canonical.x-(e.canonical.x>>g<<g),w=e.canonical.y-(e.canonical.y>>g<<g),E=s.cb(new Float64Array(16),[1/(s.X<<g),1/(s.X<<g),0]);s.J(E,E,[v*s.X,w*s.X,0]),this._demMatrixCache[e.key]={matrix:E,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){let o=this.painter,h=o.width/devicePixelRatio,f=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===f||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Vt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Vt(o.context,{width:h,height:f,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(h,f,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,h,f))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){let e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;let o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,v=0;g<this._coordsTextureSize;g++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)o[v+0]=255&w,o[v+1]=255&g,o[v+2]=w>>8<<4|g>>8,o[v+3]=0;let h=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),f=new Vt(e,h,e.gl.RGBA,{premultiply:!1});return f.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=f,f}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);let o=new Uint8Array(4),h=this.painter.context,f=h.gl,g=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),f.readPixels(g,w-v-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null);let E=o[0]+(o[2]>>4<<8),T=o[1]+((15&o[2])<<8),A=this.coordsIndex[255-o[3]],R=A&&this.sourceCache.getTileByID(A);if(!R)return null;let O=this._coordsTextureSize,z=(1<<R.tileID.canonical.z)*O;return new s.Y((R.tileID.canonical.x*O+E)/z+R.tileID.wrap,(R.tileID.canonical.y*O+T)/z,this.getElevation(R.tileID,E,T,O))}depthAtPoint(e){let o=new Uint8Array(4),h=this.painter.context,f=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),f.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,f.RGBA,f.UNSIGNED_BYTE,o),h.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(e){var o;let h=((o=this.painter.style.projection)===null||o===void 0?void 0:o.transitionState)>0,f=h&&e.canonical.y===0,g=h&&e.canonical.y===(1<<e.canonical.z)-1,v=`m_${f?"n":""}_${g?"s":""}`;if(this._meshCache[v])return this._meshCache[v];let w=this.painter.context,E=new s.cc,T=new s.aE,A=this.meshSize,R=s.X/A,O=A*A;for(let le=0;le<=A;le++)for(let ye=0;ye<=A;ye++)E.emplaceBack(ye*R,le*R,0);for(let le=0;le<O;le+=A+1)for(let ye=0;ye<A;ye++)T.emplaceBack(ye+le,A+ye+le+1,A+ye+le+2),T.emplaceBack(ye+le,A+ye+le+2,ye+le+1);let z=E.length,U=z+(A+1),K=(A+1)*A,Y=f?s.b6:0,Q=f?0:1,ee=g?s.b7:s.X,ie=g?0:1;for(let le=0;le<=A;le++)E.emplaceBack(le*R,Y,Q);for(let le=0;le<=A;le++)E.emplaceBack(le*R,ee,ie);for(let le=0;le<A;le++)T.emplaceBack(K+le,U+le,U+le+1),T.emplaceBack(K+le,U+le+1,K+le+1),T.emplaceBack(0+le,z+le+1,z+le),T.emplaceBack(0+le,0+le+1,z+le+1);let oe=E.length,se=oe+2*(A+1);for(let le of[0,1])for(let ye=0;ye<=A;ye++)for(let ve of[0,1])E.emplaceBack(le*s.X,ye*R,ve);for(let le=0;le<2*A;le+=2)T.emplaceBack(oe+le,oe+le+1,oe+le+3),T.emplaceBack(oe+le,oe+le+3,oe+le+2),T.emplaceBack(se+le,se+le+3,se+le+1),T.emplaceBack(se+le,se+le+2,se+le+3);let ce=new Li(w.createVertexBuffer(E,kp.members),w.createIndexBuffer(T),s.aD.simpleSegment(0,0,E.length,T.length));return this._meshCache[v]=ce,ce}getMeshFrameDelta(e){return 2*Math.PI*s.bo/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,o){var h;let{tileID:f}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(h=this.getMinMaxElevation(f).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(e){let o=this.getTerrainData(e).tile,h={minElevation:null,maxElevation:null};return o&&o.dem&&(h.minElevation=o.dem.min*this.exaggeration,h.maxElevation=o.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(e,o){let h=s.Y.fromLngLat(e.wrap()),f=(1<<o)*s.X,g=h.x*f,v=h.y*f,w=Math.floor(g/s.X),E=Math.floor(v/s.X);return{tileID:new s.S(o,0,o,w,E),mercatorX:g,mercatorY:v}}}class yl{constructor(e,o,h){this._context=e,this._size=o,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(let e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){let o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new Vt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(h.texture),{id:e,fbo:o,texture:h,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(o=>e.id!==o),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(let o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");let e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(let e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}let rn={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Sn{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new yl(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(h=>!e._layers[h].isHidden(o)),this._coordsAscending={};for(let h in e.sourceCaches){this._coordsAscending[h]={};let f=e.sourceCaches[h].getVisibleCoordinates();for(let g of f){let v=this.terrain.sourceCache.getTerrainCoords(g);for(let w in v)this._coordsAscending[h][w]||(this._coordsAscending[h][w]=[]),this._coordsAscending[h][w].push(v[w])}}this._coordsAscendingStr={};for(let h of e._order){let f=e._layers[h],g=f.source;if(rn[f.type]&&!this._coordsAscendingStr[g]){this._coordsAscendingStr[g]={};for(let v in this._coordsAscending[g])this._coordsAscendingStr[g][v]=this._coordsAscending[g][v].map(w=>w.key).sort().join()}}for(let h of this._renderableTiles)for(let f in this._coordsAscendingStr){let g=this._coordsAscendingStr[f][h.tileID.key];g&&g!==h.rttCoords[f]&&(h.rtt=[])}}renderLayer(e,o){if(e.isHidden(this.painter.transform.zoom))return!1;let h=Object.assign(Object.assign({},o),{isRenderingToTexture:!0}),f=e.type,g=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(rn[f]&&(this._prevType&&rn[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(e.id),!v))return!0;if(rn[this._prevType]||rn[f]&&v){this._prevType=f;let w=this._stacks.length-1,E=this._stacks[w]||[];for(let T of this._renderableTiles){if(this.pool.isFull()&&(qd(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(T),T.rtt[w]){let R=this.pool.getObjectForId(T.rtt[w].id);if(R.stamp===T.rtt[w].stamp){this.pool.useObject(R);continue}}let A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),T.rtt[w]={id:A.id,stamp:A.stamp},g.context.bindFramebuffer.set(A.fbo.framebuffer),g.context.clear({color:s.b4.transparent,stencil:0}),g.currentStencilSource=void 0;for(let R=0;R<E.length;R++){let O=g.style._layers[E[R]],z=O.source?this._coordsAscending[O.source][T.tileID.key]:[T.tileID];g.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),g._renderTileClippingMasks(O,z,!0),g.renderLayer(g,g.style.sourceCaches[O.source],O,z,h),O.source&&(T.rttCoords[O.source]=this._coordsAscendingStr[O.source][T.tileID.key])}}return qd(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),rn[f]}return!1}}let Op={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use \u2318 + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},_l=x,vl={hash:!1,interactive:!0,bearingSnap:7,attributionControl:gl,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Jd={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class eh{constructor(e,o,h=!1){this.mousedown=g=>{this.startMove(g,$.mousePos(this.element,g)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=g=>{this.move(g,$.mousePos(this.element,g))},this.mouseup=g=>{this._rotatePitchHanlder.dragEnd(g),this.offTemp()},this.touchstart=g=>{g.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,g.targetTouches)[0],this.startMove(g,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=g=>{g.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,g.targetTouches)[0],this.move(g,this._lastPos))},this.touchend=g=>{g.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=o;let f=new ml;this._rotatePitchHanlder=new We({clickTolerance:3,move:(g,v)=>{let w=o.getBoundingClientRect(),E=new s.P((w.bottom-w.top)/2,(w.right-w.left)/2);return{bearingDelta:s.c7(new s.P(g.x,v.y),v,E),pitchDelta:h?-.5*(v.y-g.y):void 0}},moveStateManager:f,enable:!0,assignEvents:()=>{}}),this.map=e,$.addEventListener(o,"mousedown",this.mousedown),$.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(o,"touchcancel",this.reset)}startMove(e,o){this._rotatePitchHanlder.dragStart(e,o),$.disableDrag()}move(e,o){let h=this.map,{bearingDelta:f,pitchDelta:g}=this._rotatePitchHanlder.dragMove(e,o)||{};f&&h.setBearing(h.getBearing()+f),g&&h.setPitch(h.getPitch()+g)}off(){let e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let ro;function ha(m,e,o){let h=new s.N(m.lng,m.lat);if(m=new s.N(m.lng,m.lat),e){let f=new s.N(m.lng-360,m.lat),g=new s.N(m.lng+360,m.lat),v=o.locationToScreenPoint(m).distSqr(e);o.locationToScreenPoint(f).distSqr(e)<v?m=f:o.locationToScreenPoint(g).distSqr(e)<v&&(m=g)}for(;Math.abs(m.lng-o.center.lng)>180;){let f=o.locationToScreenPoint(m);if(f.x>=0&&f.y>=0&&f.x<=o.width&&f.y<=o.height)break;m.lng>o.center.lng?m.lng-=360:m.lng+=360}return m.lng!==h.lng&&o.isPointOnMapSurface(o.locationToScreenPoint(m))?m:h}let bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $c(m,e,o){let h=m.classList;for(let f in bl)h.remove(`maplibregl-${o}-anchor-${f}`);h.add(`maplibregl-${o}-anchor-${e}`)}class xl extends s.E{constructor(e){if(super(),this._onKeyPress=o=>{let h=o.code,f=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&f!==32&&f!==13||this.togglePopup()},this._onMapClick=o=>{let h=o.originalEvent.target,f=this._element;this._popup&&(h===f||f.contains(h))&&this.togglePopup()},this._update=o=>{var h;if(!this._map)return;let f=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!f)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ha(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(g=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${bl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${g}`),W.frameAsync(new AbortController).then(()=>{this._updateOpacity(o&&o.type==="moveend")}).catch(()=>{})},this._onMove=o=>{if(!this._isDragging){let h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=s.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");let o=$.createNS("http://www.w3.org/2000/svg","svg"),h=41,f=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${h}px`),o.setAttributeNS(null,"width",`${f}px`),o.setAttributeNS(null,"viewBox",`0 0 ${f} ${h}`);let g=$.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"stroke","none"),g.setAttributeNS(null,"stroke-width","1"),g.setAttributeNS(null,"fill","none"),g.setAttributeNS(null,"fill-rule","evenodd");let v=$.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");let w=$.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");let E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(let Q of E){let ee=$.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Q.rx),ee.setAttributeNS(null,"ry",Q.ry),w.appendChild(ee)}let T=$.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);let A=$.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(A);let R=$.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");let O=$.createNS("http://www.w3.org/2000/svg","path");O.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(O);let z=$.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"transform","translate(6.0, 7.0)"),z.setAttributeNS(null,"fill","#FFFFFF");let U=$.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");let K=$.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");let Y=$.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#FFFFFF"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962"),U.appendChild(K),U.appendChild(Y),v.appendChild(w),v.appendChild(T),v.appendChild(R),v.appendChild(z),v.appendChild(U),o.appendChild(v),o.setAttributeNS(null,"height",h*this._scale+"px"),o.setAttributeNS(null,"width",f*this._scale+"px"),this._element.appendChild(o),this._offset=s.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()}),$c(this._element,this._anchor,"marker"),e&&e.className)for(let o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=s.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let f=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(38.1-13.5+f)],"bottom-right":[-f,-1*(38.1-13.5+f)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){let e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,h;if(!(!((o=this._map)===null||o===void 0)&&o.terrain)){let R=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==R&&(this._element.style.opacity=R))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}let f=this._map,g=f.terrain.depthAtPoint(this._pos),v=f.terrain.getElevationForLngLatZoom(this._lngLat,f.transform.tileZoom);if(f.transform.lngLatToCameraDepth(this._lngLat,v)-g<.006)return void(this._element.style.opacity=this._opacity);let w=-this._offset.y/f.transform.pixelsPerMeter,E=Math.sin(f.getPitch()*Math.PI/180)*w,T=f.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),A=f.transform.lngLatToCameraDepth(this._lngLat,v+E)-T>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=s.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return e===void 0&&o===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}let th={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},fa=0,Cs=!1,nh={maxWidth:100,unit:"metric"};function Hc(m,e,o){let h=o&&o.maxWidth||100,f=m._container.clientHeight/2,g=m._container.clientWidth/2,v=m.unproject([g-h/2,f]),w=m.unproject([g+h/2,f]),E=Math.round(m.project(w).x-m.project(v).x),T=Math.min(h,E,m._container.clientWidth),A=v.distanceTo(w);if(o&&o.unit==="imperial"){let R=3.2808*A;R>5280?Ro(e,T,R/5280,m._getUIString("ScaleControl.Miles")):Ro(e,T,R,m._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ro(e,T,A/1852,m._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Ro(e,T,A/1e3,m._getUIString("ScaleControl.Kilometers")):Ro(e,T,A,m._getUIString("ScaleControl.Meters"))}function Ro(m,e,o,h){let f=function(g){let v=Math.pow(10,`${Math.floor(g)}`.length-1),w=g/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){let T=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*T)/T}(w),v*w}(o);m.style.width=e*(f/o)+"px",m.innerHTML=`${f}&nbsp;${h}`}let rh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ih=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wl(m){if(m){if(typeof m=="number"){let e=Math.round(Math.abs(m)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,m),"top-left":new s.P(e,e),"top-right":new s.P(-e,e),bottom:new s.P(0,-m),"bottom-left":new s.P(e,-e),"bottom-right":new s.P(-e,-e),left:new s.P(m,0),right:new s.P(-m,0)}}if(m instanceof s.P||Array.isArray(m)){let e=s.P.convert(m);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:s.P.convert(m.center||[0,0]),top:s.P.convert(m.top||[0,0]),"top-left":s.P.convert(m["top-left"]||[0,0]),"top-right":s.P.convert(m["top-right"]||[0,0]),bottom:s.P.convert(m.bottom||[0,0]),"bottom-left":s.P.convert(m["bottom-left"]||[0,0]),"bottom-right":s.P.convert(m["bottom-right"]||[0,0]),left:s.P.convert(m.left||[0,0]),right:s.P.convert(m.right||[0,0])}}return wl(new s.P(0,0))}let oh=x;u.AJAXError=s.cg,u.Event=s.k,u.Evented=s.E,u.LngLat=s.N,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.ch,u.config=s.a,u.removeProtocol=s.ci,u.AttributionControl=Vc,u.BoxZoomHandler=bp,u.CanvasSource=rs,u.CooperativeGesturesHandler=Qd,u.DoubleClickZoomHandler=no,u.DragPanHandler=Bc,u.DragRotateHandler=Yd,u.EdgeInsets=pr,u.FullscreenControl=class extends s.E{constructor(m={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,m&&m.container&&(m.container instanceof HTMLElement?this._container=m.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){let m=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){let m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.title=m}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Co,u.GeolocateControl=class extends s.E{constructor(m){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{let o=new s.N(e.coords.longitude,e.coords.latitude),h=e.coords.accuracy,f=this._map.getBearing(),g=s.e({bearing:f},this.options.fitBoundsOptions),v=Dn.fromLngLat(o,h);this._map.fitBounds(v,g,{geolocateSource:!0})},this._updateMarker=e=>{if(e){let o=new s.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Cs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xl({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")),this.fire(new s.k("userlocationlostfocus")))})}},this.options=s.e({},th,m)}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return s._(this,arguments,void 0,function*(e=!1){if(ro!==void 0&&!e)return ro;if(window.navigator.permissions===void 0)return ro=!!window.navigator.geolocation,ro;try{ro=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ro=!!window.navigator.geolocation}return ro})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,fa=0,Cs=!1}_isOutOfMapMaxBounds(m){let e=this._map.getMaxBounds(),o=m.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){let m=this._map.getBounds(),e=m.getSouthEast(),o=m.getNorthEast(),h=e.distanceTo(o),f=Math.ceil(this._accuracy/(h/this._map._container.clientHeight)*2);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":fa--,Cs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart")),this.fire(new s.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),fa++,fa>1?(m={maximumAge:6e5,timeout:0},Cs=!0):(m=this.options.positionOptions,Cs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.GlobeControl=class{constructor(){this._toggleProjection=()=>{var m;let e=(m=this._map.getProjection())===null||m===void 0?void 0:m.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var m;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((m=this._map.getProjection())===null||m===void 0?void 0:m.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=$.create("button","maplibregl-ctrl-globe",this._container),$.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},u.Hash=Wd,u.ImageSource=Or,u.KeyboardHandler=Sp,u.LngLatBounds=Dn,u.LogoControl=Uc,u.Map=class extends ct{constructor(m){var e,o;s.cd.mark(s.ce.create);let h=Object.assign(Object.assign(Object.assign({},vl),m),{canvasContextAttributes:Object.assign(Object.assign({},vl.canvasContextAttributes),m.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");let f=new Qi,g=new uc;if(h.minZoom!==void 0&&f.setMinZoom(h.minZoom),h.maxZoom!==void 0&&f.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&f.setMinPitch(h.minPitch),h.maxPitch!==void 0&&f.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&f.setRenderWorldCopies(h.renderWorldCopies),super(f,g,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Mr,this._controls=[],this._mapId=s.a1(),this._contextLost=w=>{w.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:w}))},this._contextRestored=w=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:w}))},this._onMapScroll=w=>{if(w.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Op),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this.transformCameraUpdate=h.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=gt.addThrottleControl(()=>this.isMoving()),this._requestManager=new ft(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let w=!1,E=Po(T=>{this._trackResize&&!this._removed&&(this.resize(T),this.redraw())},50);this._resizeObserver=new ResizeObserver(T=>{w?E(T):w=!0}),this._resizeObserver.observe(this._container)}this.handlers=new tt(this,h),this._hash=h.hash&&new Wd(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,s.e({},h.fitBoundsOptions,{duration:0}))));let v=typeof h.style=="string"||((o=(e=h.style)===null||e===void 0?void 0:e.projection)===null||o===void 0?void 0:o.type)!=="globe";this.resize(null,v),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Vc(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new Uc,h.logoPosition),this.on("style.load",()=>{if(v||this._resizeTransform(),this.transform.unmodified){let w=s.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(w)}}),this.on("data",w=>{this._update(w.dataType==="style"),this.fire(new s.k(`${w.dataType}data`,w))}),this.on("dataloading",w=>{this.fire(new s.k(`${w.dataType}dataloading`,w))}),this.on("dataabort",w=>{this.fire(new s.k("sourcedataabort",w))})}_getMapId(){return this._mapId}addControl(m,e){if(e===void 0&&(e=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let o=m.onAdd(this);this._controls.push(m);let h=this._controlPositions[e];return e.indexOf("bottom")!==-1?h.insertBefore(o,h.firstChild):h.appendChild(o),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(m);return e>-1&&this._controls.splice(e,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}calculateCameraOptionsFromTo(m,e,o,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(m,e,o,h)}resize(m,e=!0){let[o,h]=this._containerDimensions(),f=this._getClampedPixelRatio(o,h);if(this._resizeCanvas(o,h,f),this.painter.resize(o,h,f),this.painter.overLimit()){let v=this.painter.context.gl;this._maxCanvasSize=[v.drawingBufferWidth,v.drawingBufferHeight];let w=this._getClampedPixelRatio(o,h);this._resizeCanvas(o,h,w),this.painter.resize(o,h,w)}this._resizeTransform(e);let g=!this._moving;return g&&(this.stop(),this.fire(new s.k("movestart",m)).fire(new s.k("move",m))),this.fire(new s.k("resize",m)),g&&this.fire(new s.k("moveend",m)),this}_resizeTransform(m=!0){var e;let[o,h]=this._containerDimensions();this.transform.resize(o,h,m),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,h,m)}_getClampedPixelRatio(m,e){let{0:o,1:h}=this._maxCanvasSize,f=this.getPixelRatio(),g=m*f,v=e*f;return Math.min(g>o?o/g:1,v>h?h/v:1)*f}getPixelRatio(){var m;return(m=this._overridePixelRatio)!==null&&m!==void 0?m:devicePixelRatio}setPixelRatio(m){this._overridePixelRatio=m,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(m){return this.transform.setMaxBounds(Dn.convert(m)),this._update()}setMinZoom(m){if((m=m??-2)>=-2&&m<=this.transform.maxZoom)return this.transform.setMinZoom(m),this._update(),this.getZoom()<m&&this.setZoom(m),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m??22)>=this.transform.minZoom)return this.transform.setMaxZoom(m),this._update(),this.getZoom()>m&&this.setZoom(m),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.setMinPitch(m),this._update(),this.getPitch()<m&&this.setPitch(m),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(m>=this.transform.minPitch)return this.transform.setMaxPitch(m),this._update(),this.getPitch()>m&&this.setPitch(m),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.setRenderWorldCopies(m),this._update()}project(m){return this.transform.locationToScreenPoint(s.N.convert(m),this.style&&this.terrain)}unproject(m){return this.transform.screenPointToLocation(s.P.convert(m),this.terrain)}isMoving(){var m;return this._moving||((m=this.handlers)===null||m===void 0?void 0:m.isMoving())}isZooming(){var m;return this._zooming||((m=this.handlers)===null||m===void 0?void 0:m.isZooming())}isRotating(){var m;return this._rotating||((m=this.handlers)===null||m===void 0?void 0:m.isRotating())}_createDelegatedListener(m,e,o){if(m==="mouseenter"||m==="mouseover"){let h=!1;return{layers:e,listener:o,delegates:{mousemove:g=>{let v=e.filter(E=>this.getLayer(E)),w=v.length!==0?this.queryRenderedFeatures(g.point,{layers:v}):[];w.length?h||(h=!0,o.call(this,new Tn(m,this,g.originalEvent,{features:w}))):h=!1},mouseout:()=>{h=!1}}}}if(m==="mouseleave"||m==="mouseout"){let h=!1;return{layers:e,listener:o,delegates:{mousemove:v=>{let w=e.filter(E=>this.getLayer(E));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?h=!0:h&&(h=!1,o.call(this,new Tn(m,this,v.originalEvent)))},mouseout:v=>{h&&(h=!1,o.call(this,new Tn(m,this,v.originalEvent)))}}}}{let h=f=>{let g=e.filter(w=>this.getLayer(w)),v=g.length!==0?this.queryRenderedFeatures(f.point,{layers:g}):[];v.length&&(f.features=v,o.call(this,f),delete f.features)};return{layers:e,listener:o,delegates:{[m]:h}}}}_saveDelegatedListener(m,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(e)}_removeDelegatedListener(m,e,o){if(!this._delegatedListeners||!this._delegatedListeners[m])return;let h=this._delegatedListeners[m];for(let f=0;f<h.length;f++){let g=h[f];if(g.listener===o&&g.layers.length===e.length&&g.layers.every(v=>e.includes(v))){for(let v in g.delegates)this.off(v,g.delegates[v]);return void h.splice(f,1)}}}on(m,e,o){if(o===void 0)return super.on(m,e);let h=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,h,o);this._saveDelegatedListener(m,f);for(let g in f.delegates)this.on(g,f.delegates[g]);return{unsubscribe:()=>{this._removeDelegatedListener(m,h,o)}}}once(m,e,o){if(o===void 0)return super.once(m,e);let h=typeof e=="string"?[e]:e,f=this._createDelegatedListener(m,h,o);for(let g in f.delegates){let v=f.delegates[g];f.delegates[g]=(...w)=>{this._removeDelegatedListener(m,h,o),v(...w)}}this._saveDelegatedListener(m,f);for(let g in f.delegates)this.once(g,f.delegates[g]);return this}off(m,e,o){return o===void 0?super.off(m,e):(this._removeDelegatedListener(m,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(m,e){if(!this.style)return[];let o,h=m instanceof s.P||Array.isArray(m),f=h?m:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(h?{}:m)||{},f instanceof s.P||typeof f[0]=="number")o=[s.P.convert(f)];else{let g=s.P.convert(f[0]),v=s.P.convert(f[1]);o=[g,new s.P(v.x,g.y),v,new s.P(g.x,v.y),g]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(m,e){return this.style.querySourceFeatures(m,e)}setStyle(m,e){return(e=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&m?(this._diffStyle(m,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(m,e))}setTransformRequest(m){return this._requestManager.setTransformRequest(m),this}_getUIString(m){let e=this._locale[m];if(e==null)throw new Error(`Missing UI string '${m}'`);return e}_updateStyle(m,e){var o,h;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(m,e));let f=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!m)),m?(this.style=new Xr(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m,e,f):this.style.loadJSON(m,e,f),this):((h=(o=this.style)===null||o===void 0?void 0:o.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,e){if(typeof m=="string"){let o=this._requestManager.transformRequest(m,"Style");s.h(o,new AbortController).then(h=>{this._updateDiff(h.data,e)}).catch(h=>{h&&this.fire(new s.j(h))})}else typeof m=="object"&&this._updateDiff(m,e)}_updateDiff(m,e){try{this.style.setState(m,e)&&this._update(!0)}catch(o){s.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(m,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(m,e){return this._lazyInitEmptyStyle(),this.style.addSource(m,e),this._update(!0)}isSourceLoaded(m){let e=this.style&&this.style.sourceCaches[m];if(e!==void 0)return e.loaded();this.fire(new s.j(new Error(`There is no source with ID '${m}'`)))}setTerrain(m){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),m){let e=this.style.sourceCaches[m.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${m.source}`);this.terrain===null&&e.reload();for(let o in this.style._layers){let h=this.style._layers[o];h.type==="hillshade"&&h.source===m.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new s_(this.painter,e,m),this.painter.renderToTexture=new Sn(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=o=>{o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==m.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new s.k("terrain",{terrain:m})),this}getTerrain(){var m,e;return(e=(m=this.terrain)===null||m===void 0?void 0:m.options)!==null&&e!==void 0?e:null}areTilesLoaded(){let m=this.style&&this.style.sourceCaches;for(let e in m){let o=m[e]._tiles;for(let h in o){let f=o[h];if(f.state!=="loaded"&&f.state!=="errored")return!1}}return!0}removeSource(m){return this.style.removeSource(m),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,e,o={}){let{pixelRatio:h=1,sdf:f=!1,stretchX:g,stretchY:v,content:w,textFitWidth:E,textFitHeight:T}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||s.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{let{width:A,height:R,data:O}=e,z=e;return this.style.addImage(m,{data:new s.R({width:A,height:R},new Uint8Array(O)),pixelRatio:h,stretchX:g,stretchY:v,content:w,textFitWidth:E,textFitHeight:T,sdf:f,version:0,userImage:z}),z.onAdd&&z.onAdd(this,m),this}}{let{width:A,height:R,data:O}=W.getImageData(e);this.style.addImage(m,{data:new s.R({width:A,height:R},O),pixelRatio:h,stretchX:g,stretchY:v,content:w,textFitWidth:E,textFitHeight:T,sdf:f,version:0})}}updateImage(m,e){let o=this.style.getImage(m);if(!o)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let h=e instanceof HTMLImageElement||s.b(e)?W.getImageData(e):e,{width:f,height:g,data:v}=h;if(f===void 0||g===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(f!==o.data.width||g!==o.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));let w=!(e instanceof HTMLImageElement||s.b(e));return o.data.replace(v,w),this.style.updateImage(m,o),this}getImage(m){return this.style.getImage(m)}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m){return gt.getImage(this._requestManager.transformRequest(m,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(m,e){return this._lazyInitEmptyStyle(),this.style.addLayer(m,e),this._update(!0)}moveLayer(m,e){return this.style.moveLayer(m,e),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(m,e,o){return this.style.setLayerZoomRange(m,e,o),this._update(!0)}setFilter(m,e,o={}){return this.style.setFilter(m,e,o),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,e,o,h={}){return this.style.setPaintProperty(m,e,o,h),this._update(!0)}getPaintProperty(m,e){return this.style.getPaintProperty(m,e)}setLayoutProperty(m,e,o,h={}){return this.style.setLayoutProperty(m,e,o,h),this._update(!0)}getLayoutProperty(m,e){return this.style.getLayoutProperty(m,e)}setGlyphs(m,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(m,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(m,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(m,e,o,h=>{h||this._update(!0)}),this}removeSprite(m){return this._lazyInitEmptyStyle(),this.style.removeSprite(m),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(m,e,o=>{o||this._update(!0)}),this}setLight(m,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(m,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(m,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(m,e){return this.style.setFeatureState(m,e),this._update()}removeFeatureState(m,e){return this.style.removeFeatureState(m,e),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let m=0,e=0;return this._container&&(m=this._container.clientWidth||400,e=this._container.clientHeight||300),[m,e]}_setupContainer(){let m=this._container;m.classList.add("maplibregl-map");let e=this._canvasContainer=$.create("div","maplibregl-canvas-container",m);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");let o=this._containerDimensions(),h=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],h);let f=this._controlContainer=$.create("div","maplibregl-control-container",m),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=$.create("div",`maplibregl-ctrl-${v} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,e,o){this._canvas.width=Math.floor(o*m),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${e}px`}_setupPainter(){let m=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0}),e=null;this._canvas.addEventListener("webglcontextcreationerror",h=>{e={requestedAttributes:m},h&&(e.statusMessage=h.statusMessage,e.type=h.type)},{once:!0});let o=null;if(o=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,m):this._canvas.getContext("webgl2",m)||this._canvas.getContext("webgl",m),!o){let h="Failed to initialize WebGL";throw e?(e.message=h,new Error(JSON.stringify(e))):new Error(h)}this.painter=new pp(o,this.transform),he.testSupport(o)}migrateProjection(m,e){super.migrateProjection(m,e),this.painter.transform=m,this.fire(new s.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_render(m){var e,o,h,f,g;let v=this._idleTriggered?this._fadeDuration:0,w=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._removed)return;let E=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;let R=this.transform.zoom,O=W.now();this.style.zoomHistory.update(R,O);let z=new s.z(R,{now:O,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),U=z.crossFadingFactor();U===1&&U===this._crossFadingFactor||(E=!0,this._crossFadingFactor=U),this.style.update(z)}let T=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0!==w;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((f=this.style.projection)===null||f===void 0?void 0:f.transitionState,(g=this.style.projection)===null||g===void 0?void 0:g.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||T)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,T),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.cd.mark(s.ce.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||E)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();let A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,s.cd.mark(s.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var m;this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),gt.removeThrottleControl(this._imageQueueHandle),(m=this._resizeObserver)===null||m===void 0||m.disconnect();let e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),s.cd.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,W.frame(this._frameRequest,m=>{s.cd.frame(m),this._frameRequest=null;try{this._render(m)}catch(e){if(!s.cf(e)&&!function(o){return o.message===Ec}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}get version(){return _l}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(m){return this._lazyInitEmptyStyle(),this.style.setProjection(m),this._update(!0)}},u.MapMouseEvent=Tn,u.MapTouchEvent=la,u.MapWheelEvent=yi,u.Marker=xl,u.NavigationControl=class{constructor(m){this._updateZoomButtons=()=>{let e=this._map.getZoom(),o=e===this._map.getMaxZoom(),h=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,o)=>{let h=this._map._getUIString(`NavigationControl.${o}`);e.title=h,e.setAttribute("aria-label",h)},this.options=s.e({},Jd,m),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new eh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(m,e){let o=$.create("button",m,this._container);return o.type="button",o.addEventListener("click",e),o}},u.Popup=class extends s.E{constructor(m){super(),this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var o;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(let w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ha(this._lngLat,this._flatPos,this._map.transform):(o=this._lngLat)===null||o===void 0?void 0:o.wrap(),this._trackPointer&&!e)return;let h=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let f=this.options.anchor,g=wl(this.options.offset);if(!f){let w=this._container.offsetWidth,E=this._container.offsetHeight,T;T=h.y+g.bottom.y<E?["top"]:h.y>this._map.transform.height-E?["bottom"]:[],h.x<w/2?T.push("left"):h.x>this._map.transform.width-w/2&&T.push("right"),f=T.length===0?"bottom":T.join("-")}let v=h.add(g[f]);this.options.subpixelPositioning||(v=v.round()),$.setTransform(this._container,`${bl[f]} translate(${v.x}px,${v.y}px)`),$c(this._container,f,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(rh),m)}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(m){return this._lngLat=s.N.convert(m),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(document.createTextNode(m))}setHTML(m){let e=document.createDocumentFragment(),o=document.createElement("body"),h;for(o.innerHTML=m;h=o.firstChild,h;)e.appendChild(h);return this.setDOMContent(e)}getMaxWidth(){var m;return(m=this._container)===null||m===void 0?void 0:m.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(m),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(m){return this._container&&this._container.classList.add(m),this}removeClassName(m){return this._container&&this._container.classList.remove(m),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){if(this._container)return this._container.classList.toggle(m)}setSubpixelPositioning(m){this.options.subpixelPositioning=m}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let m=this._container.querySelector(ih);m&&m.focus()}},u.RasterDEMTileSource=wo,u.RasterTileSource=pi,u.ScaleControl=class{constructor(m){this._onMove=()=>{Hc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Hc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},nh),m)}getDefaultPosition(){return"bottom-left"}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=Rp,u.Style=Xr,u.TerrainControl=class{constructor(m){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=m}onAdd(m){return this._map=m,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Fc,u.TwoFingersTouchRotateHandler=Mp,u.TwoFingersTouchZoomHandler=Nc,u.TwoFingersTouchZoomRotateHandler=Kd,u.VectorTileSource=ts,u.VideoSource=ns,u.addSourceType=(m,e)=>s._(void 0,void 0,void 0,function*(){if(Za(m))throw new Error(`A source type called "${m}" already exists.`);((o,h)=>{Eo[o]=h})(m,e)}),u.clearPrewarmedResources=function(){let m=Zr;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(Gs),Zr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.createTileMesh=tl,u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return Ki().getRTLTextPluginStatus()},u.getVersion=function(){return oh},u.getWorkerCount=function(){return Oi.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(m){return Jo().broadcast("IS",m)},u.prewarm=function(){Ko().acquire(Gs)},u.setMaxParallelImageRequests=function(m){s.a.MAX_PARALLEL_IMAGE_REQUESTS=m},u.setRTLTextPlugin=function(m,e){return Ki().setRTLTextPlugin(m,e)},u.setWorkerCount=function(m){Oi.workerCount=m},u.setWorkerUrl=function(m){s.a.WORKER_URL=m}});var c=t;return c})});function KP(t,r){return Object.is(t,r)}var ar=null,nm=!1,Y_=1,ou=Symbol("SIGNAL");function tn(t){let r=ar;return ar=t,r}function C1(){return ar}var rm={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function E1(t){if(nm)throw new Error("");if(ar===null)return;ar.consumerOnSignalRead(t);let r=ar.nextProducerIndex++;if(om(ar),r<ar.producerNode.length&&ar.producerNode[r]!==t&&Ph(ar)){let i=ar.producerNode[r];im(i,ar.producerIndexOfThis[r])}ar.producerNode[r]!==t&&(ar.producerNode[r]=t,ar.producerIndexOfThis[r]=Ph(ar)?M1(t,ar,r):0),ar.producerLastReadVersion[r]=t.version}function QP(){Y_++}function JP(t){if(!(Ph(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===Y_)){if(!t.producerMustRecompute(t)&&!Q_(t)){w1(t);return}t.producerRecomputeValue(t),w1(t)}}function I1(t){if(t.liveConsumerNode===void 0)return;let r=nm;nm=!0;try{for(let i of t.liveConsumerNode)i.dirty||tA(i)}finally{nm=r}}function eA(){return ar?.consumerAllowSignalWrites!==!1}function tA(t){t.dirty=!0,I1(t),t.consumerMarkedDirty?.(t)}function w1(t){t.dirty=!1,t.lastCleanEpoch=Y_}function K_(t){return t&&(t.nextProducerIndex=0),tn(t)}function T1(t,r){if(tn(r),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(Ph(t))for(let i=t.nextProducerIndex;i<t.producerNode.length;i++)im(t.producerNode[i],t.producerIndexOfThis[i]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Q_(t){om(t);for(let r=0;r<t.producerNode.length;r++){let i=t.producerNode[r],c=t.producerLastReadVersion[r];if(c!==i.version||(JP(i),c!==i.version))return!0}return!1}function J_(t){if(om(t),Ph(t))for(let r=0;r<t.producerNode.length;r++)im(t.producerNode[r],t.producerIndexOfThis[r]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function M1(t,r,i){if(D1(t),t.liveConsumerNode.length===0&&S1(t))for(let c=0;c<t.producerNode.length;c++)t.producerIndexOfThis[c]=M1(t.producerNode[c],t,c);return t.liveConsumerIndexOfThis.push(i),t.liveConsumerNode.push(r)-1}function im(t,r){if(D1(t),t.liveConsumerNode.length===1&&S1(t))for(let c=0;c<t.producerNode.length;c++)im(t.producerNode[c],t.producerIndexOfThis[c]);let i=t.liveConsumerNode.length-1;if(t.liveConsumerNode[r]=t.liveConsumerNode[i],t.liveConsumerIndexOfThis[r]=t.liveConsumerIndexOfThis[i],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,r<t.liveConsumerNode.length){let c=t.liveConsumerIndexOfThis[r],u=t.liveConsumerNode[r];om(u),u.producerIndexOfThis[c]=r}}function Ph(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function om(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function D1(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function S1(t){return t.producerNode!==void 0}function nA(){throw new Error}var P1=nA;function rA(){P1()}function A1(t){P1=t}var iA=null;function R1(t,r){eA()||rA(),t.equal(t.value,r)||(t.value=r,oA(t))}var k1=wn(et({},rm),{equal:KP,value:void 0,kind:"signal"});function oA(t){t.version++,QP(),I1(t),iA?.()}function St(t){return typeof t=="function"}function su(t){let i=t(c=>{Error.call(c),c.stack=new Error().stack});return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}var sm=su(t=>function(i){t(this),this.message=i?`${i.length} errors occurred during unsubscription:
${i.map((c,u)=>`${u+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=i});function Ah(t,r){if(t){let i=t.indexOf(r);0<=i&&t.splice(i,1)}}var Qn=class t{constructor(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let r;if(!this.closed){this.closed=!0;let{_parentage:i}=this;if(i)if(this._parentage=null,Array.isArray(i))for(let s of i)s.remove(this);else i.remove(this);let{initialTeardown:c}=this;if(St(c))try{c()}catch(s){r=s instanceof sm?s.errors:[s]}let{_finalizers:u}=this;if(u){this._finalizers=null;for(let s of u)try{O1(s)}catch(x){r=r??[],x instanceof sm?r=[...r,...x.errors]:r.push(x)}}if(r)throw new sm(r)}}add(r){var i;if(r&&r!==this)if(this.closed)O1(r);else{if(r instanceof t){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(i=this._finalizers)!==null&&i!==void 0?i:[]).push(r)}}_hasParent(r){let{_parentage:i}=this;return i===r||Array.isArray(i)&&i.includes(r)}_addParent(r){let{_parentage:i}=this;this._parentage=Array.isArray(i)?(i.push(r),i):i?[i,r]:r}_removeParent(r){let{_parentage:i}=this;i===r?this._parentage=null:Array.isArray(i)&&Ah(i,r)}remove(r){let{_finalizers:i}=this;i&&Ah(i,r),r instanceof t&&r._removeParent(this)}};Qn.EMPTY=(()=>{let t=new Qn;return t.closed=!0,t})();var ev=Qn.EMPTY;function am(t){return t instanceof Qn||t&&"closed"in t&&St(t.remove)&&St(t.add)&&St(t.unsubscribe)}function O1(t){St(t)?t():t.unsubscribe()}var uo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var au={setTimeout(t,r,...i){let{delegate:c}=au;return c?.setTimeout?c.setTimeout(t,r,...i):setTimeout(t,r,...i)},clearTimeout(t){let{delegate:r}=au;return(r?.clearTimeout||clearTimeout)(t)},delegate:void 0};function lm(t){au.setTimeout(()=>{let{onUnhandledError:r}=uo;if(r)r(t);else throw t})}function Rh(){}var N1=tv("C",void 0,void 0);function L1(t){return tv("E",void 0,t)}function F1(t){return tv("N",t,void 0)}function tv(t,r,i){return{kind:t,value:r,error:i}}var Pl=null;function lu(t){if(uo.useDeprecatedSynchronousErrorHandling){let r=!Pl;if(r&&(Pl={errorThrown:!1,error:null}),t(),r){let{errorThrown:i,error:c}=Pl;if(Pl=null,i)throw c}}else t()}function z1(t){uo.useDeprecatedSynchronousErrorHandling&&Pl&&(Pl.errorThrown=!0,Pl.error=t)}var Al=class extends Qn{constructor(r){super(),this.isStopped=!1,r?(this.destination=r,am(r)&&r.add(this)):this.destination=lA}static create(r,i,c){return new cu(r,i,c)}next(r){this.isStopped?rv(F1(r),this):this._next(r)}error(r){this.isStopped?rv(L1(r),this):(this.isStopped=!0,this._error(r))}complete(){this.isStopped?rv(N1,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(r){this.destination.next(r)}_error(r){try{this.destination.error(r)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},sA=Function.prototype.bind;function nv(t,r){return sA.call(t,r)}var iv=class{constructor(r){this.partialObserver=r}next(r){let{partialObserver:i}=this;if(i.next)try{i.next(r)}catch(c){cm(c)}}error(r){let{partialObserver:i}=this;if(i.error)try{i.error(r)}catch(c){cm(c)}else cm(r)}complete(){let{partialObserver:r}=this;if(r.complete)try{r.complete()}catch(i){cm(i)}}},cu=class extends Al{constructor(r,i,c){super();let u;if(St(r)||!r)u={next:r??void 0,error:i??void 0,complete:c??void 0};else{let s;this&&uo.useDeprecatedNextContext?(s=Object.create(r),s.unsubscribe=()=>this.unsubscribe(),u={next:r.next&&nv(r.next,s),error:r.error&&nv(r.error,s),complete:r.complete&&nv(r.complete,s)}):u=r}this.destination=new iv(u)}};function cm(t){uo.useDeprecatedSynchronousErrorHandling?z1(t):lm(t)}function aA(t){throw t}function rv(t,r){let{onStoppedNotification:i}=uo;i&&au.setTimeout(()=>i(t,r))}var lA={closed:!0,next:Rh,error:aA,complete:Rh};var uu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Ci(t){return t}function ov(...t){return sv(t)}function sv(t){return t.length===0?Ci:t.length===1?t[0]:function(i){return t.reduce((c,u)=>u(c),i)}}var Xt=(()=>{class t{constructor(i){i&&(this._subscribe=i)}lift(i){let c=new t;return c.source=this,c.operator=i,c}subscribe(i,c,u){let s=uA(i)?i:new cu(i,c,u);return lu(()=>{let{operator:x,source:M}=this;s.add(x?x.call(s,M):M?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(i){try{return this._subscribe(i)}catch(c){i.error(c)}}forEach(i,c){return c=B1(c),new c((u,s)=>{let x=new cu({next:M=>{try{i(M)}catch(S){s(S),x.unsubscribe()}},error:s,complete:u});this.subscribe(x)})}_subscribe(i){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(i)}[uu](){return this}pipe(...i){return sv(i)(this)}toPromise(i){return i=B1(i),new i((c,u)=>{let s;this.subscribe(x=>s=x,x=>u(x),()=>c(s))})}}return t.create=r=>new t(r),t})();function B1(t){var r;return(r=t??uo.Promise)!==null&&r!==void 0?r:Promise}function cA(t){return t&&St(t.next)&&St(t.error)&&St(t.complete)}function uA(t){return t&&t instanceof Al||cA(t)&&am(t)}function av(t){return St(t?.lift)}function $t(t){return r=>{if(av(r))return r.lift(function(i){try{return t(i,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ht(t,r,i,c,u){return new lv(t,r,i,c,u)}var lv=class extends Al{constructor(r,i,c,u,s,x){super(r),this.onFinalize=s,this.shouldUnsubscribe=x,this._next=i?function(M){try{i(M)}catch(S){r.error(S)}}:super._next,this._error=u?function(M){try{u(M)}catch(S){r.error(S)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(M){r.error(M)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:i}=this;super.unsubscribe(),!i&&((r=this.onFinalize)===null||r===void 0||r.call(this))}}};function du(){return $t((t,r)=>{let i=null;t._refCount++;let c=Ht(r,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){i=null;return}let u=t._connection,s=i;i=null,u&&(!s||u===s)&&u.unsubscribe(),r.unsubscribe()});t.subscribe(c),c.closed||(i=t.connect())})}var hu=class extends Xt{constructor(r,i){super(),this.source=r,this.subjectFactory=i,this._subject=null,this._refCount=0,this._connection=null,av(r)&&(this.lift=r.lift)}_subscribe(r){return this.getSubject().subscribe(r)}getSubject(){let r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:r}=this;this._subject=this._connection=null,r?.unsubscribe()}connect(){let r=this._connection;if(!r){r=this._connection=new Qn;let i=this.getSubject();r.add(this.source.subscribe(Ht(i,void 0,()=>{this._teardown(),i.complete()},c=>{this._teardown(),i.error(c)},()=>this._teardown()))),r.closed&&(this._connection=null,r=Qn.EMPTY)}return r}refCount(){return du()(this)}};var j1=su(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var _r=(()=>{class t extends Xt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(i){let c=new um(this,this);return c.operator=i,c}_throwIfClosed(){if(this.closed)throw new j1}next(i){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(i)}})}error(i){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=i;let{observers:c}=this;for(;c.length;)c.shift().error(i)}})}complete(){lu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:i}=this;for(;i.length;)i.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var i;return((i=this.observers)===null||i===void 0?void 0:i.length)>0}_trySubscribe(i){return this._throwIfClosed(),super._trySubscribe(i)}_subscribe(i){return this._throwIfClosed(),this._checkFinalizedStatuses(i),this._innerSubscribe(i)}_innerSubscribe(i){let{hasError:c,isStopped:u,observers:s}=this;return c||u?ev:(this.currentObservers=null,s.push(i),new Qn(()=>{this.currentObservers=null,Ah(s,i)}))}_checkFinalizedStatuses(i){let{hasError:c,thrownError:u,isStopped:s}=this;c?i.error(u):s&&i.complete()}asObservable(){let i=new Xt;return i.source=this,i}}return t.create=(r,i)=>new um(r,i),t})(),um=class extends _r{constructor(r,i){super(),this.destination=r,this.source=i}next(r){var i,c;(c=(i=this.destination)===null||i===void 0?void 0:i.next)===null||c===void 0||c.call(i,r)}error(r){var i,c;(c=(i=this.destination)===null||i===void 0?void 0:i.error)===null||c===void 0||c.call(i,r)}complete(){var r,i;(i=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||i===void 0||i.call(r)}_subscribe(r){var i,c;return(c=(i=this.source)===null||i===void 0?void 0:i.subscribe(r))!==null&&c!==void 0?c:ev}};var Tr=class extends _r{constructor(r){super(),this._value=r}get value(){return this.getValue()}_subscribe(r){let i=super._subscribe(r);return!i.closed&&r.next(this._value),i}getValue(){let{hasError:r,thrownError:i,_value:c}=this;if(r)throw i;return this._throwIfClosed(),c}next(r){super.next(this._value=r)}};var ei=new Xt(t=>t.complete());function V1(t){return t&&St(t.schedule)}function U1(t){return t[t.length-1]}function $1(t){return St(U1(t))?t.pop():void 0}function ba(t){return V1(U1(t))?t.pop():void 0}function G1(t,r,i,c){function u(s){return s instanceof i?s:new i(function(x){x(s)})}return new(i||(i=Promise))(function(s,x){function M(W){try{B(c.next(W))}catch($){x($)}}function S(W){try{B(c.throw(W))}catch($){x($)}}function B(W){W.done?s(W.value):u(W.value).then(M,S)}B((c=c.apply(t,r||[])).next())})}function H1(t){var r=typeof Symbol=="function"&&Symbol.iterator,i=r&&t[r],c=0;if(i)return i.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&c>=t.length&&(t=void 0),{value:t&&t[c++],done:!t}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rl(t){return this instanceof Rl?(this.v=t,this):new Rl(t)}function q1(t,r,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=i.apply(t,r||[]),u,s=[];return u=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),M("next"),M("throw"),M("return",x),u[Symbol.asyncIterator]=function(){return this},u;function x(ge){return function(ze){return Promise.resolve(ze).then(ge,$)}}function M(ge,ze){c[ge]&&(u[ge]=function(qe){return new Promise(function(Ye,lt){s.push([ge,qe,Ye,lt])>1||S(ge,qe)})},ze&&(u[ge]=ze(u[ge])))}function S(ge,ze){try{B(c[ge](ze))}catch(qe){he(s[0][3],qe)}}function B(ge){ge.value instanceof Rl?Promise.resolve(ge.value.v).then(W,$):he(s[0][2],ge)}function W(ge){S("next",ge)}function $(ge){S("throw",ge)}function he(ge,ze){ge(ze),s.shift(),s.length&&S(s[0][0],s[0][1])}}function Z1(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t[Symbol.asyncIterator],i;return r?r.call(t):(t=typeof H1=="function"?H1(t):t[Symbol.iterator](),i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i);function c(s){i[s]=t[s]&&function(x){return new Promise(function(M,S){x=t[s](x),u(M,S,x.done,x.value)})}}function u(s,x,M,S){Promise.resolve(S).then(function(B){s({value:B,done:M})},x)}}var dm=t=>t&&typeof t.length=="number"&&typeof t!="function";function hm(t){return St(t?.then)}function fm(t){return St(t[uu])}function pm(t){return Symbol.asyncIterator&&St(t?.[Symbol.asyncIterator])}function mm(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function dA(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var gm=dA();function ym(t){return St(t?.[gm])}function _m(t){return q1(this,arguments,function*(){let i=t.getReader();try{for(;;){let{value:c,done:u}=yield Rl(i.read());if(u)return yield Rl(void 0);yield yield Rl(c)}}finally{i.releaseLock()}})}function vm(t){return St(t?.getReader)}function vr(t){if(t instanceof Xt)return t;if(t!=null){if(fm(t))return hA(t);if(dm(t))return fA(t);if(hm(t))return pA(t);if(pm(t))return W1(t);if(ym(t))return mA(t);if(vm(t))return gA(t)}throw mm(t)}function hA(t){return new Xt(r=>{let i=t[uu]();if(St(i.subscribe))return i.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function fA(t){return new Xt(r=>{for(let i=0;i<t.length&&!r.closed;i++)r.next(t[i]);r.complete()})}function pA(t){return new Xt(r=>{t.then(i=>{r.closed||(r.next(i),r.complete())},i=>r.error(i)).then(null,lm)})}function mA(t){return new Xt(r=>{for(let i of t)if(r.next(i),r.closed)return;r.complete()})}function W1(t){return new Xt(r=>{yA(t,r).catch(i=>r.error(i))})}function gA(t){return W1(_m(t))}function yA(t,r){var i,c,u,s;return G1(this,void 0,void 0,function*(){try{for(i=Z1(t);c=yield i.next(),!c.done;){let x=c.value;if(r.next(x),r.closed)return}}catch(x){u={error:x}}finally{try{c&&!c.done&&(s=i.return)&&(yield s.call(i))}finally{if(u)throw u.error}}r.complete()})}function ti(t,r,i,c=0,u=!1){let s=r.schedule(function(){i(),u?t.add(this.schedule(null,c)):this.unsubscribe()},c);if(t.add(s),!u)return s}function bm(t,r=0){return $t((i,c)=>{i.subscribe(Ht(c,u=>ti(c,t,()=>c.next(u),r),()=>ti(c,t,()=>c.complete(),r),u=>ti(c,t,()=>c.error(u),r)))})}function xm(t,r=0){return $t((i,c)=>{c.add(t.schedule(()=>i.subscribe(c),r))})}function X1(t,r){return vr(t).pipe(xm(r),bm(r))}function Y1(t,r){return vr(t).pipe(xm(r),bm(r))}function K1(t,r){return new Xt(i=>{let c=0;return r.schedule(function(){c===t.length?i.complete():(i.next(t[c++]),i.closed||this.schedule())})})}function Q1(t,r){return new Xt(i=>{let c;return ti(i,r,()=>{c=t[gm](),ti(i,r,()=>{let u,s;try{({value:u,done:s}=c.next())}catch(x){i.error(x);return}s?i.complete():i.next(u)},0,!0)}),()=>St(c?.return)&&c.return()})}function wm(t,r){if(!t)throw new Error("Iterable cannot be null");return new Xt(i=>{ti(i,r,()=>{let c=t[Symbol.asyncIterator]();ti(i,r,()=>{c.next().then(u=>{u.done?i.complete():i.next(u.value)})},0,!0)})})}function J1(t,r){return wm(_m(t),r)}function eC(t,r){if(t!=null){if(fm(t))return X1(t,r);if(dm(t))return K1(t,r);if(hm(t))return Y1(t,r);if(pm(t))return wm(t,r);if(ym(t))return Q1(t,r);if(vm(t))return J1(t,r)}throw mm(t)}function An(t,r){return r?eC(t,r):vr(t)}function yt(...t){let r=ba(t);return An(t,r)}function fu(t,r){let i=St(t)?t:()=>t,c=u=>u.error(i());return new Xt(r?u=>r.schedule(c,0,u):c)}function cv(t){return!!t&&(t instanceof Xt||St(t.lift)&&St(t.subscribe))}var Ms=su(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Nt(t,r){return $t((i,c)=>{let u=0;i.subscribe(Ht(c,s=>{c.next(t.call(r,s,u++))}))})}var{isArray:_A}=Array;function vA(t,r){return _A(r)?t(...r):t(r)}function tC(t){return Nt(r=>vA(t,r))}var{isArray:bA}=Array,{getPrototypeOf:xA,prototype:wA,keys:CA}=Object;function nC(t){if(t.length===1){let r=t[0];if(bA(r))return{args:r,keys:null};if(EA(r)){let i=CA(r);return{args:i.map(c=>r[c]),keys:i}}}return{args:t,keys:null}}function EA(t){return t&&typeof t=="object"&&xA(t)===wA}function rC(t,r){return t.reduce((i,c,u)=>(i[c]=r[u],i),{})}function kh(...t){let r=ba(t),i=$1(t),{args:c,keys:u}=nC(t);if(c.length===0)return An([],r);let s=new Xt(IA(c,r,u?x=>rC(u,x):Ci));return i?s.pipe(tC(i)):s}function IA(t,r,i=Ci){return c=>{iC(r,()=>{let{length:u}=t,s=new Array(u),x=u,M=u;for(let S=0;S<u;S++)iC(r,()=>{let B=An(t[S],r),W=!1;B.subscribe(Ht(c,$=>{s[S]=$,W||(W=!0,M--),M||c.next(i(s.slice()))},()=>{--x||c.complete()}))},c)},c)}}function iC(t,r,i){t?ti(i,t,r):r()}function oC(t,r,i,c,u,s,x,M){let S=[],B=0,W=0,$=!1,he=()=>{$&&!S.length&&!B&&r.complete()},ge=qe=>B<c?ze(qe):S.push(qe),ze=qe=>{s&&r.next(qe),B++;let Ye=!1;vr(i(qe,W++)).subscribe(Ht(r,lt=>{u?.(lt),s?ge(lt):r.next(lt)},()=>{Ye=!0},void 0,()=>{if(Ye)try{for(B--;S.length&&B<c;){let lt=S.shift();x?ti(r,x,()=>ze(lt)):ze(lt)}he()}catch(lt){r.error(lt)}}))};return t.subscribe(Ht(r,ge,()=>{$=!0,he()})),()=>{M?.()}}function Jn(t,r,i=1/0){return St(r)?Jn((c,u)=>Nt((s,x)=>r(c,s,u,x))(vr(t(c,u))),i):(typeof r=="number"&&(i=r),$t((c,u)=>oC(c,u,t,i)))}function pu(t=1/0){return Jn(Ci,t)}function sC(){return pu(1)}function mu(...t){return sC()(An(t,ba(t)))}function Cm(t){return new Xt(r=>{vr(t()).subscribe(r)})}function ni(t,r){return $t((i,c)=>{let u=0;i.subscribe(Ht(c,s=>t.call(r,s,u++)&&c.next(s)))})}function xa(t){return $t((r,i)=>{let c=null,u=!1,s;c=r.subscribe(Ht(i,void 0,void 0,x=>{s=vr(t(x,xa(t)(r))),c?(c.unsubscribe(),c=null,s.subscribe(i)):u=!0})),u&&(c.unsubscribe(),c=null,s.subscribe(i))})}function aC(t,r,i,c,u){return(s,x)=>{let M=i,S=r,B=0;s.subscribe(Ht(x,W=>{let $=B++;S=M?t(S,W,$):(M=!0,W),c&&x.next(S)},u&&(()=>{M&&x.next(S),x.complete()})))}}function Ds(t,r){return St(r)?Jn(t,r,1):Jn(t,1)}function wa(t){return $t((r,i)=>{let c=!1;r.subscribe(Ht(i,u=>{c=!0,i.next(u)},()=>{c||i.next(t),i.complete()}))})}function Ss(t){return t<=0?()=>ei:$t((r,i)=>{let c=0;r.subscribe(Ht(i,u=>{++c<=t&&(i.next(u),t<=c&&i.complete())}))})}function Em(t=TA){return $t((r,i)=>{let c=!1;r.subscribe(Ht(i,u=>{c=!0,i.next(u)},()=>c?i.complete():i.error(t())))})}function TA(){return new Ms}function kl(t){return $t((r,i)=>{try{r.subscribe(i)}finally{i.add(t)}})}function Ps(t,r){let i=arguments.length>=2;return c=>c.pipe(t?ni((u,s)=>t(u,s,c)):Ci,Ss(1),i?wa(r):Em(()=>new Ms))}function gu(t){return t<=0?()=>ei:$t((r,i)=>{let c=[];r.subscribe(Ht(i,u=>{c.push(u),t<c.length&&c.shift()},()=>{for(let u of c)i.next(u);i.complete()},void 0,()=>{c=null}))})}function uv(t,r){let i=arguments.length>=2;return c=>c.pipe(t?ni((u,s)=>t(u,s,c)):Ci,gu(1),i?wa(r):Em(()=>new Ms))}function dv(t,r){return $t(aC(t,r,arguments.length>=2,!0))}function hv(...t){let r=ba(t);return $t((i,c)=>{(r?mu(t,i,r):mu(t,i)).subscribe(c)})}function ri(t,r){return $t((i,c)=>{let u=null,s=0,x=!1,M=()=>x&&!u&&c.complete();i.subscribe(Ht(c,S=>{u?.unsubscribe();let B=0,W=s++;vr(t(S,W)).subscribe(u=Ht(c,$=>c.next(r?r(S,$,W,B++):$),()=>{u=null,M()}))},()=>{x=!0,M()}))})}function fv(t){return $t((r,i)=>{vr(t).subscribe(Ht(i,()=>i.complete(),Rh)),!i.closed&&r.subscribe(i)})}function lr(t,r,i){let c=St(t)||r||i?{next:t,error:r,complete:i}:t;return c?$t((u,s)=>{var x;(x=c.subscribe)===null||x===void 0||x.call(c);let M=!0;u.subscribe(Ht(s,S=>{var B;(B=c.next)===null||B===void 0||B.call(c,S),s.next(S)},()=>{var S;M=!1,(S=c.complete)===null||S===void 0||S.call(c),s.complete()},S=>{var B;M=!1,(B=c.error)===null||B===void 0||B.call(c,S),s.error(S)},()=>{var S,B;M&&((S=c.unsubscribe)===null||S===void 0||S.call(c)),(B=c.finalize)===null||B===void 0||B.call(c)}))}):Ci}var _v={JSACTION:"jsaction"},vv={JSACTION:"__jsaction",OWNER:"__owner"},dC={};function MA(t){return t[vv.JSACTION]}function lC(t,r){t[vv.JSACTION]=r}function DA(t){return dC[t]}function SA(t,r){dC[t]=r}var mt={AUXCLICK:"auxclick",CHANGE:"change",CLICK:"click",CLICKMOD:"clickmod",CLICKONLY:"clickonly",DBLCLICK:"dblclick",FOCUS:"focus",FOCUSIN:"focusin",BLUR:"blur",FOCUSOUT:"focusout",SUBMIT:"submit",KEYDOWN:"keydown",KEYPRESS:"keypress",KEYUP:"keyup",MOUSEUP:"mouseup",MOUSEDOWN:"mousedown",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",MOUSEMOVE:"mousemove",POINTERUP:"pointerup",POINTERDOWN:"pointerdown",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERMOVE:"pointermove",POINTERCANCEL:"pointercancel",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",ERROR:"error",LOAD:"load",UNLOAD:"unload",TOUCHSTART:"touchstart",TOUCHEND:"touchend",TOUCHMOVE:"touchmove",INPUT:"input",SCROLL:"scroll",TOGGLE:"toggle",CUSTOM:"_custom"},PA=[mt.MOUSEENTER,mt.MOUSELEAVE,"pointerenter","pointerleave"],e$=[mt.CLICK,mt.DBLCLICK,mt.FOCUSIN,mt.FOCUSOUT,mt.KEYDOWN,mt.KEYUP,mt.KEYPRESS,mt.MOUSEOVER,mt.MOUSEOUT,mt.SUBMIT,mt.TOUCHSTART,mt.TOUCHEND,mt.TOUCHMOVE,"touchcancel","auxclick","change","compositionstart","compositionupdate","compositionend","beforeinput","input","select","copy","cut","paste","mousedown","mouseup","wheel","contextmenu","dragover","dragenter","dragleave","drop","dragstart","dragend","pointerdown","pointermove","pointerup","pointercancel","pointerover","pointerout","gotpointercapture","lostpointercapture","ended","loadedmetadata","pagehide","pageshow","visibilitychange","beforematch"],AA=[mt.FOCUS,mt.BLUR,mt.ERROR,mt.LOAD,mt.TOGGLE],bv=t=>AA.indexOf(t)>=0;var RA=3,kA=13,OA=32,Ei={MAC_ENTER:RA,ENTER:kA,SPACE:OA};function NA(t){return t===mt.MOUSEENTER?mt.MOUSEOVER:t===mt.MOUSELEAVE?mt.MOUSEOUT:t===mt.POINTERENTER?mt.POINTEROVER:t===mt.POINTERLEAVE?mt.POINTEROUT:t}function LA(t,r,i,c){let u=!1;bv(r)&&(u=!0);let s=typeof c=="boolean"?{capture:u,passive:c}:u;return t.addEventListener(r,i,s),{eventType:r,handler:i,capture:u,passive:c}}function FA(t,r){if(t.removeEventListener){let i=typeof r.passive=="boolean"?{capture:r.capture}:r.capture;t.removeEventListener(r.eventType,r.handler,i)}else t.detachEvent&&t.detachEvent(`on${r.eventType}`,r.handler)}function zA(t){t.preventDefault?t.preventDefault():t.returnValue=!1}var cC=typeof navigator<"u"&&/Macintosh/.test(navigator.userAgent);function BA(t){return t.which===2||t.which==null&&t.button===4}function jA(t){return cC&&t.metaKey||!cC&&t.ctrlKey||BA(t)||t.shiftKey}var t$=typeof navigator<"u"&&!/Opera/.test(navigator.userAgent)&&/WebKit/.test(navigator.userAgent),n$=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident/.test(navigator.userAgent)),r$=typeof navigator<"u"&&!/Opera|WebKit/.test(navigator.userAgent)&&/Gecko/.test(navigator.product);function VA(t,r,i){let c=t.relatedTarget;return(t.type===mt.MOUSEOVER&&r===mt.MOUSEENTER||t.type===mt.MOUSEOUT&&r===mt.MOUSELEAVE||t.type===mt.POINTEROVER&&r===mt.POINTERENTER||t.type===mt.POINTEROUT&&r===mt.POINTERLEAVE)&&(!c||c!==i&&!i.contains(c))}function UA(t,r){let i={};for(let c in t){if(c==="srcElement"||c==="target")continue;let u=c,s=t[u];typeof s!="function"&&(i[u]=s)}return t.type===mt.MOUSEOVER?i.type=mt.MOUSEENTER:t.type===mt.MOUSEOUT?i.type=mt.MOUSELEAVE:t.type===mt.POINTEROVER?i.type=mt.POINTERENTER:i.type=mt.POINTERLEAVE,i.target=i.srcElement=r,i.bubbles=!1,i._originalEvent=t,i}var i$={Enter:Ei.ENTER," ":Ei.SPACE},o$={A:Ei.ENTER,BUTTON:0,CHECKBOX:Ei.SPACE,COMBOBOX:Ei.ENTER,FILE:0,GRIDCELL:Ei.ENTER,LINK:Ei.ENTER,LISTBOX:Ei.ENTER,MENU:0,MENUBAR:0,MENUITEM:0,MENUITEMCHECKBOX:0,MENUITEMRADIO:0,OPTION:0,RADIO:Ei.SPACE,RADIOGROUP:Ei.SPACE,RESET:0,SUBMIT:0,SWITCH:Ei.SPACE,TAB:0,TREE:Ei.ENTER,TREEITEM:Ei.ENTER};var $A=typeof navigator<"u"&&/iPhone|iPad|iPod/.test(navigator.userAgent),Dm=class{element;handlerInfos=[];constructor(r){this.element=r}addEventListener(r,i,c){$A&&(this.element.style.cursor="pointer"),this.handlerInfos.push(LA(this.element,r,i(this.element),c))}cleanUp(){for(let r=0;r<this.handlerInfos.length;r++)FA(this.element,this.handlerInfos[r]);this.handlerInfos=[]}},HA={NAMESPACE_ACTION_SEPARATOR:".",EVENT_ACTION_SEPARATOR:":"};function Ca(t){return t.eventType}function xv(t,r){t.eventType=r}function Tm(t){return t.event}function hC(t,r){t.event=r}function fC(t){return t.targetElement}function pC(t,r){t.targetElement=r}function mC(t){return t.eic}function GA(t,r){t.eic=r}function qA(t){return t.timeStamp}function ZA(t,r){t.timeStamp=r}function Mm(t){return t.eia}function gC(t,r,i){t.eia=[r,i]}function pv(t){t.eia=void 0}function Im(t){return t[1]}function WA(t){return t.eirp}function yC(t,r){t.eirp=r}function _C(t){return t.eir}function vC(t,r){t.eir=r}function bC(t){return{eventType:t.eventType,event:t.event,targetElement:t.targetElement,eic:t.eic,eia:t.eia,timeStamp:t.timeStamp,eirp:t.eirp,eiack:t.eiack,eir:t.eir}}function XA(t,r,i,c,u,s,x,M){return{eventType:t,event:r,targetElement:i,eic:c,timeStamp:u,eia:s,eirp:x,eiack:M}}var mv=class t{eventInfo;constructor(r){this.eventInfo=r}getEventType(){return Ca(this.eventInfo)}setEventType(r){xv(this.eventInfo,r)}getEvent(){return Tm(this.eventInfo)}setEvent(r){hC(this.eventInfo,r)}getTargetElement(){return fC(this.eventInfo)}setTargetElement(r){pC(this.eventInfo,r)}getContainer(){return mC(this.eventInfo)}setContainer(r){GA(this.eventInfo,r)}getTimestamp(){return qA(this.eventInfo)}setTimestamp(r){ZA(this.eventInfo,r)}getAction(){let r=Mm(this.eventInfo);if(r)return{name:r[0],element:r[1]}}setAction(r){if(!r){pv(this.eventInfo);return}gC(this.eventInfo,r.name,r.element)}getIsReplay(){return WA(this.eventInfo)}setIsReplay(r){yC(this.eventInfo,r)}getResolved(){return _C(this.eventInfo)}setResolved(r){vC(this.eventInfo,r)}clone(){return new t(bC(this.eventInfo))}},YA={},KA=/\s*;\s*/,QA=mt.CLICK,gv=class{a11yClickSupport=!1;clickModSupport=!0;syntheticMouseEventSupport;updateEventInfoForA11yClick=void 0;preventDefaultForA11yClick=void 0;populateClickOnlyAction=void 0;constructor({syntheticMouseEventSupport:r=!1,clickModSupport:i=!0}={}){this.syntheticMouseEventSupport=r,this.clickModSupport=i}resolveEventType(r){this.clickModSupport&&Ca(r)===mt.CLICK&&jA(Tm(r))?xv(r,mt.CLICKMOD):this.a11yClickSupport&&this.updateEventInfoForA11yClick(r)}resolveAction(r){_C(r)||(this.populateAction(r,fC(r)),vC(r,!0))}resolveParentAction(r){let i=Mm(r),c=i&&Im(i);pv(r);let u=c&&this.getParentNode(c);u&&this.populateAction(r,u)}populateAction(r,i){let c=i;for(;c&&c!==mC(r)&&(c.nodeType===Node.ELEMENT_NODE&&this.populateActionOnElement(c,r),!Mm(r));)c=this.getParentNode(c);let u=Mm(r);if(u&&(this.a11yClickSupport&&this.preventDefaultForA11yClick(r),this.syntheticMouseEventSupport&&(Ca(r)===mt.MOUSEENTER||Ca(r)===mt.MOUSELEAVE||Ca(r)===mt.POINTERENTER||Ca(r)===mt.POINTERLEAVE)))if(VA(Tm(r),Ca(r),Im(u))){let s=UA(Tm(r),Im(u));hC(r,s),pC(r,Im(u))}else pv(r)}getParentNode(r){let i=r[vv.OWNER];if(i)return i;let c=r.parentNode;return c?.nodeName==="#document-fragment"?c?.host??null:c}populateActionOnElement(r,i){let c=this.parseActions(r),u=c[Ca(i)];u!==void 0&&gC(i,u,r),this.a11yClickSupport&&this.populateClickOnlyAction(r,i,c)}parseActions(r){let i=MA(r);if(!i){let c=r.getAttribute(_v.JSACTION);if(!c)i=YA,lC(r,i);else{if(i=DA(c),!i){i={};let u=c.split(KA);for(let s=0;s<u.length;s++){let x=u[s];if(!x)continue;let M=x.indexOf(HA.EVENT_ACTION_SEPARATOR),S=M!==-1,B=S?x.substr(0,M).trim():QA,W=S?x.substr(M+1).trim():x;i[B]=W}SA(c,i)}lC(r,i)}}return i}addA11yClickSupport(r,i,c){this.a11yClickSupport=!0,this.updateEventInfoForA11yClick=r,this.preventDefaultForA11yClick=i,this.populateClickOnlyAction=c}},xC=function(t){return t[t.I_AM_THE_JSACTION_FRAMEWORK=0]="I_AM_THE_JSACTION_FRAMEWORK",t}(xC||{}),yv=class{dispatchDelegate;actionResolver;eventReplayer;eventReplayScheduled=!1;replayEventInfoWrappers=[];constructor(r,{actionResolver:i,eventReplayer:c}={}){this.dispatchDelegate=r,this.actionResolver=i,this.eventReplayer=c}dispatch(r){let i=new mv(r);this.actionResolver?.resolveEventType(r),this.actionResolver?.resolveAction(r);let c=i.getAction();if(c&&JA(c.element,i)&&zA(i.getEvent()),this.eventReplayer&&i.getIsReplay()){this.scheduleEventInfoWrapperReplay(i);return}this.dispatchDelegate(i)}scheduleEventInfoWrapperReplay(r){this.replayEventInfoWrappers.push(r),!this.eventReplayScheduled&&(this.eventReplayScheduled=!0,Promise.resolve().then(()=>{this.eventReplayScheduled=!1,this.eventReplayer(this.replayEventInfoWrappers)}))}};function JA(t,r){return t.tagName==="A"&&(r.getEventType()===mt.CLICK||r.getEventType()===mt.CLICKMOD)}var wC=Symbol.for("propagationStopped"),wv={REPLAY:101};var e2="`preventDefault` called during event replay.";var t2="`composedPath` called during event replay.",Sm=class{dispatchDelegate;clickModSupport;actionResolver;dispatcher;constructor(r,i=!0){this.dispatchDelegate=r,this.clickModSupport=i,this.actionResolver=new gv({clickModSupport:i}),this.dispatcher=new yv(c=>{this.dispatchToDelegate(c)},{actionResolver:this.actionResolver})}dispatch(r){this.dispatcher.dispatch(r)}dispatchToDelegate(r){for(r.getIsReplay()&&i2(r),n2(r);r.getAction();){if(o2(r),bv(r.getEventType())&&r.getAction().element!==r.getTargetElement()||(this.dispatchDelegate(r.getEvent(),r.getAction().name),r2(r)))return;this.actionResolver.resolveParentAction(r.eventInfo)}}};function n2(t){let r=t.getEvent(),i=t.getEvent().stopPropagation.bind(r),c=()=>{r[wC]=!0,i()};Ol(r,"stopPropagation",c),Ol(r,"stopImmediatePropagation",c)}function r2(t){return!!t.getEvent()[wC]}function i2(t){let r=t.getEvent(),i=t.getTargetElement(),c=r.preventDefault.bind(r);Ol(r,"target",i),Ol(r,"eventPhase",wv.REPLAY),Ol(r,"preventDefault",()=>{throw c(),new Error(e2+"")}),Ol(r,"composedPath",()=>{throw new Error(t2+"")})}function o2(t){let r=t.getEvent(),i=t.getAction()?.element;i&&Ol(r,"currentTarget",i,{configurable:!0})}function Ol(t,r,i,{configurable:c=!1}={}){Object.defineProperty(t,r,{value:i,configurable:c})}function CC(t,r){t.ecrd(i=>{r.dispatch(i)},xC.I_AM_THE_JSACTION_FRAMEWORK)}function s2(t){return t?.q??[]}function a2(t){t&&(uC(t.c,t.et,t.h),uC(t.c,t.etc,t.h,!0))}function uC(t,r,i,c){for(let u=0;u<r.length;u++)t.removeEventListener(r[u],i,c)}var l2=!1,EC=(()=>{class t{static MOUSE_SPECIAL_SUPPORT=l2;containerManager;eventHandlers={};browserEventTypeToExtraEventTypes={};dispatcher=null;queuedEventInfos=[];constructor(i){this.containerManager=i}handleEvent(i,c,u){let s=XA(i,c,c.target,u,Date.now());this.handleEventInfo(s)}handleEventInfo(i){if(!this.dispatcher){yC(i,!0),this.queuedEventInfos?.push(i);return}this.dispatcher(i)}addEvent(i,c,u){if(i in this.eventHandlers||!this.containerManager||!t.MOUSE_SPECIAL_SUPPORT&&PA.indexOf(i)>=0)return;let s=(M,S,B)=>{this.handleEvent(M,S,B)};this.eventHandlers[i]=s;let x=NA(c||i);if(x!==i){let M=this.browserEventTypeToExtraEventTypes[x]||[];M.push(i),this.browserEventTypeToExtraEventTypes[x]=M}this.containerManager.addEventListener(x,M=>S=>{s(i,S,M)},u)}replayEarlyEvents(i=window._ejsa){i&&(this.replayEarlyEventInfos(i.q),a2(i),delete window._ejsa)}replayEarlyEventInfos(i){for(let c=0;c<i.length;c++){let u=i[c],s=this.getEventTypesForBrowserEventType(u.eventType);for(let x=0;x<s.length;x++){let M=bC(u);xv(M,s[x]),this.handleEventInfo(M)}}}getEventTypesForBrowserEventType(i){let c=[];return this.eventHandlers[i]&&c.push(i),this.browserEventTypeToExtraEventTypes[i]&&c.push(...this.browserEventTypeToExtraEventTypes[i]),c}handler(i){return this.eventHandlers[i]}cleanUp(){this.containerManager?.cleanUp(),this.containerManager=null,this.eventHandlers={},this.browserEventTypeToExtraEventTypes={},this.dispatcher=null,this.queuedEventInfos=[]}registerDispatcher(i,c){this.ecrd(i,c)}ecrd(i,c){if(this.dispatcher=i,this.queuedEventInfos?.length){for(let u=0;u<this.queuedEventInfos.length;u++)this.handleEventInfo(this.queuedEventInfos[u]);this.queuedEventInfos=null}}}return t})();function IC(t,r=window){return s2(r._ejsas?.[t])}function Cv(t,r=window){r._ejsas&&(r._ejsas[t]=void 0)}var wE="https://g.co/ng/security#xss",it=class extends Error{code;constructor(r,i){super(yg(r,i)),this.code=r}};function yg(t,r){return`${`NG0${Math.abs(t)}`}${r?": "+r:""}`}var CE=Symbol("InputSignalNode#UNSET"),c2=wn(et({},k1),{transformFn:void 0,applyValueToInputSignal(t,r){R1(t,r)}});function EE(t,r){let i=Object.create(c2);i.value=t,i.transformFn=r?.transform;function c(){if(E1(i),i.value===CE)throw new it(-950,!1);return i.value}return c[ou]=i,c}function qh(t){return{toString:t}.toString()}var Pm="__parameters__";function u2(t){return function(...i){if(t){let c=t(...i);for(let u in c)this[u]=c[u]}}}function IE(t,r,i){return qh(()=>{let c=u2(r);function u(...s){if(this instanceof u)return c.apply(this,s),this;let x=new u(...s);return M.annotation=x,M;function M(S,B,W){let $=S.hasOwnProperty(Pm)?S[Pm]:Object.defineProperty(S,Pm,{value:[]})[Pm];for(;$.length<=W;)$.push(null);return($[W]=$[W]||[]).push(x),S}}return i&&(u.prototype=Object.create(i.prototype)),u.prototype.ngMetadataName=t,u.annotationCls=u,u})}var Ll=globalThis;function _n(t){for(let r in t)if(t[r]===_n)return r;throw Error("Could not find renamed property on target object.")}function $r(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map($r).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let r=t.toString();if(r==null)return""+r;let i=r.indexOf(`
`);return i===-1?r:r.substring(0,i)}function TC(t,r){return t==null||t===""?r===null?"":r:r==null||r===""?t:t+" "+r}var d2=_n({__forward_ref__:_n});function TE(t){return t.__forward_ref__=TE,t.toString=function(){return $r(this())},t}function Vi(t){return ME(t)?t():t}function ME(t){return typeof t=="function"&&t.hasOwnProperty(d2)&&t.__forward_ref__===TE}function nt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ru(t){return{providers:t.providers||[],imports:t.imports||[]}}function _g(t){return MC(t,SE)||MC(t,PE)}function DE(t){return _g(t)!==null}function MC(t,r){return t.hasOwnProperty(r)?t[r]:null}function h2(t){let r=t&&(t[SE]||t[PE]);return r||null}function DC(t){return t&&(t.hasOwnProperty(SC)||t.hasOwnProperty(f2))?t[SC]:null}var SE=_n({\u0275prov:_n}),SC=_n({\u0275inj:_n}),PE=_n({ngInjectableDef:_n}),f2=_n({ngInjectorDef:_n}),ot=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(r,i){this._desc=r,this.\u0275prov=void 0,typeof i=="number"?this.__NG_ELEMENT_ID__=i:i!==void 0&&(this.\u0275prov=nt({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function AE(t){return t&&!!t.\u0275providers}var p2=_n({\u0275cmp:_n}),m2=_n({\u0275dir:_n}),g2=_n({\u0275pipe:_n}),y2=_n({\u0275mod:_n}),$m=_n({\u0275fac:_n}),Fh=_n({__NG_ELEMENT_ID__:_n}),PC=_n({__NG_ENV_ID__:_n});function Fl(t){return typeof t=="string"?t:t==null?"":String(t)}function _2(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Fl(t)}function v2(t,r){let i=r?`. Dependency path: ${r.join(" > ")} > ${t}`:"";throw new it(-200,t)}function A0(t,r){throw new it(-201,!1)}var Lt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Lt||{}),zv;function RE(){return zv}function ii(t){let r=zv;return zv=t,r}function kE(t,r,i){let c=_g(t);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(i&Lt.Optional)return null;if(r!==void 0)return r;A0(t,"Injector")}var b2={},zh=b2,Bv="__NG_DI_FLAG__",Hm="ngTempTokenPath",x2="ngTokenPath",w2=/\n/gm,C2="\u0275",AC="__source",wu;function E2(){return wu}function Ea(t){let r=wu;return wu=t,r}function I2(t,r=Lt.Default){if(wu===void 0)throw new it(-203,!1);return wu===null?kE(t,void 0,r):wu.get(t,r&Lt.Optional?null:void 0,r)}function ht(t,r=Lt.Default){return(RE()||I2)(Vi(t),r)}function Le(t,r=Lt.Default){return ht(t,vg(r))}function vg(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function jv(t){let r=[];for(let i=0;i<t.length;i++){let c=Vi(t[i]);if(Array.isArray(c)){if(c.length===0)throw new it(900,!1);let u,s=Lt.Default;for(let x=0;x<c.length;x++){let M=c[x],S=T2(M);typeof S=="number"?S===-1?u=M.token:s|=S:u=M}r.push(ht(u,s))}else r.push(ht(c))}return r}function OE(t,r){return t[Bv]=r,t.prototype[Bv]=r,t}function T2(t){return t[Bv]}function M2(t,r,i,c){let u=t[Hm];throw r[AC]&&u.unshift(r[AC]),t.message=D2(`
`+t.message,u,i,c),t[x2]=u,t[Hm]=null,t}function D2(t,r,i,c=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==C2?t.slice(2):t;let u=$r(r);if(Array.isArray(r))u=r.map($r).join(" -> ");else if(typeof r=="object"){let s=[];for(let x in r)if(r.hasOwnProperty(x)){let M=r[x];s.push(x+":"+(typeof M=="string"?JSON.stringify(M):$r(M)))}u=`{${s.join(", ")}}`}return`${i}${c?"("+c+")":""}[${u}]: ${t.replace(w2,`
  `)}`}var NE=OE(IE("Optional"),8);var S2=OE(IE("SkipSelf"),4);function Bl(t,r){let i=t.hasOwnProperty($m);return i?t[$m]:null}function P2(t,r,i){if(t.length!==r.length)return!1;for(let c=0;c<t.length;c++){let u=t[c],s=r[c];if(i&&(u=i(u),s=i(s)),s!==u)return!1}return!0}function A2(t){return t.flat(Number.POSITIVE_INFINITY)}function R0(t,r){t.forEach(i=>Array.isArray(i)?R0(i,r):r(i))}function LE(t,r,i){r>=t.length?t.push(i):t.splice(r,0,i)}function Gm(t,r){return r>=t.length-1?t.pop():t.splice(r,1)[0]}function R2(t,r,i,c){let u=t.length;if(u==r)t.push(i,c);else if(u===1)t.push(c,t[0]),t[0]=i;else{for(u--,t.push(t[u-1],t[u]);u>r;){let s=u-2;t[u]=t[s],u--}t[r]=i,t[r+1]=c}}function k2(t,r,i){let c=Zh(t,r);return c>=0?t[c|1]=i:(c=~c,R2(t,c,r,i)),c}function Ev(t,r){let i=Zh(t,r);if(i>=0)return t[i|1]}function Zh(t,r){return O2(t,r,1)}function O2(t,r,i){let c=0,u=t.length>>i;for(;u!==c;){let s=c+(u-c>>1),x=t[s<<i];if(r===x)return s<<i;x>r?u=s:c=s+1}return~(u<<i)}var Bh={},fo=[],Ta=new ot(""),FE=new ot("",-1),zE=new ot(""),qm=class{get(r,i=zh){if(i===zh){let c=new Error(`NullInjectorError: No provider for ${$r(r)}!`);throw c.name="NullInjectorError",c}return i}};function BE(t,r){let i=t[y2]||null;if(!i&&r===!0)throw new Error(`Type ${$r(t)} does not have '\u0275mod' property.`);return i}function As(t){return t[p2]||null}function k0(t){return t[m2]||null}function O0(t){return t[g2]||null}function jE(t){let r=As(t)||k0(t)||O0(t);return r!==null&&r.standalone}function Aa(t){return{\u0275providers:t}}function N2(...t){return{\u0275providers:N0(!0,t),\u0275fromNgModule:!0}}function N0(t,...r){let i=[],c=new Set,u,s=x=>{i.push(x)};return R0(r,x=>{let M=x;Vv(M,s,[],c)&&(u||=[],u.push(M))}),u!==void 0&&VE(u,s),i}function VE(t,r){for(let i=0;i<t.length;i++){let{ngModule:c,providers:u}=t[i];L0(u,s=>{r(s,c)})}}function Vv(t,r,i,c){if(t=Vi(t),!t)return!1;let u=null,s=DC(t),x=!s&&As(t);if(!s&&!x){let S=t.ngModule;if(s=DC(S),s)u=S;else return!1}else{if(x&&!x.standalone)return!1;u=t}let M=c.has(u);if(x){if(M)return!1;if(c.add(u),x.dependencies){let S=typeof x.dependencies=="function"?x.dependencies():x.dependencies;for(let B of S)Vv(B,r,i,c)}}else if(s){if(s.imports!=null&&!M){c.add(u);let B;try{R0(s.imports,W=>{Vv(W,r,i,c)&&(B||=[],B.push(W))})}finally{}B!==void 0&&VE(B,r)}if(!M){let B=Bl(u)||(()=>new u);r({provide:u,useFactory:B,deps:fo},u),r({provide:zE,useValue:u,multi:!0},u),r({provide:Ta,useValue:()=>ht(u),multi:!0},u)}let S=s.providers;if(S!=null&&!M){let B=t;L0(S,W=>{r(W,B)})}}else return!1;return u!==t&&t.providers!==void 0}function L0(t,r){for(let i of t)AE(i)&&(i=i.\u0275providers),Array.isArray(i)?L0(i,r):r(i)}var L2=_n({provide:String,useValue:_n});function UE(t){return t!==null&&typeof t=="object"&&L2 in t}function F2(t){return!!(t&&t.useExisting)}function z2(t){return!!(t&&t.useFactory)}function Uv(t){return typeof t=="function"}var bg=new ot(""),Nm={},B2={},Iv;function F0(){return Iv===void 0&&(Iv=new qm),Iv}var Pr=class{},jh=class extends Pr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(r,i,c,u){super(),this.parent=i,this.source=c,this.scopes=u,Hv(r,x=>this.processProvider(x)),this.records.set(FE,yu(void 0,this)),u.has("environment")&&this.records.set(Pr,yu(void 0,this));let s=this.records.get(bg);s!=null&&typeof s.value=="string"&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(zE,fo,Lt.Self))}destroy(){Nh(this),this._destroyed=!0;let r=tn(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let i=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of i)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),tn(r)}}onDestroy(r){return Nh(this),this._onDestroyHooks.push(r),()=>this.removeOnDestroy(r)}runInContext(r){Nh(this);let i=Ea(this),c=ii(void 0),u;try{return r()}finally{Ea(i),ii(c)}}get(r,i=zh,c=Lt.Default){if(Nh(this),r.hasOwnProperty(PC))return r[PC](this);c=vg(c);let u,s=Ea(this),x=ii(void 0);try{if(!(c&Lt.SkipSelf)){let S=this.records.get(r);if(S===void 0){let B=G2(r)&&_g(r);B&&this.injectableDefInScope(B)?S=yu($v(r),Nm):S=null,this.records.set(r,S)}if(S!=null)return this.hydrate(r,S)}let M=c&Lt.Self?F0():this.parent;return i=c&Lt.Optional&&i===zh?null:i,M.get(r,i)}catch(M){if(M.name==="NullInjectorError"){if((M[Hm]=M[Hm]||[]).unshift($r(r)),s)throw M;return M2(M,r,"R3InjectorError",this.source)}else throw M}finally{ii(x),Ea(s)}}resolveInjectorInitializers(){let r=tn(null),i=Ea(this),c=ii(void 0),u;try{let s=this.get(Ta,fo,Lt.Self);for(let x of s)x()}finally{Ea(i),ii(c),tn(r)}}toString(){let r=[],i=this.records;for(let c of i.keys())r.push($r(c));return`R3Injector[${r.join(", ")}]`}processProvider(r){r=Vi(r);let i=Uv(r)?r:Vi(r&&r.provide),c=V2(r);if(!Uv(r)&&r.multi===!0){let u=this.records.get(i);u||(u=yu(void 0,Nm,!0),u.factory=()=>jv(u.multi),this.records.set(i,u)),i=r,u.multi.push(r)}this.records.set(i,c)}hydrate(r,i){let c=tn(null);try{return i.value===Nm&&(i.value=B2,i.value=i.factory()),typeof i.value=="object"&&i.value&&H2(i.value)&&this._ngOnDestroyHooks.add(i.value),i.value}finally{tn(c)}}injectableDefInScope(r){if(!r.providedIn)return!1;let i=Vi(r.providedIn);return typeof i=="string"?i==="any"||this.scopes.has(i):this.injectorDefTypes.has(i)}removeOnDestroy(r){let i=this._onDestroyHooks.indexOf(r);i!==-1&&this._onDestroyHooks.splice(i,1)}};function $v(t){let r=_g(t),i=r!==null?r.factory:Bl(t);if(i!==null)return i;if(t instanceof ot)throw new it(204,!1);if(t instanceof Function)return j2(t);throw new it(204,!1)}function j2(t){if(t.length>0)throw new it(204,!1);let i=h2(t);return i!==null?()=>i.factory(t):()=>new t}function V2(t){if(UE(t))return yu(void 0,t.useValue);{let r=U2(t);return yu(r,Nm)}}function U2(t,r,i){let c;if(Uv(t)){let u=Vi(t);return Bl(u)||$v(u)}else if(UE(t))c=()=>Vi(t.useValue);else if(z2(t))c=()=>t.useFactory(...jv(t.deps||[]));else if(F2(t))c=()=>ht(Vi(t.useExisting));else{let u=Vi(t&&(t.useClass||t.provide));if($2(t))c=()=>new u(...jv(t.deps));else return Bl(u)||$v(u)}return c}function Nh(t){if(t.destroyed)throw new it(205,!1)}function yu(t,r,i=!1){return{factory:t,value:r,multi:i?[]:void 0}}function $2(t){return!!t.deps}function H2(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function G2(t){return typeof t=="function"||typeof t=="object"&&t instanceof ot}function Hv(t,r){for(let i of t)Array.isArray(i)?Hv(i,r):i&&AE(i)?Hv(i.\u0275providers,r):r(i)}function li(t,r){t instanceof jh&&Nh(t);let i,c=Ea(t),u=ii(void 0);try{return r()}finally{Ea(c),ii(u)}}function $E(){return RE()!==void 0||E2()!=null}function q2(t){if(!$E())throw new it(-203,!1)}function Z2(t){return typeof t=="function"}var Mi=0,wt=1,Tt=2,xr=3,po=4,yo=5,Fo=6,Zm=7,$i=8,Ma=9,Rs=10,zn=11,Vh=12,RC=13,ku=14,Hi=15,jl=16,_u=17,ks=18,xg=19,HE=20,Ia=21,Tv=22,Wm=23,Ti=24,cr=25,GE=1,Vl=6,Os=7,Xm=8,Tu=9,oi=10;function mo(t){return Array.isArray(t)&&typeof t[GE]=="object"}function jo(t){return Array.isArray(t)&&t[GE]===!0}function qE(t){return(t.flags&4)!==0}function Ra(t){return t.componentOffset>-1}function z0(t){return(t.flags&1)===1}function Ou(t){return!!t.template}function Uh(t){return(t[Tt]&512)!==0}function Nu(t){return(t[Tt]&256)===256}var Gv=class{previousValue;currentValue;firstChange;constructor(r,i,c){this.previousValue=r,this.currentValue=i,this.firstChange=c}isFirstChange(){return this.firstChange}};function ZE(t,r,i,c){r!==null?r.applyValueToInputSignal(r,c):t[i]=c}var wg=(()=>{let t=()=>WE;return t.ngInherit=!0,t})();function WE(t){return t.type.prototype.ngOnChanges&&(t.setInput=X2),W2}function W2(){let t=YE(this),r=t?.current;if(r){let i=t.previous;if(i===Bh)t.previous=r;else for(let c in r)i[c]=r[c];t.current=null,this.ngOnChanges(r)}}function X2(t,r,i,c,u){let s=this.declaredInputs[c],x=YE(t)||Y2(t,{previous:Bh,current:null}),M=x.current||(x.current={}),S=x.previous,B=S[s];M[s]=new Gv(B&&B.currentValue,i,S===Bh),ZE(t,r,u,i)}var XE="__ngSimpleChanges__";function YE(t){return t[XE]||null}function Y2(t,r){return t[XE]=r}var kC=null;var Ui=function(t,r,i){kC?.(t,r,i)},K2="svg",Q2="math";function go(t){for(;Array.isArray(t);)t=t[Mi];return t}function KE(t,r){return go(r[t])}function Gi(t,r){return go(r[t.index])}function Cg(t,r){return t.data[r]}function J2(t,r){return t[r]}function zo(t,r){let i=r[t];return mo(i)?i:i[Mi]}function eR(t){return(t[Tt]&4)===4}function B0(t){return(t[Tt]&128)===128}function tR(t){return jo(t[xr])}function Ym(t,r){return r==null?null:t[r]}function QE(t){t[_u]=0}function j0(t){t[Tt]&1024||(t[Tt]|=1024,B0(t)&&Ig(t))}function nR(t,r){for(;t>0;)r=r[ku],t--;return r}function Eg(t){return!!(t[Tt]&9216||t[Ti]?.dirty)}function qv(t){t[Rs].changeDetectionScheduler?.notify(9),t[Tt]&64&&(t[Tt]|=1024),Eg(t)&&Ig(t)}function Ig(t){t[Rs].changeDetectionScheduler?.notify(0);let r=Ul(t);for(;r!==null&&!(r[Tt]&8192||(r[Tt]|=8192,!B0(r)));)r=Ul(r)}function JE(t,r){if(Nu(t))throw new it(911,!1);t[Ia]===null&&(t[Ia]=[]),t[Ia].push(r)}function rR(t,r){if(t[Ia]===null)return;let i=t[Ia].indexOf(r);i!==-1&&t[Ia].splice(i,1)}function Ul(t){let r=t[xr];return jo(r)?r[xr]:r}function eI(t){return t[Zm]??=[]}function tI(t){return t.cleanup??=[]}function iR(t,r,i,c){let u=eI(r);u.push(i),t.firstCreatePass&&tI(t).push(c,u.length-1)}var kt={lFrame:uI(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var Zv=!1;function oR(){return kt.lFrame.elementDepthCount}function sR(){kt.lFrame.elementDepthCount++}function aR(){kt.lFrame.elementDepthCount--}function nI(){return kt.bindingsEnabled}function Wh(){return kt.skipHydrationRootTNode!==null}function lR(t){return kt.skipHydrationRootTNode===t}function cR(t){kt.skipHydrationRootTNode=t}function uR(){kt.skipHydrationRootTNode=null}function an(){return kt.lFrame.lView}function qi(){return kt.lFrame.tView}function ci(t){return kt.lFrame.contextLView=t,t[$i]}function ui(t){return kt.lFrame.contextLView=null,t}function _o(){let t=rI();for(;t!==null&&t.type===64;)t=t.parent;return t}function rI(){return kt.lFrame.currentTNode}function dR(){let t=kt.lFrame,r=t.currentTNode;return t.isParent?r:r.parent}function Xh(t,r){let i=kt.lFrame;i.currentTNode=t,i.isParent=r}function iI(){return kt.lFrame.isParent}function hR(){kt.lFrame.isParent=!1}function oI(){return Zv}function OC(t){let r=Zv;return Zv=t,r}function V0(){let t=kt.lFrame,r=t.bindingRootIndex;return r===-1&&(r=t.bindingRootIndex=t.tView.bindingStartIndex),r}function fR(){return kt.lFrame.bindingIndex}function pR(t){return kt.lFrame.bindingIndex=t}function U0(){return kt.lFrame.bindingIndex++}function sI(t){let r=kt.lFrame,i=r.bindingIndex;return r.bindingIndex=r.bindingIndex+t,i}function mR(){return kt.lFrame.inI18n}function gR(t,r){let i=kt.lFrame;i.bindingIndex=i.bindingRootIndex=t,Wv(r)}function yR(){return kt.lFrame.currentDirectiveIndex}function Wv(t){kt.lFrame.currentDirectiveIndex=t}function _R(t){let r=kt.lFrame.currentDirectiveIndex;return r===-1?null:t[r]}function aI(){return kt.lFrame.currentQueryIndex}function $0(t){kt.lFrame.currentQueryIndex=t}function vR(t){let r=t[wt];return r.type===2?r.declTNode:r.type===1?t[yo]:null}function lI(t,r,i){if(i&Lt.SkipSelf){let u=r,s=t;for(;u=u.parent,u===null&&!(i&Lt.Host);)if(u=vR(s),u===null||(s=s[ku],u.type&10))break;if(u===null)return!1;r=u,t=s}let c=kt.lFrame=cI();return c.currentTNode=r,c.lView=t,!0}function H0(t){let r=cI(),i=t[wt];kt.lFrame=r,r.currentTNode=i.firstChild,r.lView=t,r.tView=i,r.contextLView=t,r.bindingIndex=i.bindingStartIndex,r.inI18n=!1}function cI(){let t=kt.lFrame,r=t===null?null:t.child;return r===null?uI(t):r}function uI(t){let r={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=r),r}function dI(){let t=kt.lFrame;return kt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var hI=dI;function G0(){let t=dI();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function bR(t){return(kt.lFrame.contextLView=nR(t,kt.lFrame.contextLView))[$i]}function Wl(){return kt.lFrame.selectedIndex}function $l(t){kt.lFrame.selectedIndex=t}function fI(){let t=kt.lFrame;return Cg(t.tView,t.selectedIndex)}function pI(){return kt.lFrame.currentNamespace}var mI=!0;function q0(){return mI}function ka(t){mI=t}function xR(t,r,i){let{ngOnChanges:c,ngOnInit:u,ngDoCheck:s}=r.type.prototype;if(c){let x=WE(r);(i.preOrderHooks??=[]).push(t,x),(i.preOrderCheckHooks??=[]).push(t,x)}u&&(i.preOrderHooks??=[]).push(0-t,u),s&&((i.preOrderHooks??=[]).push(t,s),(i.preOrderCheckHooks??=[]).push(t,s))}function Z0(t,r){for(let i=r.directiveStart,c=r.directiveEnd;i<c;i++){let s=t.data[i].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:M,ngAfterViewInit:S,ngAfterViewChecked:B,ngOnDestroy:W}=s;x&&(t.contentHooks??=[]).push(-i,x),M&&((t.contentHooks??=[]).push(i,M),(t.contentCheckHooks??=[]).push(i,M)),S&&(t.viewHooks??=[]).push(-i,S),B&&((t.viewHooks??=[]).push(i,B),(t.viewCheckHooks??=[]).push(i,B)),W!=null&&(t.destroyHooks??=[]).push(i,W)}}function Lm(t,r,i){gI(t,r,3,i)}function Fm(t,r,i,c){(t[Tt]&3)===i&&gI(t,r,i,c)}function Mv(t,r){let i=t[Tt];(i&3)===r&&(i&=16383,i+=1,t[Tt]=i)}function gI(t,r,i,c){let u=c!==void 0?t[_u]&65535:0,s=c??-1,x=r.length-1,M=0;for(let S=u;S<x;S++)if(typeof r[S+1]=="number"){if(M=r[S],c!=null&&M>=c)break}else r[S]<0&&(t[_u]+=65536),(M<s||s==-1)&&(wR(t,i,r,S),t[_u]=(t[_u]&4294901760)+S+2),S++}function NC(t,r){Ui(4,t,r);let i=tn(null);try{r.call(t)}finally{tn(i),Ui(5,t,r)}}function wR(t,r,i,c){let u=i[c]<0,s=i[c+1],x=u?-i[c]:i[c],M=t[x];u?t[Tt]>>14<t[_u]>>16&&(t[Tt]&3)===r&&(t[Tt]+=16384,NC(M,s)):NC(M,s)}var Cu=-1,$h=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(r,i,c){this.factory=r,this.canSeeViewProviders=i,this.injectImpl=c}};function CR(t){return t instanceof $h}function ER(t){return(t.flags&8)!==0}function IR(t){return(t.flags&16)!==0}function TR(t,r,i){let c=0;for(;c<i.length;){let u=i[c];if(typeof u=="number"){if(u!==0)break;c++;let s=i[c++],x=i[c++],M=i[c++];t.setAttribute(r,x,M,s)}else{let s=u,x=i[++c];MR(s)?t.setProperty(r,s,x):t.setAttribute(r,s,x),c++}}return c}function yI(t){return t===3||t===4||t===6}function MR(t){return t.charCodeAt(0)===64}function Km(t,r){if(!(r===null||r.length===0))if(t===null||t.length===0)t=r.slice();else{let i=-1;for(let c=0;c<r.length;c++){let u=r[c];typeof u=="number"?i=u:i===0||(i===-1||i===2?LC(t,i,u,null,r[++c]):LC(t,i,u,null,null))}}return t}function LC(t,r,i,c,u){let s=0,x=t.length;if(r===-1)x=-1;else for(;s<t.length;){let M=t[s++];if(typeof M=="number"){if(M===r){x=-1;break}else if(M>r){x=s-1;break}}}for(;s<t.length;){let M=t[s];if(typeof M=="number")break;if(M===i){if(c===null){u!==null&&(t[s+1]=u);return}else if(c===t[s+1]){t[s+2]=u;return}}s++,c!==null&&s++,u!==null&&s++}x!==-1&&(t.splice(x,0,r),s=x+1),t.splice(s++,0,i),c!==null&&t.splice(s++,0,c),u!==null&&t.splice(s++,0,u)}var Dv={},Eu=class{injector;parentInjector;constructor(r,i){this.injector=r,this.parentInjector=i}get(r,i,c){c=vg(c);let u=this.injector.get(r,Dv,c);return u!==Dv||i===Dv?u:this.parentInjector.get(r,i,c)}};function _I(t){return t!==Cu}function Qm(t){return t&32767}function DR(t){return t>>16}function Jm(t,r){let i=DR(t),c=r;for(;i>0;)c=c[ku],i--;return c}var Xv=!0;function eg(t){let r=Xv;return Xv=t,r}var SR=256,vI=SR-1,bI=5,PR=0,Lo={};function AR(t,r,i){let c;typeof i=="string"?c=i.charCodeAt(0)||0:i.hasOwnProperty(Fh)&&(c=i[Fh]),c==null&&(c=i[Fh]=PR++);let u=c&vI,s=1<<u;r.data[t+(u>>bI)]|=s}function xI(t,r){let i=wI(t,r);if(i!==-1)return i;let c=r[wt];c.firstCreatePass&&(t.injectorIndex=r.length,Sv(c.data,t),Sv(r,null),Sv(c.blueprint,null));let u=W0(t,r),s=t.injectorIndex;if(_I(u)){let x=Qm(u),M=Jm(u,r),S=M[wt].data;for(let B=0;B<8;B++)r[s+B]=M[x+B]|S[x+B]}return r[s+8]=u,s}function Sv(t,r){t.push(0,0,0,0,0,0,0,0,r)}function wI(t,r){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||r[t.injectorIndex+8]===null?-1:t.injectorIndex}function W0(t,r){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let i=0,c=null,u=r;for(;u!==null;){if(c=MI(u),c===null)return Cu;if(i++,u=u[ku],c.injectorIndex!==-1)return c.injectorIndex|i<<16}return Cu}function RR(t,r,i){AR(t,r,i)}function kR(t,r){if(r==="class")return t.classes;if(r==="style")return t.styles;let i=t.attrs;if(i){let c=i.length,u=0;for(;u<c;){let s=i[u];if(yI(s))break;if(s===0)u=u+2;else if(typeof s=="number")for(u++;u<c&&typeof i[u]=="string";)u++;else{if(s===r)return i[u+1];u=u+2}}}return null}function CI(t,r,i){if(i&Lt.Optional||t!==void 0)return t;A0(r,"NodeInjector")}function EI(t,r,i,c){if(i&Lt.Optional&&c===void 0&&(c=null),!(i&(Lt.Self|Lt.Host))){let u=t[Ma],s=ii(void 0);try{return u?u.get(r,c,i&Lt.Optional):kE(r,c,i&Lt.Optional)}finally{ii(s)}}return CI(c,r,i)}function II(t,r,i,c=Lt.Default,u){if(t!==null){if(r[Tt]&2048&&!(c&Lt.Self)){let x=FR(t,r,i,c,Lo);if(x!==Lo)return x}let s=TI(t,r,i,c,Lo);if(s!==Lo)return s}return EI(r,i,c,u)}function TI(t,r,i,c,u){let s=NR(i);if(typeof s=="function"){if(!lI(r,t,c))return c&Lt.Host?CI(u,i,c):EI(r,i,c,u);try{let x;if(x=s(c),x==null&&!(c&Lt.Optional))A0(i);else return x}finally{hI()}}else if(typeof s=="number"){let x=null,M=wI(t,r),S=Cu,B=c&Lt.Host?r[Hi][yo]:null;for((M===-1||c&Lt.SkipSelf)&&(S=M===-1?W0(t,r):r[M+8],S===Cu||!zC(c,!1)?M=-1:(x=r[wt],M=Qm(S),r=Jm(S,r)));M!==-1;){let W=r[wt];if(FC(s,M,W.data)){let $=OR(M,r,i,x,c,B);if($!==Lo)return $}S=r[M+8],S!==Cu&&zC(c,r[wt].data[M+8]===B)&&FC(s,M,r)?(x=W,M=Qm(S),r=Jm(S,r)):M=-1}}return u}function OR(t,r,i,c,u,s){let x=r[wt],M=x.data[t+8],S=c==null?Ra(M)&&Xv:c!=x&&(M.type&3)!==0,B=u&Lt.Host&&s===M,W=zm(M,x,i,S,B);return W!==null?tg(r,x,W,M):Lo}function zm(t,r,i,c,u){let s=t.providerIndexes,x=r.data,M=s&1048575,S=t.directiveStart,B=t.directiveEnd,W=s>>20,$=c?M:M+W,he=u?M+W:B;for(let ge=$;ge<he;ge++){let ze=x[ge];if(ge<S&&i===ze||ge>=S&&ze.type===i)return ge}if(u){let ge=x[S];if(ge&&Ou(ge)&&ge.type===i)return S}return null}function tg(t,r,i,c){let u=t[i],s=r.data;if(CR(u)){let x=u;x.resolving&&v2(_2(s[i]));let M=eg(x.canSeeViewProviders);x.resolving=!0;let S,B=x.injectImpl?ii(x.injectImpl):null,W=lI(t,c,Lt.Default);try{u=t[i]=x.factory(void 0,s,t,c),r.firstCreatePass&&i>=c.directiveStart&&xR(i,s[i],r)}finally{B!==null&&ii(B),eg(M),x.resolving=!1,hI()}}return u}function NR(t){if(typeof t=="string")return t.charCodeAt(0)||0;let r=t.hasOwnProperty(Fh)?t[Fh]:void 0;return typeof r=="number"?r>=0?r&vI:LR:r}function FC(t,r,i){let c=1<<t;return!!(i[r+(t>>bI)]&c)}function zC(t,r){return!(t&Lt.Self)&&!(t&Lt.Host&&r)}var zl=class{_tNode;_lView;constructor(r,i){this._tNode=r,this._lView=i}get(r,i,c){return II(this._tNode,this._lView,r,vg(c),i)}};function LR(){return new zl(_o(),an())}function X0(t){return qh(()=>{let r=t.prototype.constructor,i=r[$m]||Yv(r),c=Object.prototype,u=Object.getPrototypeOf(t.prototype).constructor;for(;u&&u!==c;){let s=u[$m]||Yv(u);if(s&&s!==i)return s;u=Object.getPrototypeOf(u)}return s=>new s})}function Yv(t){return ME(t)?()=>{let r=Yv(Vi(t));return r&&r()}:Bl(t)}function FR(t,r,i,c,u){let s=t,x=r;for(;s!==null&&x!==null&&x[Tt]&2048&&!Uh(x);){let M=TI(s,x,i,c|Lt.Self,Lo);if(M!==Lo)return M;let S=s.parent;if(!S){let B=x[HE];if(B){let W=B.get(i,Lo,c);if(W!==Lo)return W}S=MI(x),x=x[ku]}s=S}return u}function MI(t){let r=t[wt],i=r.type;return i===2?r.declTNode:i===1?t[yo]:null}function Y0(t){return kR(_o(),t)}function BC(t,r=null,i=null,c){let u=DI(t,r,i,c);return u.resolveInjectorInitializers(),u}function DI(t,r=null,i=null,c,u=new Set){let s=[i||fo,N2(t)];return c=c||(typeof t=="object"?void 0:$r(t)),new jh(s,r||F0(),c||null,u)}var si=class t{static THROW_IF_NOT_FOUND=zh;static NULL=new qm;static create(r,i){if(Array.isArray(r))return BC({name:""},i,r,"");{let c=r.name??"";return BC({name:c},r.parent,r.providers,c)}}static \u0275prov=nt({token:t,providedIn:"any",factory:()=>ht(FE)});static __NG_ELEMENT_ID__=-1};var zR=new ot("");zR.__NG_ELEMENT_ID__=t=>{let r=_o();if(r===null)throw new it(204,!1);if(r.type&2)return r.value;if(t&Lt.Optional)return null;throw new it(204,!1)};var SI=!1,Yh=(()=>{class t{static __NG_ELEMENT_ID__=BR;static __NG_ENV_ID__=i=>i}return t})(),Kv=class extends Yh{_lView;constructor(r){super(),this._lView=r}onDestroy(r){return JE(this._lView,r),()=>rR(this._lView,r)}};function BR(){return new Kv(an())}var Mu=class{},Tg=new ot("",{providedIn:"root",factory:()=>!1});var PI=new ot(""),AI=new ot(""),Vo=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new Tr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let i=this.taskId++;return this.pendingTasks.add(i),i}has(i){return this.pendingTasks.has(i)}remove(i){this.pendingTasks.delete(i),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=nt({token:t,providedIn:"root",factory:()=>new t})}return t})();var Qv=class extends _r{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(r=!1){super(),this.__isAsync=r,$E()&&(this.destroyRef=Le(Yh,{optional:!0})??void 0,this.pendingTasks=Le(Vo,{optional:!0})??void 0)}emit(r){let i=tn(null);try{super.next(r)}finally{tn(i)}}subscribe(r,i,c){let u=r,s=i||(()=>null),x=c;if(r&&typeof r=="object"){let S=r;u=S.next?.bind(S),s=S.error?.bind(S),x=S.complete?.bind(S)}this.__isAsync&&(s=this.wrapInTimeout(s),u&&(u=this.wrapInTimeout(u)),x&&(x=this.wrapInTimeout(x)));let M=super.subscribe({next:u,error:s,complete:x});return r instanceof Qn&&r.add(M),M}wrapInTimeout(r){return i=>{let c=this.pendingTasks?.add();setTimeout(()=>{r(i),c!==void 0&&this.pendingTasks?.remove(c)})}}},Rn=Qv;function ng(...t){}function RI(t){let r,i;function c(){t=ng;try{i!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(i),r!==void 0&&clearTimeout(r)}catch{}}return r=setTimeout(()=>{t(),c()}),typeof requestAnimationFrame=="function"&&(i=requestAnimationFrame(()=>{t(),c()})),()=>c()}function jC(t){return queueMicrotask(()=>t()),()=>{t=ng}}var K0="isAngularZone",rg=K0+"_ID",jR=0,kn=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Rn(!1);onMicrotaskEmpty=new Rn(!1);onStable=new Rn(!1);onError=new Rn(!1);constructor(r){let{enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:c=!1,shouldCoalesceRunChangeDetection:u=!1,scheduleInRootZone:s=SI}=r;if(typeof Zone>"u")throw new it(908,!1);Zone.assertZonePatched();let x=this;x._nesting=0,x._outer=x._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(x._inner=x._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(x._inner=x._inner.fork(Zone.longStackTraceZoneSpec)),x.shouldCoalesceEventChangeDetection=!u&&c,x.shouldCoalesceRunChangeDetection=u,x.callbackScheduled=!1,x.scheduleInRootZone=s,$R(x)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(K0)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new it(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new it(909,!1)}run(r,i,c){return this._inner.run(r,i,c)}runTask(r,i,c,u){let s=this._inner,x=s.scheduleEventTask("NgZoneEvent: "+u,r,VR,ng,ng);try{return s.runTask(x,i,c)}finally{s.cancelTask(x)}}runGuarded(r,i,c){return this._inner.runGuarded(r,i,c)}runOutsideAngular(r){return this._outer.run(r)}},VR={};function Q0(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function UR(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function r(){RI(()=>{t.callbackScheduled=!1,Jv(t),t.isCheckStableRunning=!0,Q0(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{r()}):t._outer.run(()=>{r()}),Jv(t)}function $R(t){let r=()=>{UR(t)},i=jR++;t._inner=t._inner.fork({name:"angular",properties:{[K0]:!0,[rg]:i,[rg+i]:!0},onInvokeTask:(c,u,s,x,M,S)=>{if(HR(S))return c.invokeTask(s,x,M,S);try{return VC(t),c.invokeTask(s,x,M,S)}finally{(t.shouldCoalesceEventChangeDetection&&x.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&r(),UC(t)}},onInvoke:(c,u,s,x,M,S,B)=>{try{return VC(t),c.invoke(s,x,M,S,B)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!GR(S)&&r(),UC(t)}},onHasTask:(c,u,s,x)=>{c.hasTask(s,x),u===s&&(x.change=="microTask"?(t._hasPendingMicrotasks=x.microTask,Jv(t),Q0(t)):x.change=="macroTask"&&(t.hasPendingMacrotasks=x.macroTask))},onHandleError:(c,u,s,x)=>(c.handleError(s,x),t.runOutsideAngular(()=>t.onError.emit(x)),!1)})}function Jv(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function VC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function UC(t){t._nesting--,Q0(t)}var e0=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Rn;onMicrotaskEmpty=new Rn;onStable=new Rn;onError=new Rn;run(r,i,c){return r.apply(i,c)}runGuarded(r,i,c){return r.apply(i,c)}runOutsideAngular(r){return r()}runTask(r,i,c,u){return r.apply(i,c)}};function HR(t){return kI(t,"__ignore_ng_zone__")}function GR(t){return kI(t,"__scheduler_tick__")}function kI(t,r){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[r]===!0}var Ns=class{_console=console;handleError(r){this._console.error("ERROR",r)}},qR=new ot("",{providedIn:"root",factory:()=>{let t=Le(kn),r=Le(Ns);return i=>t.runOutsideAngular(()=>r.handleError(i))}});function $C(t,r){return EE(t,r)}function ZR(t){return EE(CE,t)}var OI=($C.required=ZR,$C);function WR(){return Lu(_o(),an())}function Lu(t,r){return new Fs(Gi(t,r))}var Fs=(()=>{class t{nativeElement;constructor(i){this.nativeElement=i}static __NG_ELEMENT_ID__=WR}return t})();function XR(t){return t instanceof Fs?t.nativeElement:t}var HC=new Set;function Oa(t){HC.has(t)||(HC.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function YR(){return this._results[Symbol.iterator]()}var t0=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new _r}constructor(r=!1){this._emitDistinctChangesOnly=r}get(r){return this._results[r]}map(r){return this._results.map(r)}filter(r){return this._results.filter(r)}find(r){return this._results.find(r)}reduce(r,i){return this._results.reduce(r,i)}forEach(r){this._results.forEach(r)}some(r){return this._results.some(r)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(r,i){this.dirty=!1;let c=A2(r);(this._changesDetected=!P2(this._results,c,i))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(r){this._onDirty=r}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=YR},KR="ngSkipHydration",QR="ngskiphydration";function NI(t){let r=t.mergedAttrs;if(r===null)return!1;for(let i=0;i<r.length;i+=2){let c=r[i];if(typeof c=="number")return!1;if(typeof c=="string"&&c.toLowerCase()===QR)return!0}return!1}function LI(t){return t.hasAttribute(KR)}function ig(t){return(t.flags&128)===128}function JR(t){if(ig(t))return!0;let r=t.parent;for(;r;){if(ig(t)||NI(r))return!0;r=r.parent}return!1}var FI=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(FI||{}),zI=new Map,ek=0;function tk(){return ek++}function nk(t){zI.set(t[xg],t)}function n0(t){zI.delete(t[xg])}var GC="__ngContext__";function Fu(t,r){mo(r)?(t[GC]=r[xg],nk(r)):t[GC]=r}function BI(t){return VI(t[Vh])}function jI(t){return VI(t[po])}function VI(t){for(;t!==null&&!jo(t);)t=t[po];return t}var r0;function UI(t){r0=t}function Mg(){if(r0!==void 0)return r0;if(typeof document<"u")return document;throw new it(210,!1)}var Hl=new ot("",{providedIn:"root",factory:()=>rk}),rk="ng",J0=new ot(""),Di=new ot("",{providedIn:"platform",factory:()=>"unknown"});var eb=new ot("",{providedIn:"root",factory:()=>Mg().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function ik(){let t=new Xl;return Le(Di)==="browser"&&(t.store=ok(Mg(),Le(Hl))),t}var Xl=(()=>{class t{static \u0275prov=nt({token:t,providedIn:"root",factory:ik});store={};onSerializeCallbacks={};get(i,c){return this.store[i]!==void 0?this.store[i]:c}set(i,c){this.store[i]=c}remove(i){delete this.store[i]}hasKey(i){return this.store.hasOwnProperty(i)}get isEmpty(){return Object.keys(this.store).length===0}onSerialize(i,c){this.onSerializeCallbacks[i]=c}toJson(){for(let i in this.onSerializeCallbacks)if(this.onSerializeCallbacks.hasOwnProperty(i))try{this.store[i]=this.onSerializeCallbacks[i]()}catch(c){console.warn("Exception in onSerialize callback: ",c)}return JSON.stringify(this.store).replace(/</g,"\\u003C")}}return t})();function ok(t,r){let i=t.getElementById(r+"-state");if(i?.textContent)try{return JSON.parse(i.textContent)}catch(c){console.warn("Exception while restoring TransferState for app "+r,c)}return{}}var $I="h",HI="b",sk="f",ak="n",lk="e",ck="t",tb="c",GI="x",og="r",uk="i",dk="n",qI="d";var hk="di",fk="s",pk="p";var Am=new ot(""),ZI=!1,WI=new ot("",{providedIn:"root",factory:()=>ZI});var XI=new ot(""),mk=!1,gk=new ot(""),qC=new ot("",{providedIn:"root",factory:()=>new Map}),nb=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(nb||{}),zu=new ot("");var vu=function(t){return t[t.EarlyRead=0]="EarlyRead",t[t.Write=1]="Write",t[t.MixedReadWrite=2]="MixedReadWrite",t[t.Read=3]="Read",t}(vu||{}),YI=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=nt({token:t,providedIn:"root",factory:()=>new t})}return t})(),yk=[vu.EarlyRead,vu.Write,vu.MixedReadWrite,vu.Read],_k=(()=>{class t{ngZone=Le(kn);scheduler=Le(Mu);errorHandler=Le(Ns,{optional:!0});sequences=new Set;deferredRegistrations=new Set;executing=!1;constructor(){Le(zu,{optional:!0})}execute(){this.executing=!0;for(let i of yk)for(let c of this.sequences)if(!(c.erroredOrDestroyed||!c.hooks[i]))try{c.pipelinedValue=this.ngZone.runOutsideAngular(()=>this.maybeTrace(()=>c.hooks[i](c.pipelinedValue),c.snapshot))}catch(u){c.erroredOrDestroyed=!0,this.errorHandler?.handleError(u)}this.executing=!1;for(let i of this.sequences)i.afterRun(),i.once&&(this.sequences.delete(i),i.destroy());for(let i of this.deferredRegistrations)this.sequences.add(i);this.deferredRegistrations.size>0&&this.scheduler.notify(8),this.deferredRegistrations.clear()}register(i){this.executing?this.deferredRegistrations.add(i):(this.sequences.add(i),this.scheduler.notify(7))}unregister(i){this.executing&&this.sequences.has(i)?(i.erroredOrDestroyed=!0,i.pipelinedValue=void 0,i.once=!0):(this.sequences.delete(i),this.deferredRegistrations.delete(i))}maybeTrace(i,c){return c?c.run(nb.AFTER_NEXT_RENDER,i):i()}static \u0275prov=nt({token:t,providedIn:"root",factory:()=>new t})}return t})(),i0=class{impl;hooks;once;snapshot;erroredOrDestroyed=!1;pipelinedValue=void 0;unregisterOnDestroy;constructor(r,i,c,u,s=null){this.impl=r,this.hooks=i,this.once=c,this.snapshot=s,this.unregisterOnDestroy=u?.onDestroy(()=>this.destroy())}afterRun(){this.erroredOrDestroyed=!1,this.pipelinedValue=void 0,this.snapshot?.dispose(),this.snapshot=null}destroy(){this.impl.unregister(this),this.unregisterOnDestroy?.()}};function Dg(t,r){!r?.injector&&q2(Dg);let i=r?.injector??Le(si);return Oa("NgAfterNextRender"),bk(t,i,r,!0)}function vk(t,r){if(t instanceof Function){let i=[void 0,void 0,void 0,void 0];return i[r]=t,i}else return[t.earlyRead,t.write,t.mixedReadWrite,t.read]}function bk(t,r,i,c){let u=r.get(YI);u.impl??=r.get(_k);let s=r.get(zu,null,{optional:!0}),x=i?.phase??vu.MixedReadWrite,M=i?.manualCleanup!==!0?r.get(Yh):null,S=new i0(u.impl,vk(t,x),c,M,s?.snapshot(null));return u.impl.register(S),S}var Ii=function(t){return t[t.NOT_STARTED=0]="NOT_STARTED",t[t.IN_PROGRESS=1]="IN_PROGRESS",t[t.COMPLETE=2]="COMPLETE",t[t.FAILED=3]="FAILED",t}(Ii||{}),ZC=0,xk=1,br=function(t){return t[t.Placeholder=0]="Placeholder",t[t.Loading=1]="Loading",t[t.Complete=2]="Complete",t[t.Error=3]="Error",t}(br||{});var wk=0,rb=1;var Ck=4,Ek=5;var Ik=7,Iu=8,Tk=9,KI=function(t){return t[t.Manual=0]="Manual",t[t.Playthrough=1]="Playthrough",t}(KI||{});function Bm(t,r){let i=Dk(t),c=r[i];if(c!==null){for(let u of c)u();r[i]=null}}function Mk(t){Bm(1,t),Bm(0,t),Bm(2,t)}function Dk(t){let r=Ck;return t===1?r=Ek:t===2&&(r=Tk),r}function QI(t){return t+1}function Sg(t,r){let i=t[wt],c=QI(r.index);return t[c]}function Pg(t,r){let i=QI(r.index);return t.data[i]}function Sk(t,r,i){let c=r[wt],u=Pg(c,i);switch(t){case br.Complete:return u.primaryTmplIndex;case br.Loading:return u.loadingTmplIndex;case br.Error:return u.errorTmplIndex;case br.Placeholder:return u.placeholderTmplIndex;default:return null}}function WC(t,r){return r===br.Placeholder?t.placeholderBlockConfig?.[ZC]??null:r===br.Loading?t.loadingBlockConfig?.[ZC]??null:null}function Pk(t){return t.loadingBlockConfig?.[xk]??null}function XC(t,r){if(!t||t.length===0)return r;let i=new Set(t);for(let c of r)i.add(c);return t.length===i.size?t:Array.from(i)}function Ak(t,r){let i=r.primaryTmplIndex+cr;return Cg(t,i)}var Ag="ngb";var Rk=(t,r,i)=>{let c=t,u=c.__jsaction_fns??new Map,s=u.get(r)??[];s.push(i),u.set(r,s),c.__jsaction_fns=u},kk=(t,r)=>{let i=t.getAttribute(Ag)??"",c=t,u=r.get(i)??new Set;u.has(c)||u.add(c),r.set(i,u)};var Ok=t=>{t.removeAttribute(_v.JSACTION),t.removeAttribute(Ag),t.__jsaction_fns=void 0},Nk=new ot("",{providedIn:"root",factory:()=>({})});function JI(t,r){let i=r?.__jsaction_fns?.get(t.type);if(i)for(let c of i)c(t)}var eT=new ot("");var Lk="__nghData__",tT=Lk,Fk="__nghDeferData__",zk=Fk,Pv="ngh",Bk="nghm",nT=()=>null;function jk(t,r,i=!1){let c=t.getAttribute(Pv);if(c==null)return null;let[u,s]=c.split("|");if(c=i?s:u,!c)return null;let x=s?`|${s}`:"",M=i?u:x,S={};if(c!==""){let W=r.get(Xl,null,{optional:!0});W!==null&&(S=W.get(tT,[])[Number(c)])}let B={data:S,firstChild:t.firstChild??null};return i&&(B.firstChild=t,Rg(B,0,t.nextSibling)),M?t.setAttribute(Pv,M):t.removeAttribute(Pv),B}function Vk(){nT=jk}function rT(t,r,i=!1){return nT(t,r,i)}function Uk(t){let r=t._lView;return r[wt].type===2?null:(Uh(r)&&(r=r[cr]),r)}function $k(t){return t.textContent?.replace(/\s/gm,"")}function Hk(t){let r=Mg(),i=r.createNodeIterator(t,NodeFilter.SHOW_COMMENT,{acceptNode(s){let x=$k(s);return x==="ngetn"||x==="ngtns"?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}}),c,u=[];for(;c=i.nextNode();)u.push(c);for(let s of u)s.textContent==="ngetn"?s.replaceWith(r.createTextNode("")):s.remove()}function Rg(t,r,i){t.segmentHeads??={},t.segmentHeads[r]=i}function o0(t,r){return t.segmentHeads?.[r]??null}function Gk(t){return t.get(gk,!1,{optional:!0})}function qk(t,r){let i=t.data,c=i[lk]?.[r]??null;return c===null&&i[tb]?.[r]&&(c=ib(t,r)),c}function iT(t,r){return t.data[tb]?.[r]??null}function ib(t,r){let i=iT(t,r)??[],c=0;for(let u of i)c+=u[og]*(u[GI]??1);return c}function Zk(t){if(typeof t.disconnectedNodes>"u"){let r=t.data[qI];t.disconnectedNodes=r?new Set(r):null}return t.disconnectedNodes}function Kh(t,r){if(typeof t.disconnectedNodes>"u"){let i=t.data[qI];t.disconnectedNodes=i?new Set(i):null}return!!Zk(t)?.has(r)}function Wk(t,r){let i=r.get(eT),u=r.get(Xl).get(zk,{}),s=!1,x=t,M=null,S=[];for(;!s&&x;){s=i.has(x);let B=i.hydrating.get(x);if(M===null&&B!=null){M=B.promise;break}S.unshift(x),x=u[x][pk]}return{parentBlockPromise:M,hydrationQueue:S}}function oT(t,r){let i=t.contentQueries;if(i!==null){let c=tn(null);try{for(let u=0;u<i.length;u+=2){let s=i[u],x=i[u+1];if(x!==-1){let M=t.data[x];$0(s),M.contentQueries(2,r[x],x)}}}finally{tn(c)}}}function s0(t,r,i){$0(0);let c=tn(null);try{r(t,i)}finally{tn(c)}}function sT(t,r,i){if(qE(r)){let c=tn(null);try{let u=r.directiveStart,s=r.directiveEnd;for(let x=u;x<s;x++){let M=t.data[x];if(M.contentQueries){let S=i[x];M.contentQueries(1,S,x)}}}finally{tn(c)}}}var Bo=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Bo||{});var Rm;function Xk(){if(Rm===void 0&&(Rm=null,Ll.trustedTypes))try{Rm=Ll.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Rm}function YC(t){return Xk()?.createScriptURL(t)||t}var sg=class{changingThisBreaksApplicationSecurity;constructor(r){this.changingThisBreaksApplicationSecurity=r}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${wE})`}};function Qh(t){return t instanceof sg?t.changingThisBreaksApplicationSecurity:t}function ob(t,r){let i=Yk(t);if(i!=null&&i!==r){if(i==="ResourceURL"&&r==="URL")return!0;throw new Error(`Required a safe ${r}, got a ${i} (see ${wE})`)}return i===r}function Yk(t){return t instanceof sg&&t.getTypeName()||null}var Kk=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function aT(t){return t=String(t),t.match(Kk)?t:"unsafe:"+t}var kg=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(kg||{});function Yl(t){let r=cT();return r?r.sanitize(kg.URL,t)||"":ob(t,"URL")?Qh(t):aT(Fl(t))}function Qk(t){let r=cT();if(r)return YC(r.sanitize(kg.RESOURCE_URL,t)||"");if(ob(t,"ResourceURL"))return YC(Qh(t));throw new it(904,!1)}function Jk(t,r){return r==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||r==="href"&&(t==="base"||t==="link")?Qk:Yl}function lT(t,r,i){return Jk(r,i)(t)}function cT(){let t=an();return t&&t[Rs].sanitizer}var eO=/^>|^->|<!--|-->|--!>|<!-$/g,tO=/(<|>)/g,nO="\u200B$1\u200B";function rO(t){return t.replace(eO,r=>r.replace(tO,nO))}function iO(t){return t.ownerDocument.body}function uT(t){return t instanceof Function?t():t}var Da=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Da||{});function oO(t,r,i){let c=t.length;for(;;){let u=t.indexOf(r,i);if(u===-1)return u;if(u===0||t.charCodeAt(u-1)<=32){let s=r.length;if(u+s===c||t.charCodeAt(u+s)<=32)return u}i=u+1}}var dT="ng-template";function sO(t,r,i,c){let u=0;if(c){for(;u<r.length&&typeof r[u]=="string";u+=2)if(r[u]==="class"&&oO(r[u+1].toLowerCase(),i,0)!==-1)return!0}else if(sb(t))return!1;if(u=r.indexOf(1,u),u>-1){let s;for(;++u<r.length&&typeof(s=r[u])=="string";)if(s.toLowerCase()===i)return!0}return!1}function sb(t){return t.type===4&&t.value!==dT}function aO(t,r,i){let c=t.type===4&&!i?dT:t.value;return r===c}function lO(t,r,i){let c=4,u=t.attrs,s=u!==null?dO(u):0,x=!1;for(let M=0;M<r.length;M++){let S=r[M];if(typeof S=="number"){if(!x&&!ho(c)&&!ho(S))return!1;if(x&&ho(S))continue;x=!1,c=S|c&1;continue}if(!x)if(c&4){if(c=2|c&1,S!==""&&!aO(t,S,i)||S===""&&r.length===1){if(ho(c))return!1;x=!0}}else if(c&8){if(u===null||!sO(t,u,S,i)){if(ho(c))return!1;x=!0}}else{let B=r[++M],W=cO(S,u,sb(t),i);if(W===-1){if(ho(c))return!1;x=!0;continue}if(B!==""){let $;if(W>s?$="":$=u[W+1].toLowerCase(),c&2&&B!==$){if(ho(c))return!1;x=!0}}}}return ho(c)||x}function ho(t){return(t&1)===0}function cO(t,r,i,c){if(r===null)return-1;let u=0;if(c||!i){let s=!1;for(;u<r.length;){let x=r[u];if(x===t)return u;if(x===3||x===6)s=!0;else if(x===1||x===2){let M=r[++u];for(;typeof M=="string";)M=r[++u];continue}else{if(x===4)break;if(x===0){u+=4;continue}}u+=s?1:2}return-1}else return hO(r,t)}function uO(t,r,i=!1){for(let c=0;c<r.length;c++)if(lO(t,r[c],i))return!0;return!1}function dO(t){for(let r=0;r<t.length;r++){let i=t[r];if(yI(i))return r}return t.length}function hO(t,r){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){let c=t[i];if(typeof c=="number")return-1;if(c===r)return i;i++}return-1}function KC(t,r){return t?":not("+r.trim()+")":r}function fO(t){let r=t[0],i=1,c=2,u="",s=!1;for(;i<t.length;){let x=t[i];if(typeof x=="string")if(c&2){let M=t[++i];u+="["+x+(M.length>0?'="'+M+'"':"")+"]"}else c&8?u+="."+x:c&4&&(u+=" "+x);else u!==""&&!ho(x)&&(r+=KC(s,u),u=""),c=x,s=s||!ho(c);i++}return u!==""&&(r+=KC(s,u)),r}function pO(t){return t.map(fO).join(",")}function mO(t){let r=[],i=[],c=1,u=2;for(;c<t.length;){let s=t[c];if(typeof s=="string")u===2?s!==""&&r.push(s,t[++c]):u===8&&i.push(s);else{if(!ho(u))break;u=s}c++}return i.length&&r.push(1,...i),r}var Uo={};function hT(t,r){return t.createText(r)}function gO(t,r,i){t.setValue(r,i)}function fT(t,r){return t.createComment(rO(r))}function ab(t,r,i){return t.createElement(r,i)}function ag(t,r,i,c,u){t.insertBefore(r,i,c,u)}function pT(t,r,i){t.appendChild(r,i)}function QC(t,r,i,c,u){c!==null?ag(t,r,i,c,u):pT(t,r,i)}function lb(t,r,i){t.removeChild(null,r,i)}function mT(t){t.textContent=""}function yO(t,r,i){t.setAttribute(r,"style",i)}function _O(t,r,i){i===""?t.removeAttribute(r,"class"):t.setAttribute(r,"class",i)}function gT(t,r,i){let{mergedAttrs:c,classes:u,styles:s}=i;c!==null&&TR(t,r,c),u!==null&&_O(t,r,u),s!==null&&yO(t,r,s)}function Ze(t=1){yT(qi(),an(),Wl()+t,!1)}function yT(t,r,i,c){if(!c)if((r[Tt]&3)===3){let s=t.preOrderCheckHooks;s!==null&&Lm(r,s,i)}else{let s=t.preOrderHooks;s!==null&&Fm(r,s,0,i)}$l(i)}function xt(t,r=Lt.Default){let i=an();if(i===null)return ht(t,r);let c=_o();return II(c,i,Vi(t),r)}function _T(){let t="invalid";throw new Error(t)}function vT(t,r,i,c,u,s){let x=tn(null);try{let M=null;u&Da.SignalBased&&(M=r[c][ou]),M!==null&&M.transformFn!==void 0&&(s=M.transformFn(s)),u&Da.HasDecoratorInputTransform&&(s=t.inputTransforms[c].call(r,s)),t.setInput!==null?t.setInput(r,M,s,i,c):ZE(r,M,c,s)}finally{tn(x)}}function cb(t,r,i,c,u,s,x,M,S,B,W){let $=r.blueprint.slice();return $[Mi]=u,$[Tt]=c|4|128|8|64|1024,(B!==null||t&&t[Tt]&2048)&&($[Tt]|=2048),QE($),$[xr]=$[ku]=t,$[$i]=i,$[Rs]=x||t&&t[Rs],$[zn]=M||t&&t[zn],$[Ma]=S||t&&t[Ma]||null,$[yo]=s,$[xg]=tk(),$[Fo]=W,$[HE]=B,$[Hi]=r.type==2?t[Hi]:$,$}function bT(t,r,i,c){if(i===0)return-1;let u=r.length;for(let s=0;s<i;s++)r.push(c),t.blueprint.push(c),t.data.push(null);return u}function xT(t,r,i,c,u){let s=Wl(),x=c&2;try{$l(-1),x&&r.length>cr&&yT(t,r,cr,!1),Ui(x?2:0,u),i(c,u)}finally{$l(s),Ui(x?3:1,u)}}function wT(t,r,i){nI()&&(Fu(Gi(i,r),r),CT(t,r,i))}function CT(t,r,i){AO(t,r,i),(i.flags&64)===64&&RO(t,r,i)}function ET(t,r,i=Gi){let c=r.localNames;if(c!==null){let u=r.index+1;for(let s=0;s<c.length;s+=2){let x=c[s+1],M=x===-1?i(r,t):t[x];t[u++]=M}}}function vO(t){let r=t.tView;return r===null||r.incompleteFirstPass?t.tView=ub(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):r}function ub(t,r,i,c,u,s,x,M,S,B,W){let $=cr+c,he=$+u,ge=bO($,he),ze=typeof B=="function"?B():B;return ge[wt]={type:t,blueprint:ge,template:i,queries:null,viewQuery:M,declTNode:r,data:ge.slice().fill(null,$),bindingStartIndex:$,expandoStartIndex:he,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof s=="function"?s():s,pipeRegistry:typeof x=="function"?x():x,firstChild:null,schemas:S,consts:ze,incompleteFirstPass:!1,ssrId:W}}function bO(t,r){let i=[];for(let c=0;c<r;c++)i.push(c<t?null:Uo);return i}function xO(t,r,i,c){let s=c.get(WI,ZI)||i===Bo.ShadowDom,x=t.selectRootElement(r,s);return wO(x),x}function wO(t){IT(t)}var IT=()=>null;function CO(t){LI(t)?mT(t):Hk(t)}function EO(){IT=CO}function JC(t,r,i,c,u){for(let s in r){if(!r.hasOwnProperty(s))continue;let x=r[s];if(x===void 0)continue;c??={};let M,S=Da.None;Array.isArray(x)?(M=x[0],S=x[1]):M=x;let B=s;if(u!==null){if(!u.hasOwnProperty(s))continue;B=u[s]}t===0?eE(c,i,B,M,S):eE(c,i,B,M)}return c}function eE(t,r,i,c,u){let s;t.hasOwnProperty(i)?(s=t[i]).push(r,c):s=t[i]=[r,c],u!==void 0&&s.push(u)}function IO(t,r,i){let c=r.directiveStart,u=r.directiveEnd,s=t.data,x=r.attrs,M=[],S=null,B=null;for(let W=c;W<u;W++){let $=s[W],he=i?i.get($):null,ge=he?he.inputs:null,ze=he?he.outputs:null;S=JC(0,$.inputs,W,S,ge),B=JC(1,$.outputs,W,B,ze);let qe=S!==null&&x!==null&&!sb(r)?GO(S,W,x):null;M.push(qe)}S!==null&&(S.hasOwnProperty("class")&&(r.flags|=8),S.hasOwnProperty("style")&&(r.flags|=16)),r.initialInputs=M,r.inputs=S,r.outputs=B}function TO(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function MO(t,r,i,c,u,s,x,M){let S=Gi(r,i),B=r.inputs,W;!M&&B!=null&&(W=B[c])?(hb(t,i,W,c,u),Ra(r)&&DO(i,r.index)):r.type&3?(c=TO(c),u=x!=null?x(u,r.value||"",c):u,s.setProperty(S,c,u)):r.type&12}function DO(t,r){let i=zo(r,t);i[Tt]&16||(i[Tt]|=64)}function TT(t,r,i,c){if(nI()){let u=c===null?null:{"":-1},s=OO(t,i);if(s!==null){let[x,M]=DT(t,i,s);MT(t,r,i,x,u,M)}u&&LO(i,c,u)}i.mergedAttrs=Km(i.mergedAttrs,i.attrs)}function MT(t,r,i,c,u,s){for(let B=0;B<c.length;B++)RR(xI(i,r),t,c[B].type);zO(i,t.data.length,c.length);for(let B=0;B<c.length;B++){let W=c[B];W.providersResolver&&W.providersResolver(W)}let x=!1,M=!1,S=bT(t,r,c.length,null);for(let B=0;B<c.length;B++){let W=c[B];i.mergedAttrs=Km(i.mergedAttrs,W.hostAttrs),BO(t,i,r,S,W),FO(S,W,u),W.contentQueries!==null&&(i.flags|=4),(W.hostBindings!==null||W.hostAttrs!==null||W.hostVars!==0)&&(i.flags|=64);let $=W.type.prototype;!x&&($.ngOnChanges||$.ngOnInit||$.ngDoCheck)&&((t.preOrderHooks??=[]).push(i.index),x=!0),!M&&($.ngOnChanges||$.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(i.index),M=!0),S++}IO(t,i,s)}function SO(t,r,i,c,u){let s=u.hostBindings;if(s){let x=t.hostBindingOpCodes;x===null&&(x=t.hostBindingOpCodes=[]);let M=~r.index;PO(x)!=M&&x.push(M),x.push(i,c,s)}}function PO(t){let r=t.length;for(;r>0;){let i=t[--r];if(typeof i=="number"&&i<0)return i}return 0}function AO(t,r,i){let c=i.directiveStart,u=i.directiveEnd;Ra(i)&&VO(r,i,t.data[c+i.componentOffset]),t.firstCreatePass||xI(i,r);let s=i.initialInputs;for(let x=c;x<u;x++){let M=t.data[x],S=tg(r,t,x,i);if(Fu(S,r),s!==null&&HO(r,x-c,S,M,i,s),Ou(M)){let B=zo(i.index,r);B[$i]=tg(r,t,x,i)}}}function RO(t,r,i){let c=i.directiveStart,u=i.directiveEnd,s=i.index,x=yR();try{$l(s);for(let M=c;M<u;M++){let S=t.data[M],B=r[M];Wv(M),(S.hostBindings!==null||S.hostVars!==0||S.hostAttrs!==null)&&kO(S,B)}}finally{$l(-1),Wv(x)}}function kO(t,r){t.hostBindings!==null&&t.hostBindings(1,r)}function OO(t,r){let i=t.directiveRegistry,c=null;if(i)for(let u=0;u<i.length;u++){let s=i[u];uO(r,s.selectors,!1)&&(c??=[],Ou(s)?c.unshift(s):c.push(s))}return c}function DT(t,r,i){let c=[],u=null;for(let s of i)s.findHostDirectiveDefs!==null&&(u??=new Map,s.findHostDirectiveDefs(s,c,u)),Ou(s)&&(c.push(s),NO(t,r,c.length-1));return Ra(r)?c.push(...i.slice(1)):c.push(...i),[c,u]}function NO(t,r,i){r.componentOffset=i,(t.components??=[]).push(r.index)}function LO(t,r,i){if(r){let c=t.localNames=[];for(let u=0;u<r.length;u+=2){let s=i[r[u+1]];if(s==null)throw new it(-301,!1);c.push(r[u],s)}}}function FO(t,r,i){if(i){if(r.exportAs)for(let c=0;c<r.exportAs.length;c++)i[r.exportAs[c]]=t;Ou(r)&&(i[""]=t)}}function zO(t,r,i){t.flags|=1,t.directiveStart=r,t.directiveEnd=r+i,t.providerIndexes=r}function BO(t,r,i,c,u){t.data[c]=u;let s=u.factory||(u.factory=Bl(u.type,!0)),x=new $h(s,Ou(u),xt);t.blueprint[c]=x,i[c]=x,SO(t,r,c,bT(t,i,u.hostVars,Uo),u)}function jO(t){let r=16;return t.signals?r=4096:t.onPush&&(r=64),r}function VO(t,r,i){let c=Gi(r,t),u=vO(i),s=t[Rs].rendererFactory,x=db(t,cb(t,u,null,jO(i),c,r,null,s.createRenderer(c,i),null,null,null));return t[r.index]=x}function UO(t,r,i,c,u,s){let x=Gi(t,r);$O(r[zn],x,s,t.value,i,c,u)}function $O(t,r,i,c,u,s,x){if(s==null)t.removeAttribute(r,u,i);else{let M=x==null?Fl(s):x(s,c||"",u);t.setAttribute(r,u,M,i)}}function HO(t,r,i,c,u,s){let x=s[r];if(x!==null)for(let M=0;M<x.length;){let S=x[M++],B=x[M++],W=x[M++],$=x[M++];vT(c,i,S,B,W,$)}}function GO(t,r,i){let c=null,u=0;for(;u<i.length;){let s=i[u];if(s===0){u+=4;continue}else if(s===5){u+=2;continue}if(typeof s=="number")break;if(t.hasOwnProperty(s)){c===null&&(c=[]);let x=t[s];for(let M=0;M<x.length;M+=3)if(x[M]===r){c.push(s,x[M+1],x[M+2],i[u+1]);break}}u+=2}return c}function ST(t,r,i,c){return[t,!0,0,r,null,c,null,i,null,null]}function db(t,r){return t[Vh]?t[RC][po]=r:t[Vh]=r,t[RC]=r,r}function Og(t,r){let i=t[Ma],c=i?i.get(Ns,null):null;c&&c.handleError(r)}function hb(t,r,i,c,u){for(let s=0;s<i.length;){let x=i[s++],M=i[s++],S=i[s++],B=r[x],W=t.data[x];vT(W,B,c,M,S,u)}}function qO(t,r){let i=zo(r,t),c=i[wt];ZO(c,i);let u=i[Mi];u!==null&&i[Fo]===null&&(i[Fo]=rT(u,i[Ma])),fb(c,i,i[$i])}function ZO(t,r){for(let i=r.length;i<t.blueprint.length;i++)r.push(t.blueprint[i])}function fb(t,r,i){H0(r);try{let c=t.viewQuery;c!==null&&s0(1,c,i);let u=t.template;u!==null&&xT(t,r,u,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),r[ks]?.finishViewCreation(t),t.staticContentQueries&&oT(t,r),t.staticViewQueries&&s0(2,t.viewQuery,i);let s=t.components;s!==null&&WO(r,s)}catch(c){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),c}finally{r[Tt]&=-5,G0()}}function WO(t,r){for(let i=0;i<r.length;i++)qO(t,r[i])}var Ls=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Ls||{}),XO;function pb(t,r){return XO(t,r)}function Bu(t){return(t.flags&32)===32}function bu(t,r,i,c,u){if(c!=null){let s,x=!1;jo(c)?s=c:mo(c)&&(x=!0,c=c[Mi]);let M=go(c);t===0&&i!==null?u==null?pT(r,i,M):ag(r,i,M,u||null,!0):t===1&&i!==null?ag(r,i,M,u||null,!0):t===2?lb(r,M,x):t===3&&r.destroyNode(M),s!=null&&lN(r,t,s,i,u)}}function YO(t,r){PT(t,r),r[Mi]=null,r[yo]=null}function KO(t,r,i,c,u,s){c[Mi]=u,c[yo]=r,Ng(t,c,i,1,u,s)}function PT(t,r){r[Rs].changeDetectionScheduler?.notify(10),Ng(t,r,r[zn],2,null,null)}function QO(t){let r=t[Vh];if(!r)return Av(t[wt],t);for(;r;){let i=null;if(mo(r))i=r[Vh];else{let c=r[oi];c&&(i=c)}if(!i){for(;r&&!r[po]&&r!==t;)mo(r)&&Av(r[wt],r),r=r[xr];r===null&&(r=t),mo(r)&&Av(r[wt],r),i=r&&r[po]}r=i}}function JO(t,r,i,c){let u=oi+c,s=i.length;c>0&&(i[u-1][po]=r),c<s-oi?(r[po]=i[u],LE(i,oi+c,r)):(i.push(r),r[po]=null),r[xr]=i;let x=r[jl];x!==null&&i!==x&&AT(x,r);let M=r[ks];M!==null&&M.insertView(t),qv(r),r[Tt]|=128}function AT(t,r){let i=t[Tu],c=r[xr];if(mo(c))t[Tt]|=2;else{let u=c[xr][Hi];r[Hi]!==u&&(t[Tt]|=2)}i===null?t[Tu]=[r]:i.push(r)}function mb(t,r){let i=t[Tu],c=i.indexOf(r);i.splice(c,1)}function lg(t,r){if(t.length<=oi)return;let i=oi+r,c=t[i];if(c){let u=c[jl];u!==null&&u!==t&&mb(u,c),r>0&&(t[i-1][po]=c[po]);let s=Gm(t,oi+r);YO(c[wt],c);let x=s[ks];x!==null&&x.detachView(s[wt]),c[xr]=null,c[po]=null,c[Tt]&=-129}return c}function gb(t,r){if(Nu(r))return;let i=r[zn];i.destroyNode&&Ng(t,r,i,3,null,null),QO(r)}function Av(t,r){if(Nu(r))return;let i=tn(null);try{r[Tt]&=-129,r[Tt]|=256,r[Ti]&&J_(r[Ti]),tN(t,r),eN(t,r),r[wt].type===1&&r[zn].destroy();let c=r[jl];if(c!==null&&jo(r[xr])){c!==r[xr]&&mb(c,r);let u=r[ks];u!==null&&u.detachView(t)}n0(r)}finally{tn(i)}}function eN(t,r){let i=t.cleanup,c=r[Zm];if(i!==null)for(let x=0;x<i.length-1;x+=2)if(typeof i[x]=="string"){let M=i[x+3];M>=0?c[M]():c[-M].unsubscribe(),x+=2}else{let M=c[i[x+1]];i[x].call(M)}c!==null&&(r[Zm]=null);let u=r[Ia];if(u!==null){r[Ia]=null;for(let x=0;x<u.length;x++){let M=u[x];M()}}let s=r[Wm];if(s!==null){r[Wm]=null;for(let x of s)x.destroy()}}function tN(t,r){let i;if(t!=null&&(i=t.destroyHooks)!=null)for(let c=0;c<i.length;c+=2){let u=r[i[c]];if(!(u instanceof $h)){let s=i[c+1];if(Array.isArray(s))for(let x=0;x<s.length;x+=2){let M=u[s[x]],S=s[x+1];Ui(4,M,S);try{S.call(M)}finally{Ui(5,M,S)}}else{Ui(4,u,s);try{s.call(u)}finally{Ui(5,u,s)}}}}}function nN(t,r,i){return rN(t,r.parent,i)}function rN(t,r,i){let c=r;for(;c!==null&&c.type&168;)r=c,c=r.parent;if(c===null)return i[Mi];if(Ra(c)){let{encapsulation:u}=t.data[c.directiveStart+c.componentOffset];if(u===Bo.None||u===Bo.Emulated)return null}return Gi(c,i)}function iN(t,r,i){return sN(t,r,i)}function oN(t,r,i){return t.type&40?Gi(t,i):null}var sN=oN,tE;function yb(t,r,i,c){let u=nN(t,c,r),s=r[zn],x=c.parent||r[yo],M=iN(x,c,r);if(u!=null)if(Array.isArray(i))for(let S=0;S<i.length;S++)QC(s,u,i[S],M,!1);else QC(s,u,i,M,!1);tE!==void 0&&tE(s,c,r,i,u)}function Lh(t,r){if(r!==null){let i=r.type;if(i&3)return Gi(r,t);if(i&4)return a0(-1,t[r.index]);if(i&8){let c=r.child;if(c!==null)return Lh(t,c);{let u=t[r.index];return jo(u)?a0(-1,u):go(u)}}else{if(i&128)return Lh(t,r.next);if(i&32)return pb(r,t)()||go(t[r.index]);{let c=RT(t,r);if(c!==null){if(Array.isArray(c))return c[0];let u=Ul(t[Hi]);return Lh(u,c)}else return Lh(t,r.next)}}}return null}function RT(t,r){if(r!==null){let c=t[Hi][yo],u=r.projection;return c.projection[u]}return null}function a0(t,r){let i=oi+t+1;if(i<r.length){let c=r[i],u=c[wt].firstChild;if(u!==null)return Lh(c,u)}return r[Os]}function _b(t,r,i,c,u,s,x){for(;i!=null;){if(i.type===128){i=i.next;continue}let M=c[i.index],S=i.type;if(x&&r===0&&(M&&Fu(go(M),c),i.flags|=2),!Bu(i))if(S&8)_b(t,r,i.child,c,u,s,!1),bu(r,t,u,M,s);else if(S&32){let B=pb(i,c),W;for(;W=B();)bu(r,t,u,W,s);bu(r,t,u,M,s)}else S&16?aN(t,r,c,i,u,s):bu(r,t,u,M,s);i=x?i.projectionNext:i.next}}function Ng(t,r,i,c,u,s){_b(i,c,t.firstChild,r,u,s,!1)}function aN(t,r,i,c,u,s){let x=i[Hi],S=x[yo].projection[c.projection];if(Array.isArray(S))for(let B=0;B<S.length;B++){let W=S[B];bu(r,t,u,W,s)}else{let B=S,W=x[xr];ig(c)&&(B.flags|=128),_b(t,r,B,W,u,s,!0)}}function lN(t,r,i,c,u){let s=i[Os],x=go(i);s!==x&&bu(r,t,c,s,u);for(let M=oi;M<i.length;M++){let S=i[M];Ng(S[wt],S,t,r,c,s)}}function cN(t,r,i,c,u){if(r)u?t.addClass(i,c):t.removeClass(i,c);else{let s=c.indexOf("-")===-1?void 0:Ls.DashCase;u==null?t.removeStyle(i,c,s):(typeof u=="string"&&u.endsWith("!important")&&(u=u.slice(0,-10),s|=Ls.Important),t.setStyle(i,c,u,s))}}function kT(t,r,i,c){let u=tn(null);try{let s=r.tView,M=t[Tt]&4096?4096:16,S=cb(t,s,i,M,null,r,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),B=t[r.index];S[jl]=B;let W=t[ks];return W!==null&&(S[ks]=W.createEmbeddedView(s)),fb(s,S,i),S}finally{tn(u)}}function l0(t,r){return!r||r.firstChild===null||ig(t)}function OT(t,r,i,c=!0){let u=r[wt];if(JO(u,r,t,i),c){let x=a0(i,t),M=r[zn],S=M.parentNode(t[Os]);S!==null&&KO(u,t[yo],M,r,S,x)}let s=r[Fo];s!==null&&s.firstChild!==null&&(s.firstChild=null)}function uN(t,r){let i=lg(t,r);return i!==void 0&&gb(i[wt],i),i}function cg(t,r,i,c,u=!1){for(;i!==null;){if(i.type===128){i=u?i.projectionNext:i.next;continue}let s=r[i.index];s!==null&&c.push(go(s)),jo(s)&&dN(s,c);let x=i.type;if(x&8)cg(t,r,i.child,c);else if(x&32){let M=pb(i,r),S;for(;S=M();)c.push(S)}else if(x&16){let M=RT(r,i);if(Array.isArray(M))c.push(...M);else{let S=Ul(r[Hi]);cg(S[wt],S,M,c,!0)}}i=u?i.projectionNext:i.next}return c}function dN(t,r){for(let i=oi;i<t.length;i++){let c=t[i],u=c[wt].firstChild;u!==null&&cg(c[wt],c,u,r)}t[Os]!==t[Mi]&&r.push(t[Os])}var NT=[];function hN(t){return t[Ti]??fN(t)}function fN(t){let r=NT.pop()??Object.create(mN);return r.lView=t,r}function pN(t){t.lView[Ti]!==t&&(t.lView=null,NT.push(t))}var mN=wn(et({},rm),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{Ig(t.lView)},consumerOnSignalRead(){this.lView[Ti]=this}});function gN(t){let r=t[Ti]??Object.create(yN);return r.lView=t,r}var yN=wn(et({},rm),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let r=Ul(t.lView);for(;r&&!LT(r[wt]);)r=Ul(r);r&&j0(r)},consumerOnSignalRead(){this.lView[Ti]=this}});function LT(t){return t.type!==2}function FT(t){if(t[Wm]===null)return;let r=!0;for(;r;){let i=!1;for(let c of t[Wm])c.dirty&&(i=!0,c.zone===null||Zone.current===c.zone?c.run():c.zone.run(()=>c.run()));r=i&&!!(t[Tt]&8192)}}var _N=100;function zT(t,r=!0,i=0){let u=t[Rs].rendererFactory,s=!1;s||u.begin?.();try{vN(t,i)}catch(x){throw r&&Og(t,x),x}finally{s||u.end?.()}}function vN(t,r){let i=oI();try{OC(!0),c0(t,r);let c=0;for(;Eg(t);){if(c===_N)throw new it(103,!1);c++,c0(t,1)}}finally{OC(i)}}function bN(t,r,i,c){if(Nu(r))return;let u=r[Tt],s=!1,x=!1;H0(r);let M=!0,S=null,B=null;s||(LT(t)?(B=hN(r),S=K_(B)):C1()===null?(M=!1,B=gN(r),S=K_(B)):r[Ti]&&(J_(r[Ti]),r[Ti]=null));try{QE(r),pR(t.bindingStartIndex),i!==null&&xT(t,r,i,2,c);let W=(u&3)===3;if(!s)if(W){let ge=t.preOrderCheckHooks;ge!==null&&Lm(r,ge,null)}else{let ge=t.preOrderHooks;ge!==null&&Fm(r,ge,0,null),Mv(r,0)}if(x||xN(r),FT(r),BT(r,0),t.contentQueries!==null&&oT(t,r),!s)if(W){let ge=t.contentCheckHooks;ge!==null&&Lm(r,ge)}else{let ge=t.contentHooks;ge!==null&&Fm(r,ge,1),Mv(r,1)}CN(t,r);let $=t.components;$!==null&&VT(r,$,0);let he=t.viewQuery;if(he!==null&&s0(2,he,c),!s)if(W){let ge=t.viewCheckHooks;ge!==null&&Lm(r,ge)}else{let ge=t.viewHooks;ge!==null&&Fm(r,ge,2),Mv(r,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),r[Tv]){for(let ge of r[Tv])ge();r[Tv]=null}s||(r[Tt]&=-73)}catch(W){throw s||Ig(r),W}finally{B!==null&&(T1(B,S),M&&pN(B)),G0()}}function BT(t,r){for(let i=BI(t);i!==null;i=jI(i))for(let c=oi;c<i.length;c++){let u=i[c];jT(u,r)}}function xN(t){for(let r=BI(t);r!==null;r=jI(r)){if(!(r[Tt]&2))continue;let i=r[Tu];for(let c=0;c<i.length;c++){let u=i[c];j0(u)}}}function wN(t,r,i){let c=zo(r,t);jT(c,i)}function jT(t,r){B0(t)&&c0(t,r)}function c0(t,r){let c=t[wt],u=t[Tt],s=t[Ti],x=!!(r===0&&u&16);if(x||=!!(u&64&&r===0),x||=!!(u&1024),x||=!!(s?.dirty&&Q_(s)),x||=!1,s&&(s.dirty=!1),t[Tt]&=-9217,x)bN(c,t,c.template,t[$i]);else if(u&8192){FT(t),BT(t,1);let M=c.components;M!==null&&VT(t,M,1)}}function VT(t,r,i){for(let c=0;c<r.length;c++)wN(t,r[c],i)}function CN(t,r){let i=t.hostBindingOpCodes;if(i!==null)try{for(let c=0;c<i.length;c++){let u=i[c];if(u<0)$l(~u);else{let s=u,x=i[++c],M=i[++c];gR(x,s);let S=r[s];Ui(24,S),M(2,S),Ui(25,S)}}}finally{$l(-1)}}function Lg(t,r){let i=oI()?64:1088;for(t[Rs].changeDetectionScheduler?.notify(r);t;){t[Tt]|=i;let c=Ul(t);if(Uh(t)&&!c)return t;t=c}return null}var Gl=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let r=this._lView,i=r[wt];return cg(i,r,i.firstChild,[])}constructor(r,i,c=!0){this._lView=r,this._cdRefInjectingView=i,this.notifyErrorHandler=c}get context(){return this._lView[$i]}get dirty(){return!!(this._lView[Tt]&9280)||!!this._lView[Ti]?.dirty}set context(r){this._lView[$i]=r}get destroyed(){return Nu(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let r=this._lView[xr];if(jo(r)){let i=r[Xm],c=i?i.indexOf(this):-1;c>-1&&(lg(r,c),Gm(i,c))}this._attachedToViewContainer=!1}gb(this._lView[wt],this._lView)}onDestroy(r){JE(this._lView,r)}markForCheck(){Lg(this._cdRefInjectingView||this._lView,4)}markForRefresh(){j0(this._cdRefInjectingView||this._lView)}detach(){this._lView[Tt]&=-129}reattach(){qv(this._lView),this._lView[Tt]|=128}detectChanges(){this._lView[Tt]|=1024,zT(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new it(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let r=Uh(this._lView),i=this._lView[jl];i!==null&&!r&&mb(i,this._lView),PT(this._lView[wt],this._lView)}attachToAppRef(r){if(this._attachedToViewContainer)throw new it(902,!1);this._appRef=r;let i=Uh(this._lView),c=this._lView[jl];c!==null&&!i&&AT(c,this._lView),qv(this._lView)}},ql=(()=>{class t{static __NG_ELEMENT_ID__=TN}return t})(),EN=ql,IN=class extends EN{_declarationLView;_declarationTContainer;elementRef;constructor(r,i,c){super(),this._declarationLView=r,this._declarationTContainer=i,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(r,i){return this.createEmbeddedViewImpl(r,i)}createEmbeddedViewImpl(r,i,c){let u=kT(this._declarationLView,this._declarationTContainer,r,{embeddedViewInjector:i,dehydratedView:c});return new Gl(u)}};function TN(){return vb(_o(),an())}function vb(t,r){return t.type&4?new IN(r,t,Lu(t,r)):null}function Fg(t,r,i,c,u){let s=t.data[r];if(s===null)s=MN(t,r,i,c,u),mR()&&(s.flags|=32);else if(s.type&64){s.type=i,s.value=c,s.attrs=u;let x=dR();s.injectorIndex=x===null?-1:x.injectorIndex}return Xh(s,!0),s}function MN(t,r,i,c,u){let s=rI(),x=iI(),M=x?s:s&&s.parent,S=t.data[r]=SN(t,M,i,r,c,u);return DN(t,S,s,x),S}function DN(t,r,i,c){t.firstChild===null&&(t.firstChild=r),i!==null&&(c?i.child==null&&r.parent!==null&&(i.child=r):i.next===null&&(i.next=r,r.prev=i))}function SN(t,r,i,c,u,s){let x=r?r.injectorIndex:-1,M=0;return Wh()&&(M|=128),{type:i,index:c,insertBeforeIndex:null,injectorIndex:x,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:M,providerIndexes:0,value:u,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:r,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var PN=new RegExp(`^(\\d+)*(${HI}|${$I})*(.*)`);function AN(t){let r=t.match(PN),[i,c,u,s]=r,x=c?parseInt(c,10):u,M=[];for(let[S,B,W]of s.matchAll(/(f|n)(\d*)/g)){let $=parseInt(W,10)||1;M.push(B,$)}return[x,...M]}function RN(t){return!t.prev&&t.parent?.type===8}function Rv(t){return t.index-cr}function kN(t,r){let i=t.i18nNodes;if(i)return i.get(r)}function zg(t,r,i,c){let u=Rv(c),s=kN(t,u);if(s===void 0){let x=t.data[dk];if(x?.[u])s=NN(x[u],i);else if(r.firstChild===c)s=t.firstChild;else{let M=c.prev===null,S=c.prev??c.parent;if(RN(c)){let B=Rv(c.parent);s=o0(t,B)}else{let B=Gi(S,i);if(M)s=B.firstChild;else{let W=Rv(S),$=o0(t,W);if(S.type===2&&$){let ge=ib(t,W)+1;s=Bg(ge,$)}else s=B.nextSibling}}}}return s}function Bg(t,r){let i=r;for(let c=0;c<t;c++)i=i.nextSibling;return i}function ON(t,r){let i=t;for(let c=0;c<r.length;c+=2){let u=r[c],s=r[c+1];for(let x=0;x<s;x++)switch(u){case sk:i=i.firstChild;break;case ak:i=i.nextSibling;break}}return i}function NN(t,r){let[i,...c]=AN(t),u;if(i===$I)u=r[Hi][Mi];else if(i===HI)u=iO(r[Hi][Mi]);else{let s=Number(i);u=go(r[s+cr])}return ON(u,c)}var LN=!1;function FN(t){LN=t}function zN(t){let r=t[Fo];if(r){let{i18nNodes:i,dehydratedIcuData:c}=r;if(i&&c){let u=t[zn];for(let s of c.values())BN(u,i,s)}r.i18nNodes=void 0,r.dehydratedIcuData=void 0}}function BN(t,r,i){for(let c of i.node.cases[i.case]){let u=r.get(c.index-cr);u&&lb(t,u,!1)}}function UT(t){let r=t[Vl]??[],c=t[xr][zn],u=[];for(let s of r)s.data[hk]!==void 0?u.push(s):jN(s,c);t[Vl]=u}function jN(t,r){let i=0,c=t.firstChild;if(c){let u=t.data[og];for(;i<u;){let s=c.nextSibling;lb(r,c,!1),c=s,i++}}}function bb(t){UT(t);let r=t[Mi];mo(r)&&ug(r);for(let i=oi;i<t.length;i++)ug(t[i])}function ug(t){zN(t);let r=t[wt];for(let i=cr;i<r.bindingStartIndex;i++)if(jo(t[i])){let c=t[i];bb(c)}else mo(t[i])&&ug(t[i])}function $T(t){let r=t._views;for(let i of r){let c=Uk(i);c!==null&&c[Mi]!==null&&(mo(c)?ug(c):bb(c))}}function VN(t,r,i,c){t!==null&&(i.cleanup(r),bb(t.lContainer),$T(c))}function UN(t,r){let i=[];for(let c of r)for(let u=0;u<(c[GI]??1);u++){let s={data:c,firstChild:null};c[og]>0&&(s.firstChild=t,t=Bg(c[og],t)),i.push(s)}return[t,i]}var HT=()=>null;function $N(t,r){let i=t[Vl];return!r||i===null||i.length===0?null:i[0].data[uk]===r?i.shift():(UT(t),null)}function HN(){HT=$N}function nE(t,r){return HT(t,r)}var u0=class{},dg=class{},d0=class{resolveComponentFactory(r){throw Error(`No component factory found for ${$r(r)}.`)}},Du=class{static NULL=new d0},Su=class{},Kl=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>GN()}return t})();function GN(){let t=an(),r=_o(),i=zo(r.index,t);return(mo(i)?i:t)[zn]}var qN=(()=>{class t{static \u0275prov=nt({token:t,providedIn:"root",factory:()=>null})}return t})();function h0(t,r,i){let c=i?t.styles:null,u=i?t.classes:null,s=0;if(r!==null)for(let x=0;x<r.length;x++){let M=r[x];if(typeof M=="number")s=M;else if(s==1)u=TC(u,M);else if(s==2){let S=M,B=r[++x];c=TC(c,S+": "+B+";")}}i?t.styles=c:t.stylesWithoutHost=c,i?t.classes=u:t.classesWithoutHost=u}var hg=class extends Du{ngModule;constructor(r){super(),this.ngModule=r}resolveComponentFactory(r){let i=As(r);return new Pu(i,this.ngModule)}};function rE(t,r){let i=[];for(let c in t){if(!t.hasOwnProperty(c))continue;let u=t[c];if(u===void 0)continue;let s=Array.isArray(u),x=s?u[0]:u,M=s?u[1]:Da.None;r?i.push({propName:x,templateName:c,isSignal:(M&Da.SignalBased)!==0}):i.push({propName:x,templateName:c})}return i}function ZN(t){let r=t.toLowerCase();return r==="svg"?K2:r==="math"?Q2:null}var Pu=class extends dg{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let r=this.componentDef,i=r.inputTransforms,c=rE(r.inputs,!0);if(i!==null)for(let u of c)i.hasOwnProperty(u.propName)&&(u.transform=i[u.propName]);return c}get outputs(){return rE(this.componentDef.outputs,!1)}constructor(r,i){super(),this.componentDef=r,this.ngModule=i,this.componentType=r.type,this.selector=pO(r.selectors),this.ngContentSelectors=r.ngContentSelectors??[],this.isBoundToModule=!!i}create(r,i,c,u){let s=tn(null);try{u=u||this.ngModule;let x=u instanceof Pr?u:u?.injector;x&&this.componentDef.getStandaloneInjector!==null&&(x=this.componentDef.getStandaloneInjector(x)||x);let M=x?new Eu(r,x):r,S=M.get(Su,null);if(S===null)throw new it(407,!1);let B=M.get(qN,null),W=M.get(Mu,null),$={rendererFactory:S,sanitizer:B,changeDetectionScheduler:W},he=S.createRenderer(null,this.componentDef),ge=this.componentDef.selectors[0][0]||"div",ze=c?xO(he,c,this.componentDef.encapsulation,M):ab(he,ge,ZN(ge)),qe=512;this.componentDef.signals?qe|=4096:this.componentDef.onPush||(qe|=16);let Ye=null;ze!==null&&(Ye=rT(ze,M,!0));let lt=ub(0,null,null,1,0,null,null,null,null,null,null),gt=cb(null,lt,null,qe,null,null,$,he,M,null,Ye);gt[cr]=ze,H0(gt);let ft=null;try{let _t=c?["ng-version","19.1.4"]:mO(this.componentDef.selectors[0]),dt=Fg(lt,cr,2,"#host",_t),[Vt,ki]=DT(lt,dt,[this.componentDef]);MT(lt,gt,dt,Vt,{},ki);for(let $s of Vt)dt.mergedAttrs=Km(dt.mergedAttrs,$s.hostAttrs);dt.mergedAttrs=Km(dt.mergedAttrs,_t),h0(dt,dt.mergedAttrs,!0),ze&&(gT(he,ze,dt),Fu(ze,gt)),i!==void 0&&WN(dt,this.ngContentSelectors,i),CT(lt,gt,dt),sT(lt,dt,gt),Z0(lt,dt),ft=zo(dt.index,gt),gt[$i]=ft[$i],fb(lt,gt,null)}catch(_t){throw ft!==null&&n0(ft),n0(gt),_t}finally{G0()}return new f0(this.componentType,gt)}finally{tn(s)}}},f0=class extends u0{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(r,i){super(),this._rootLView=i,this._tNode=Cg(i[wt],cr),this.location=Lu(this._tNode,i),this.instance=zo(this._tNode.index,i)[$i],this.hostView=this.changeDetectorRef=new Gl(i,void 0,!1),this.componentType=r}setInput(r,i){let c=this._tNode.inputs,u;if(c!==null&&(u=c[r])){if(this.previousInputValues??=new Map,this.previousInputValues.has(r)&&Object.is(this.previousInputValues.get(r),i))return;let s=this._rootLView;hb(s[wt],s,u,r,i),this.previousInputValues.set(r,i);let x=zo(this._tNode.index,s);Lg(x,1)}}get injector(){return new zl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(r){this.hostView.onDestroy(r)}};function WN(t,r,i){let c=t.projection=[];for(let u=0;u<r.length;u++){let s=i[u];c.push(s!=null&&s.length?Array.from(s):null)}}var Na=(()=>{class t{static __NG_ELEMENT_ID__=XN}return t})();function XN(){let t=_o();return qT(t,an())}var YN=Na,GT=class extends YN{_lContainer;_hostTNode;_hostLView;constructor(r,i,c){super(),this._lContainer=r,this._hostTNode=i,this._hostLView=c}get element(){return Lu(this._hostTNode,this._hostLView)}get injector(){return new zl(this._hostTNode,this._hostLView)}get parentInjector(){let r=W0(this._hostTNode,this._hostLView);if(_I(r)){let i=Jm(r,this._hostLView),c=Qm(r),u=i[wt].data[c+8];return new zl(u,i)}else return new zl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(r){let i=iE(this._lContainer);return i!==null&&i[r]||null}get length(){return this._lContainer.length-oi}createEmbeddedView(r,i,c){let u,s;typeof c=="number"?u=c:c!=null&&(u=c.index,s=c.injector);let x=nE(this._lContainer,r.ssrId),M=r.createEmbeddedViewImpl(i||{},s,x);return this.insertImpl(M,u,l0(this._hostTNode,x)),M}createComponent(r,i,c,u,s){let x=r&&!Z2(r),M;if(x)M=i;else{let ze=i||{};M=ze.index,c=ze.injector,u=ze.projectableNodes,s=ze.environmentInjector||ze.ngModuleRef}let S=x?r:new Pu(As(r)),B=c||this.parentInjector;if(!s&&S.ngModule==null){let qe=(x?B:this.parentInjector).get(Pr,null);qe&&(s=qe)}let W=As(S.componentType??{}),$=nE(this._lContainer,W?.id??null),he=$?.firstChild??null,ge=S.create(B,u,he,s);return this.insertImpl(ge.hostView,M,l0(this._hostTNode,$)),ge}insert(r,i){return this.insertImpl(r,i,!0)}insertImpl(r,i,c){let u=r._lView;if(tR(u)){let M=this.indexOf(r);if(M!==-1)this.detach(M);else{let S=u[xr],B=new GT(S,S[yo],S[xr]);B.detach(B.indexOf(r))}}let s=this._adjustIndex(i),x=this._lContainer;return OT(x,u,s,c),r.attachToViewContainerRef(),LE(kv(x),s,r),r}move(r,i){return this.insert(r,i)}indexOf(r){let i=iE(this._lContainer);return i!==null?i.indexOf(r):-1}remove(r){let i=this._adjustIndex(r,-1),c=lg(this._lContainer,i);c&&(Gm(kv(this._lContainer),i),gb(c[wt],c))}detach(r){let i=this._adjustIndex(r,-1),c=lg(this._lContainer,i);return c&&Gm(kv(this._lContainer),i)!=null?new Gl(c):null}_adjustIndex(r,i=0){return r??this.length+i}};function iE(t){return t[Xm]}function kv(t){return t[Xm]||(t[Xm]=[])}function qT(t,r){let i,c=r[t.index];return jo(c)?i=c:(i=ST(c,r,null,t),r[t.index]=i,db(r,i)),ZT(i,r,t,c),new GT(i,t,r)}function KN(t,r){let i=t[zn],c=i.createComment(""),u=Gi(r,t),s=i.parentNode(u);return ag(i,s,c,i.nextSibling(u),!1),c}var ZT=WT,xb=()=>!1;function QN(t,r,i){return xb(t,r,i)}function WT(t,r,i,c){if(t[Os])return;let u;i.type&8?u=go(c):u=KN(r,i),t[Os]=u}function JN(t,r,i){if(t[Os]&&t[Vl])return!0;let c=i[Fo],u=r.index-cr;if(!c||JR(r)||Kh(c,u))return!1;let x=o0(c,u),M=c.data[tb]?.[u],[S,B]=UN(x,M);return t[Os]=S,t[Vl]=B,!0}function eL(t,r,i,c){xb(t,i,r)||WT(t,r,i,c)}function tL(){ZT=eL,xb=JN}var p0=class t{queryList;matches=null;constructor(r){this.queryList=r}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},m0=class t{queries;constructor(r=[]){this.queries=r}createEmbeddedView(r){let i=r.queries;if(i!==null){let c=r.contentQueries!==null?r.contentQueries[0]:i.length,u=[];for(let s=0;s<c;s++){let x=i.getByIndex(s),M=this.queries[x.indexInDeclarationView];u.push(M.clone())}return new t(u)}return null}insertView(r){this.dirtyQueriesWithMatches(r)}detachView(r){this.dirtyQueriesWithMatches(r)}finishViewCreation(r){this.dirtyQueriesWithMatches(r)}dirtyQueriesWithMatches(r){for(let i=0;i<this.queries.length;i++)wb(r,i).matches!==null&&this.queries[i].setDirty()}},g0=class{flags;read;predicate;constructor(r,i,c=null){this.flags=i,this.read=c,typeof r=="string"?this.predicate=cL(r):this.predicate=r}},y0=class t{queries;constructor(r=[]){this.queries=r}elementStart(r,i){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(r,i)}elementEnd(r){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(r)}embeddedTView(r){let i=null;for(let c=0;c<this.length;c++){let u=i!==null?i.length:0,s=this.getByIndex(c).embeddedTView(r,u);s&&(s.indexInDeclarationView=c,i!==null?i.push(s):i=[s])}return i!==null?new t(i):null}template(r,i){for(let c=0;c<this.queries.length;c++)this.queries[c].template(r,i)}getByIndex(r){return this.queries[r]}get length(){return this.queries.length}track(r){this.queries.push(r)}},_0=class t{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(r,i=-1){this.metadata=r,this._declarationNodeIndex=i}elementStart(r,i){this.isApplyingToNode(i)&&this.matchTNode(r,i)}elementEnd(r){this._declarationNodeIndex===r.index&&(this._appliesToNextNode=!1)}template(r,i){this.elementStart(r,i)}embeddedTView(r,i){return this.isApplyingToNode(r)?(this.crossesNgTemplate=!0,this.addMatch(-r.index,i),new t(this.metadata)):null}isApplyingToNode(r){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let i=this._declarationNodeIndex,c=r.parent;for(;c!==null&&c.type&8&&c.index!==i;)c=c.parent;return i===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(r,i){let c=this.metadata.predicate;if(Array.isArray(c))for(let u=0;u<c.length;u++){let s=c[u];this.matchTNodeWithReadOption(r,i,nL(i,s)),this.matchTNodeWithReadOption(r,i,zm(i,r,s,!1,!1))}else c===ql?i.type&4&&this.matchTNodeWithReadOption(r,i,-1):this.matchTNodeWithReadOption(r,i,zm(i,r,c,!1,!1))}matchTNodeWithReadOption(r,i,c){if(c!==null){let u=this.metadata.read;if(u!==null)if(u===Fs||u===Na||u===ql&&i.type&4)this.addMatch(i.index,-2);else{let s=zm(i,r,u,!1,!1);s!==null&&this.addMatch(i.index,s)}else this.addMatch(i.index,c)}}addMatch(r,i){this.matches===null?this.matches=[r,i]:this.matches.push(r,i)}};function nL(t,r){let i=t.localNames;if(i!==null){for(let c=0;c<i.length;c+=2)if(i[c]===r)return i[c+1]}return null}function rL(t,r){return t.type&11?Lu(t,r):t.type&4?vb(t,r):null}function iL(t,r,i,c){return i===-1?rL(r,t):i===-2?oL(t,r,c):tg(t,t[wt],i,r)}function oL(t,r,i){if(i===Fs)return Lu(r,t);if(i===ql)return vb(r,t);if(i===Na)return qT(r,t)}function XT(t,r,i,c){let u=r[ks].queries[c];if(u.matches===null){let s=t.data,x=i.matches,M=[];for(let S=0;x!==null&&S<x.length;S+=2){let B=x[S];if(B<0)M.push(null);else{let W=s[B];M.push(iL(r,W,x[S+1],i.metadata.read))}}u.matches=M}return u.matches}function v0(t,r,i,c){let u=t.queries.getByIndex(i),s=u.matches;if(s!==null){let x=XT(t,r,u,i);for(let M=0;M<s.length;M+=2){let S=s[M];if(S>0)c.push(x[M/2]);else{let B=s[M+1],W=r[-S];for(let $=oi;$<W.length;$++){let he=W[$];he[jl]===he[xr]&&v0(he[wt],he,B,c)}if(W[Tu]!==null){let $=W[Tu];for(let he=0;he<$.length;he++){let ge=$[he];v0(ge[wt],ge,B,c)}}}}}return c}function sL(t,r){return t[ks].queries[r].queryList}function aL(t,r,i){let c=new t0((i&4)===4);return iR(t,r,c,c.destroy),(r[ks]??=new m0).queries.push(new p0(c))-1}function lL(t,r,i){let c=qi();return c.firstCreatePass&&(uL(c,new g0(t,r,i),-1),(r&2)===2&&(c.staticViewQueries=!0)),aL(c,an(),r)}function cL(t){return t.split(",").map(r=>r.trim())}function uL(t,r,i){t.queries===null&&(t.queries=new y0),t.queries.track(new _0(r,i))}function wb(t,r){return t.queries.getByIndex(r)}function dL(t,r){let i=t[wt],c=wb(i,r);return c.crossesNgTemplate?v0(i,t,r,[]):XT(i,t,c,r)}var Sa=class{},Hh=class{};var b0=class extends Sa{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new hg(this);constructor(r,i,c,u=!0){super(),this.ngModuleType=r,this._parent=i;let s=BE(r);this._bootstrapComponents=uT(s.bootstrap),this._r3Injector=DI(r,i,[{provide:Sa,useValue:this},{provide:Du,useValue:this.componentFactoryResolver},...c],$r(r),new Set(["environment"])),u&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let r=this._r3Injector;!r.destroyed&&r.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(r){this.destroyCbs.push(r)}},x0=class extends Hh{moduleType;constructor(r){super(),this.moduleType=r}create(r){return new b0(this.moduleType,r,[])}};var fg=class extends Sa{injector;componentFactoryResolver=new hg(this);instance=null;constructor(r){super();let i=new jh([...r.providers,{provide:Sa,useValue:this},{provide:Du,useValue:this.componentFactoryResolver}],r.parent||F0(),r.debugName,new Set(["environment"]));this.injector=i,r.runEnvironmentInitializers&&i.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(r){this.injector.onDestroy(r)}};function Jh(t,r,i=null){return new fg({providers:t,parent:r,debugName:i,runEnvironmentInitializers:!0}).injector}var hL=(()=>{class t{_injector;cachedInjectors=new Map;constructor(i){this._injector=i}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){let c=N0(!1,i.type),u=c.length>0?Jh([c],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,u)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=nt({token:t,providedIn:"environment",factory:()=>new t(ht(Pr))})}return t})();function Gt(t){return qh(()=>{let r=KT(t),i=wn(et({},r),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===FI.OnPush,directiveDefs:null,pipeDefs:null,dependencies:r.standalone&&t.dependencies||null,getStandaloneInjector:r.standalone?u=>u.get(hL).getOrCreateStandaloneInjector(i):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Bo.Emulated,styles:t.styles||fo,_:null,schemas:t.schemas||null,tView:null,id:""});r.standalone&&Oa("NgStandalone"),QT(i);let c=t.dependencies;return i.directiveDefs=sE(c,!1),i.pipeDefs=sE(c,!0),i.id=mL(i),i})}function fL(t){return As(t)||k0(t)}function pL(t){return t!==null}function ju(t){return qh(()=>({type:t.type,bootstrap:t.bootstrap||fo,declarations:t.declarations||fo,imports:t.imports||fo,exports:t.exports||fo,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function oE(t,r){if(t==null)return Bh;let i={};for(let c in t)if(t.hasOwnProperty(c)){let u=t[c],s,x,M=Da.None;Array.isArray(u)?(M=u[0],s=u[1],x=u[2]??s):(s=u,x=u),r?(i[s]=M!==Da.None?[c,M]:c,r[s]=x):i[s]=c}return i}function Ql(t){return qh(()=>{let r=KT(t);return QT(r),r})}function YT(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function KT(t){let r={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:r,inputTransforms:null,inputConfig:t.inputs||Bh,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||fo,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:oE(t.inputs,r),outputs:oE(t.outputs),debugInfo:null}}function QT(t){t.features?.forEach(r=>r(t))}function sE(t,r){if(!t)return null;let i=r?O0:fL;return()=>(typeof t=="function"?t():t).map(c=>i(c)).filter(pL)}function mL(t){let r=0,i=typeof t.consts=="function"?"":t.consts,c=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,i,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let s of c.join("|"))r=Math.imul(31,r)+s.charCodeAt(0)<<0;return r+=2147483648,"c"+r}function Cb(t){let r=t.inputConfig,i={};for(let c in r)if(r.hasOwnProperty(c)){let u=r[c];Array.isArray(u)&&u[3]&&(i[c]=u[3])}t.inputTransforms=i}function JT(t){return yL(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function gL(t,r){if(Array.isArray(t))for(let i=0;i<t.length;i++)r(t[i]);else{let i=t[Symbol.iterator](),c;for(;!(c=i.next()).done;)r(c.value)}}function yL(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function Eb(t,r,i){return t[r]=i}function _L(t,r){return t[r]}function Pa(t,r,i){let c=t[r];return Object.is(c,i)?!1:(t[r]=i,!0)}function vL(t,r,i,c){let u=Pa(t,r,i);return Pa(t,r+1,c)||u}function eM(t,r,i,c,u){let s=vL(t,r,i,c);return Pa(t,r+2,u)||s}function bL(t,r,i,c,u,s,x,M,S){let B=r.consts,W=Fg(r,t,4,x||null,M||null);TT(r,i,W,Ym(B,S)),Z0(r,W);let $=W.tView=ub(2,W,c,u,s,r.directiveRegistry,r.pipeRegistry,null,r.schemas,B,null);return r.queries!==null&&(r.queries.template(r,W),$.queries=r.queries.embeddedTView(W)),W}function xL(t,r,i,c,u,s,x,M,S,B){let W=i+cr,$=r.firstCreatePass?bL(W,r,t,c,u,s,x,M,S):r.data[W];Xh($,!1);let he=tM(r,t,$,i);q0()&&yb(r,t,he,$),Fu(he,t);let ge=ST(he,t,he,$);return t[W]=ge,db(t,ge),QN(ge,$,t),z0($)&&wT(r,t,$),S!=null&&ET(t,$,B),$}function Zn(t,r,i,c,u,s,x,M){let S=an(),B=qi(),W=Ym(B.consts,s);return xL(S,B,t,r,i,c,u,W,x,M),Zn}var tM=nM;function nM(t,r,i,c){return ka(!0),r[zn].createComment("")}function wL(t,r,i,c){let u=r[Fo],s=!u||Wh()||Bu(i)||Kh(u,c);if(ka(s),s)return nM(t,r,i,c);let x=u.data[ck]?.[c]??null;x!==null&&i.tView!==null&&i.tView.ssrId===null&&(i.tView.ssrId=x);let M=zg(u,t,r,i);Rg(u,c,M);let S=ib(u,c);return Bg(S,M)}function CL(){tM=wL}var EL=(()=>{class t{cachedInjectors=new Map;getOrCreateInjector(i,c,u,s){if(!this.cachedInjectors.has(i)){let x=u.length>0?Jh(u,c,s):null;this.cachedInjectors.set(i,x)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=nt({token:t,providedIn:"environment",factory:()=>new t})}return t})();var IL=new ot("");function Ov(t,r,i){return t.get(EL).getOrCreateInjector(r,t,i,"")}function TL(t,r,i){if(t instanceof Eu){let u=t.injector,s=t.parentInjector,x=Ov(s,r,i);return new Eu(u,x)}let c=t.get(Pr);if(c!==t){let u=Ov(c,r,i);return new Eu(t,u)}return Ov(t,r,i)}function xu(t,r,i,c=!1){let u=i[xr],s=u[wt];if(Nu(u))return;let x=Sg(u,r),M=x[rb],S=x[Ik];if(!(S!==null&&t<S)&&aE(M,t)&&aE(x[wk]??-1,t)){let B=Pg(s,r),$=!c&&!0&&(Pk(B)!==null||WC(B,br.Loading)!==null||WC(B,br.Placeholder))?SL:DL;try{$(t,x,i,r,u)}catch(he){Og(u,he)}}}function ML(t,r){return t[Vl]?.find(i=>i.data[fk]===r[rb])??null}function DL(t,r,i,c,u){let s=Sk(t,u,c);if(s!==null){r[rb]=t;let x=u[wt],M=s+cr,S=Cg(x,M),B=0;uN(i,B);let W;if(t===br.Complete){let ge=Pg(x,c),ze=ge.providers;ze&&ze.length>0&&(W=TL(u[Ma],ge,ze))}let $=ML(i,r);i[Vl]=null;let he=kT(u,S,null,{injector:W,dehydratedView:$});if(OT(i,he,B,l0(S,$)),Lg(he,2),(t===br.Complete||t===br.Error)&&Array.isArray(r[Iu])){for(let ge of r[Iu])ge();r[Iu]=null}}}function aE(t,r){return t<r}function lE(t,r,i){t.loadingPromise.then(()=>{t.loadingState===Ii.COMPLETE?xu(br.Complete,r,i):t.loadingState===Ii.FAILED&&xu(br.Error,r,i)})}var SL=null;var Ib=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var rM=new ot("");function ef(t){return!!t&&typeof t.then=="function"}function iM(t){return!!t&&typeof t.subscribe=="function"}var jg=new ot("");var oM=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((i,c)=>{this.resolve=i,this.reject=c});appInits=Le(jg,{optional:!0})??[];injector=Le(si);constructor(){}runInitializers(){if(this.initialized)return;let i=[];for(let u of this.appInits){let s=li(this.injector,u);if(ef(s))i.push(s);else if(iM(s)){let x=new Promise((M,S)=>{s.subscribe({complete:M,error:S})});i.push(x)}}let c=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{c()}).catch(u=>{this.reject(u)}),i.length===0&&c(),this.initialized=!0}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),PL=(()=>{class t{static \u0275prov=nt({token:t,providedIn:"root",factory:()=>new w0})}return t})(),w0=class{queuedEffectCount=0;queues=new Map;schedule(r){this.enqueue(r)}remove(r){let i=r.zone,c=this.queues.get(i);c.has(r)&&(c.delete(r),this.queuedEffectCount--)}enqueue(r){let i=r.zone;this.queues.has(i)||this.queues.set(i,new Set);let c=this.queues.get(i);c.has(r)||(this.queuedEffectCount++,c.add(r))}flush(){for(;this.queuedEffectCount>0;)for(let[r,i]of this.queues)r===null?this.flushQueue(i):r.run(()=>this.flushQueue(i))}flushQueue(r){for(let i of r)r.delete(i),this.queuedEffectCount--,i.run()}},La=new ot("");function AL(){A1(()=>{throw new it(600,!1)})}function RL(t){return t.isBoundToModule}var kL=10;function OL(t,r,i){try{let c=i();return ef(c)?c.catch(u=>{throw r.runOutsideAngular(()=>t.handleError(u)),u}):c}catch(c){throw r.runOutsideAngular(()=>t.handleError(c)),c}}var ai=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=Le(qR);afterRenderManager=Le(YI);zonelessEnabled=Le(Tg);rootEffectScheduler=Le(PL);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new _r;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=Le(Vo).hasPendingTasks.pipe(Nt(i=>!i));constructor(){Le(zu,{optional:!0})}whenStable(){let i;return new Promise(c=>{i=this.isStable.subscribe({next:u=>{u&&c()}})}).finally(()=>{i.unsubscribe()})}_injector=Le(Pr);_rendererFactory=null;get injector(){return this._injector}bootstrap(i,c){let u=i instanceof dg;if(!this._injector.get(oM).done){let he=!u&&jE(i),ge=!1;throw new it(405,ge)}let x;u?x=i:x=this._injector.get(Du).resolveComponentFactory(i),this.componentTypes.push(x.componentType);let M=RL(x)?void 0:this._injector.get(Sa),S=c||x.selector,B=x.create(si.NULL,[],S,M),W=B.location.nativeElement,$=B.injector.get(rM,null);return $?.registerApplication(W),B.onDestroy(()=>{this.detachView(B.hostView),jm(this.components,B),$?.unregisterApplication(W)}),this._loadComponent(B),B}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let c=this.tracingSnapshot;this.tracingSnapshot=null,c.run(nb.CHANGE_DETECTION,this._tick),c.dispose();return}if(this._runningTick)throw new it(101,!1);let i=tn(null);try{this._runningTick=!0,this.synchronize()}catch(c){this.internalErrorHandler(c)}finally{this._runningTick=!1,tn(i),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Su,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let i=0;for(;this.dirtyFlags!==0&&i++<kL;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let i=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:c,notifyErrorHandler:u}of this.allViews)NL(c,u,i,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:i})=>Eg(i))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(i){let c=i;this._views.push(c),c.attachToAppRef(this)}detachView(i){let c=i;jm(this._views,c),c.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i),this._injector.get(La,[]).forEach(u=>u(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>jm(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new it(406,!1);let i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function jm(t,r){let i=t.indexOf(r);i>-1&&t.splice(i,1)}function NL(t,r,i,c){if(!i&&!Eg(t))return;zT(t,r,i&&!c?0:1)}function LL(t,r,i){let c=r[Ma],u=r[wt];if(t.loadingState!==Ii.NOT_STARTED)return t.loadingPromise??Promise.resolve();let s=Sg(r,i),x=Ak(u,t);t.loadingState=Ii.IN_PROGRESS,Bm(1,s);let M=t.dependencyResolverFn,S=c.get(Vo),B=S.add();return M?(t.loadingPromise=Promise.allSettled(M()).then(W=>{let $=!1,he=[],ge=[];for(let ze of W)if(ze.status==="fulfilled"){let qe=ze.value,Ye=As(qe)||k0(qe);if(Ye)he.push(Ye);else{let lt=O0(qe);lt&&ge.push(lt)}}else{$=!0;break}if(t.loadingPromise=null,S.remove(B),$){if(t.loadingState=Ii.FAILED,t.errorTmplIndex===null){let ze="",qe=new it(-750,!1);Og(r,qe)}}else{t.loadingState=Ii.COMPLETE;let ze=x.tView;if(he.length>0){ze.directiveRegistry=XC(ze.directiveRegistry,he);let qe=he.map(lt=>lt.type),Ye=N0(!1,...qe);t.providers=Ye}ge.length>0&&(ze.pipeRegistry=XC(ze.pipeRegistry,ge))}}),t.loadingPromise):(t.loadingPromise=Promise.resolve().then(()=>{t.loadingPromise=null,t.loadingState=Ii.COMPLETE,S.remove(B)}),t.loadingPromise)}function FL(t,r){return r[Ma].get(IL,null,{optional:!0})?.behavior!==KI.Manual}function zL(t,r,i){let c=r[wt],u=r[i.index];if(!FL(t,r))return;let s=Sg(r,i),x=Pg(c,i);switch(Mk(s),x.loadingState){case Ii.NOT_STARTED:xu(br.Loading,i,u),LL(x,r,i),x.loadingState===Ii.IN_PROGRESS&&lE(x,i,u);break;case Ii.IN_PROGRESS:xu(br.Loading,i,u),lE(x,i,u);break;case Ii.COMPLETE:xu(br.Complete,i,u);break;case Ii.FAILED:xu(br.Error,i,u);break;default:}}function BL(t,r,i){return on(this,null,function*(){let c=t.get(eT),u=c.hydrating;if(u.has(r))return;let{parentBlockPromise:s,hydrationQueue:x}=Wk(r,t);jL(c,x);let M=t.get(Vo),S=M.add();s!==null&&(yield s);for(let B of x)yield UL(B,c),yield VL(t),u.get(B).resolve();yield u.get(r)?.promise,M.remove(S),i&&i(x),VN(c.get(r),x,c,t.get(ai))})}function jL(t,r){for(let i of r)t.hydrating.set(i,Promise.withResolvers())}function VL(t){return new Promise(r=>Dg(r,{injector:t}))}function UL(t,r){return on(this,null,function*(){let i=r.get(t);if(i===null)return;let{tNode:c,lView:u}=i,s=Sg(u,c);return new Promise(x=>{$L(s,x),zL(2,u,c)})})}function $L(t,r){Array.isArray(t[Iu])||(t[Iu]=[]),t[Iu].push(r)}function Tb(t,r,i,c){let u=an(),s=U0();if(Pa(u,s,r)){let x=qi(),M=fI();UO(M,u,t,r,i,c)}return Tb}function HL(t,r,i,c){return Pa(t,U0(),i)?r+Fl(i)+c:Uo}function GL(t,r,i,c,u,s,x,M){let S=fR(),B=eM(t,S,i,u,x);return sI(3),B?r+Fl(i)+c+Fl(u)+s+Fl(x)+M:Uo}function km(t,r){return t<<17|r<<2}function Zl(t){return t>>17&32767}function qL(t){return(t&2)==2}function ZL(t,r){return t&131071|r<<17}function C0(t){return t|2}function Au(t){return(t&131068)>>2}function Nv(t,r){return t&-131069|r<<2}function WL(t){return(t&1)===1}function E0(t){return t|1}function XL(t,r,i,c,u,s){let x=s?r.classBindings:r.styleBindings,M=Zl(x),S=Au(x);t[c]=i;let B=!1,W;if(Array.isArray(i)){let $=i;W=$[1],(W===null||Zh($,W)>0)&&(B=!0)}else W=i;if(u)if(S!==0){let he=Zl(t[M+1]);t[c+1]=km(he,M),he!==0&&(t[he+1]=Nv(t[he+1],c)),t[M+1]=ZL(t[M+1],c)}else t[c+1]=km(M,0),M!==0&&(t[M+1]=Nv(t[M+1],c)),M=c;else t[c+1]=km(S,0),M===0?M=c:t[S+1]=Nv(t[S+1],c),S=c;B&&(t[c+1]=C0(t[c+1])),cE(t,W,c,!0),cE(t,W,c,!1),YL(r,W,t,c,s),x=km(M,S),s?r.classBindings=x:r.styleBindings=x}function YL(t,r,i,c,u){let s=u?t.residualClasses:t.residualStyles;s!=null&&typeof r=="string"&&Zh(s,r)>=0&&(i[c+1]=E0(i[c+1]))}function cE(t,r,i,c){let u=t[i+1],s=r===null,x=c?Zl(u):Au(u),M=!1;for(;x!==0&&(M===!1||s);){let S=t[x],B=t[x+1];KL(S,r)&&(M=!0,t[x+1]=c?E0(B):C0(B)),x=c?Zl(B):Au(B)}M&&(t[i+1]=c?C0(u):E0(u))}function KL(t,r){return t===null||r==null||(Array.isArray(t)?t[1]:t)===r?!0:Array.isArray(t)&&typeof r=="string"?Zh(t,r)>=0:!1}function Mt(t,r,i){let c=an(),u=U0();if(Pa(c,u,r)){let s=qi(),x=fI();MO(s,x,c,t,r,c[zn],i,!1)}return Mt}function uE(t,r,i,c,u){let s=r.inputs,x=u?"class":"style";hb(t,i,s[x],x,c)}function $o(t,r,i){return sM(t,r,i,!1),$o}function tf(t,r){return sM(t,r,null,!0),tf}function sM(t,r,i,c){let u=an(),s=qi(),x=sI(2);if(s.firstUpdatePass&&JL(s,t,x,c),r!==Uo&&Pa(u,x,r)){let M=s.data[Wl()];iF(s,M,u,u[zn],t,u[x+1]=oF(r,i),c,x)}}function QL(t,r){return r>=t.expandoStartIndex}function JL(t,r,i,c){let u=t.data;if(u[i+1]===null){let s=u[Wl()],x=QL(t,i);sF(s,c)&&r===null&&!x&&(r=!1),r=eF(u,s,r,c),XL(u,s,r,i,x,c)}}function eF(t,r,i,c){let u=_R(t),s=c?r.residualClasses:r.residualStyles;if(u===null)(c?r.classBindings:r.styleBindings)===0&&(i=Lv(null,t,r,i,c),i=Gh(i,r.attrs,c),s=null);else{let x=r.directiveStylingLast;if(x===-1||t[x]!==u)if(i=Lv(u,t,r,i,c),s===null){let S=tF(t,r,c);S!==void 0&&Array.isArray(S)&&(S=Lv(null,t,r,S[1],c),S=Gh(S,r.attrs,c),nF(t,r,c,S))}else s=rF(t,r,c)}return s!==void 0&&(c?r.residualClasses=s:r.residualStyles=s),i}function tF(t,r,i){let c=i?r.classBindings:r.styleBindings;if(Au(c)!==0)return t[Zl(c)]}function nF(t,r,i,c){let u=i?r.classBindings:r.styleBindings;t[Zl(u)]=c}function rF(t,r,i){let c,u=r.directiveEnd;for(let s=1+r.directiveStylingLast;s<u;s++){let x=t[s].hostAttrs;c=Gh(c,x,i)}return Gh(c,r.attrs,i)}function Lv(t,r,i,c,u){let s=null,x=i.directiveEnd,M=i.directiveStylingLast;for(M===-1?M=i.directiveStart:M++;M<x&&(s=r[M],c=Gh(c,s.hostAttrs,u),s!==t);)M++;return t!==null&&(i.directiveStylingLast=M),c}function Gh(t,r,i){let c=i?1:2,u=-1;if(r!==null)for(let s=0;s<r.length;s++){let x=r[s];typeof x=="number"?u=x:u===c&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),k2(t,x,i?!0:r[++s]))}return t===void 0?null:t}function iF(t,r,i,c,u,s,x,M){if(!(r.type&3))return;let S=t.data,B=S[M+1],W=WL(B)?dE(S,r,i,u,Au(B),x):void 0;if(!pg(W)){pg(s)||qL(B)&&(s=dE(S,null,i,u,M,x));let $=KE(Wl(),i);cN(c,x,$,u,s)}}function dE(t,r,i,c,u,s){let x=r===null,M;for(;u>0;){let S=t[u],B=Array.isArray(S),W=B?S[1]:S,$=W===null,he=i[u+1];he===Uo&&(he=$?fo:void 0);let ge=$?Ev(he,c):W===c?he:void 0;if(B&&!pg(ge)&&(ge=Ev(S,c)),pg(ge)&&(M=ge,x))return M;let ze=t[u+1];u=x?Zl(ze):Au(ze)}if(r!==null){let S=s?r.residualClasses:r.residualStyles;S!=null&&(M=Ev(S,c))}return M}function pg(t){return t!==void 0}function oF(t,r){return t==null||t===""||(typeof r=="string"?t=t+r:typeof t=="object"&&(t=$r(Qh(t)))),t}function sF(t,r){return(t.flags&(r?8:16))!==0}function aF(t,r,i,c,u,s){let x=r.consts,M=Ym(x,u),S=Fg(r,t,2,c,M);return TT(r,i,S,Ym(x,s)),S.attrs!==null&&h0(S,S.attrs,!1),S.mergedAttrs!==null&&h0(S,S.mergedAttrs,!0),r.queries!==null&&r.queries.elementStart(r,S),S}function we(t,r,i,c){let u=an(),s=qi(),x=cr+t,M=u[zn],S=s.firstCreatePass?aF(x,s,u,r,i,c):s.data[x],B=aM(s,u,S,M,r,t);u[x]=B;let W=z0(S);return Xh(S,!0),gT(M,B,S),!Bu(S)&&q0()&&yb(s,u,B,S),oR()===0&&Fu(B,u),sR(),W&&(wT(s,u,S),sT(s,S,u)),c!==null&&ET(u,S),we}function Me(){let t=_o();iI()?hR():(t=t.parent,Xh(t,!1));let r=t;lR(r)&&uR(),aR();let i=qi();return i.firstCreatePass&&(Z0(i,t),qE(t)&&i.queries.elementEnd(t)),r.classesWithoutHost!=null&&ER(r)&&uE(i,r,an(),r.classesWithoutHost,!0),r.stylesWithoutHost!=null&&IR(r)&&uE(i,r,an(),r.stylesWithoutHost,!1),Me}function Ct(t,r,i,c){return we(t,r,i,c),Me(),Ct}var aM=(t,r,i,c,u,s)=>(ka(!0),ab(c,u,pI()));function lF(t,r,i,c,u,s){let x=r[Fo],M=!x||Wh()||Bu(i)||Kh(x,s);if(ka(M),M)return ab(c,u,pI());let S=zg(x,t,r,i);return iT(x,s)&&Rg(x,s,S.nextSibling),x&&(NI(i)||LI(S))&&Ra(i)&&(cR(i),mT(S)),S}function cF(){aM=lF}var uF=(t,r,i,c)=>(ka(!0),fT(r[zn],""));function dF(t,r,i,c){let u,s=r[Fo],x=!s||Wh()||Kh(s,c)||Bu(i);if(ka(x),x)return fT(r[zn],"");let M=zg(s,t,r,i),S=qk(s,c);return Rg(s,c,M),u=Bg(S,M),u}function hF(){uF=dF}function Si(){return an()}var Nl=void 0;function fF(t){let r=t,i=Math.floor(Math.abs(t)),c=t.toString().replace(/^[^.]*\.?/,"").length;return i===1&&c===0?1:5}var pF=["en",[["a","p"],["AM","PM"],Nl],[["AM","PM"],Nl,Nl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Nl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Nl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Nl,"{1} 'at' {0}",Nl],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",fF],Fv={};function Mb(t){let r=mF(t),i=hE(r);if(i)return i;let c=r.split("-")[0];if(i=hE(c),i)return i;if(c==="en")return pF;throw new it(701,!1)}function hE(t){return t in Fv||(Fv[t]=Ll.ng&&Ll.ng.common&&Ll.ng.common.locales&&Ll.ng.common.locales[t]),Fv[t]}var Vu=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Vu||{});function mF(t){return t.toLowerCase().replace(/_/g,"-")}var mg="en-US";var gF=mg;function yF(t){typeof t=="string"&&(gF=t.toLowerCase().replace(/_/g,"-"))}var lM=(t,r,i)=>{};function fE(t){lM=t}function qt(t,r,i,c){let u=an(),s=qi(),x=_o();return vF(s,u,u[zn],x,t,r,c),qt}function _F(t,r,i,c){let u=t.cleanup;if(u!=null)for(let s=0;s<u.length-1;s+=2){let x=u[s];if(x===i&&u[s+1]===c){let M=r[Zm],S=u[s+2];return M.length>S?M[S]:null}typeof x=="string"&&(s+=2)}return null}function vF(t,r,i,c,u,s,x){let M=z0(c),B=t.firstCreatePass&&tI(t),W=r[$i],$=eI(r),he=!0;if(c.type&3||x){let qe=Gi(c,r),Ye=x?x(qe):qe,lt=$.length,gt=x?_t=>x(go(_t[c.index])):c.index,ft=null;if(!x&&M&&(ft=_F(t,r,u,c.index)),ft!==null){let _t=ft.__ngLastListenerFn__||ft;_t.__ngNextListenerFn__=s,ft.__ngLastListenerFn__=s,he=!1}else{s=mE(c,r,W,s),lM(qe,u,s);let _t=i.listen(Ye,u,s);$.push(s,_t),B&&B.push(u,gt,lt,lt+1)}}else s=mE(c,r,W,s);let ge=c.outputs,ze;if(he&&ge!==null&&(ze=ge[u])){let qe=ze.length;if(qe)for(let Ye=0;Ye<qe;Ye+=2){let lt=ze[Ye],gt=ze[Ye+1],dt=r[lt][gt].subscribe(s),Vt=$.length;$.push(s,dt),B&&B.push(u,c.index,Vt,-(Vt+1))}}}function pE(t,r,i,c){let u=tn(null);try{return Ui(6,r,i),i(c)!==!1}catch(s){return Og(t,s),!1}finally{Ui(7,r,i),tn(u)}}function mE(t,r,i,c){return function u(s){if(s===Function)return c;let x=Ra(t)?zo(t.index,r):r;Lg(x,5);let M=pE(r,i,c,s),S=u.__ngNextListenerFn__;for(;S;)M=pE(r,i,S,s)&&M,S=S.__ngNextListenerFn__;return M}}function er(t=1){return bR(t)}function Pi(t,r,i){lL(t,r,i)}function di(t){let r=an(),i=qi(),c=aI();$0(c+1);let u=wb(i,c);if(t.dirty&&eR(r)===((u.metadata.flags&2)===2)){if(u.matches===null)t.reset([]);else{let s=dL(r,c);t.reset(s,XR),t.notifyOnChanges()}return!0}return!1}function hi(){return sL(an(),aI())}function bF(t,r,i,c){i>=t.data.length&&(t.data[i]=null,t.blueprint[i]=null),r[i]=c}function De(t,r=""){let i=an(),c=qi(),u=t+cr,s=c.firstCreatePass?Fg(c,u,1,r,null):c.data[u],x=cM(c,i,s,r,t);i[u]=x,q0()&&yb(c,i,x,s),Xh(s,!1)}var cM=(t,r,i,c,u)=>(ka(!0),hT(r[zn],c));function xF(t,r,i,c,u){let s=r[Fo],x=!s||Wh()||Bu(i)||Kh(s,u);return ka(x),x?hT(r[zn],c):zg(s,t,r,i)}function wF(){cM=xF}function Hr(t){return Yt("",t,""),Hr}function Yt(t,r,i){let c=an(),u=HL(c,t,r,i);return u!==Uo&&uM(c,Wl(),u),Yt}function Jl(t,r,i,c,u,s,x){let M=an(),S=GL(M,t,r,i,c,u,s,x);return S!==Uo&&uM(M,Wl(),S),Jl}function uM(t,r,i){let c=KE(r,t);gO(t[zn],c,i)}function nf(t,r,i){let c=V0()+t,u=an();return u[c]===Uo?Eb(u,c,i?r.call(i):r()):_L(u,c)}function Uu(t,r,i,c,u,s){return EF(an(),V0(),t,r,i,c,u,s)}function dM(t,r){let i=t[r];return i===Uo?void 0:i}function CF(t,r,i,c,u,s){let x=r+i;return Pa(t,x,u)?Eb(t,x+1,s?c.call(s,u):c(u)):dM(t,x+1)}function EF(t,r,i,c,u,s,x,M){let S=r+i;return eM(t,S,u,s,x)?Eb(t,S+3,M?c.call(M,u,s,x):c(u,s,x)):dM(t,S+3)}function hM(t,r){let i=qi(),c,u=t+cr;i.firstCreatePass?(c=IF(r,i.pipeRegistry),i.data[u]=c,c.onDestroy&&(i.destroyHooks??=[]).push(u,c.onDestroy)):c=i.data[u];let s=c.factory||(c.factory=Bl(c.type,!0)),x,M=ii(xt);try{let S=eg(!1),B=s();return eg(S),bF(i,an(),u,B),B}finally{ii(M)}}function IF(t,r){if(r)for(let i=r.length-1;i>=0;i--){let c=r[i];if(t===c.name)return c}}function fM(t,r,i){let c=t+cr,u=an(),s=J2(u,c);return TF(u,c)?CF(u,V0(),r,s.transform,i,s):s.transform(i)}function TF(t,r){return t[wt].data[r].pure}var I0=class{ngModuleFactory;componentFactories;constructor(r,i){this.ngModuleFactory=r,this.componentFactories=i}},Vg=(()=>{class t{compileModuleSync(i){return new x0(i)}compileModuleAsync(i){return Promise.resolve(this.compileModuleSync(i))}compileModuleAndAllComponentsSync(i){let c=this.compileModuleSync(i),u=BE(i),s=uT(u.declarations).reduce((x,M)=>{let S=As(M);return S&&x.push(new Pu(S)),x},[]);return new I0(c,s)}compileModuleAndAllComponentsAsync(i){return Promise.resolve(this.compileModuleAndAllComponentsSync(i))}clearCache(){}clearCacheFor(i){}getModuleId(i){}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var MF=(()=>{class t{zone=Le(kn);changeDetectionScheduler=Le(Mu);applicationRef=Le(ai);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),DF=new ot("",{factory:()=>!1});function pM({ngZoneFactory:t,ignoreChangesOutsideZone:r,scheduleInRootZone:i}){return t??=()=>new kn(wn(et({},gM()),{scheduleInRootZone:i})),[{provide:kn,useFactory:t},{provide:Ta,multi:!0,useFactory:()=>{let c=Le(MF,{optional:!0});return()=>c.initialize()}},{provide:Ta,multi:!0,useFactory:()=>{let c=Le(SF);return()=>{c.initialize()}}},r===!0?{provide:PI,useValue:!0}:[],{provide:AI,useValue:i??SI}]}function mM(t){let r=t?.ignoreChangesOutsideZone,i=t?.scheduleInRootZone,c=pM({ngZoneFactory:()=>{let u=gM(t);return u.scheduleInRootZone=i,u.shouldCoalesceEventChangeDetection&&Oa("NgZone_CoalesceEvent"),new kn(u)},ignoreChangesOutsideZone:r,scheduleInRootZone:i});return Aa([{provide:DF,useValue:!0},{provide:Tg,useValue:!1},c])}function gM(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var SF=(()=>{class t{subscription=new Qn;initialized=!1;zone=Le(kn);pendingTasks=Le(Vo);initialize(){if(this.initialized)return;this.initialized=!0;let i=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(i=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{kn.assertNotInAngularZone(),queueMicrotask(()=>{i!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(i),i=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{kn.assertInAngularZone(),i??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var PF=(()=>{class t{appRef=Le(ai);taskService=Le(Vo);ngZone=Le(kn);zonelessEnabled=Le(Tg);tracing=Le(zu,{optional:!0});disableScheduling=Le(PI,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Qn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(rg):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(Le(AI,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof e0||!this.zoneIsDefined)}notify(i){if(!this.zonelessEnabled&&i===5)return;let c=!1;switch(i){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,c=!0;break}case 13:{this.appRef.dirtyFlags|=16,c=!0;break}case 14:{this.appRef.dirtyFlags|=2,c=!0;break}case 12:{c=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(c))return;let u=this.useMicrotaskScheduler?jC:RI;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>u(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>u(()=>this.tick()))}shouldScheduleTick(i){return!(this.disableScheduling&&!i||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(rg+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let i=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(c){throw this.taskService.remove(i),c}finally{this.cleanup()}this.useMicrotaskScheduler=!0,jC(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(i)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let i=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(i)}}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function AF(){return typeof $localize<"u"&&$localize.locale||mg}var Ug=new ot("",{providedIn:"root",factory:()=>Le(Ug,Lt.Optional|Lt.SkipSelf)||AF()});var T0=new ot(""),RF=new ot("");function Oh(t){return!t.moduleRef}function kF(t){let r=Oh(t)?t.r3Injector:t.moduleRef.injector,i=r.get(kn);return i.run(()=>{Oh(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let c=r.get(Ns,null),u;if(i.runOutsideAngular(()=>{u=i.onError.subscribe({next:s=>{c.handleError(s)}})}),Oh(t)){let s=()=>r.destroy(),x=t.platformInjector.get(T0);x.add(s),r.onDestroy(()=>{u.unsubscribe(),x.delete(s)})}else{let s=()=>t.moduleRef.destroy(),x=t.platformInjector.get(T0);x.add(s),t.moduleRef.onDestroy(()=>{jm(t.allPlatformModules,t.moduleRef),u.unsubscribe(),x.delete(s)})}return OL(c,i,()=>{let s=r.get(oM);return s.runInitializers(),s.donePromise.then(()=>{let x=r.get(Ug,mg);if(yF(x||mg),!r.get(RF,!0))return Oh(t)?r.get(ai):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(Oh(t)){let S=r.get(ai);return t.rootComponent!==void 0&&S.bootstrap(t.rootComponent),S}else return OF(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function OF(t,r){let i=t.injector.get(ai);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(c=>i.bootstrap(c));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(i);else throw new it(-403,!1);r.push(t)}var Vm=null;function NF(t=[],r){return si.create({name:r,providers:[{provide:bg,useValue:"platform"},{provide:T0,useValue:new Set([()=>Vm=null])},...t]})}function LF(t=[]){if(Vm)return Vm;let r=NF(t);return Vm=r,AL(),FF(r),r}function FF(t){let r=t.get(J0,null);li(t,()=>{r?.forEach(i=>i())})}var rf=(()=>{class t{static __NG_ELEMENT_ID__=zF}return t})();function zF(t){return BF(_o(),an(),(t&16)===16)}function BF(t,r,i){if(Ra(t)&&!i){let c=zo(t.index,r);return new Gl(c,c)}else if(t.type&175){let c=r[Hi];return new Gl(c,r)}return null}var M0=class{constructor(){}supports(r){return JT(r)}create(r){return new D0(r)}},jF=(t,r)=>r,D0=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(r){this._trackByFn=r||jF}forEachItem(r){let i;for(i=this._itHead;i!==null;i=i._next)r(i)}forEachOperation(r){let i=this._itHead,c=this._removalsHead,u=0,s=null;for(;i||c;){let x=!c||i&&i.currentIndex<gE(c,u,s)?i:c,M=gE(x,u,s),S=x.currentIndex;if(x===c)u--,c=c._nextRemoved;else if(i=i._next,x.previousIndex==null)u++;else{s||(s=[]);let B=M-u,W=S-u;if(B!=W){for(let he=0;he<B;he++){let ge=he<s.length?s[he]:s[he]=0,ze=ge+he;W<=ze&&ze<B&&(s[he]=ge+1)}let $=x.previousIndex;s[$]=W-B}}M!==S&&r(x,M,S)}}forEachPreviousItem(r){let i;for(i=this._previousItHead;i!==null;i=i._nextPrevious)r(i)}forEachAddedItem(r){let i;for(i=this._additionsHead;i!==null;i=i._nextAdded)r(i)}forEachMovedItem(r){let i;for(i=this._movesHead;i!==null;i=i._nextMoved)r(i)}forEachRemovedItem(r){let i;for(i=this._removalsHead;i!==null;i=i._nextRemoved)r(i)}forEachIdentityChange(r){let i;for(i=this._identityChangesHead;i!==null;i=i._nextIdentityChange)r(i)}diff(r){if(r==null&&(r=[]),!JT(r))throw new it(900,!1);return this.check(r)?this:null}onDestroy(){}check(r){this._reset();let i=this._itHead,c=!1,u,s,x;if(Array.isArray(r)){this.length=r.length;for(let M=0;M<this.length;M++)s=r[M],x=this._trackByFn(M,s),i===null||!Object.is(i.trackById,x)?(i=this._mismatch(i,s,x,M),c=!0):(c&&(i=this._verifyReinsertion(i,s,x,M)),Object.is(i.item,s)||this._addIdentityChange(i,s)),i=i._next}else u=0,gL(r,M=>{x=this._trackByFn(u,M),i===null||!Object.is(i.trackById,x)?(i=this._mismatch(i,M,x,u),c=!0):(c&&(i=this._verifyReinsertion(i,M,x,u)),Object.is(i.item,M)||this._addIdentityChange(i,M)),i=i._next,u++}),this.length=u;return this._truncate(i),this.collection=r,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let r;for(r=this._previousItHead=this._itHead;r!==null;r=r._next)r._nextPrevious=r._next;for(r=this._additionsHead;r!==null;r=r._nextAdded)r.previousIndex=r.currentIndex;for(this._additionsHead=this._additionsTail=null,r=this._movesHead;r!==null;r=r._nextMoved)r.previousIndex=r.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(r,i,c,u){let s;return r===null?s=this._itTail:(s=r._prev,this._remove(r)),r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null),r!==null?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._reinsertAfter(r,s,u)):(r=this._linkedRecords===null?null:this._linkedRecords.get(c,u),r!==null?(Object.is(r.item,i)||this._addIdentityChange(r,i),this._moveAfter(r,s,u)):r=this._addAfter(new S0(i,c),s,u)),r}_verifyReinsertion(r,i,c,u){let s=this._unlinkedRecords===null?null:this._unlinkedRecords.get(c,null);return s!==null?r=this._reinsertAfter(s,r._prev,u):r.currentIndex!=u&&(r.currentIndex=u,this._addToMoves(r,u)),r}_truncate(r){for(;r!==null;){let i=r._next;this._addToRemovals(this._unlink(r)),r=i}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(r,i,c){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(r);let u=r._prevRemoved,s=r._nextRemoved;return u===null?this._removalsHead=s:u._nextRemoved=s,s===null?this._removalsTail=u:s._prevRemoved=u,this._insertAfter(r,i,c),this._addToMoves(r,c),r}_moveAfter(r,i,c){return this._unlink(r),this._insertAfter(r,i,c),this._addToMoves(r,c),r}_addAfter(r,i,c){return this._insertAfter(r,i,c),this._additionsTail===null?this._additionsTail=this._additionsHead=r:this._additionsTail=this._additionsTail._nextAdded=r,r}_insertAfter(r,i,c){let u=i===null?this._itHead:i._next;return r._next=u,r._prev=i,u===null?this._itTail=r:u._prev=r,i===null?this._itHead=r:i._next=r,this._linkedRecords===null&&(this._linkedRecords=new gg),this._linkedRecords.put(r),r.currentIndex=c,r}_remove(r){return this._addToRemovals(this._unlink(r))}_unlink(r){this._linkedRecords!==null&&this._linkedRecords.remove(r);let i=r._prev,c=r._next;return i===null?this._itHead=c:i._next=c,c===null?this._itTail=i:c._prev=i,r}_addToMoves(r,i){return r.previousIndex===i||(this._movesTail===null?this._movesTail=this._movesHead=r:this._movesTail=this._movesTail._nextMoved=r),r}_addToRemovals(r){return this._unlinkedRecords===null&&(this._unlinkedRecords=new gg),this._unlinkedRecords.put(r),r.currentIndex=null,r._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=r,r._prevRemoved=null):(r._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=r),r}_addIdentityChange(r,i){return r.item=i,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=r:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=r,r}},S0=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(r,i){this.item=r,this.trackById=i}},P0=class{_head=null;_tail=null;add(r){this._head===null?(this._head=this._tail=r,r._nextDup=null,r._prevDup=null):(this._tail._nextDup=r,r._prevDup=this._tail,r._nextDup=null,this._tail=r)}get(r,i){let c;for(c=this._head;c!==null;c=c._nextDup)if((i===null||i<=c.currentIndex)&&Object.is(c.trackById,r))return c;return null}remove(r){let i=r._prevDup,c=r._nextDup;return i===null?this._head=c:i._nextDup=c,c===null?this._tail=i:c._prevDup=i,this._head===null}},gg=class{map=new Map;put(r){let i=r.trackById,c=this.map.get(i);c||(c=new P0,this.map.set(i,c)),c.add(r)}get(r,i){let c=r,u=this.map.get(c);return u?u.get(r,i):null}remove(r){let i=r.trackById;return this.map.get(i).remove(r)&&this.map.delete(i),r}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function gE(t,r,i){let c=t.previousIndex;if(c===null)return c;let u=0;return i&&c<i.length&&(u=i[c]),c+r+u}function yE(){return new Db([new M0])}var Db=(()=>{class t{factories;static \u0275prov=nt({token:t,providedIn:"root",factory:yE});constructor(i){this.factories=i}static create(i,c){if(c!=null){let u=c.factories.slice();i=i.concat(u)}return new t(i)}static extend(i){return{provide:t,useFactory:c=>t.create(i,c||yE()),deps:[[t,new S2,new NE]]}}find(i){let c=this.factories.find(u=>u.supports(i));if(c!=null)return c;throw new it(901,!1)}}return t})();function yM(t){try{let{rootComponent:r,appProviders:i,platformProviders:c}=t,u=LF(c),s=[pM({}),{provide:Mu,useExisting:PF},...i||[]],x=new fg({providers:s,parent:u,debugName:"",runEnvironmentInitializers:!1});return kF({r3Injector:x.injector,platformInjector:u,rootComponent:r})}catch(r){return Promise.reject(r)}}var Om=new WeakSet,_E="",Um=[];function vE(t){return t.get(XI,mk)}function _M(){let t=[{provide:XI,useFactory:()=>{let r=!0;{let i=Le(Hl);r=!!window._ejsas?.[i]}return r&&Oa("NgEventReplay"),r}}];return t.push({provide:Ta,useValue:()=>{let r=Le(si),i=r.get(ai);if(!Om.has(i)){let c=Le(qC);vE(r)&&fE((u,s,x)=>{Rk(u,s,x),kk(u,c)})}},multi:!0},{provide:La,useFactory:()=>{let r=Le(Hl),i=Le(si),c=Le(ai);return()=>{!vE(i)||Om.has(c)||(Om.add(c),c.onDestroy(()=>{Om.delete(c),Cv(r),fE(()=>{})}),c.whenStable().then(()=>{let u=i.get(Nk);VF(u,i);let s=i.get(qC);s.get(_E)?.forEach(Ok),s.delete(_E);let x=u.instance;Gk(i)?c.onDestroy(()=>x.cleanUp()):x.cleanUp()}))}},multi:!0}),t}var VF=(t,r)=>{let i=r.get(Hl),c=window._ejsas[i],u=t.instance=new EC(new Dm(c.c));for(let M of c.et)u.addEvent(M);for(let M of c.etc)u.addEvent(M);let s=IC(i);u.replayEarlyEventInfos(s),Cv(i);let x=new Sm(M=>{UF(r,M,M.currentTarget)});CC(u,x)};function UF(t,r,i){let c=(i&&i.getAttribute(Ag))??"";/d\d+/.test(c)?$F(c,t,r,i):r.eventPhase===wv.REPLAY&&JI(r,i)}function $F(t,r,i,c){Um.push({event:i,currentTarget:c}),BL(r,t,HF)}function HF(t){let r=[...Um],i=new Set(t);Um=[];for(let{event:c,currentTarget:u}of r){let s=u.getAttribute(Ag);i.has(s)?JI(c,u):Um.push({event:c,currentTarget:u})}}var bE=!1;function GF(){bE||(bE=!0,Vk(),cF(),wF(),hF(),CL(),tL(),HN(),EO())}function qF(t){return t.whenStable()}function vM(){let t=[{provide:Am,useFactory:()=>{let r=!0;return r=!!Le(Xl,{optional:!0})?.get(tT,null),r&&Oa("NgHydration"),r}},{provide:Ta,useValue:()=>{FN(!1),Le(Am)&&(ZF(),GF())},multi:!0}];return t.push({provide:WI,useFactory:()=>Le(Am)},{provide:La,useFactory:()=>{if(Le(Am)){let r=Le(ai);return()=>{qF(r).then(()=>{r.destroyed||$T(r)})}}return()=>{}},multi:!0}),Aa(t)}function ZF(){let t=Mg(),r;for(let i of t.body.childNodes)if(i.nodeType===Node.COMMENT_NODE&&i.textContent?.trim()===Bk){r=i;break}if(!r)throw new it(-507,!1)}function of(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}var xE=class{[ou];constructor(r){this[ou]=r}destroy(){this[ou].destroy()}};function bM(t){let r=As(t);if(!r)return null;let i=new Pu(r);return{get selector(){return i.selector},get type(){return i.componentType},get inputs(){return i.inputs},get outputs(){return i.outputs},get ngContentSelectors(){return i.ngContentSelectors},get isStandalone(){return r.standalone},get isSignal(){return r.signals}}}var DM=null;function $u(){return DM}function SM(t){DM??=t}var $g=class{};var Ar=new ot(""),Nb=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(WF),providedIn:"platform"})}return t})(),PM=new ot(""),WF=(()=>{class t extends Nb{_location;_history;_doc=Le(Ar);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return $u().getBaseHref(this._doc)}onPopState(i){let c=$u().getGlobalEventTarget(this._doc,"window");return c.addEventListener("popstate",i,!1),()=>c.removeEventListener("popstate",i)}onHashChange(i){let c=$u().getGlobalEventTarget(this._doc,"window");return c.addEventListener("hashchange",i,!1),()=>c.removeEventListener("hashchange",i)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(i){this._location.pathname=i}pushState(i,c,u){this._history.pushState(i,c,u)}replaceState(i,c,u){this._history.replaceState(i,c,u)}forward(){this._history.forward()}back(){this._history.back()}historyGo(i=0){this._history.go(i)}getState(){return this._history.state}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function Lb(t,r){return t?r?t.endsWith("/")?r.startsWith("/")?t+r.slice(1):t+r:r.startsWith("/")?t+r:`${t}/${r}`:t:r}function xM(t){let r=t.match(/#|\?|$/),i=r&&r.index||t.length,c=i-(t[i-1]==="/"?1:0);return t.slice(0,c)+t.slice(i)}function zs(t){return t&&t[0]!=="?"?"?"+t:t}var js=(()=>{class t{historyGo(i){throw new Error("")}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(Fb),providedIn:"root"})}return t})(),AM=new ot(""),Fb=(()=>{class t extends js{_platformLocation;_baseHref;_removeListenerFns=[];constructor(i,c){super(),this._platformLocation=i,this._baseHref=c??this._platformLocation.getBaseHrefFromDOM()??Le(Ar).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}prepareExternalUrl(i){return Lb(this._baseHref,i)}path(i=!1){let c=this._platformLocation.pathname+zs(this._platformLocation.search),u=this._platformLocation.hash;return u&&i?`${c}${u}`:c}pushState(i,c,u,s){let x=this.prepareExternalUrl(u+zs(s));this._platformLocation.pushState(i,c,x)}replaceState(i,c,u,s){let x=this.prepareExternalUrl(u+zs(s));this._platformLocation.replaceState(i,c,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(c){return new(c||t)(ht(Nb),ht(AM,8))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),RM=(()=>{class t extends js{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(i,c){super(),this._platformLocation=i,c!=null&&(this._baseHref=c)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(i){this._removeListenerFns.push(this._platformLocation.onPopState(i),this._platformLocation.onHashChange(i))}getBaseHref(){return this._baseHref}path(i=!1){let c=this._platformLocation.hash??"#";return c.length>0?c.substring(1):c}prepareExternalUrl(i){let c=Lb(this._baseHref,i);return c.length>0?"#"+c:c}pushState(i,c,u,s){let x=this.prepareExternalUrl(u+zs(s));x.length==0&&(x=this._platformLocation.pathname),this._platformLocation.pushState(i,c,x)}replaceState(i,c,u,s){let x=this.prepareExternalUrl(u+zs(s));x.length==0&&(x=this._platformLocation.pathname),this._platformLocation.replaceState(i,c,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(i=0){this._platformLocation.historyGo?.(i)}static \u0275fac=function(c){return new(c||t)(ht(Nb),ht(AM,8))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),Gu=(()=>{class t{_subject=new _r;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(i){this._locationStrategy=i;let c=this._locationStrategy.getBaseHref();this._basePath=KF(xM(wM(c))),this._locationStrategy.onPopState(u=>{this._subject.next({url:this.path(!0),pop:!0,state:u.state,type:u.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(i=!1){return this.normalize(this._locationStrategy.path(i))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(i,c=""){return this.path()==this.normalize(i+zs(c))}normalize(i){return t.stripTrailingSlash(YF(this._basePath,wM(i)))}prepareExternalUrl(i){return i&&i[0]!=="/"&&(i="/"+i),this._locationStrategy.prepareExternalUrl(i)}go(i,c="",u=null){this._locationStrategy.pushState(u,"",i,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+zs(c)),u)}replaceState(i,c="",u=null){this._locationStrategy.replaceState(u,"",i,c),this._notifyUrlChangeListeners(this.prepareExternalUrl(i+zs(c)),u)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(i=0){this._locationStrategy.historyGo?.(i)}onUrlChange(i){return this._urlChangeListeners.push(i),this._urlChangeSubscription??=this.subscribe(c=>{this._notifyUrlChangeListeners(c.url,c.state)}),()=>{let c=this._urlChangeListeners.indexOf(i);this._urlChangeListeners.splice(c,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(i="",c){this._urlChangeListeners.forEach(u=>u(i,c))}subscribe(i,c,u){return this._subject.subscribe({next:i,error:c??void 0,complete:u??void 0})}static normalizeQueryParams=zs;static joinWithSlash=Lb;static stripTrailingSlash=xM;static \u0275fac=function(c){return new(c||t)(ht(js))};static \u0275prov=nt({token:t,factory:()=>XF(),providedIn:"root"})}return t})();function XF(){return new Gu(ht(js))}function YF(t,r){if(!t||!r.startsWith(t))return r;let i=r.substring(t.length);return i===""||["/",";","?","#"].includes(i[0])?i:r}function wM(t){return t.replace(/\/index.html$/,"")}function KF(t){if(new RegExp("^(https?:)?//").test(t)){let[,i]=t.split(/\/\/[^\/]+/);return i}return t}var kM=function(t){return t[t.Decimal=0]="Decimal",t[t.Percent=1]="Percent",t[t.Currency=2]="Currency",t[t.Scientific=3]="Scientific",t}(kM||{});var Bs={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function sf(t,r){let i=Mb(t),c=i[Vu.NumberSymbols][r];if(typeof c>"u"){if(r===Bs.CurrencyDecimal)return i[Vu.NumberSymbols][Bs.Decimal];if(r===Bs.CurrencyGroup)return i[Vu.NumberSymbols][Bs.Group]}return c}function QF(t,r){return Mb(t)[Vu.NumberFormats][r]}var JF=/^(\d+)?\.((\d+)(-(\d+))?)?$/,CM=22,Hg=".",af="0",ez=";",tz=",",Sb="#";function nz(t,r,i,c,u,s,x=!1){let M="",S=!1;if(!isFinite(t))M=sf(i,Bs.Infinity);else{let B=sz(t);x&&(B=oz(B));let W=r.minInt,$=r.minFrac,he=r.maxFrac;if(s){let gt=s.match(JF);if(gt===null)throw new Error(`${s} is not a valid digit info`);let ft=gt[1],_t=gt[3],dt=gt[5];ft!=null&&(W=Pb(ft)),_t!=null&&($=Pb(_t)),dt!=null?he=Pb(dt):_t!=null&&$>he&&(he=$)}az(B,$,he);let ge=B.digits,ze=B.integerLen,qe=B.exponent,Ye=[];for(S=ge.every(gt=>!gt);ze<W;ze++)ge.unshift(0);for(;ze<0;ze++)ge.unshift(0);ze>0?Ye=ge.splice(ze,ge.length):(Ye=ge,ge=[0]);let lt=[];for(ge.length>=r.lgSize&&lt.unshift(ge.splice(-r.lgSize,ge.length).join(""));ge.length>r.gSize;)lt.unshift(ge.splice(-r.gSize,ge.length).join(""));ge.length&&lt.unshift(ge.join("")),M=lt.join(sf(i,c)),Ye.length&&(M+=sf(i,u)+Ye.join("")),qe&&(M+=sf(i,Bs.Exponential)+"+"+qe)}return t<0&&!S?M=r.negPre+M+r.negSuf:M=r.posPre+M+r.posSuf,M}function rz(t,r,i){let c=QF(r,kM.Decimal),u=iz(c,sf(r,Bs.MinusSign));return nz(t,u,r,Bs.Group,Bs.Decimal,i)}function iz(t,r="-"){let i={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},c=t.split(ez),u=c[0],s=c[1],x=u.indexOf(Hg)!==-1?u.split(Hg):[u.substring(0,u.lastIndexOf(af)+1),u.substring(u.lastIndexOf(af)+1)],M=x[0],S=x[1]||"";i.posPre=M.substring(0,M.indexOf(Sb));for(let W=0;W<S.length;W++){let $=S.charAt(W);$===af?i.minFrac=i.maxFrac=W+1:$===Sb?i.maxFrac=W+1:i.posSuf+=$}let B=M.split(tz);if(i.gSize=B[1]?B[1].length:0,i.lgSize=B[2]||B[1]?(B[2]||B[1]).length:0,s){let W=u.length-i.posPre.length-i.posSuf.length,$=s.indexOf(Sb);i.negPre=s.substring(0,$).replace(/'/g,""),i.negSuf=s.slice($+W).replace(/'/g,"")}else i.negPre=r+i.posPre,i.negSuf=i.posSuf;return i}function oz(t){if(t.digits[0]===0)return t;let r=t.digits.length-t.integerLen;return t.exponent?t.exponent+=2:(r===0?t.digits.push(0,0):r===1&&t.digits.push(0),t.integerLen+=2),t}function sz(t){let r=Math.abs(t)+"",i=0,c,u,s,x,M;for((u=r.indexOf(Hg))>-1&&(r=r.replace(Hg,"")),(s=r.search(/e/i))>0?(u<0&&(u=s),u+=+r.slice(s+1),r=r.substring(0,s)):u<0&&(u=r.length),s=0;r.charAt(s)===af;s++);if(s===(M=r.length))c=[0],u=1;else{for(M--;r.charAt(M)===af;)M--;for(u-=s,c=[],x=0;s<=M;s++,x++)c[x]=Number(r.charAt(s))}return u>CM&&(c=c.splice(0,CM-1),i=u-1,u=1),{digits:c,exponent:i,integerLen:u}}function az(t,r,i){if(r>i)throw new Error(`The minimum number of digits after fraction (${r}) is higher than the maximum (${i}).`);let c=t.digits,u=c.length-t.integerLen,s=Math.min(Math.max(r,u),i),x=s+t.integerLen,M=c[x];if(x>0){c.splice(Math.max(t.integerLen,x));for(let $=x;$<c.length;$++)c[$]=0}else{u=Math.max(0,u),t.integerLen=1,c.length=Math.max(1,x=s+1),c[0]=0;for(let $=1;$<x;$++)c[$]=0}if(M>=5)if(x-1<0){for(let $=0;$>x;$--)c.unshift(0),t.integerLen++;c.unshift(1),t.integerLen++}else c[x-1]++;for(;u<Math.max(0,s);u++)c.push(0);let S=s!==0,B=r+t.integerLen,W=c.reduceRight(function($,he,ge,ze){return he=he+$,ze[ge]=he<10?he:he-10,S&&(ze[ge]===0&&ge>=B?ze.pop():S=!1),he>=10?1:0},0);W&&(c.unshift(W),t.integerLen++)}function Pb(t){let r=parseInt(t);if(isNaN(r))throw new Error("Invalid integer literal when parsing "+t);return r}function Gg(t,r){r=encodeURIComponent(r);for(let i of t.split(";")){let c=i.indexOf("="),[u,s]=c==-1?[i,""]:[i.slice(0,c),i.slice(c+1)];if(u.trim()===r)return decodeURIComponent(s)}return null}var Ab=/\s+/,EM=[],qu=(()=>{class t{_ngEl;_renderer;initialClasses=EM;rawClass;stateMap=new Map;constructor(i,c){this._ngEl=i,this._renderer=c}set klass(i){this.initialClasses=i!=null?i.trim().split(Ab):EM}set ngClass(i){this.rawClass=typeof i=="string"?i.trim().split(Ab):i}ngDoCheck(){for(let c of this.initialClasses)this._updateState(c,!0);let i=this.rawClass;if(Array.isArray(i)||i instanceof Set)for(let c of i)this._updateState(c,!0);else if(i!=null)for(let c of Object.keys(i))this._updateState(c,!!i[c]);this._applyStateDiff()}_updateState(i,c){let u=this.stateMap.get(i);u!==void 0?(u.enabled!==c&&(u.changed=!0,u.enabled=c),u.touched=!0):this.stateMap.set(i,{enabled:c,changed:!0,touched:!0})}_applyStateDiff(){for(let i of this.stateMap){let c=i[0],u=i[1];u.changed?(this._toggleClass(c,u.enabled),u.changed=!1):u.touched||(u.enabled&&this._toggleClass(c,!1),this.stateMap.delete(c)),u.touched=!1}}_toggleClass(i,c){i=i.trim(),i.length>0&&i.split(Ab).forEach(u=>{c?this._renderer.addClass(this._ngEl.nativeElement,u):this._renderer.removeClass(this._ngEl.nativeElement,u)})}static \u0275fac=function(c){return new(c||t)(xt(Fs),xt(Kl))};static \u0275dir=Ql({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var Rb=class{$implicit;ngForOf;index;count;constructor(r,i,c,u){this.$implicit=r,this.ngForOf=i,this.index=c,this.count=u}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},OM=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(i){this._ngForOf=i,this._ngForOfDirty=!0}set ngForTrackBy(i){this._trackByFn=i}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(i,c,u){this._viewContainer=i,this._template=c,this._differs=u}set ngForTemplate(i){i&&(this._template=i)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let i=this._ngForOf;!this._differ&&i&&(this._differ=this._differs.find(i).create(this.ngForTrackBy))}if(this._differ){let i=this._differ.diff(this._ngForOf);i&&this._applyChanges(i)}}_applyChanges(i){let c=this._viewContainer;i.forEachOperation((u,s,x)=>{if(u.previousIndex==null)c.createEmbeddedView(this._template,new Rb(u.item,this._ngForOf,-1,-1),x===null?void 0:x);else if(x==null)c.remove(s===null?void 0:s);else if(s!==null){let M=c.get(s);c.move(M,x),IM(M,u)}});for(let u=0,s=c.length;u<s;u++){let M=c.get(u).context;M.index=u,M.count=s,M.ngForOf=this._ngForOf}i.forEachIdentityChange(u=>{let s=c.get(u.currentIndex);IM(s,u)})}static ngTemplateContextGuard(i,c){return!0}static \u0275fac=function(c){return new(c||t)(xt(Na),xt(ql),xt(Db))};static \u0275dir=Ql({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function IM(t,r){t.context.$implicit=r.item}var Rr=(()=>{class t{_viewContainer;_context=new kb;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(i,c){this._viewContainer=i,this._thenTemplateRef=c}set ngIf(i){this._context.$implicit=this._context.ngIf=i,this._updateView()}set ngIfThen(i){TM("ngIfThen",i),this._thenTemplateRef=i,this._thenViewRef=null,this._updateView()}set ngIfElse(i){TM("ngIfElse",i),this._elseTemplateRef=i,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(i,c){return!0}static \u0275fac=function(c){return new(c||t)(xt(Na),xt(ql))};static \u0275dir=Ql({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),kb=class{$implicit=null;ngIf=null};function TM(t,r){if(!!!(!r||r.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${$r(r)}'.`)}function lz(t,r){return new it(2100,!1)}var NM=(()=>{class t{_locale;constructor(i){this._locale=i}transform(i,c,u){if(!cz(i))return null;u||=this._locale;try{let s=uz(i);return rz(s,u,c)}catch(s){throw lz(t,s.message)}}static \u0275fac=function(c){return new(c||t)(xt(Ug,16))};static \u0275pipe=YT({name:"number",type:t,pure:!0})}return t})();function cz(t){return!(t==null||t===""||t!==t)}function uz(t){if(typeof t=="string"&&!isNaN(Number(t)-parseFloat(t)))return Number(t);if(typeof t!="number")throw new Error(`${t} is not a number`);return t}var ur=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275mod=ju({type:t});static \u0275inj=Ru({})}return t})(),zb="browser",dz="server";function LM(t){return t===zb}function Bb(t){return t===dz}var FM=(()=>{class t{static \u0275prov=nt({token:t,providedIn:"root",factory:()=>new Ob(Le(Ar),window)})}return t})(),Ob=class{document;window;offset=()=>[0,0];constructor(r,i){this.document=r,this.window=i}setOffset(r){Array.isArray(r)?this.offset=()=>r:this.offset=r}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(r){this.window.scrollTo(r[0],r[1])}scrollToAnchor(r){let i=hz(this.document,r);i&&(this.scrollToElement(i),i.focus())}setHistoryScrollRestoration(r){this.window.history.scrollRestoration=r}scrollToElement(r){let i=r.getBoundingClientRect(),c=i.left+this.window.pageXOffset,u=i.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(c-s[0],u-s[1])}};function hz(t,r){let i=t.getElementById(r)||t.getElementsByName(r)[0];if(i)return i;if(typeof t.createTreeWalker=="function"&&t.body&&typeof t.body.attachShadow=="function"){let c=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT),u=c.currentNode;for(;u;){let s=u.shadowRoot;if(s){let x=s.getElementById(r)||s.querySelector(`[name="${r}"]`);if(x)return x}u=c.nextNode()}}return null}var Hu=class{};var uf=class{},df=class{},Go=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(r){r?typeof r=="string"?this.lazyInit=()=>{this.headers=new Map,r.split(`
`).forEach(i=>{let c=i.indexOf(":");if(c>0){let u=i.slice(0,c),s=i.slice(c+1).trim();this.addHeaderEntry(u,s)}})}:typeof Headers<"u"&&r instanceof Headers?(this.headers=new Map,r.forEach((i,c)=>{this.addHeaderEntry(c,i)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(r).forEach(([i,c])=>{this.setHeaderEntries(i,c)})}:this.headers=new Map}has(r){return this.init(),this.headers.has(r.toLowerCase())}get(r){this.init();let i=this.headers.get(r.toLowerCase());return i&&i.length>0?i[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(r){return this.init(),this.headers.get(r.toLowerCase())||null}append(r,i){return this.clone({name:r,value:i,op:"a"})}set(r,i){return this.clone({name:r,value:i,op:"s"})}delete(r,i){return this.clone({name:r,value:i,op:"d"})}maybeSetNormalizedName(r,i){this.normalizedNames.has(i)||this.normalizedNames.set(i,r)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(r=>this.applyUpdate(r)),this.lazyUpdate=null))}copyFrom(r){r.init(),Array.from(r.headers.keys()).forEach(i=>{this.headers.set(i,r.headers.get(i)),this.normalizedNames.set(i,r.normalizedNames.get(i))})}clone(r){let i=new t;return i.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,i.lazyUpdate=(this.lazyUpdate||[]).concat([r]),i}applyUpdate(r){let i=r.name.toLowerCase();switch(r.op){case"a":case"s":let c=r.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(r.name,i);let u=(r.op==="a"?this.headers.get(i):void 0)||[];u.push(...c),this.headers.set(i,u);break;case"d":let s=r.value;if(!s)this.headers.delete(i),this.normalizedNames.delete(i);else{let x=this.headers.get(i);if(!x)return;x=x.filter(M=>s.indexOf(M)===-1),x.length===0?(this.headers.delete(i),this.normalizedNames.delete(i)):this.headers.set(i,x)}break}}addHeaderEntry(r,i){let c=r.toLowerCase();this.maybeSetNormalizedName(r,c),this.headers.has(c)?this.headers.get(c).push(i):this.headers.set(c,[i])}setHeaderEntries(r,i){let c=(Array.isArray(i)?i:[i]).map(s=>s.toString()),u=r.toLowerCase();this.headers.set(u,c),this.maybeSetNormalizedName(r,u)}forEach(r){this.init(),Array.from(this.normalizedNames.keys()).forEach(i=>r(this.normalizedNames.get(i),this.headers.get(i)))}};var Ub=class{encodeKey(r){return zM(r)}encodeValue(r){return zM(r)}decodeKey(r){return decodeURIComponent(r)}decodeValue(r){return decodeURIComponent(r)}};function fz(t,r){let i=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(u=>{let s=u.indexOf("="),[x,M]=s==-1?[r.decodeKey(u),""]:[r.decodeKey(u.slice(0,s)),r.decodeValue(u.slice(s+1))],S=i.get(x)||[];S.push(M),i.set(x,S)}),i}var pz=/%(\d[a-f0-9])/gi,mz={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function zM(t){return encodeURIComponent(t).replace(pz,(r,i)=>mz[i]??r)}function qg(t){return`${t}`}var za=class t{map;encoder;updates=null;cloneFrom=null;constructor(r={}){if(this.encoder=r.encoder||new Ub,r.fromString){if(r.fromObject)throw new it(2805,!1);this.map=fz(r.fromString,this.encoder)}else r.fromObject?(this.map=new Map,Object.keys(r.fromObject).forEach(i=>{let c=r.fromObject[i],u=Array.isArray(c)?c.map(qg):[qg(c)];this.map.set(i,u)})):this.map=null}has(r){return this.init(),this.map.has(r)}get(r){this.init();let i=this.map.get(r);return i?i[0]:null}getAll(r){return this.init(),this.map.get(r)||null}keys(){return this.init(),Array.from(this.map.keys())}append(r,i){return this.clone({param:r,value:i,op:"a"})}appendAll(r){let i=[];return Object.keys(r).forEach(c=>{let u=r[c];Array.isArray(u)?u.forEach(s=>{i.push({param:c,value:s,op:"a"})}):i.push({param:c,value:u,op:"a"})}),this.clone(i)}set(r,i){return this.clone({param:r,value:i,op:"s"})}delete(r,i){return this.clone({param:r,value:i,op:"d"})}toString(){return this.init(),this.keys().map(r=>{let i=this.encoder.encodeKey(r);return this.map.get(r).map(c=>i+"="+this.encoder.encodeValue(c)).join("&")}).filter(r=>r!=="").join("&")}clone(r){let i=new t({encoder:this.encoder});return i.cloneFrom=this.cloneFrom||this,i.updates=(this.updates||[]).concat(r),i}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(r=>this.map.set(r,this.cloneFrom.map.get(r))),this.updates.forEach(r=>{switch(r.op){case"a":case"s":let i=(r.op==="a"?this.map.get(r.param):void 0)||[];i.push(qg(r.value)),this.map.set(r.param,i);break;case"d":if(r.value!==void 0){let c=this.map.get(r.param)||[],u=c.indexOf(qg(r.value));u!==-1&&c.splice(u,1),c.length>0?this.map.set(r.param,c):this.map.delete(r.param)}else{this.map.delete(r.param);break}}}),this.cloneFrom=this.updates=null)}};var $b=class{map=new Map;set(r,i){return this.map.set(r,i),this}get(r){return this.map.has(r)||this.map.set(r,r.defaultValue()),this.map.get(r)}delete(r){return this.map.delete(r),this}has(r){return this.map.has(r)}keys(){return this.map.keys()}};function gz(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function BM(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function jM(t){return typeof Blob<"u"&&t instanceof Blob}function VM(t){return typeof FormData<"u"&&t instanceof FormData}function yz(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var lf="Content-Type",Wg="Accept",qb="X-Request-URL",qM="text/plain",ZM="application/json",WM=`${ZM}, ${qM}, */*`,cf=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(r,i,c,u){this.url=i,this.method=r.toUpperCase();let s;if(gz(this.method)||u?(this.body=c!==void 0?c:null,s=u):s=c,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new Go,this.context??=new $b,!this.params)this.params=new za,this.urlWithParams=i;else{let x=this.params.toString();if(x.length===0)this.urlWithParams=i;else{let M=i.indexOf("?"),S=M===-1?"?":M<i.length-1?"&":"";this.urlWithParams=i+S+x}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||BM(this.body)||jM(this.body)||VM(this.body)||yz(this.body)?this.body:this.body instanceof za?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||VM(this.body)?null:jM(this.body)?this.body.type||null:BM(this.body)?null:typeof this.body=="string"?qM:this.body instanceof za?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?ZM:null}clone(r={}){let i=r.method||this.method,c=r.url||this.url,u=r.responseType||this.responseType,s=r.transferCache??this.transferCache,x=r.body!==void 0?r.body:this.body,M=r.withCredentials??this.withCredentials,S=r.reportProgress??this.reportProgress,B=r.headers||this.headers,W=r.params||this.params,$=r.context??this.context;return r.setHeaders!==void 0&&(B=Object.keys(r.setHeaders).reduce((he,ge)=>he.set(ge,r.setHeaders[ge]),B)),r.setParams&&(W=Object.keys(r.setParams).reduce((he,ge)=>he.set(ge,r.setParams[ge]),W)),new t(i,c,x,{params:W,headers:B,context:$,reportProgress:S,responseType:u,withCredentials:M,transferCache:s})}},Ba=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Ba||{}),hf=class{headers;status;statusText;url;ok;type;constructor(r,i=200,c="OK"){this.headers=r.headers||new Go,this.status=r.status!==void 0?r.status:i,this.statusText=r.statusText||c,this.url=r.url||null,this.ok=this.status>=200&&this.status<300}},Xg=class t extends hf{constructor(r={}){super(r)}type=Ba.ResponseHeader;clone(r={}){return new t({headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},ec=class t extends hf{body;constructor(r={}){super(r),this.body=r.body!==void 0?r.body:null}type=Ba.Response;clone(r={}){return new t({body:r.body!==void 0?r.body:this.body,headers:r.headers||this.headers,status:r.status!==void 0?r.status:this.status,statusText:r.statusText||this.statusText,url:r.url||this.url||void 0})}},Fa=class extends hf{name="HttpErrorResponse";message;error;ok=!1;constructor(r){super(r,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${r.url||"(unknown url)"}`:this.message=`Http failure response for ${r.url||"(unknown url)"}: ${r.status} ${r.statusText}`,this.error=r.error||null}},XM=200,_z=204;function jb(t,r){return{body:r,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var Zb=(()=>{class t{handler;constructor(i){this.handler=i}request(i,c,u={}){let s;if(i instanceof cf)s=i;else{let S;u.headers instanceof Go?S=u.headers:S=new Go(u.headers);let B;u.params&&(u.params instanceof za?B=u.params:B=new za({fromObject:u.params})),s=new cf(i,c,u.body!==void 0?u.body:null,{headers:S,context:u.context,params:B,reportProgress:u.reportProgress,responseType:u.responseType||"json",withCredentials:u.withCredentials,transferCache:u.transferCache})}let x=yt(s).pipe(Ds(S=>this.handler.handle(S)));if(i instanceof cf||u.observe==="events")return x;let M=x.pipe(ni(S=>S instanceof ec));switch(u.observe||"body"){case"body":switch(s.responseType){case"arraybuffer":return M.pipe(Nt(S=>{if(S.body!==null&&!(S.body instanceof ArrayBuffer))throw new it(2806,!1);return S.body}));case"blob":return M.pipe(Nt(S=>{if(S.body!==null&&!(S.body instanceof Blob))throw new it(2807,!1);return S.body}));case"text":return M.pipe(Nt(S=>{if(S.body!==null&&typeof S.body!="string")throw new it(2808,!1);return S.body}));case"json":default:return M.pipe(Nt(S=>S.body))}case"response":return M;default:throw new it(2809,!1)}}delete(i,c={}){return this.request("DELETE",i,c)}get(i,c={}){return this.request("GET",i,c)}head(i,c={}){return this.request("HEAD",i,c)}jsonp(i,c){return this.request("JSONP",i,{params:new za().append(c,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(i,c={}){return this.request("OPTIONS",i,c)}patch(i,c,u={}){return this.request("PATCH",i,jb(u,c))}post(i,c,u={}){return this.request("POST",i,jb(u,c))}put(i,c,u={}){return this.request("PUT",i,jb(u,c))}static \u0275fac=function(c){return new(c||t)(ht(uf))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),vz=/^\)\]\}',?\n/;function UM(t){if(t.url)return t.url;let r=qb.toLocaleLowerCase();return t.headers.get(r)}var YM=new ot(""),Vb=(()=>{class t{fetchImpl=Le(Hb,{optional:!0})?.fetch??((...i)=>globalThis.fetch(...i));ngZone=Le(kn);handle(i){return new Xt(c=>{let u=new AbortController;return this.doRequest(i,u.signal,c).then(Gb,s=>c.error(new Fa({error:s}))),()=>u.abort()})}doRequest(i,c,u){return on(this,null,function*(){let s=this.createRequestInit(i),x;try{let ge=this.ngZone.runOutsideAngular(()=>this.fetchImpl(i.urlWithParams,et({signal:c},s)));bz(ge),u.next({type:Ba.Sent}),x=yield ge}catch(ge){u.error(new Fa({error:ge,status:ge.status??0,statusText:ge.statusText,url:i.urlWithParams,headers:ge.headers}));return}let M=new Go(x.headers),S=x.statusText,B=UM(x)??i.urlWithParams,W=x.status,$=null;if(i.reportProgress&&u.next(new Xg({headers:M,status:W,statusText:S,url:B})),x.body){let ge=x.headers.get("content-length"),ze=[],qe=x.body.getReader(),Ye=0,lt,gt,ft=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>on(this,null,function*(){for(;;){let{done:dt,value:Vt}=yield qe.read();if(dt)break;if(ze.push(Vt),Ye+=Vt.length,i.reportProgress){gt=i.responseType==="text"?(gt??"")+(lt??=new TextDecoder).decode(Vt,{stream:!0}):void 0;let ki=()=>u.next({type:Ba.DownloadProgress,total:ge?+ge:void 0,loaded:Ye,partialText:gt});ft?ft.run(ki):ki()}}}));let _t=this.concatChunks(ze,Ye);try{let dt=x.headers.get(lf)??"";$=this.parseBody(i,_t,dt)}catch(dt){u.error(new Fa({error:dt,headers:new Go(x.headers),status:x.status,statusText:x.statusText,url:UM(x)??i.urlWithParams}));return}}W===0&&(W=$?XM:0),W>=200&&W<300?(u.next(new ec({body:$,headers:M,status:W,statusText:S,url:B})),u.complete()):u.error(new Fa({error:$,headers:M,status:W,statusText:S,url:B}))})}parseBody(i,c,u){switch(i.responseType){case"json":let s=new TextDecoder().decode(c).replace(vz,"");return s===""?null:JSON.parse(s);case"text":return new TextDecoder().decode(c);case"blob":return new Blob([c],{type:u});case"arraybuffer":return c.buffer}}createRequestInit(i){let c={},u=i.withCredentials?"include":void 0;if(i.headers.forEach((s,x)=>c[s]=x.join(",")),i.headers.has(Wg)||(c[Wg]=WM),!i.headers.has(lf)){let s=i.detectContentTypeHeader();s!==null&&(c[lf]=s)}return{body:i.serializeBody(),method:i.method,headers:c,credentials:u}}concatChunks(i,c){let u=new Uint8Array(c),s=0;for(let x of i)u.set(x,s),s+=x.length;return u}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),Hb=class{};function Gb(){}function bz(t){t.then(Gb,Gb)}function xz(t,r){return r(t)}function wz(t,r,i){return(c,u)=>li(i,()=>r(c,s=>t(s,u)))}var KM=new ot(""),QM=new ot(""),Cz=new ot("",{providedIn:"root",factory:()=>!0});var $M=(()=>{class t extends uf{backend;injector;chain=null;pendingTasks=Le(Vo);contributeToStability=Le(Cz);constructor(i,c){super(),this.backend=i,this.injector=c}handle(i){if(this.chain===null){let c=Array.from(new Set([...this.injector.get(KM),...this.injector.get(QM,[])]));this.chain=c.reduceRight((u,s)=>wz(u,s,this.injector),xz)}if(this.contributeToStability){let c=this.pendingTasks.add();return this.chain(i,u=>this.backend.handle(u)).pipe(kl(()=>this.pendingTasks.remove(c)))}else return this.chain(i,c=>this.backend.handle(c))}static \u0275fac=function(c){return new(c||t)(ht(df),ht(Pr))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})();var Ez=/^\)\]\}',?\n/,Iz=RegExp(`^${qb}:`,"m");function Tz(t){return"responseURL"in t&&t.responseURL?t.responseURL:Iz.test(t.getAllResponseHeaders())?t.getResponseHeader(qb):null}var HM=(()=>{class t{xhrFactory;constructor(i){this.xhrFactory=i}handle(i){if(i.method==="JSONP")throw new it(-2800,!1);let c=this.xhrFactory;return(c.\u0275loadImpl?An(c.\u0275loadImpl()):yt(null)).pipe(ri(()=>new Xt(s=>{let x=c.build();if(x.open(i.method,i.urlWithParams),i.withCredentials&&(x.withCredentials=!0),i.headers.forEach((qe,Ye)=>x.setRequestHeader(qe,Ye.join(","))),i.headers.has(Wg)||x.setRequestHeader(Wg,WM),!i.headers.has(lf)){let qe=i.detectContentTypeHeader();qe!==null&&x.setRequestHeader(lf,qe)}if(i.responseType){let qe=i.responseType.toLowerCase();x.responseType=qe!=="json"?qe:"text"}let M=i.serializeBody(),S=null,B=()=>{if(S!==null)return S;let qe=x.statusText||"OK",Ye=new Go(x.getAllResponseHeaders()),lt=Tz(x)||i.url;return S=new Xg({headers:Ye,status:x.status,statusText:qe,url:lt}),S},W=()=>{let{headers:qe,status:Ye,statusText:lt,url:gt}=B(),ft=null;Ye!==_z&&(ft=typeof x.response>"u"?x.responseText:x.response),Ye===0&&(Ye=ft?XM:0);let _t=Ye>=200&&Ye<300;if(i.responseType==="json"&&typeof ft=="string"){let dt=ft;ft=ft.replace(Ez,"");try{ft=ft!==""?JSON.parse(ft):null}catch(Vt){ft=dt,_t&&(_t=!1,ft={error:Vt,text:ft})}}_t?(s.next(new ec({body:ft,headers:qe,status:Ye,statusText:lt,url:gt||void 0})),s.complete()):s.error(new Fa({error:ft,headers:qe,status:Ye,statusText:lt,url:gt||void 0}))},$=qe=>{let{url:Ye}=B(),lt=new Fa({error:qe,status:x.status||0,statusText:x.statusText||"Unknown Error",url:Ye||void 0});s.error(lt)},he=!1,ge=qe=>{he||(s.next(B()),he=!0);let Ye={type:Ba.DownloadProgress,loaded:qe.loaded};qe.lengthComputable&&(Ye.total=qe.total),i.responseType==="text"&&x.responseText&&(Ye.partialText=x.responseText),s.next(Ye)},ze=qe=>{let Ye={type:Ba.UploadProgress,loaded:qe.loaded};qe.lengthComputable&&(Ye.total=qe.total),s.next(Ye)};return x.addEventListener("load",W),x.addEventListener("error",$),x.addEventListener("timeout",$),x.addEventListener("abort",$),i.reportProgress&&(x.addEventListener("progress",ge),M!==null&&x.upload&&x.upload.addEventListener("progress",ze)),x.send(M),s.next({type:Ba.Sent}),()=>{x.removeEventListener("error",$),x.removeEventListener("abort",$),x.removeEventListener("load",W),x.removeEventListener("timeout",$),i.reportProgress&&(x.removeEventListener("progress",ge),M!==null&&x.upload&&x.upload.removeEventListener("progress",ze)),x.readyState!==x.DONE&&x.abort()}})))}static \u0275fac=function(c){return new(c||t)(ht(Hu))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),JM=new ot(""),Mz="XSRF-TOKEN",Dz=new ot("",{providedIn:"root",factory:()=>Mz}),Sz="X-XSRF-TOKEN",Pz=new ot("",{providedIn:"root",factory:()=>Sz}),Yg=class{},Az=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(i,c,u){this.doc=i,this.platform=c,this.cookieName=u}getToken(){if(this.platform==="server")return null;let i=this.doc.cookie||"";return i!==this.lastCookieString&&(this.parseCount++,this.lastToken=Gg(i,this.cookieName),this.lastCookieString=i),this.lastToken}static \u0275fac=function(c){return new(c||t)(ht(Ar),ht(Di),ht(Dz))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})();function Rz(t,r){let i=t.url.toLowerCase();if(!Le(JM)||t.method==="GET"||t.method==="HEAD"||i.startsWith("http://")||i.startsWith("https://"))return r(t);let c=Le(Yg).getToken(),u=Le(Pz);return c!=null&&!t.headers.has(u)&&(t=t.clone({headers:t.headers.set(u,c)})),r(t)}var eD=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(eD||{});function kz(t,r){return{\u0275kind:t,\u0275providers:r}}function tD(...t){let r=[Zb,HM,$M,{provide:uf,useExisting:$M},{provide:df,useFactory:()=>Le(YM,{optional:!0})??Le(HM)},{provide:KM,useValue:Rz,multi:!0},{provide:JM,useValue:!0},{provide:Yg,useClass:Az}];for(let i of t)r.push(...i.\u0275providers);return Aa(r)}function nD(){return kz(eD.Fetch,[Vb,{provide:YM,useExisting:Vb},{provide:df,useExisting:Vb}])}var Oz=new ot(""),Nz="b",Lz="h",Fz="s",zz="st",Bz="u",jz="rt",Zg=new ot(""),Vz=["GET","HEAD"];function Uz(t,r){let he=Le(Zg),{isCacheActive:i}=he,c=x1(he,["isCacheActive"]),{transferCache:u,method:s}=t;if(!i||u===!1||s==="POST"&&!c.includePostRequests&&!u||s!=="POST"&&!Vz.includes(s)||!c.includeRequestsWithAuthHeaders&&$z(t)||c.filter?.(t)===!1)return r(t);let x=Le(Xl);if(Le(Oz,{optional:!0}))throw new it(2803,!1);let S=t.url,B=Hz(t,S),W=x.get(B,null),$=c.includeHeaders;if(typeof u=="object"&&u.includeHeaders&&($=u.includeHeaders),W){let{[Nz]:ge,[jz]:ze,[Lz]:qe,[Fz]:Ye,[zz]:lt,[Bz]:gt}=W,ft=ge;switch(ze){case"arraybuffer":ft=new TextEncoder().encode(ge).buffer;break;case"blob":ft=new Blob([ge]);break}let _t=new Go(qe);return yt(new ec({body:ft,headers:_t,status:Ye,statusText:lt,url:gt}))}return r(t).pipe(lr(ge=>{ge instanceof ec}))}function $z(t){return t.headers.has("authorization")||t.headers.has("proxy-authorization")}function GM(t){return[...t.keys()].sort().map(r=>`${r}=${t.getAll(r)}`).join("&")}function Hz(t,r){let{params:i,method:c,responseType:u}=t,s=GM(i),x=t.serializeBody();x instanceof URLSearchParams?x=GM(x):typeof x!="string"&&(x="");let M=[c,u,r,x,s].join("|"),S=Gz(M);return S}function Gz(t){let r=0;for(let i of t)r=Math.imul(31,r)+i.charCodeAt(0)<<0;return r+=2147483648,r.toString()}function rD(t){return[{provide:Zg,useFactory:()=>(Oa("NgHttpTransferCache"),et({isCacheActive:!0},t))},{provide:QM,useValue:Uz,multi:!0,deps:[Xl,Zg]},{provide:La,multi:!0,useFactory:()=>{let r=Le(ai),i=Le(Zg);return()=>{r.whenStable().then(()=>{i.isCacheActive=!1})}}}]}var Xb=class extends $g{supportsDOMEvents=!0},Yb=class t extends Xb{static makeCurrent(){SM(new t)}onAndCancel(r,i,c,u){return r.addEventListener(i,c,u),()=>{r.removeEventListener(i,c,u)}}dispatchEvent(r,i){r.dispatchEvent(i)}remove(r){r.remove()}createElement(r,i){return i=i||this.getDefaultDocument(),i.createElement(r)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(r){return r.nodeType===Node.ELEMENT_NODE}isShadowRoot(r){return r instanceof DocumentFragment}getGlobalEventTarget(r,i){return i==="window"?window:i==="document"?r:i==="body"?r.body:null}getBaseHref(r){let i=Zz();return i==null?null:Wz(i)}resetBaseElement(){ff=null}getUserAgent(){return window.navigator.userAgent}getCookie(r){return Gg(document.cookie,r)}},ff=null;function Zz(){return ff=ff||document.querySelector("base"),ff?ff.getAttribute("href"):null}function Wz(t){return new URL(t,document.baseURI).pathname}var Xz=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),Kb=new ot(""),cD=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(i,c){this._zone=c,i.forEach(u=>{u.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,c,u,s){return this._findPluginFor(c).addEventListener(i,c,u,s)}getZone(){return this._zone}_findPluginFor(i){let c=this._eventNameToPlugin.get(i);if(c)return c;if(c=this._plugins.find(s=>s.supports(i)),!c)throw new it(5101,!1);return this._eventNameToPlugin.set(i,c),c}static \u0275fac=function(c){return new(c||t)(ht(Kb),ht(kn))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),Qg=class{_doc;constructor(r){this._doc=r}manager},Kg="ng-app-id";function iD(t){for(let r of t)r.remove()}function oD(t,r){let i=r.createElement("style");return i.textContent=t,i}function Yz(t,r,i,c){let u=t.head?.querySelectorAll(`style[${Kg}="${r}"],link[${Kg}="${r}"]`);if(u)for(let s of u)s.removeAttribute(Kg),s instanceof HTMLLinkElement?c.set(s.href.slice(s.href.lastIndexOf("/")+1),{usage:0,elements:[s]}):s.textContent&&i.set(s.textContent,{usage:0,elements:[s]})}function Qb(t,r){let i=r.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("href",t),i}var uD=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(i,c,u,s={}){this.doc=i,this.appId=c,this.nonce=u,this.isServer=Bb(s),Yz(i,c,this.inline,this.external),this.hosts.add(i.head)}addStyles(i,c){for(let u of i)this.addUsage(u,this.inline,oD);c?.forEach(u=>this.addUsage(u,this.external,Qb))}removeStyles(i,c){for(let u of i)this.removeUsage(u,this.inline);c?.forEach(u=>this.removeUsage(u,this.external))}addUsage(i,c,u){let s=c.get(i);s?s.usage++:c.set(i,{usage:1,elements:[...this.hosts].map(x=>this.addElement(x,u(i,this.doc)))})}removeUsage(i,c){let u=c.get(i);u&&(u.usage--,u.usage<=0&&(iD(u.elements),c.delete(i)))}ngOnDestroy(){for(let[,{elements:i}]of[...this.inline,...this.external])iD(i);this.hosts.clear()}addHost(i){this.hosts.add(i);for(let[c,{elements:u}]of this.inline)u.push(this.addElement(i,oD(c,this.doc)));for(let[c,{elements:u}]of this.external)u.push(this.addElement(i,Qb(c,this.doc)))}removeHost(i){this.hosts.delete(i)}addElement(i,c){return this.nonce&&c.setAttribute("nonce",this.nonce),this.isServer&&c.setAttribute(Kg,this.appId),i.appendChild(c)}static \u0275fac=function(c){return new(c||t)(ht(Ar),ht(Hl),ht(eb,8),ht(Di))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),Wb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},ex=/%COMP%/g;var dD="%COMP%",Kz=`_nghost-${dD}`,Qz=`_ngcontent-${dD}`,Jz=!0,eB=new ot("",{providedIn:"root",factory:()=>Jz});function tB(t){return Qz.replace(ex,t)}function nB(t){return Kz.replace(ex,t)}function hD(t,r){return r.map(i=>i.replace(ex,t))}var sD=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(i,c,u,s,x,M,S,B=null,W=null){this.eventManager=i,this.sharedStylesHost=c,this.appId=u,this.removeStylesOnCompDestroy=s,this.doc=x,this.platformId=M,this.ngZone=S,this.nonce=B,this.tracingService=W,this.platformIsServer=Bb(M),this.defaultRenderer=new pf(i,x,S,this.platformIsServer,this.tracingService)}createRenderer(i,c){if(!i||!c)return this.defaultRenderer;this.platformIsServer&&c.encapsulation===Bo.ShadowDom&&(c=wn(et({},c),{encapsulation:Bo.Emulated}));let u=this.getOrCreateRenderer(i,c);return u instanceof Jg?u.applyToHost(i):u instanceof mf&&u.applyStyles(),u}getOrCreateRenderer(i,c){let u=this.rendererByCompId,s=u.get(c.id);if(!s){let x=this.doc,M=this.ngZone,S=this.eventManager,B=this.sharedStylesHost,W=this.removeStylesOnCompDestroy,$=this.platformIsServer,he=this.tracingService;switch(c.encapsulation){case Bo.Emulated:s=new Jg(S,B,c,this.appId,W,x,M,$,he);break;case Bo.ShadowDom:return new Jb(S,B,i,c,x,M,this.nonce,$,he);default:s=new mf(S,B,c,W,x,M,$,he);break}u.set(c.id,s)}return s}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(i){this.rendererByCompId.delete(i)}static \u0275fac=function(c){return new(c||t)(ht(cD),ht(uD),ht(Hl),ht(eB),ht(Ar),ht(Di),ht(kn),ht(eb),ht(zu,8))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),pf=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(r,i,c,u,s){this.eventManager=r,this.doc=i,this.ngZone=c,this.platformIsServer=u,this.tracingService=s}destroy(){}destroyNode=null;createElement(r,i){return i?this.doc.createElementNS(Wb[i]||i,r):this.doc.createElement(r)}createComment(r){return this.doc.createComment(r)}createText(r){return this.doc.createTextNode(r)}appendChild(r,i){(aD(r)?r.content:r).appendChild(i)}insertBefore(r,i,c){r&&(aD(r)?r.content:r).insertBefore(i,c)}removeChild(r,i){i.remove()}selectRootElement(r,i){let c=typeof r=="string"?this.doc.querySelector(r):r;if(!c)throw new it(-5104,!1);return i||(c.textContent=""),c}parentNode(r){return r.parentNode}nextSibling(r){return r.nextSibling}setAttribute(r,i,c,u){if(u){i=u+":"+i;let s=Wb[u];s?r.setAttributeNS(s,i,c):r.setAttribute(i,c)}else r.setAttribute(i,c)}removeAttribute(r,i,c){if(c){let u=Wb[c];u?r.removeAttributeNS(u,i):r.removeAttribute(`${c}:${i}`)}else r.removeAttribute(i)}addClass(r,i){r.classList.add(i)}removeClass(r,i){r.classList.remove(i)}setStyle(r,i,c,u){u&(Ls.DashCase|Ls.Important)?r.style.setProperty(i,c,u&Ls.Important?"important":""):r.style[i]=c}removeStyle(r,i,c){c&Ls.DashCase?r.style.removeProperty(i):r.style[i]=""}setProperty(r,i,c){r!=null&&(r[i]=c)}setValue(r,i){r.nodeValue=i}listen(r,i,c,u){if(typeof r=="string"&&(r=$u().getGlobalEventTarget(this.doc,r),!r))throw new Error(`Unsupported event target ${r} for event ${i}`);let s=this.decoratePreventDefault(c);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(s=this.tracingService.wrapEventListener(r,i,s)),this.eventManager.addEventListener(r,i,s,u)}decoratePreventDefault(r){return i=>{if(i==="__ngUnwrap__")return r;(this.platformIsServer?this.ngZone.runGuarded(()=>r(i)):r(i))===!1&&i.preventDefault()}}};function aD(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var Jb=class extends pf{sharedStylesHost;hostEl;shadowRoot;constructor(r,i,c,u,s,x,M,S,B){super(r,s,x,S,B),this.sharedStylesHost=i,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let W=u.styles;W=hD(u.id,W);for(let he of W){let ge=document.createElement("style");M&&ge.setAttribute("nonce",M),ge.textContent=he,this.shadowRoot.appendChild(ge)}let $=u.getExternalStyles?.();if($)for(let he of $){let ge=Qb(he,s);M&&ge.setAttribute("nonce",M),this.shadowRoot.appendChild(ge)}}nodeOrShadowRoot(r){return r===this.hostEl?this.shadowRoot:r}appendChild(r,i){return super.appendChild(this.nodeOrShadowRoot(r),i)}insertBefore(r,i,c){return super.insertBefore(this.nodeOrShadowRoot(r),i,c)}removeChild(r,i){return super.removeChild(null,i)}parentNode(r){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(r)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},mf=class extends pf{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(r,i,c,u,s,x,M,S,B){super(r,s,x,M,S),this.sharedStylesHost=i,this.removeStylesOnCompDestroy=u;let W=c.styles;this.styles=B?hD(B,W):W,this.styleUrls=c.getExternalStyles?.(B)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Jg=class extends mf{contentAttr;hostAttr;constructor(r,i,c,u,s,x,M,S,B){let W=u+"-"+c.id;super(r,i,c,s,x,M,S,B,W),this.contentAttr=tB(W),this.hostAttr=nB(W)}applyToHost(r){this.applyStyles(),this.setAttribute(r,this.hostAttr,"")}createElement(r,i){let c=super.createElement(r,i);return super.setAttribute(c,this.contentAttr,""),c}},rB=(()=>{class t extends Qg{constructor(i){super(i)}supports(i){return!0}addEventListener(i,c,u,s){return i.addEventListener(c,u,s),()=>this.removeEventListener(i,c,u,s)}removeEventListener(i,c,u,s){return i.removeEventListener(c,u,s)}static \u0275fac=function(c){return new(c||t)(ht(Ar))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})(),lD=["alt","control","meta","shift"],iB={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},oB={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},sB=(()=>{class t extends Qg{constructor(i){super(i)}supports(i){return t.parseEventName(i)!=null}addEventListener(i,c,u,s){let x=t.parseEventName(c),M=t.eventCallback(x.fullKey,u,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$u().onAndCancel(i,x.domEventName,M,s))}static parseEventName(i){let c=i.toLowerCase().split("."),u=c.shift();if(c.length===0||!(u==="keydown"||u==="keyup"))return null;let s=t._normalizeKey(c.pop()),x="",M=c.indexOf("code");if(M>-1&&(c.splice(M,1),x="code."),lD.forEach(B=>{let W=c.indexOf(B);W>-1&&(c.splice(W,1),x+=B+".")}),x+=s,c.length!=0||s.length===0)return null;let S={};return S.domEventName=u,S.fullKey=x,S}static matchEventFullKeyCode(i,c){let u=iB[i.key]||i.key,s="";return c.indexOf("code.")>-1&&(u=i.code,s="code."),u==null||!u?!1:(u=u.toLowerCase(),u===" "?u="space":u==="."&&(u="dot"),lD.forEach(x=>{if(x!==u){let M=oB[x];M(i)&&(s+=x+".")}}),s+=u,s===c)}static eventCallback(i,c,u){return s=>{t.matchEventFullKeyCode(s,i)&&u.runGuarded(()=>c(s))}}static _normalizeKey(i){return i==="esc"?"escape":i}static \u0275fac=function(c){return new(c||t)(ht(Ar))};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})();function fD(t,r){return yM(et({rootComponent:t},aB(r)))}function aB(t){return{appProviders:[...hB,...t?.providers??[]],platformProviders:dB}}function lB(){Yb.makeCurrent()}function cB(){return new Ns}function uB(){return UI(document),document}var dB=[{provide:Di,useValue:zb},{provide:J0,useValue:lB,multi:!0},{provide:Ar,useFactory:uB,deps:[]}];var hB=[{provide:bg,useValue:"root"},{provide:Ns,useFactory:cB,deps:[]},{provide:Kb,useClass:rB,multi:!0,deps:[Ar,kn,Di]},{provide:Kb,useClass:sB,multi:!0,deps:[Ar]},sD,uD,cD,{provide:Su,useExisting:sD},{provide:Hu,useClass:Xz,deps:[]},[]];var pD=(()=>{class t{_doc;constructor(i){this._doc=i}getTitle(){return this._doc.title}setTitle(i){this._doc.title=i||""}static \u0275fac=function(c){return new(c||t)(ht(Ar))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var ey=function(t){return t[t.NoHttpTransferCache=0]="NoHttpTransferCache",t[t.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",t[t.I18nSupport=2]="I18nSupport",t[t.EventReplay=3]="EventReplay",t[t.IncrementalHydration=4]="IncrementalHydration",t}(ey||{});function fB(t,r=[],i={}){return{\u0275kind:t,\u0275providers:r}}function mD(){return fB(ey.EventReplay,_M())}function gD(...t){let r=[],i=new Set,c=i.has(ey.HttpTransferCacheOptions);for(let{\u0275providers:u,\u0275kind:s}of t)i.add(s),u.length&&r.push(u);return Aa([[],vM(),i.has(ey.NoHttpTransferCache)||c?[]:rD({}),r])}var Rt="primary",Sf=Symbol("RouteTitle"),ox=class{params;constructor(r){this.params=r||{}}has(r){return Object.prototype.hasOwnProperty.call(this.params,r)}get(r){if(this.has(r)){let i=this.params[r];return Array.isArray(i)?i[0]:i}return null}getAll(r){if(this.has(r)){let i=this.params[r];return Array.isArray(i)?i:[i]}return[]}get keys(){return Object.keys(this.params)}};function Qu(t){return new ox(t)}function mB(t,r,i){let c=i.path.split("/");if(c.length>t.length||i.pathMatch==="full"&&(r.hasChildren()||c.length<t.length))return null;let u={};for(let s=0;s<c.length;s++){let x=c[s],M=t[s];if(x[0]===":")u[x.substring(1)]=M;else if(x!==M.path)return null}return{consumed:t.slice(0,c.length),posParams:u}}function gB(t,r){if(t.length!==r.length)return!1;for(let i=0;i<t.length;++i)if(!qo(t[i],r[i]))return!1;return!0}function qo(t,r){let i=t?sx(t):void 0,c=r?sx(r):void 0;if(!i||!c||i.length!=c.length)return!1;let u;for(let s=0;s<i.length;s++)if(u=i[s],!TD(t[u],r[u]))return!1;return!0}function sx(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function TD(t,r){if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return!1;let i=[...t].sort(),c=[...r].sort();return i.every((u,s)=>c[s]===u)}else return t===r}function MD(t){return t.length>0?t[t.length-1]:null}function Va(t){return cv(t)?t:ef(t)?An(Promise.resolve(t)):yt(t)}var yB={exact:SD,subset:PD},DD={exact:_B,subset:vB,ignored:()=>!0};function yD(t,r,i){return yB[i.paths](t.root,r.root,i.matrixParams)&&DD[i.queryParams](t.queryParams,r.queryParams)&&!(i.fragment==="exact"&&t.fragment!==r.fragment)}function _B(t,r){return qo(t,r)}function SD(t,r,i){if(!nc(t.segments,r.segments)||!ry(t.segments,r.segments,i)||t.numberOfChildren!==r.numberOfChildren)return!1;for(let c in r.children)if(!t.children[c]||!SD(t.children[c],r.children[c],i))return!1;return!0}function vB(t,r){return Object.keys(r).length<=Object.keys(t).length&&Object.keys(r).every(i=>TD(t[i],r[i]))}function PD(t,r,i){return AD(t,r,r.segments,i)}function AD(t,r,i,c){if(t.segments.length>i.length){let u=t.segments.slice(0,i.length);return!(!nc(u,i)||r.hasChildren()||!ry(u,i,c))}else if(t.segments.length===i.length){if(!nc(t.segments,i)||!ry(t.segments,i,c))return!1;for(let u in r.children)if(!t.children[u]||!PD(t.children[u],r.children[u],c))return!1;return!0}else{let u=i.slice(0,t.segments.length),s=i.slice(t.segments.length);return!nc(t.segments,u)||!ry(t.segments,u,c)||!t.children[Rt]?!1:AD(t.children[Rt],r,s,c)}}function ry(t,r,i){return r.every((c,u)=>DD[i](t[u].parameters,c.parameters))}var Us=class{root;queryParams;fragment;_queryParamMap;constructor(r=new sn([],{}),i={},c=null){this.root=r,this.queryParams=i,this.fragment=c}get queryParamMap(){return this._queryParamMap??=Qu(this.queryParams),this._queryParamMap}toString(){return wB.serialize(this)}},sn=class{segments;children;parent=null;constructor(r,i){this.segments=r,this.children=i,Object.values(i).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return iy(this)}},tc=class{path;parameters;_parameterMap;constructor(r,i){this.path=r,this.parameters=i}get parameterMap(){return this._parameterMap??=Qu(this.parameters),this._parameterMap}toString(){return kD(this)}};function bB(t,r){return nc(t,r)&&t.every((i,c)=>qo(i.parameters,r[c].parameters))}function nc(t,r){return t.length!==r.length?!1:t.every((i,c)=>i.path===r[c].path)}function xB(t,r){let i=[];return Object.entries(t.children).forEach(([c,u])=>{c===Rt&&(i=i.concat(r(u,c)))}),Object.entries(t.children).forEach(([c,u])=>{c!==Rt&&(i=i.concat(r(u,c)))}),i}var Pf=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>new Ju,providedIn:"root"})}return t})(),Ju=class{parse(r){let i=new lx(r);return new Us(i.parseRootSegment(),i.parseQueryParams(),i.parseFragment())}serialize(r){let i=`/${gf(r.root,!0)}`,c=IB(r.queryParams),u=typeof r.fragment=="string"?`#${CB(r.fragment)}`:"";return`${i}${c}${u}`}},wB=new Ju;function iy(t){return t.segments.map(r=>kD(r)).join("/")}function gf(t,r){if(!t.hasChildren())return iy(t);if(r){let i=t.children[Rt]?gf(t.children[Rt],!1):"",c=[];return Object.entries(t.children).forEach(([u,s])=>{u!==Rt&&c.push(`${u}:${gf(s,!1)}`)}),c.length>0?`${i}(${c.join("//")})`:i}else{let i=xB(t,(c,u)=>u===Rt?[gf(t.children[Rt],!1)]:[`${u}:${gf(c,!1)}`]);return Object.keys(t.children).length===1&&t.children[Rt]!=null?`${iy(t)}/${i[0]}`:`${iy(t)}/(${i.join("//")})`}}function RD(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ty(t){return RD(t).replace(/%3B/gi,";")}function CB(t){return encodeURI(t)}function ax(t){return RD(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function oy(t){return decodeURIComponent(t)}function _D(t){return oy(t.replace(/\+/g,"%20"))}function kD(t){return`${ax(t.path)}${EB(t.parameters)}`}function EB(t){return Object.entries(t).map(([r,i])=>`;${ax(r)}=${ax(i)}`).join("")}function IB(t){let r=Object.entries(t).map(([i,c])=>Array.isArray(c)?c.map(u=>`${ty(i)}=${ty(u)}`).join("&"):`${ty(i)}=${ty(c)}`).filter(i=>i);return r.length?`?${r.join("&")}`:""}var TB=/^[^\/()?;#]+/;function tx(t){let r=t.match(TB);return r?r[0]:""}var MB=/^[^\/()?;=#]+/;function DB(t){let r=t.match(MB);return r?r[0]:""}var SB=/^[^=?&#]+/;function PB(t){let r=t.match(SB);return r?r[0]:""}var AB=/^[^&#]+/;function RB(t){let r=t.match(AB);return r?r[0]:""}var lx=class{url;remaining;constructor(r){this.url=r,this.remaining=r}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new sn([],{}):new sn([],this.parseChildren())}parseQueryParams(){let r={};if(this.consumeOptional("?"))do this.parseQueryParam(r);while(this.consumeOptional("&"));return r}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let r=[];for(this.peekStartsWith("(")||r.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),r.push(this.parseSegment());let i={};this.peekStartsWith("/(")&&(this.capture("/"),i=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(r.length>0||Object.keys(i).length>0)&&(c[Rt]=new sn(r,i)),c}parseSegment(){let r=tx(this.remaining);if(r===""&&this.peekStartsWith(";"))throw new it(4009,!1);return this.capture(r),new tc(oy(r),this.parseMatrixParams())}parseMatrixParams(){let r={};for(;this.consumeOptional(";");)this.parseParam(r);return r}parseParam(r){let i=DB(this.remaining);if(!i)return;this.capture(i);let c="";if(this.consumeOptional("=")){let u=tx(this.remaining);u&&(c=u,this.capture(c))}r[oy(i)]=oy(c)}parseQueryParam(r){let i=PB(this.remaining);if(!i)return;this.capture(i);let c="";if(this.consumeOptional("=")){let x=RB(this.remaining);x&&(c=x,this.capture(c))}let u=_D(i),s=_D(c);if(r.hasOwnProperty(u)){let x=r[u];Array.isArray(x)||(x=[x],r[u]=x),x.push(s)}else r[u]=s}parseParens(r){let i={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=tx(this.remaining),u=this.remaining[c.length];if(u!=="/"&&u!==")"&&u!==";")throw new it(4010,!1);let s;c.indexOf(":")>-1?(s=c.slice(0,c.indexOf(":")),this.capture(s),this.capture(":")):r&&(s=Rt);let x=this.parseChildren();i[s]=Object.keys(x).length===1?x[Rt]:new sn([],x),this.consumeOptional("//")}return i}peekStartsWith(r){return this.remaining.startsWith(r)}consumeOptional(r){return this.peekStartsWith(r)?(this.remaining=this.remaining.substring(r.length),!0):!1}capture(r){if(!this.consumeOptional(r))throw new it(4011,!1)}};function OD(t){return t.segments.length>0?new sn([],{[Rt]:t}):t}function ND(t){let r={};for(let[c,u]of Object.entries(t.children)){let s=ND(u);if(c===Rt&&s.segments.length===0&&s.hasChildren())for(let[x,M]of Object.entries(s.children))r[x]=M;else(s.segments.length>0||s.hasChildren())&&(r[c]=s)}let i=new sn(t.segments,r);return kB(i)}function kB(t){if(t.numberOfChildren===1&&t.children[Rt]){let r=t.children[Rt];return new sn(t.segments.concat(r.segments),r.children)}return t}function rc(t){return t instanceof Us}function OB(t,r,i=null,c=null){let u=LD(t);return FD(u,r,i,c)}function LD(t){let r;function i(s){let x={};for(let S of s.children){let B=i(S);x[S.outlet]=B}let M=new sn(s.url,x);return s===t&&(r=M),M}let c=i(t.root),u=OD(c);return r??u}function FD(t,r,i,c){let u=t;for(;u.parent;)u=u.parent;if(r.length===0)return nx(u,u,u,i,c);let s=NB(r);if(s.toRoot())return nx(u,u,new sn([],{}),i,c);let x=LB(s,u,t),M=x.processChildren?_f(x.segmentGroup,x.index,s.commands):BD(x.segmentGroup,x.index,s.commands);return nx(u,x.segmentGroup,M,i,c)}function sy(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function xf(t){return typeof t=="object"&&t!=null&&t.outlets}function nx(t,r,i,c,u){let s={};c&&Object.entries(c).forEach(([S,B])=>{s[S]=Array.isArray(B)?B.map(W=>`${W}`):`${B}`});let x;t===r?x=i:x=zD(t,r,i);let M=OD(ND(x));return new Us(M,s,u)}function zD(t,r,i){let c={};return Object.entries(t.children).forEach(([u,s])=>{s===r?c[u]=i:c[u]=zD(s,r,i)}),new sn(t.segments,c)}var ay=class{isAbsolute;numberOfDoubleDots;commands;constructor(r,i,c){if(this.isAbsolute=r,this.numberOfDoubleDots=i,this.commands=c,r&&c.length>0&&sy(c[0]))throw new it(4003,!1);let u=c.find(xf);if(u&&u!==MD(c))throw new it(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function NB(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new ay(!0,0,t);let r=0,i=!1,c=t.reduce((u,s,x)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let M={};return Object.entries(s.outlets).forEach(([S,B])=>{M[S]=typeof B=="string"?B.split("/"):B}),[...u,{outlets:M}]}if(s.segmentPath)return[...u,s.segmentPath]}return typeof s!="string"?[...u,s]:x===0?(s.split("/").forEach((M,S)=>{S==0&&M==="."||(S==0&&M===""?i=!0:M===".."?r++:M!=""&&u.push(M))}),u):[...u,s]},[]);return new ay(i,r,c)}var Xu=class{segmentGroup;processChildren;index;constructor(r,i,c){this.segmentGroup=r,this.processChildren=i,this.index=c}};function LB(t,r,i){if(t.isAbsolute)return new Xu(r,!0,0);if(!i)return new Xu(r,!1,NaN);if(i.parent===null)return new Xu(i,!0,0);let c=sy(t.commands[0])?0:1,u=i.segments.length-1+c;return FB(i,u,t.numberOfDoubleDots)}function FB(t,r,i){let c=t,u=r,s=i;for(;s>u;){if(s-=u,c=c.parent,!c)throw new it(4005,!1);u=c.segments.length}return new Xu(c,!1,u-s)}function zB(t){return xf(t[0])?t[0].outlets:{[Rt]:t}}function BD(t,r,i){if(t??=new sn([],{}),t.segments.length===0&&t.hasChildren())return _f(t,r,i);let c=BB(t,r,i),u=i.slice(c.commandIndex);if(c.match&&c.pathIndex<t.segments.length){let s=new sn(t.segments.slice(0,c.pathIndex),{});return s.children[Rt]=new sn(t.segments.slice(c.pathIndex),t.children),_f(s,0,u)}else return c.match&&u.length===0?new sn(t.segments,{}):c.match&&!t.hasChildren()?cx(t,r,i):c.match?_f(t,0,u):cx(t,r,i)}function _f(t,r,i){if(i.length===0)return new sn(t.segments,{});{let c=zB(i),u={};if(Object.keys(c).some(s=>s!==Rt)&&t.children[Rt]&&t.numberOfChildren===1&&t.children[Rt].segments.length===0){let s=_f(t.children[Rt],r,i);return new sn(t.segments,s.children)}return Object.entries(c).forEach(([s,x])=>{typeof x=="string"&&(x=[x]),x!==null&&(u[s]=BD(t.children[s],r,x))}),Object.entries(t.children).forEach(([s,x])=>{c[s]===void 0&&(u[s]=x)}),new sn(t.segments,u)}}function BB(t,r,i){let c=0,u=r,s={match:!1,pathIndex:0,commandIndex:0};for(;u<t.segments.length;){if(c>=i.length)return s;let x=t.segments[u],M=i[c];if(xf(M))break;let S=`${M}`,B=c<i.length-1?i[c+1]:null;if(u>0&&S===void 0)break;if(S&&B&&typeof B=="object"&&B.outlets===void 0){if(!bD(S,B,x))return s;c+=2}else{if(!bD(S,{},x))return s;c++}u++}return{match:!0,pathIndex:u,commandIndex:c}}function cx(t,r,i){let c=t.segments.slice(0,r),u=0;for(;u<i.length;){let s=i[u];if(xf(s)){let S=jB(s.outlets);return new sn(c,S)}if(u===0&&sy(i[0])){let S=t.segments[r];c.push(new tc(S.path,vD(i[0]))),u++;continue}let x=xf(s)?s.outlets[Rt]:`${s}`,M=u<i.length-1?i[u+1]:null;x&&M&&sy(M)?(c.push(new tc(x,vD(M))),u+=2):(c.push(new tc(x,{})),u++)}return new sn(c,{})}function jB(t){let r={};return Object.entries(t).forEach(([i,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(r[i]=cx(new sn([],{}),0,c))}),r}function vD(t){let r={};return Object.entries(t).forEach(([i,c])=>r[i]=`${c}`),r}function bD(t,r,i){return t==i.path&&qo(r,i.parameters)}var vf="imperative",wr=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(wr||{}),Zi=class{id;url;constructor(r,i){this.id=r,this.url=i}},ed=class extends Zi{type=wr.NavigationStart;navigationTrigger;restoredState;constructor(r,i,c="imperative",u=null){super(r,i),this.navigationTrigger=c,this.restoredState=u}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Zo=class extends Zi{urlAfterRedirects;type=wr.NavigationEnd;constructor(r,i,c){super(r,i),this.urlAfterRedirects=c}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Ri=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(Ri||{}),ly=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(ly||{}),Vs=class extends Zi{reason;code;type=wr.NavigationCancel;constructor(r,i,c,u){super(r,i),this.reason=c,this.code=u}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ja=class extends Zi{reason;code;type=wr.NavigationSkipped;constructor(r,i,c,u){super(r,i),this.reason=c,this.code=u}},wf=class extends Zi{error;target;type=wr.NavigationError;constructor(r,i,c,u){super(r,i),this.error=c,this.target=u}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},cy=class extends Zi{urlAfterRedirects;state;type=wr.RoutesRecognized;constructor(r,i,c,u){super(r,i),this.urlAfterRedirects=c,this.state=u}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ux=class extends Zi{urlAfterRedirects;state;type=wr.GuardsCheckStart;constructor(r,i,c,u){super(r,i),this.urlAfterRedirects=c,this.state=u}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},dx=class extends Zi{urlAfterRedirects;state;shouldActivate;type=wr.GuardsCheckEnd;constructor(r,i,c,u,s){super(r,i),this.urlAfterRedirects=c,this.state=u,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},hx=class extends Zi{urlAfterRedirects;state;type=wr.ResolveStart;constructor(r,i,c,u){super(r,i),this.urlAfterRedirects=c,this.state=u}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},fx=class extends Zi{urlAfterRedirects;state;type=wr.ResolveEnd;constructor(r,i,c,u){super(r,i),this.urlAfterRedirects=c,this.state=u}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},px=class{route;type=wr.RouteConfigLoadStart;constructor(r){this.route=r}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},mx=class{route;type=wr.RouteConfigLoadEnd;constructor(r){this.route=r}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},gx=class{snapshot;type=wr.ChildActivationStart;constructor(r){this.snapshot=r}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},yx=class{snapshot;type=wr.ChildActivationEnd;constructor(r){this.snapshot=r}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},_x=class{snapshot;type=wr.ActivationStart;constructor(r){this.snapshot=r}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},vx=class{snapshot;type=wr.ActivationEnd;constructor(r){this.snapshot=r}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uy=class{routerEvent;position;anchor;type=wr.Scroll;constructor(r,i,c){this.routerEvent=r,this.position=i,this.anchor=c}toString(){let r=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${r}')`}},Cf=class{},td=class{url;navigationBehaviorOptions;constructor(r,i){this.url=r,this.navigationBehaviorOptions=i}};function VB(t,r){return t.providers&&!t._injector&&(t._injector=Jh(t.providers,r,`Route: ${t.path}`)),t._injector??r}function vo(t){return t.outlet||Rt}function UB(t,r){let i=t.filter(c=>vo(c)===r);return i.push(...t.filter(c=>vo(c)!==r)),i}function Af(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let r=t.parent;r;r=r.parent){let i=r.routeConfig;if(i?._loadedInjector)return i._loadedInjector;if(i?._injector)return i._injector}return null}var bx=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Af(this.route?.snapshot)??this.rootInjector}constructor(r){this.rootInjector=r,this.children=new Rf(this.rootInjector)}},Rf=(()=>{class t{rootInjector;contexts=new Map;constructor(i){this.rootInjector=i}onChildOutletCreated(i,c){let u=this.getOrCreateContext(i);u.outlet=c,this.contexts.set(i,u)}onChildOutletDestroyed(i){let c=this.getContext(i);c&&(c.outlet=null,c.attachRef=null)}onOutletDeactivated(){let i=this.contexts;return this.contexts=new Map,i}onOutletReAttached(i){this.contexts=i}getOrCreateContext(i){let c=this.getContext(i);return c||(c=new bx(this.rootInjector),this.contexts.set(i,c)),c}getContext(i){return this.contexts.get(i)||null}static \u0275fac=function(c){return new(c||t)(ht(Pr))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),dy=class{_root;constructor(r){this._root=r}get root(){return this._root.value}parent(r){let i=this.pathFromRoot(r);return i.length>1?i[i.length-2]:null}children(r){let i=xx(r,this._root);return i?i.children.map(c=>c.value):[]}firstChild(r){let i=xx(r,this._root);return i&&i.children.length>0?i.children[0].value:null}siblings(r){let i=wx(r,this._root);return i.length<2?[]:i[i.length-2].children.map(u=>u.value).filter(u=>u!==r)}pathFromRoot(r){return wx(r,this._root).map(i=>i.value)}};function xx(t,r){if(t===r.value)return r;for(let i of r.children){let c=xx(t,i);if(c)return c}return null}function wx(t,r){if(t===r.value)return[r];for(let i of r.children){let c=wx(t,i);if(c.length)return c.unshift(r),c}return[]}var Ai=class{value;children;constructor(r,i){this.value=r,this.children=i}toString(){return`TreeNode(${this.value})`}};function Wu(t){let r={};return t&&t.children.forEach(i=>r[i.value.outlet]=i),r}var hy=class extends dy{snapshot;constructor(r,i){super(r),this.snapshot=i,Ax(this,r)}toString(){return this.snapshot.toString()}};function jD(t){let r=$B(t),i=new Tr([new tc("",{})]),c=new Tr({}),u=new Tr({}),s=new Tr({}),x=new Tr(""),M=new tr(i,c,s,x,u,Rt,t,r.root);return M.snapshot=r.root,new hy(new Ai(M,[]),r)}function $B(t){let r={},i={},c={},u="",s=new Yu([],r,c,u,i,Rt,t,null,{});return new py("",new Ai(s,[]))}var tr=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(r,i,c,u,s,x,M,S){this.urlSubject=r,this.paramsSubject=i,this.queryParamsSubject=c,this.fragmentSubject=u,this.dataSubject=s,this.outlet=x,this.component=M,this._futureSnapshot=S,this.title=this.dataSubject?.pipe(Nt(B=>B[Sf]))??yt(void 0),this.url=r,this.params=i,this.queryParams=c,this.fragment=u,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Nt(r=>Qu(r))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Nt(r=>Qu(r))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function fy(t,r,i="emptyOnly"){let c,{routeConfig:u}=t;return r!==null&&(i==="always"||u?.path===""||!r.component&&!r.routeConfig?.loadComponent)?c={params:et(et({},r.params),t.params),data:et(et({},r.data),t.data),resolve:et(et(et(et({},t.data),r.data),u?.data),t._resolvedData)}:c={params:et({},t.params),data:et({},t.data),resolve:et(et({},t.data),t._resolvedData??{})},u&&UD(u)&&(c.resolve[Sf]=u.title),c}var Yu=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Sf]}constructor(r,i,c,u,s,x,M,S,B){this.url=r,this.params=i,this.queryParams=c,this.fragment=u,this.data=s,this.outlet=x,this.component=M,this.routeConfig=S,this._resolve=B}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Qu(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Qu(this.queryParams),this._queryParamMap}toString(){let r=this.url.map(c=>c.toString()).join("/"),i=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${r}', path:'${i}')`}},py=class extends dy{url;constructor(r,i){super(i),this.url=r,Ax(this,i)}toString(){return VD(this._root)}};function Ax(t,r){r.value._routerState=t,r.children.forEach(i=>Ax(t,i))}function VD(t){let r=t.children.length>0?` { ${t.children.map(VD).join(", ")} } `:"";return`${t.value}${r}`}function rx(t){if(t.snapshot){let r=t.snapshot,i=t._futureSnapshot;t.snapshot=i,qo(r.queryParams,i.queryParams)||t.queryParamsSubject.next(i.queryParams),r.fragment!==i.fragment&&t.fragmentSubject.next(i.fragment),qo(r.params,i.params)||t.paramsSubject.next(i.params),gB(r.url,i.url)||t.urlSubject.next(i.url),qo(r.data,i.data)||t.dataSubject.next(i.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Cx(t,r){let i=qo(t.params,r.params)&&bB(t.url,r.url),c=!t.parent!=!r.parent;return i&&!c&&(!t.parent||Cx(t.parent,r.parent))}function UD(t){return typeof t.title=="string"||t.title===null}var HB=new ot(""),Rx=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=Rt;activateEvents=new Rn;deactivateEvents=new Rn;attachEvents=new Rn;detachEvents=new Rn;routerOutletData=OI(void 0);parentContexts=Le(Rf);location=Le(Na);changeDetector=Le(rf);inputBinder=Le(_y,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(i){if(i.name){let{firstChange:c,previousValue:u}=i.name;if(c)return;this.isTrackedInParentContexts(u)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(u)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(i){return this.parentContexts.getContext(i)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let i=this.parentContexts.getContext(this.name);i?.route&&(i.attachRef?this.attach(i.attachRef,i.route):this.activateWith(i.route,i.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new it(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new it(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new it(4012,!1);this.location.detach();let i=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(i.instance),i}attach(i,c){this.activated=i,this._activatedRoute=c,this.location.insert(i.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(i.instance)}deactivate(){if(this.activated){let i=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(i)}}activateWith(i,c){if(this.isActivated)throw new it(4013,!1);this._activatedRoute=i;let u=this.location,x=i.snapshot.component,M=this.parentContexts.getOrCreateContext(this.name).children,S=new Ex(i,M,u.injector,this.routerOutletData);this.activated=u.createComponent(x,{index:u.length,injector:S,environmentInjector:c}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(c){return new(c||t)};static \u0275dir=Ql({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[wg]})}return t})(),Ex=class t{route;childContexts;parent;outletData;__ngOutletInjector(r){return new t(this.route,this.childContexts,r,this.outletData)}constructor(r,i,c,u){this.route=r,this.childContexts=i,this.parent=c,this.outletData=u}get(r,i){return r===tr?this.route:r===Rf?this.childContexts:r===HB?this.outletData:this.parent.get(r,i)}},_y=new ot(""),xD=(()=>{class t{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(i){this.unsubscribeFromRouteData(i),this.subscribeToRouteData(i)}unsubscribeFromRouteData(i){this.outletDataSubscriptions.get(i)?.unsubscribe(),this.outletDataSubscriptions.delete(i)}subscribeToRouteData(i){let{activatedRoute:c}=i,u=kh([c.queryParams,c.params,c.data]).pipe(ri(([s,x,M],S)=>(M=et(et(et({},s),x),M),S===0?yt(M):Promise.resolve(M)))).subscribe(s=>{if(!i.isActivated||!i.activatedComponentRef||i.activatedRoute!==c||c.component===null){this.unsubscribeFromRouteData(i);return}let x=bM(c.component);if(!x){this.unsubscribeFromRouteData(i);return}for(let{templateName:M}of x.inputs)i.activatedComponentRef.setInput(M,s[M])});this.outletDataSubscriptions.set(i,u)}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})();function GB(t,r,i){let c=Ef(t,r._root,i?i._root:void 0);return new hy(c,r)}function Ef(t,r,i){if(i&&t.shouldReuseRoute(r.value,i.value.snapshot)){let c=i.value;c._futureSnapshot=r.value;let u=qB(t,r,i);return new Ai(c,u)}else{if(t.shouldAttach(r.value)){let s=t.retrieve(r.value);if(s!==null){let x=s.route;return x.value._futureSnapshot=r.value,x.children=r.children.map(M=>Ef(t,M)),x}}let c=ZB(r.value),u=r.children.map(s=>Ef(t,s));return new Ai(c,u)}}function qB(t,r,i){return r.children.map(c=>{for(let u of i.children)if(t.shouldReuseRoute(c.value,u.value.snapshot))return Ef(t,c,u);return Ef(t,c)})}function ZB(t){return new tr(new Tr(t.url),new Tr(t.params),new Tr(t.queryParams),new Tr(t.fragment),new Tr(t.data),t.outlet,t.component,t)}var If=class{redirectTo;navigationBehaviorOptions;constructor(r,i){this.redirectTo=r,this.navigationBehaviorOptions=i}},$D="ngNavigationCancelingError";function my(t,r){let{redirectTo:i,navigationBehaviorOptions:c}=rc(r)?{redirectTo:r,navigationBehaviorOptions:void 0}:r,u=HD(!1,Ri.Redirect);return u.url=i,u.navigationBehaviorOptions=c,u}function HD(t,r){let i=new Error(`NavigationCancelingError: ${t||""}`);return i[$D]=!0,i.cancellationCode=r,i}function WB(t){return GD(t)&&rc(t.url)}function GD(t){return!!t&&t[$D]}var XB=(t,r,i,c)=>Nt(u=>(new Ix(r,u.targetRouterState,u.currentRouterState,i,c).activate(t),u)),Ix=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(r,i,c,u,s){this.routeReuseStrategy=r,this.futureState=i,this.currState=c,this.forwardEvent=u,this.inputBindingEnabled=s}activate(r){let i=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(i,c,r),rx(this.futureState.root),this.activateChildRoutes(i,c,r)}deactivateChildRoutes(r,i,c){let u=Wu(i);r.children.forEach(s=>{let x=s.value.outlet;this.deactivateRoutes(s,u[x],c),delete u[x]}),Object.values(u).forEach(s=>{this.deactivateRouteAndItsChildren(s,c)})}deactivateRoutes(r,i,c){let u=r.value,s=i?i.value:null;if(u===s)if(u.component){let x=c.getContext(u.outlet);x&&this.deactivateChildRoutes(r,i,x.children)}else this.deactivateChildRoutes(r,i,c);else s&&this.deactivateRouteAndItsChildren(i,c)}deactivateRouteAndItsChildren(r,i){r.value.component&&this.routeReuseStrategy.shouldDetach(r.value.snapshot)?this.detachAndStoreRouteSubtree(r,i):this.deactivateRouteAndOutlet(r,i)}detachAndStoreRouteSubtree(r,i){let c=i.getContext(r.value.outlet),u=c&&r.value.component?c.children:i,s=Wu(r);for(let x of Object.values(s))this.deactivateRouteAndItsChildren(x,u);if(c&&c.outlet){let x=c.outlet.detach(),M=c.children.onOutletDeactivated();this.routeReuseStrategy.store(r.value.snapshot,{componentRef:x,route:r,contexts:M})}}deactivateRouteAndOutlet(r,i){let c=i.getContext(r.value.outlet),u=c&&r.value.component?c.children:i,s=Wu(r);for(let x of Object.values(s))this.deactivateRouteAndItsChildren(x,u);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(r,i,c){let u=Wu(i);r.children.forEach(s=>{this.activateRoutes(s,u[s.value.outlet],c),this.forwardEvent(new vx(s.value.snapshot))}),r.children.length&&this.forwardEvent(new yx(r.value.snapshot))}activateRoutes(r,i,c){let u=r.value,s=i?i.value:null;if(rx(u),u===s)if(u.component){let x=c.getOrCreateContext(u.outlet);this.activateChildRoutes(r,i,x.children)}else this.activateChildRoutes(r,i,c);else if(u.component){let x=c.getOrCreateContext(u.outlet);if(this.routeReuseStrategy.shouldAttach(u.snapshot)){let M=this.routeReuseStrategy.retrieve(u.snapshot);this.routeReuseStrategy.store(u.snapshot,null),x.children.onOutletReAttached(M.contexts),x.attachRef=M.componentRef,x.route=M.route.value,x.outlet&&x.outlet.attach(M.componentRef,M.route.value),rx(M.route.value),this.activateChildRoutes(r,null,x.children)}else x.attachRef=null,x.route=u,x.outlet&&x.outlet.activateWith(u,x.injector),this.activateChildRoutes(r,null,x.children)}else this.activateChildRoutes(r,null,c)}},gy=class{path;route;constructor(r){this.path=r,this.route=this.path[this.path.length-1]}},Ku=class{component;route;constructor(r,i){this.component=r,this.route=i}};function YB(t,r,i){let c=t._root,u=r?r._root:null;return yf(c,u,i,[c.value])}function KB(t){let r=t.routeConfig?t.routeConfig.canActivateChild:null;return!r||r.length===0?null:{node:t,guards:r}}function rd(t,r){let i=Symbol(),c=r.get(t,i);return c===i?typeof t=="function"&&!DE(t)?t:r.get(t):c}function yf(t,r,i,c,u={canDeactivateChecks:[],canActivateChecks:[]}){let s=Wu(r);return t.children.forEach(x=>{QB(x,s[x.value.outlet],i,c.concat([x.value]),u),delete s[x.value.outlet]}),Object.entries(s).forEach(([x,M])=>bf(M,i.getContext(x),u)),u}function QB(t,r,i,c,u={canDeactivateChecks:[],canActivateChecks:[]}){let s=t.value,x=r?r.value:null,M=i?i.getContext(t.value.outlet):null;if(x&&s.routeConfig===x.routeConfig){let S=JB(x,s,s.routeConfig.runGuardsAndResolvers);S?u.canActivateChecks.push(new gy(c)):(s.data=x.data,s._resolvedData=x._resolvedData),s.component?yf(t,r,M?M.children:null,c,u):yf(t,r,i,c,u),S&&M&&M.outlet&&M.outlet.isActivated&&u.canDeactivateChecks.push(new Ku(M.outlet.component,x))}else x&&bf(r,M,u),u.canActivateChecks.push(new gy(c)),s.component?yf(t,null,M?M.children:null,c,u):yf(t,null,i,c,u);return u}function JB(t,r,i){if(typeof i=="function")return i(t,r);switch(i){case"pathParamsChange":return!nc(t.url,r.url);case"pathParamsOrQueryParamsChange":return!nc(t.url,r.url)||!qo(t.queryParams,r.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Cx(t,r)||!qo(t.queryParams,r.queryParams);case"paramsChange":default:return!Cx(t,r)}}function bf(t,r,i){let c=Wu(t),u=t.value;Object.entries(c).forEach(([s,x])=>{u.component?r?bf(x,r.children.getContext(s),i):bf(x,null,i):bf(x,r,i)}),u.component?r&&r.outlet&&r.outlet.isActivated?i.canDeactivateChecks.push(new Ku(r.outlet.component,u)):i.canDeactivateChecks.push(new Ku(null,u)):i.canDeactivateChecks.push(new Ku(null,u))}function kf(t){return typeof t=="function"}function ej(t){return typeof t=="boolean"}function tj(t){return t&&kf(t.canLoad)}function nj(t){return t&&kf(t.canActivate)}function rj(t){return t&&kf(t.canActivateChild)}function ij(t){return t&&kf(t.canDeactivate)}function oj(t){return t&&kf(t.canMatch)}function qD(t){return t instanceof Ms||t?.name==="EmptyError"}var ny=Symbol("INITIAL_VALUE");function nd(){return ri(t=>kh(t.map(r=>r.pipe(Ss(1),hv(ny)))).pipe(Nt(r=>{for(let i of r)if(i!==!0){if(i===ny)return ny;if(i===!1||sj(i))return i}return!0}),ni(r=>r!==ny),Ss(1)))}function sj(t){return rc(t)||t instanceof If}function aj(t,r){return Jn(i=>{let{targetSnapshot:c,currentSnapshot:u,guards:{canActivateChecks:s,canDeactivateChecks:x}}=i;return x.length===0&&s.length===0?yt(wn(et({},i),{guardsResult:!0})):lj(x,c,u,t).pipe(Jn(M=>M&&ej(M)?cj(c,s,t,r):yt(M)),Nt(M=>wn(et({},i),{guardsResult:M})))})}function lj(t,r,i,c){return An(t).pipe(Jn(u=>pj(u.component,u.route,i,r,c)),Ps(u=>u!==!0,!0))}function cj(t,r,i,c){return An(r).pipe(Ds(u=>mu(dj(u.route.parent,c),uj(u.route,c),fj(t,u.path,i),hj(t,u.route,i))),Ps(u=>u!==!0,!0))}function uj(t,r){return t!==null&&r&&r(new _x(t)),yt(!0)}function dj(t,r){return t!==null&&r&&r(new gx(t)),yt(!0)}function hj(t,r,i){let c=r.routeConfig?r.routeConfig.canActivate:null;if(!c||c.length===0)return yt(!0);let u=c.map(s=>Cm(()=>{let x=Af(r)??i,M=rd(s,x),S=nj(M)?M.canActivate(r,t):li(x,()=>M(r,t));return Va(S).pipe(Ps())}));return yt(u).pipe(nd())}function fj(t,r,i){let c=r[r.length-1],s=r.slice(0,r.length-1).reverse().map(x=>KB(x)).filter(x=>x!==null).map(x=>Cm(()=>{let M=x.guards.map(S=>{let B=Af(x.node)??i,W=rd(S,B),$=rj(W)?W.canActivateChild(c,t):li(B,()=>W(c,t));return Va($).pipe(Ps())});return yt(M).pipe(nd())}));return yt(s).pipe(nd())}function pj(t,r,i,c,u){let s=r&&r.routeConfig?r.routeConfig.canDeactivate:null;if(!s||s.length===0)return yt(!0);let x=s.map(M=>{let S=Af(r)??u,B=rd(M,S),W=ij(B)?B.canDeactivate(t,r,i,c):li(S,()=>B(t,r,i,c));return Va(W).pipe(Ps())});return yt(x).pipe(nd())}function mj(t,r,i,c){let u=r.canLoad;if(u===void 0||u.length===0)return yt(!0);let s=u.map(x=>{let M=rd(x,t),S=tj(M)?M.canLoad(r,i):li(t,()=>M(r,i));return Va(S)});return yt(s).pipe(nd(),ZD(c))}function ZD(t){return ov(lr(r=>{if(typeof r!="boolean")throw my(t,r)}),Nt(r=>r===!0))}function gj(t,r,i,c){let u=r.canMatch;if(!u||u.length===0)return yt(!0);let s=u.map(x=>{let M=rd(x,t),S=oj(M)?M.canMatch(r,i):li(t,()=>M(r,i));return Va(S)});return yt(s).pipe(nd(),ZD(c))}var Tf=class{segmentGroup;constructor(r){this.segmentGroup=r||null}},Mf=class extends Error{urlTree;constructor(r){super(),this.urlTree=r}};function Zu(t){return fu(new Tf(t))}function yj(t){return fu(new it(4e3,!1))}function _j(t){return fu(HD(!1,Ri.GuardRejected))}var Tx=class{urlSerializer;urlTree;constructor(r,i){this.urlSerializer=r,this.urlTree=i}lineralizeSegments(r,i){let c=[],u=i.root;for(;;){if(c=c.concat(u.segments),u.numberOfChildren===0)return yt(c);if(u.numberOfChildren>1||!u.children[Rt])return yj(`${r.redirectTo}`);u=u.children[Rt]}}applyRedirectCommands(r,i,c,u,s){if(typeof i!="string"){let M=i,{queryParams:S,fragment:B,routeConfig:W,url:$,outlet:he,params:ge,data:ze,title:qe}=u,Ye=li(s,()=>M({params:ge,data:ze,queryParams:S,fragment:B,routeConfig:W,url:$,outlet:he,title:qe}));if(Ye instanceof Us)throw new Mf(Ye);i=Ye}let x=this.applyRedirectCreateUrlTree(i,this.urlSerializer.parse(i),r,c);if(i[0]==="/")throw new Mf(x);return x}applyRedirectCreateUrlTree(r,i,c,u){let s=this.createSegmentGroup(r,i.root,c,u);return new Us(s,this.createQueryParams(i.queryParams,this.urlTree.queryParams),i.fragment)}createQueryParams(r,i){let c={};return Object.entries(r).forEach(([u,s])=>{if(typeof s=="string"&&s[0]===":"){let M=s.substring(1);c[u]=i[M]}else c[u]=s}),c}createSegmentGroup(r,i,c,u){let s=this.createSegments(r,i.segments,c,u),x={};return Object.entries(i.children).forEach(([M,S])=>{x[M]=this.createSegmentGroup(r,S,c,u)}),new sn(s,x)}createSegments(r,i,c,u){return i.map(s=>s.path[0]===":"?this.findPosParam(r,s,u):this.findOrReturn(s,c))}findPosParam(r,i,c){let u=c[i.path.substring(1)];if(!u)throw new it(4001,!1);return u}findOrReturn(r,i){let c=0;for(let u of i){if(u.path===r.path)return i.splice(c),u;c++}return r}},Mx={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function vj(t,r,i,c,u){let s=WD(t,r,i);return s.matched?(c=VB(r,c),gj(c,r,i,u).pipe(Nt(x=>x===!0?s:et({},Mx)))):yt(s)}function WD(t,r,i){if(r.path==="**")return bj(i);if(r.path==="")return r.pathMatch==="full"&&(t.hasChildren()||i.length>0)?et({},Mx):{matched:!0,consumedSegments:[],remainingSegments:i,parameters:{},positionalParamSegments:{}};let u=(r.matcher||mB)(i,t,r);if(!u)return et({},Mx);let s={};Object.entries(u.posParams??{}).forEach(([M,S])=>{s[M]=S.path});let x=u.consumed.length>0?et(et({},s),u.consumed[u.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:u.consumed,remainingSegments:i.slice(u.consumed.length),parameters:x,positionalParamSegments:u.posParams??{}}}function bj(t){return{matched:!0,parameters:t.length>0?MD(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function wD(t,r,i,c){return i.length>0&&Cj(t,i,c)?{segmentGroup:new sn(r,wj(c,new sn(i,t.children))),slicedSegments:[]}:i.length===0&&Ej(t,i,c)?{segmentGroup:new sn(t.segments,xj(t,i,c,t.children)),slicedSegments:i}:{segmentGroup:new sn(t.segments,t.children),slicedSegments:i}}function xj(t,r,i,c){let u={};for(let s of i)if(vy(t,r,s)&&!c[vo(s)]){let x=new sn([],{});u[vo(s)]=x}return et(et({},c),u)}function wj(t,r){let i={};i[Rt]=r;for(let c of t)if(c.path===""&&vo(c)!==Rt){let u=new sn([],{});i[vo(c)]=u}return i}function Cj(t,r,i){return i.some(c=>vy(t,r,c)&&vo(c)!==Rt)}function Ej(t,r,i){return i.some(c=>vy(t,r,c))}function vy(t,r,i){return(t.hasChildren()||r.length>0)&&i.pathMatch==="full"?!1:i.path===""}function Ij(t,r,i){return r.length===0&&!t.children[i]}var Dx=class{};function Tj(t,r,i,c,u,s,x="emptyOnly"){return new Sx(t,r,i,c,u,x,s).recognize()}var Mj=31,Sx=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(r,i,c,u,s,x,M){this.injector=r,this.configLoader=i,this.rootComponentType=c,this.config=u,this.urlTree=s,this.paramsInheritanceStrategy=x,this.urlSerializer=M,this.applyRedirects=new Tx(this.urlSerializer,this.urlTree)}noMatchError(r){return new it(4002,`'${r.segmentGroup}'`)}recognize(){let r=wD(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(r).pipe(Nt(({children:i,rootSnapshot:c})=>{let u=new Ai(c,i),s=new py("",u),x=OB(c,[],this.urlTree.queryParams,this.urlTree.fragment);return x.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(x),{state:s,tree:x}}))}match(r){let i=new Yu([],Object.freeze({}),Object.freeze(et({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),Rt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,r,Rt,i).pipe(Nt(c=>({children:c,rootSnapshot:i})),xa(c=>{if(c instanceof Mf)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof Tf?this.noMatchError(c):c}))}processSegmentGroup(r,i,c,u,s){return c.segments.length===0&&c.hasChildren()?this.processChildren(r,i,c,s):this.processSegment(r,i,c,c.segments,u,!0,s).pipe(Nt(x=>x instanceof Ai?[x]:[]))}processChildren(r,i,c,u){let s=[];for(let x of Object.keys(c.children))x==="primary"?s.unshift(x):s.push(x);return An(s).pipe(Ds(x=>{let M=c.children[x],S=UB(i,x);return this.processSegmentGroup(r,S,M,x,u)}),dv((x,M)=>(x.push(...M),x)),wa(null),uv(),Jn(x=>{if(x===null)return Zu(c);let M=XD(x);return Dj(M),yt(M)}))}processSegment(r,i,c,u,s,x,M){return An(i).pipe(Ds(S=>this.processSegmentAgainstRoute(S._injector??r,i,S,c,u,s,x,M).pipe(xa(B=>{if(B instanceof Tf)return yt(null);throw B}))),Ps(S=>!!S),xa(S=>{if(qD(S))return Ij(c,u,s)?yt(new Dx):Zu(c);throw S}))}processSegmentAgainstRoute(r,i,c,u,s,x,M,S){return vo(c)!==x&&(x===Rt||!vy(u,s,c))?Zu(u):c.redirectTo===void 0?this.matchSegmentAgainstRoute(r,u,c,s,x,S):this.allowRedirects&&M?this.expandSegmentAgainstRouteUsingRedirect(r,u,i,c,s,x,S):Zu(u)}expandSegmentAgainstRouteUsingRedirect(r,i,c,u,s,x,M){let{matched:S,parameters:B,consumedSegments:W,positionalParamSegments:$,remainingSegments:he}=WD(i,u,s);if(!S)return Zu(i);typeof u.redirectTo=="string"&&u.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Mj&&(this.allowRedirects=!1));let ge=new Yu(s,B,Object.freeze(et({},this.urlTree.queryParams)),this.urlTree.fragment,CD(u),vo(u),u.component??u._loadedComponent??null,u,ED(u)),ze=fy(ge,M,this.paramsInheritanceStrategy);ge.params=Object.freeze(ze.params),ge.data=Object.freeze(ze.data);let qe=this.applyRedirects.applyRedirectCommands(W,u.redirectTo,$,ge,r);return this.applyRedirects.lineralizeSegments(u,qe).pipe(Jn(Ye=>this.processSegment(r,c,i,Ye.concat(he),x,!1,M)))}matchSegmentAgainstRoute(r,i,c,u,s,x){let M=vj(i,c,u,r,this.urlSerializer);return c.path==="**"&&(i.children={}),M.pipe(ri(S=>S.matched?(r=c._injector??r,this.getChildConfig(r,c,u).pipe(ri(({routes:B})=>{let W=c._loadedInjector??r,{parameters:$,consumedSegments:he,remainingSegments:ge}=S,ze=new Yu(he,$,Object.freeze(et({},this.urlTree.queryParams)),this.urlTree.fragment,CD(c),vo(c),c.component??c._loadedComponent??null,c,ED(c)),qe=fy(ze,x,this.paramsInheritanceStrategy);ze.params=Object.freeze(qe.params),ze.data=Object.freeze(qe.data);let{segmentGroup:Ye,slicedSegments:lt}=wD(i,he,ge,B);if(lt.length===0&&Ye.hasChildren())return this.processChildren(W,B,Ye,ze).pipe(Nt(ft=>new Ai(ze,ft)));if(B.length===0&&lt.length===0)return yt(new Ai(ze,[]));let gt=vo(c)===s;return this.processSegment(W,B,Ye,lt,gt?Rt:s,!0,ze).pipe(Nt(ft=>new Ai(ze,ft instanceof Ai?[ft]:[])))}))):Zu(i)))}getChildConfig(r,i,c){return i.children?yt({routes:i.children,injector:r}):i.loadChildren?i._loadedRoutes!==void 0?yt({routes:i._loadedRoutes,injector:i._loadedInjector}):mj(r,i,c,this.urlSerializer).pipe(Jn(u=>u?this.configLoader.loadChildren(r,i).pipe(lr(s=>{i._loadedRoutes=s.routes,i._loadedInjector=s.injector})):_j(i))):yt({routes:[],injector:r})}};function Dj(t){t.sort((r,i)=>r.value.outlet===Rt?-1:i.value.outlet===Rt?1:r.value.outlet.localeCompare(i.value.outlet))}function Sj(t){let r=t.value.routeConfig;return r&&r.path===""}function XD(t){let r=[],i=new Set;for(let c of t){if(!Sj(c)){r.push(c);continue}let u=r.find(s=>c.value.routeConfig===s.value.routeConfig);u!==void 0?(u.children.push(...c.children),i.add(u)):r.push(c)}for(let c of i){let u=XD(c.children);r.push(new Ai(c.value,u))}return r.filter(c=>!i.has(c))}function CD(t){return t.data||{}}function ED(t){return t.resolve||{}}function Pj(t,r,i,c,u,s){return Jn(x=>Tj(t,r,i,c,x.extractedUrl,u,s).pipe(Nt(({state:M,tree:S})=>wn(et({},x),{targetSnapshot:M,urlAfterRedirects:S}))))}function Aj(t,r){return Jn(i=>{let{targetSnapshot:c,guards:{canActivateChecks:u}}=i;if(!u.length)return yt(i);let s=new Set(u.map(S=>S.route)),x=new Set;for(let S of s)if(!x.has(S))for(let B of YD(S))x.add(B);let M=0;return An(x).pipe(Ds(S=>s.has(S)?Rj(S,c,t,r):(S.data=fy(S,S.parent,t).resolve,yt(void 0))),lr(()=>M++),gu(1),Jn(S=>M===x.size?yt(i):ei))})}function YD(t){let r=t.children.map(i=>YD(i)).flat();return[t,...r]}function Rj(t,r,i,c){let u=t.routeConfig,s=t._resolve;return u?.title!==void 0&&!UD(u)&&(s[Sf]=u.title),kj(s,t,r,c).pipe(Nt(x=>(t._resolvedData=x,t.data=fy(t,t.parent,i).resolve,null)))}function kj(t,r,i,c){let u=sx(t);if(u.length===0)return yt({});let s={};return An(u).pipe(Jn(x=>Oj(t[x],r,i,c).pipe(Ps(),lr(M=>{if(M instanceof If)throw my(new Ju,M);s[x]=M}))),gu(1),Nt(()=>s),xa(x=>qD(x)?ei:fu(x)))}function Oj(t,r,i,c){let u=Af(r)??c,s=rd(t,u),x=s.resolve?s.resolve(r,i):li(u,()=>s(r,i));return Va(x)}function ix(t){return ri(r=>{let i=t(r);return i?An(i).pipe(Nt(()=>r)):yt(r)})}var KD=(()=>{class t{buildTitle(i){let c,u=i.root;for(;u!==void 0;)c=this.getResolvedTitleForRoute(u)??c,u=u.children.find(s=>s.outlet===Rt);return c}getResolvedTitleForRoute(i){return i.data[Sf]}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(Nj),providedIn:"root"})}return t})(),Nj=(()=>{class t extends KD{title;constructor(i){super(),this.title=i}updateTitle(i){let c=this.buildTitle(i);c!==void 0&&this.title.setTitle(c)}static \u0275fac=function(c){return new(c||t)(ht(pD))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Of=new ot("",{providedIn:"root",factory:()=>({})}),Lj=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275cmp=Gt({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(c,u){c&1&&Ct(0,"router-outlet")},dependencies:[Rx],encapsulation:2})}return t})();function kx(t){let r=t.children&&t.children.map(kx),i=r?wn(et({},t),{children:r}):et({},t);return!i.component&&!i.loadComponent&&(r||i.loadChildren)&&i.outlet&&i.outlet!==Rt&&(i.component=Lj),i}var Df=new ot(""),Ox=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=Le(Vg);loadComponent(i){if(this.componentLoaders.get(i))return this.componentLoaders.get(i);if(i._loadedComponent)return yt(i._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(i);let c=Va(i.loadComponent()).pipe(Nt(QD),lr(s=>{this.onLoadEndListener&&this.onLoadEndListener(i),i._loadedComponent=s}),kl(()=>{this.componentLoaders.delete(i)})),u=new hu(c,()=>new _r).pipe(du());return this.componentLoaders.set(i,u),u}loadChildren(i,c){if(this.childrenLoaders.get(c))return this.childrenLoaders.get(c);if(c._loadedRoutes)return yt({routes:c._loadedRoutes,injector:c._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(c);let s=Fj(c,this.compiler,i,this.onLoadEndListener).pipe(kl(()=>{this.childrenLoaders.delete(c)})),x=new hu(s,()=>new _r).pipe(du());return this.childrenLoaders.set(c,x),x}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Fj(t,r,i,c){return Va(t.loadChildren()).pipe(Nt(QD),Jn(u=>u instanceof Hh||Array.isArray(u)?yt(u):An(r.compileModuleAsync(u))),Nt(u=>{c&&c(t);let s,x,M=!1;return Array.isArray(u)?(x=u,M=!0):(s=u.create(i).injector,x=s.get(Df,[],{optional:!0,self:!0}).flat()),{routes:x.map(kx),injector:s}}))}function zj(t){return t&&typeof t=="object"&&"default"in t}function QD(t){return zj(t)?t.default:t}var Nx=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(Bj),providedIn:"root"})}return t})(),Bj=(()=>{class t{shouldProcessUrl(i){return!0}extract(i){return i}merge(i,c){return i}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),JD=new ot(""),eS=new ot("");function jj(t,r,i){let c=t.get(eS),u=t.get(Ar);return t.get(kn).runOutsideAngular(()=>{if(!u.startViewTransition||c.skipNextTransition)return c.skipNextTransition=!1,new Promise(B=>setTimeout(B));let s,x=new Promise(B=>{s=B}),M=u.startViewTransition(()=>(s(),Vj(t))),{onViewTransitionCreated:S}=c;return S&&li(t,()=>S({transition:M,from:r,to:i})),x})}function Vj(t){return new Promise(r=>{Dg({read:()=>setTimeout(r)},{injector:t})})}var tS=new ot(""),Lx=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new _r;transitionAbortSubject=new _r;configLoader=Le(Ox);environmentInjector=Le(Pr);destroyRef=Le(Yh);urlSerializer=Le(Pf);rootContexts=Le(Rf);location=Le(Gu);inputBindingEnabled=Le(_y,{optional:!0})!==null;titleStrategy=Le(KD);options=Le(Of,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=Le(Nx);createViewTransition=Le(JD,{optional:!0});navigationErrorHandler=Le(tS,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>yt(void 0);rootComponentType=null;destroyed=!1;constructor(){let i=u=>this.events.next(new px(u)),c=u=>this.events.next(new mx(u));this.configLoader.onLoadEndListener=c,this.configLoader.onLoadStartListener=i,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(i){let c=++this.navigationId;this.transitions?.next(wn(et(et({},this.transitions.value),i),{id:c}))}setupNavigations(i,c,u){return this.transitions=new Tr({id:0,currentUrlTree:c,currentRawUrl:c,extractedUrl:this.urlHandlingStrategy.extract(c),urlAfterRedirects:this.urlHandlingStrategy.extract(c),rawUrl:c,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:vf,restoredState:null,currentSnapshot:u.snapshot,targetSnapshot:null,currentRouterState:u,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ni(s=>s.id!==0),Nt(s=>wn(et({},s),{extractedUrl:this.urlHandlingStrategy.extract(s.rawUrl)})),ri(s=>{let x=!1,M=!1;return yt(s).pipe(ri(S=>{if(this.navigationId>s.id)return this.cancelNavigationTransition(s,"",Ri.SupersededByNewNavigation),ei;this.currentTransition=s,this.currentNavigation={id:S.id,initialUrl:S.rawUrl,extractedUrl:S.extractedUrl,targetBrowserUrl:typeof S.extras.browserUrl=="string"?this.urlSerializer.parse(S.extras.browserUrl):S.extras.browserUrl,trigger:S.source,extras:S.extras,previousNavigation:this.lastSuccessfulNavigation?wn(et({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let B=!i.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),W=S.extras.onSameUrlNavigation??i.onSameUrlNavigation;if(!B&&W!=="reload"){let $="";return this.events.next(new ja(S.id,this.urlSerializer.serialize(S.rawUrl),$,ly.IgnoredSameUrlNavigation)),S.resolve(!1),ei}if(this.urlHandlingStrategy.shouldProcessUrl(S.rawUrl))return yt(S).pipe(ri($=>{let he=this.transitions?.getValue();return this.events.next(new ed($.id,this.urlSerializer.serialize($.extractedUrl),$.source,$.restoredState)),he!==this.transitions?.getValue()?ei:Promise.resolve($)}),Pj(this.environmentInjector,this.configLoader,this.rootComponentType,i.config,this.urlSerializer,this.paramsInheritanceStrategy),lr($=>{s.targetSnapshot=$.targetSnapshot,s.urlAfterRedirects=$.urlAfterRedirects,this.currentNavigation=wn(et({},this.currentNavigation),{finalUrl:$.urlAfterRedirects});let he=new cy($.id,this.urlSerializer.serialize($.extractedUrl),this.urlSerializer.serialize($.urlAfterRedirects),$.targetSnapshot);this.events.next(he)}));if(B&&this.urlHandlingStrategy.shouldProcessUrl(S.currentRawUrl)){let{id:$,extractedUrl:he,source:ge,restoredState:ze,extras:qe}=S,Ye=new ed($,this.urlSerializer.serialize(he),ge,ze);this.events.next(Ye);let lt=jD(this.rootComponentType).snapshot;return this.currentTransition=s=wn(et({},S),{targetSnapshot:lt,urlAfterRedirects:he,extras:wn(et({},qe),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=he,yt(s)}else{let $="";return this.events.next(new ja(S.id,this.urlSerializer.serialize(S.extractedUrl),$,ly.IgnoredByUrlHandlingStrategy)),S.resolve(!1),ei}}),lr(S=>{let B=new ux(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(B)}),Nt(S=>(this.currentTransition=s=wn(et({},S),{guards:YB(S.targetSnapshot,S.currentSnapshot,this.rootContexts)}),s)),aj(this.environmentInjector,S=>this.events.next(S)),lr(S=>{if(s.guardsResult=S.guardsResult,S.guardsResult&&typeof S.guardsResult!="boolean")throw my(this.urlSerializer,S.guardsResult);let B=new dx(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot,!!S.guardsResult);this.events.next(B)}),ni(S=>S.guardsResult?!0:(this.cancelNavigationTransition(S,"",Ri.GuardRejected),!1)),ix(S=>{if(S.guards.canActivateChecks.length)return yt(S).pipe(lr(B=>{let W=new hx(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(W)}),ri(B=>{let W=!1;return yt(B).pipe(Aj(this.paramsInheritanceStrategy,this.environmentInjector),lr({next:()=>W=!0,complete:()=>{W||this.cancelNavigationTransition(B,"",Ri.NoDataFromResolver)}}))}),lr(B=>{let W=new fx(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(W)}))}),ix(S=>{let B=W=>{let $=[];W.routeConfig?.loadComponent&&!W.routeConfig._loadedComponent&&$.push(this.configLoader.loadComponent(W.routeConfig).pipe(lr(he=>{W.component=he}),Nt(()=>{})));for(let he of W.children)$.push(...B(he));return $};return kh(B(S.targetSnapshot.root)).pipe(wa(null),Ss(1))}),ix(()=>this.afterPreactivation()),ri(()=>{let{currentSnapshot:S,targetSnapshot:B}=s,W=this.createViewTransition?.(this.environmentInjector,S.root,B.root);return W?An(W).pipe(Nt(()=>s)):yt(s)}),Nt(S=>{let B=GB(i.routeReuseStrategy,S.targetSnapshot,S.currentRouterState);return this.currentTransition=s=wn(et({},S),{targetRouterState:B}),this.currentNavigation.targetRouterState=B,s}),lr(()=>{this.events.next(new Cf)}),XB(this.rootContexts,i.routeReuseStrategy,S=>this.events.next(S),this.inputBindingEnabled),Ss(1),lr({next:S=>{x=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Zo(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects))),this.titleStrategy?.updateTitle(S.targetRouterState.snapshot),S.resolve(!0)},complete:()=>{x=!0}}),fv(this.transitionAbortSubject.pipe(lr(S=>{throw S}))),kl(()=>{!x&&!M&&this.cancelNavigationTransition(s,"",Ri.SupersededByNewNavigation),this.currentTransition?.id===s.id&&(this.currentNavigation=null,this.currentTransition=null)}),xa(S=>{if(this.destroyed)return s.resolve(!1),ei;if(M=!0,GD(S))this.events.next(new Vs(s.id,this.urlSerializer.serialize(s.extractedUrl),S.message,S.cancellationCode)),WB(S)?this.events.next(new td(S.url,S.navigationBehaviorOptions)):s.resolve(!1);else{let B=new wf(s.id,this.urlSerializer.serialize(s.extractedUrl),S,s.targetSnapshot??void 0);try{let W=li(this.environmentInjector,()=>this.navigationErrorHandler?.(B));if(W instanceof If){let{message:$,cancellationCode:he}=my(this.urlSerializer,W);this.events.next(new Vs(s.id,this.urlSerializer.serialize(s.extractedUrl),$,he)),this.events.next(new td(W.redirectTo,W.navigationBehaviorOptions))}else throw this.events.next(B),S}catch(W){this.options.resolveNavigationPromiseOnError?s.resolve(!1):s.reject(W)}}return ei}))}))}cancelNavigationTransition(i,c,u){let s=new Vs(i.id,this.urlSerializer.serialize(i.extractedUrl),c,u);this.events.next(s),i.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let i=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),c=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return i.toString()!==c?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Uj(t){return t!==vf}var $j=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(Hj),providedIn:"root"})}return t})(),Px=class{shouldDetach(r){return!1}store(r,i){}shouldAttach(r){return!1}retrieve(r){return null}shouldReuseRoute(r,i){return r.routeConfig===i.routeConfig}},Hj=(()=>{class t extends Px{static \u0275fac=(()=>{let i;return function(u){return(i||(i=X0(t)))(u||t)}})();static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),nS=(()=>{class t{static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:()=>Le(Gj),providedIn:"root"})}return t})(),Gj=(()=>{class t extends nS{location=Le(Gu);urlSerializer=Le(Pf);options=Le(Of,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=Le(Nx);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Us;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=jD(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(i){return this.location.subscribe(c=>{c.type==="popstate"&&i(c.url,c.state)})}handleRouterEvent(i,c){if(i instanceof ed)this.stateMemento=this.createStateMemento();else if(i instanceof ja)this.rawUrlTree=c.initialUrl;else if(i instanceof cy){if(this.urlUpdateStrategy==="eager"&&!c.extras.skipLocationChange){let u=this.urlHandlingStrategy.merge(c.finalUrl,c.initialUrl);this.setBrowserUrl(c.targetBrowserUrl??u,c)}}else i instanceof Cf?(this.currentUrlTree=c.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(c.finalUrl,c.initialUrl),this.routerState=c.targetRouterState,this.urlUpdateStrategy==="deferred"&&!c.extras.skipLocationChange&&this.setBrowserUrl(c.targetBrowserUrl??this.rawUrlTree,c)):i instanceof Vs&&(i.code===Ri.GuardRejected||i.code===Ri.NoDataFromResolver)?this.restoreHistory(c):i instanceof wf?this.restoreHistory(c,!0):i instanceof Zo&&(this.lastSuccessfulId=i.id,this.currentPageId=this.browserPageId)}setBrowserUrl(i,c){let u=i instanceof Us?this.urlSerializer.serialize(i):i;if(this.location.isCurrentPathEqualTo(u)||c.extras.replaceUrl){let s=this.browserPageId,x=et(et({},c.extras.state),this.generateNgRouterState(c.id,s));this.location.replaceState(u,"",x)}else{let s=et(et({},c.extras.state),this.generateNgRouterState(c.id,this.browserPageId+1));this.location.go(u,"",s)}}restoreHistory(i,c=!1){if(this.canceledNavigationResolution==="computed"){let u=this.browserPageId,s=this.currentPageId-u;s!==0?this.location.historyGo(s):this.currentUrlTree===i.finalUrl&&s===0&&(this.resetState(i),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(c&&this.resetState(i),this.resetUrlToCurrentUrlTree())}resetState(i){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,i.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(i,c){return this.canceledNavigationResolution==="computed"?{navigationId:i,\u0275routerPageId:c}:{navigationId:i}}static \u0275fac=(()=>{let i;return function(u){return(i||(i=X0(t)))(u||t)}})();static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function rS(t,r){t.events.pipe(ni(i=>i instanceof Zo||i instanceof Vs||i instanceof wf||i instanceof ja),Nt(i=>i instanceof Zo||i instanceof ja?0:(i instanceof Vs?i.code===Ri.Redirect||i.code===Ri.SupersededByNewNavigation:!1)?2:1),ni(i=>i!==2),Ss(1)).subscribe(()=>{r()})}var qj={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Zj={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Bn=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=Le(Ib);stateManager=Le(nS);options=Le(Of,{optional:!0})||{};pendingTasks=Le(Vo);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=Le(Lx);urlSerializer=Le(Pf);location=Le(Gu);urlHandlingStrategy=Le(Nx);_events=new _r;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=Le($j);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=Le(Df,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!Le(_y,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:i=>{this.console.warn(i)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Qn;subscribeToNavigationEvents(){let i=this.navigationTransitions.events.subscribe(c=>{try{let u=this.navigationTransitions.currentTransition,s=this.navigationTransitions.currentNavigation;if(u!==null&&s!==null){if(this.stateManager.handleRouterEvent(c,s),c instanceof Vs&&c.code!==Ri.Redirect&&c.code!==Ri.SupersededByNewNavigation)this.navigated=!0;else if(c instanceof Zo)this.navigated=!0;else if(c instanceof td){let x=c.navigationBehaviorOptions,M=this.urlHandlingStrategy.merge(c.url,u.currentRawUrl),S=et({browserUrl:u.extras.browserUrl,info:u.extras.info,skipLocationChange:u.extras.skipLocationChange,replaceUrl:u.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Uj(u.source)},x);this.scheduleNavigation(M,vf,null,S,{resolve:u.resolve,reject:u.reject,promise:u.promise})}}Xj(c)&&this._events.next(c)}catch(u){this.navigationTransitions.transitionAbortSubject.next(u)}});this.eventsSubscription.add(i)}resetRootComponentType(i){this.routerState.root.component=i,this.navigationTransitions.rootComponentType=i}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),vf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((i,c)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(i,"popstate",c)},0)})}navigateToSyncWithBrowser(i,c,u){let s={replaceUrl:!0},x=u?.navigationId?u:null;if(u){let S=et({},u);delete S.navigationId,delete S.\u0275routerPageId,Object.keys(S).length!==0&&(s.state=S)}let M=this.parseUrl(i);this.scheduleNavigation(M,c,x,s)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(i){this.config=i.map(kx),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(i,c={}){let{relativeTo:u,queryParams:s,fragment:x,queryParamsHandling:M,preserveFragment:S}=c,B=S?this.currentUrlTree.fragment:x,W=null;switch(M??this.options.defaultQueryParamsHandling){case"merge":W=et(et({},this.currentUrlTree.queryParams),s);break;case"preserve":W=this.currentUrlTree.queryParams;break;default:W=s||null}W!==null&&(W=this.removeEmptyProps(W));let $;try{let he=u?u.snapshot:this.routerState.snapshot.root;$=LD(he)}catch{(typeof i[0]!="string"||i[0][0]!=="/")&&(i=[]),$=this.currentUrlTree.root}return FD($,i,W,B??null)}navigateByUrl(i,c={skipLocationChange:!1}){let u=rc(i)?i:this.parseUrl(i),s=this.urlHandlingStrategy.merge(u,this.rawUrlTree);return this.scheduleNavigation(s,vf,null,c)}navigate(i,c={skipLocationChange:!1}){return Wj(i),this.navigateByUrl(this.createUrlTree(i,c),c)}serializeUrl(i){return this.urlSerializer.serialize(i)}parseUrl(i){try{return this.urlSerializer.parse(i)}catch{return this.urlSerializer.parse("/")}}isActive(i,c){let u;if(c===!0?u=et({},qj):c===!1?u=et({},Zj):u=c,rc(i))return yD(this.currentUrlTree,i,u);let s=this.parseUrl(i);return yD(this.currentUrlTree,s,u)}removeEmptyProps(i){return Object.entries(i).reduce((c,[u,s])=>(s!=null&&(c[u]=s),c),{})}scheduleNavigation(i,c,u,s,x){if(this.disposed)return Promise.resolve(!1);let M,S,B;x?(M=x.resolve,S=x.reject,B=x.promise):B=new Promise(($,he)=>{M=$,S=he});let W=this.pendingTasks.add();return rS(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(W))}),this.navigationTransitions.handleNavigationRequest({source:c,restoredState:u,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:i,extras:s,resolve:M,reject:S,promise:B,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),B.catch($=>Promise.reject($))}static \u0275fac=function(c){return new(c||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Wj(t){for(let r=0;r<t.length;r++)if(t[r]==null)throw new it(4008,!1)}function Xj(t){return!(t instanceof Cf)&&!(t instanceof td)}var iS=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new _r;constructor(i,c,u,s,x,M){this.router=i,this.route=c,this.tabIndexAttribute=u,this.renderer=s,this.el=x,this.locationStrategy=M;let S=x.nativeElement.tagName?.toLowerCase();this.isAnchorElement=S==="a"||S==="area",this.isAnchorElement?this.subscription=i.events.subscribe(B=>{B instanceof Zo&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(i){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",i)}ngOnChanges(i){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(i){i==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(rc(i)?this.routerLinkInput=i:this.routerLinkInput=Array.isArray(i)?i:[i],this.setTabIndexIfNotOnNativeEl("0"))}onClick(i,c,u,s,x){let M=this.urlTree;if(M===null||this.isAnchorElement&&(i!==0||c||u||s||x||typeof this.target=="string"&&this.target!="_self"))return!0;let S={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(M,S),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let i=this.urlTree;this.href=i!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(i)):null;let c=this.href===null?null:lT(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",c)}applyAttributeValue(i,c){let u=this.renderer,s=this.el.nativeElement;c!==null?u.setAttribute(s,i,c):u.removeAttribute(s,i)}get urlTree(){return this.routerLinkInput===null?null:rc(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(c){return new(c||t)(xt(Bn),xt(tr),Y0("tabindex"),xt(Kl),xt(Fs),xt(js))};static \u0275dir=Ql({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(c,u){c&1&&qt("click",function(x){return u.onClick(x.button,x.ctrlKey,x.shiftKey,x.altKey,x.metaKey)}),c&2&&Tb("target",u.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",of],skipLocationChange:[2,"skipLocationChange","skipLocationChange",of],replaceUrl:[2,"replaceUrl","replaceUrl",of],routerLink:"routerLink"},features:[Cb,wg]})}return t})();var yy=class{};var Yj=(()=>{class t{router;injector;preloadingStrategy;loader;subscription;constructor(i,c,u,s,x){this.router=i,this.injector=u,this.preloadingStrategy=s,this.loader=x}setUpPreloading(){this.subscription=this.router.events.pipe(ni(i=>i instanceof Zo),Ds(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(i,c){let u=[];for(let s of c){s.providers&&!s._injector&&(s._injector=Jh(s.providers,i,`Route: ${s.path}`));let x=s._injector??i,M=s._loadedInjector??x;(s.loadChildren&&!s._loadedRoutes&&s.canLoad===void 0||s.loadComponent&&!s._loadedComponent)&&u.push(this.preloadConfig(x,s)),(s.children||s._loadedRoutes)&&u.push(this.processRoutes(M,s.children??s._loadedRoutes))}return An(u).pipe(pu())}preloadConfig(i,c){return this.preloadingStrategy.preload(c,()=>{let u;c.loadChildren&&c.canLoad===void 0?u=this.loader.loadChildren(i,c):u=yt(null);let s=u.pipe(Jn(x=>x===null?yt(void 0):(c._loadedRoutes=x.routes,c._loadedInjector=x.injector,this.processRoutes(x.injector??i,x.routes))));if(c.loadComponent&&!c._loadedComponent){let x=this.loader.loadComponent(c);return An([s,x]).pipe(pu())}else return s})}static \u0275fac=function(c){return new(c||t)(ht(Bn),ht(Vg),ht(Pr),ht(yy),ht(Ox))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oS=new ot(""),Kj=(()=>{class t{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(i,c,u,s,x={}){this.urlSerializer=i,this.transitions=c,this.viewportScroller=u,this.zone=s,this.options=x,x.scrollPositionRestoration||="disabled",x.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof ed?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=i.navigationTrigger,this.restoredId=i.restoredState?i.restoredState.navigationId:0):i instanceof Zo?(this.lastId=i.id,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.urlAfterRedirects).fragment)):i instanceof ja&&i.code===ly.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(i,this.urlSerializer.parse(i.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(i=>{i instanceof uy&&(i.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(i.position):i.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(i.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(i,c){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new uy(i,this.lastSource==="popstate"?this.store[this.restoredId]:null,c))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(c){_T()};static \u0275prov=nt({token:t,factory:t.\u0275fac})}return t})();function sS(t,...r){return Aa([{provide:Df,multi:!0,useValue:t},[],{provide:tr,useFactory:aS,deps:[Bn]},{provide:La,multi:!0,useFactory:lS},r.map(i=>i.\u0275providers)])}function aS(t){return t.routerState.root}function Nf(t,r){return{\u0275kind:t,\u0275providers:r}}function lS(){let t=Le(si);return r=>{let i=t.get(ai);if(r!==i.components[0])return;let c=t.get(Bn),u=t.get(cS);t.get(Fx)===1&&c.initialNavigation(),t.get(uS,null,Lt.Optional)?.setUpPreloading(),t.get(oS,null,Lt.Optional)?.init(),c.resetRootComponentType(i.componentTypes[0]),u.closed||(u.next(),u.complete(),u.unsubscribe())}}var cS=new ot("",{factory:()=>new _r}),Fx=new ot("",{providedIn:"root",factory:()=>1});function Qj(){return Nf(2,[{provide:Fx,useValue:0},{provide:jg,multi:!0,deps:[si],useFactory:r=>{let i=r.get(PM,Promise.resolve());return()=>i.then(()=>new Promise(c=>{let u=r.get(Bn),s=r.get(cS);rS(u,()=>{c(!0)}),r.get(Lx).afterPreactivation=()=>(c(!0),s.closed?yt(void 0):s),u.initialNavigation()}))}}])}function Jj(){return Nf(3,[{provide:jg,multi:!0,useFactory:()=>{let r=Le(Bn);return()=>{r.setUpLocationChangeListener()}}},{provide:Fx,useValue:2}])}var uS=new ot("");function e3(t){return Nf(0,[{provide:uS,useExisting:Yj},{provide:yy,useExisting:t}])}function t3(){return Nf(8,[xD,{provide:_y,useExisting:xD}])}function n3(t){let r=[{provide:JD,useValue:jj},{provide:eS,useValue:et({skipNextTransition:!!t?.skipInitialTransition},t)}];return Nf(9,r)}var r3=[Gu,{provide:Pf,useClass:Ju},Bn,Rf,{provide:tr,useFactory:aS,deps:[Bn]},Ox,[]],dS=(()=>{class t{constructor(){}static forRoot(i,c){return{ngModule:t,providers:[r3,[],{provide:Df,multi:!0,useValue:i},[],c?.errorHandler?{provide:tS,useValue:c.errorHandler}:[],{provide:Of,useValue:c||{}},c?.useHash?o3():s3(),i3(),c?.preloadingStrategy?e3(c.preloadingStrategy).\u0275providers:[],c?.initialNavigation?a3(c):[],c?.bindToComponentInputs?t3().\u0275providers:[],c?.enableViewTransitions?n3().\u0275providers:[],l3()]}}static forChild(i){return{ngModule:t,providers:[{provide:Df,multi:!0,useValue:i}]}}static \u0275fac=function(c){return new(c||t)};static \u0275mod=ju({type:t});static \u0275inj=Ru({})}return t})();function i3(){return{provide:oS,useFactory:()=>{let t=Le(FM),r=Le(kn),i=Le(Of),c=Le(Lx),u=Le(Pf);return i.scrollOffset&&t.setOffset(i.scrollOffset),new Kj(u,c,t,r,i)}}}function o3(){return{provide:js,useClass:RM}}function s3(){return{provide:js,useClass:Fb}}function a3(t){return[t.initialNavigation==="disabled"?Jj().\u0275providers:[],t.initialNavigation==="enabledBlocking"?Qj().\u0275providers:[]]}var ID=new ot("");function l3(){return[{provide:ID,useFactory:lS},{provide:La,multi:!0,useExisting:ID}]}var ic=function(t){return t[t.State=0]="State",t[t.Transition=1]="Transition",t[t.Sequence=2]="Sequence",t[t.Group=3]="Group",t[t.Animate=4]="Animate",t[t.Keyframes=5]="Keyframes",t[t.Style=6]="Style",t[t.Trigger=7]="Trigger",t[t.Reference=8]="Reference",t[t.AnimateChild=9]="AnimateChild",t[t.AnimateRef=10]="AnimateRef",t[t.Query=11]="Query",t[t.Stagger=12]="Stagger",t}(ic||{});function by(t,r){return{type:ic.Trigger,name:t,definitions:r,options:{}}}function Lf(t,r=null){return{type:ic.Animate,styles:r,timings:t}}function hS(t,r=null){return{type:ic.Group,steps:t,options:r}}function oc(t){return{type:ic.Style,styles:t,offset:null}}function xy(t,r,i=null){return{type:ic.Transition,expr:t,animation:r,options:i}}function wy(t,r,i=null){return{type:ic.Query,selector:t,animation:r,options:i}}var c3=["mapCanvas"],u3=["particleCanvas"],d3=()=>["/select-mode"],h3=()=>["/leaderboard"],f3=()=>["/how-to-play"],p3=()=>["/about"],Cy=class t{mapCanvas;particleCanvas;particles=[];ngOnInit(){this.initializeParticles()}ngAfterViewInit(){this.setupBackground(),this.animateParticles()}initializeParticles(){for(let r=0;r<100;r++)this.particles.push({x:Math.random()*window.innerWidth,y:Math.random()*window.innerHeight,speed:.5+Math.random()*1,size:1+Math.random()*2})}setupBackground(){let r=this.mapCanvas.nativeElement,i=r.getContext("2d");if(!i)return;r.width=window.innerWidth,r.height=window.innerHeight;let c=0,u=()=>{i.fillStyle="rgba(57, 58, 85, 0.9)",i.fillRect(0,0,r.width,r.height),i.strokeStyle="rgba(255, 255, 255, 0)",i.beginPath();for(let s=-c;s<r.width;s+=50)for(let x=0;x<r.height;x+=50)i.moveTo(s,x),i.lineTo(s+30,x);i.stroke(),c=(c+.5)%50,requestAnimationFrame(u)};u()}animateParticles(){let r=this.particleCanvas.nativeElement,i=r.getContext("2d");if(!i)return;r.width=window.innerWidth,r.height=window.innerHeight;let c=()=>{i.clearRect(0,0,r.width,r.height),this.particles.forEach(u=>{u.y-=u.speed,u.y<0&&(u.y=r.height,u.x=Math.random()*r.width),i.fillStyle="#fff",i.beginPath(),i.arc(u.x,u.y,u.size,0,Math.PI*2),i.fill()}),requestAnimationFrame(c)};c()}onButtonHover(r){let i=r.target;i.style.transform="scale(1.05)"}onButtonLeave(r){let i=r.target;i.style.transform="scale(1)"}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-home"]],viewQuery:function(i,c){if(i&1&&(Pi(c3,5),Pi(u3,5)),i&2){let u;di(u=hi())&&(c.mapCanvas=u.first),di(u=hi())&&(c.particleCanvas=u.first)}},decls:24,vars:9,consts:[["mapCanvas",""],["particleCanvas",""],[1,"game-container"],[1,"background-map"],[1,"overlay"],[1,"particle-layer"],[1,"content"],[1,"neon-title"],[1,"subtitle"],[1,"gradient-button",3,"mouseenter","mouseleave","routerLink"],[1,"menu-options",3,"routerLink"],[1,"glass-button","leader"],[1,"fas","fa-trophy"],[1,"how","glass-button",3,"routerLink"],[1,"fa-solid","fa-circle-question"],[1,"glass-button","about",3,"routerLink"],[1,"fa-solid","fa-users"]],template:function(i,c){if(i&1){let u=Si();we(0,"div",2)(1,"div",3),Ct(2,"canvas",null,0)(4,"div",4),Me(),Ct(5,"canvas",5,1),we(7,"div",6)(8,"h1",7),De(9,"GlobeTreck"),Me(),we(10,"p",8),De(11,"Test your geography knowledge in fun and challenging modes!"),Me(),we(12,"button",9),qt("mouseenter",function(x){return ci(u),ui(c.onButtonHover(x))})("mouseleave",function(x){return ci(u),ui(c.onButtonLeave(x))}),De(13," Start Game "),Me(),we(14,"div",10)(15,"button",11),Ct(16,"i",12),De(17," Leaderboard "),Me(),we(18,"button",13),Ct(19,"i",14),De(20," How to Play "),Me(),we(21,"button",15),Ct(22,"i",16),De(23," About Us "),Me()()()()}i&2&&(Ze(7),Mt("@fadeIn",void 0),Ze(5),Mt("routerLink",nf(5,d3)),Ze(2),Mt("routerLink",nf(6,h3)),Ze(4),Mt("routerLink",nf(7,f3)),Ze(3),Mt("routerLink",nf(8,p3)))},dependencies:[dS,iS],styles:['[_nghost-%COMP%]{display:block;width:100vw;height:100vh;overflow:hidden}.game-container[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#000;font-family:Arvo,serif}.background-map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;opacity:.4}.background-map[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,transparent 30%,rgba(0,0,0,.8) 100%)}.particle-layer[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.content[_ngcontent-%COMP%]{position:relative;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:2rem;text-align:center}.neon-title[_ngcontent-%COMP%]{font-size:3rem;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.5em;margin-bottom:1rem;text-shadow:0 0 5px var(--neon-color),0 0 10px var(--neon-color),0 0 20px var(--neon-color),0 0 40px var(--neon-color);animation:_ngcontent-%COMP%_glow 2s ease-in-out infinite alternate}.subtitle[_ngcontent-%COMP%]{color:#fff;font-size:1.2rem;margin-bottom:3rem;opacity:.8}.gradient-button[_ngcontent-%COMP%]{padding:1rem 3rem;font-size:1.5rem;color:#fff;background:#ffffff1a;border:none;border-radius:50px;cursor:pointer;transition:all .3s ease;margin-bottom:3rem;position:relative;overflow:hidden;opacity:0;transform:translateY(50px) scale(.8);animation:_ngcontent-%COMP%_fadeInUpScale .8s cubic-bezier(.25,1,.5,1) forwards}.gradient-button[_ngcontent-%COMP%]:hover{transform:scale(1.05);box-shadow:0 0 20px #393a55e6}.gradient-button[_ngcontent-%COMP%]:after{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.1),transparent);transform:rotate(45deg);animation:_ngcontent-%COMP%_shine 3s infinite}.menu-options[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:2rem;margin-top:1rem}.glass-button[_ngcontent-%COMP%]{padding:1rem 2rem;background:#ffffff1a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:10px;color:#fff;font-size:1rem;width:35vh;height:12vh;text-align:center;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:.5rem;opacity:0;transform:translateY(50px) scale(.8);animation:_ngcontent-%COMP%_fadeInUpScale 1s cubic-bezier(.25,1,.5,1) forwards}.glass-button[_ngcontent-%COMP%]:hover{background:#fff3;transform:translateY(-2px)}.glass-button[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem}@keyframes _ngcontent-%COMP%_glow{0%{text-shadow:0 0 5px var(--neon-color),0 0 10px var(--neon-color),0 0 20px var(--neon-color)}to{text-shadow:0 0 10px var(--neon-color),0 0 20px var(--neon-color),0 0 40px var(--neon-color),0 0 60px var(--neon-color)}}@keyframes _ngcontent-%COMP%_shine{0%{transform:rotate(45deg) translate(-100%)}to{transform:rotate(45deg) translate(100%)}}@keyframes _ngcontent-%COMP%_fadeInUpScale{0%{opacity:0;transform:translateY(50px) scale(.8)}to{opacity:1;transform:translateY(0) scale(1)}}@media (max-width: 768px){.neon-title[_ngcontent-%COMP%]{font-size:3rem;letter-spacing:.3em}.menu-options[_ngcontent-%COMP%]{flex-direction:column}}@keyframes _ngcontent-%COMP%_slideInLeft{0%{opacity:0;transform:translate(-50px)}to{opacity:1;transform:translate(0)}}@keyframes _ngcontent-%COMP%_slideInRight{0%{opacity:0;transform:translate(50px)}to{opacity:1;transform:translate(0)}}.subtitle[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_slideInLeft 1s cubic-bezier(.25,1,.5,1) forwards;animation-delay:.2s}.neon-title[_ngcontent-%COMP%]{opacity:0;animation:_ngcontent-%COMP%_slideInRight 1s cubic-bezier(.25,1,.5,1) forwards;animation-delay:.4s}.about[_ngcontent-%COMP%], .how[_ngcontent-%COMP%], .leader[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}'],data:{animation:[by("fadeIn",[xy(":enter",[oc({opacity:0,transform:"translateY(20px)"}),Lf("1s ease-out",oc({opacity:1,transform:"translateY(0)"}))])])]}})};var Ey=class t{constructor(r){this.router=r}currentBackground="assets/images/default-bg.jpg";selectedMode=null;tostreetviewmode(){this.router.navigate(["streetview"])}tolandmarksmode(){this.router.navigate(["landmarks"])}toflagsmode(){this.router.navigate(["flags"])}selectMode(r){switch(this.selectedMode=r,r){case"street":this.currentBackground="/images/transition-select-mode/street-trans.png";break;case"landmark":this.currentBackground="/images/transition-select-mode/3599.jpg";break;case"flags":this.currentBackground="/images/transition-select-mode/flags-trans.png";break}}startSelectedMode(){switch(this.selectedMode){case"street":this.tostreetviewmode();break;case"landmark":this.tolandmarksmode();break;case"flags":this.toflagsmode();break}}static \u0275fac=function(i){return new(i||t)(xt(Bn))};static \u0275cmp=Gt({type:t,selectors:[["app-selectmode"]],decls:19,vars:9,consts:[[1,"main"],[1,"header"],[1,"logo"],["src","/logo-removebg.png","alt",""],[1,"title"],["id","holder"],["id","street",1,"mode",3,"click"],[1,"mode-text"],["id","landmark",1,"mode",3,"click"],["id","flags",1,"mode",3,"click"],[1,"select"],[1,"button-33",3,"click","disabled"]],template:function(i,c){i&1&&(we(0,"div",0)(1,"div",1)(2,"div",2),Ct(3,"img",3),Me(),we(4,"div",4),De(5,"Select Mode"),Me()(),we(6,"div",5)(7,"div",6),qt("click",function(){return c.selectMode("street")}),we(8,"span",7),De(9,"StreetView"),Me()(),we(10,"div",8),qt("click",function(){return c.selectMode("landmark")}),we(11,"span",7),De(12,"Landmarks"),Me()(),we(13,"div",9),qt("click",function(){return c.selectMode("flags")}),we(14,"span",7),De(15,"Flags"),Me()()(),we(16,"div",10)(17,"button",11),qt("click",function(){return c.startSelectedMode()}),De(18,"Select This Mode"),Me()()()),i&2&&($o("background-image","url("+c.currentBackground+")"),Ze(7),tf("selected",c.selectedMode==="street"),Ze(3),tf("selected",c.selectedMode==="landmark"),Ze(3),tf("selected",c.selectedMode==="flags"),Ze(4),Mt("disabled",!c.selectedMode))},styles:['.main[_ngcontent-%COMP%]{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background-size:cover;background-position:center;transition:background-image .5s ease-in-out}.main[_ngcontent-%COMP%]:before{content:"";position:absolute;inset:0;background:radial-gradient(circle at center bottom,#393a55e6,#1a1b26f2);pointer-events:none;z-index:1}.header[_ngcontent-%COMP%], #holder[_ngcontent-%COMP%], .select[_ngcontent-%COMP%]{position:relative;z-index:2}.header[_ngcontent-%COMP%]{height:20vh;display:flex;align-items:center;justify-content:center;padding:20px}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:80px;height:80px;margin-right:15px;transition:transform .3s ease-in-out}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.1)}.title[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;border-right:2px solid white;font-size:7vh;font-family:Cinzel,monospace;color:#fff;width:fit-content;margin:0 auto;font-weight:700;font-family:Arvo,serif;letter-spacing:3px;animation:_ngcontent-%COMP%_typing 1s steps(10,end),_ngcontent-%COMP%_blinkCursor 1s step-end}@keyframes _ngcontent-%COMP%_typing{0%{width:3ch}to{width:10ch}}@keyframes _ngcontent-%COMP%_blinkCursor{0%,to{border-color:#fff}50%{border-color:transparent}}#holder[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;gap:30px;flex-wrap:wrap;padding:20px}.mode[_ngcontent-%COMP%]{position:relative;width:250px;height:300px;border-radius:10px;overflow:hidden;cursor:pointer;transition:transform .3s ease-in-out,box-shadow .3s ease-in-out}.mode[_ngcontent-%COMP%]:hover{transform:scale(1.07);box-shadow:0 0 20px #fff3}.mode[_ngcontent-%COMP%]:before{content:"";background-size:cover;background-position:center;position:absolute;inset:0;transition:transform .3s ease-in-out,filter .3s ease-in-out}#street[_ngcontent-%COMP%]:before{background-image:url(/images/modesbg/streetview.jpg)}#landmark[_ngcontent-%COMP%]:before{background-image:url(/images/modesbg/landmark.png)}#flags[_ngcontent-%COMP%]:before{background-image:url(/images/modesbg/flags.jpg)}.mode[_ngcontent-%COMP%]:hover:before{transform:scale(1.1);filter:brightness(1.2)}@keyframes _ngcontent-%COMP%_fadeInUpScale{0%{opacity:0;transform:translateY(50px) scale(.8)}to{opacity:1;transform:translateY(0) scale(1)}}.mode[_ngcontent-%COMP%]{opacity:0;transform:translateY(50px) scale(.8);animation:_ngcontent-%COMP%_fadeInUpScale .8s cubic-bezier(.25,1,.5,1) forwards}.mode[_ngcontent-%COMP%]:nth-child(1){animation-delay:.2s}.mode[_ngcontent-%COMP%]:nth-child(2){animation-delay:.4s}.mode[_ngcontent-%COMP%]:nth-child(3){animation-delay:.6s}.mode[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:linear-gradient(to bottom,#0000004d,#000000b3);transition:background .3s ease-in-out}.mode[_ngcontent-%COMP%]:hover:after{background:linear-gradient(to bottom,#0003,#0009)}.mode-text[_ngcontent-%COMP%]{color:#ecefce;font-size:1.6em;font-weight:700;position:absolute;bottom:20px;left:50%;transform:translate(-50%);text-shadow:2px 2px 10px rgba(0,0,0,.7);transition:opacity .3s ease-in-out}.select[_ngcontent-%COMP%]{position:relative;margin-top:40px;padding:20px;z-index:2}@media (max-width: 768px){.title[_ngcontent-%COMP%]{font-size:2.5em}.mode[_ngcontent-%COMP%]{width:200px;height:250px}.mode-text[_ngcontent-%COMP%]{font-size:1.3em}}@media (max-width: 480px){.title[_ngcontent-%COMP%]{font-size:2em;text-align:center}.mode[_ngcontent-%COMP%]{width:90%;height:200px}.mode-text[_ngcontent-%COMP%]{font-size:1.2em}}.button-33[_ngcontent-%COMP%]{background-color:#448aff;border-radius:100px;box-shadow:#448aff33 0 -25px 18px -14px inset,#448aff26 0 1px 2px,#448aff26 0 2px 4px,#448aff26 0 4px 8px,#448aff26 0 8px 16px,#448aff26 0 16px 32px;color:#e0e0e0;cursor:pointer;display:inline-block;font-family:CerebriSans-Regular,-apple-system,system-ui,Roboto,sans-serif;padding:1vh 3vh;text-align:center;text-decoration:none;transition:all .25s;border:0;font-size:3vh;user-select:none;-webkit-user-select:none;touch-action:manipulation;opacity:0;transform:translateY(50px) scale(.8);animation:_ngcontent-%COMP%_fadeInUpScale .8s cubic-bezier(.25,1,.5,1) forwards;transition:all .3s ease-in-out}.button-33[_ngcontent-%COMP%]:hover{box-shadow:#448aff59 0 -25px 18px -14px inset,#448aff40 0 1px 2px,#448aff40 0 2px 4px,#448aff40 0 4px 8px,#448aff40 0 8px 16px,#448aff40 0 16px 32px;transform:scale(1.05) rotate(-1deg)}.button-33[_ngcontent-%COMP%]:disabled{opacity:.3;cursor:not-allowed;pointer-events:none;background-color:#448aff33}']})};var sc=Sh(id());var Wo=class t{storageKey="leaderboard";constructor(){}getLeaderboard(r){let i=localStorage.getItem(this.storageKey),c=i?JSON.parse(i):[];return r?c.filter(u=>u.mode===r):c}addEntry(r){let i=this.getLeaderboard();i.push(r),i.sort((c,u)=>u.score-c.score),localStorage.setItem(this.storageKey,JSON.stringify(i))}clearLeaderboard(r){let i=this.getLeaderboard().filter(c=>c.mode!==r);localStorage.setItem(this.storageKey,JSON.stringify(i))}static \u0275fac=function(i){return new(i||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})};var m3=["mapContainer"];function g3(t,r){if(t&1){let i=Si();we(0,"button",17),qt("click",function(){ci(i);let u=er();return ui(u.goToNextRound())}),De(1," START NEXT ROUND "),Me()}}function y3(t,r){if(t&1){let i=Si();we(0,"button",17),qt("click",function(){ci(i);let u=er();return ui(u.saveScore())}),De(1," SAVE SCORE "),Me()}}function _3(t,r){t&1&&(we(0,"a",18),De(1," Leaderboard "),Me())}var Ty=class t{constructor(r,i,c){this.route=r;this.router=i;this.leaderboardService=c}mapContainer;map;streetViewLocation;NoAnswer=!0;clickedLocation;distance=null;timeLeft=0;roundScore=0;totalScore=0;round=1;isFinal=!1;timePassed=0;myclick=null;markerImagePath="/images/marker.jpg";ngOnInit(){this.route.queryParams.subscribe(r=>{this.streetViewLocation={latitude:+r.streetViewLat,longitude:+r.streetViewLng},this.NoAnswer=r.NoAnswer==="true",this.NoAnswer?this.clickedLocation=null:(this.distance=Math.round(+r.Distance),this.clickedLocation={latitude:+r.clickedLat,longitude:+r.clickedLng}),this.timeLeft=+r.timeLeft||0,this.roundScore=+r.roundScore,this.totalScore=+r.totalScore,this.round=+r.currentRound||1,this.timePassed=+r.timePassed||0}),this.round==5&&(this.isFinal=!0)}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.map=new sc.default.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ux7U0JoDzUbunhk0mxHh",center:[2,45],zoom:3}),this.map.on("load",()=>{this.NoAnswer?(new sc.default.Marker({color:"blue"}).setLngLat([this.streetViewLocation.longitude,this.streetViewLocation.latitude]).addTo(this.map),this.map.flyTo({center:[this.streetViewLocation.longitude,this.streetViewLocation.latitude],zoom:5,speed:.8,curve:1,essential:!0})):(this.addCustomMarker(this.clickedLocation.longitude,this.clickedLocation.latitude),new sc.default.Marker({color:"blue"}).setLngLat([this.streetViewLocation.longitude,this.streetViewLocation.latitude]).addTo(this.map),this.drawLine())})}splitLineSegment(r,i){if(Math.abs(i[0]-r[0])>180){let s=[(r[0]+i[0]+(r[0]>i[0]?360:-360))/2,(r[1]+i[1])/2],x=[r,s],M=[s,i];return this.splitLineSegment(x[0],x[1]).concat(this.splitLineSegment(M[0],M[1]))}else return[r,i]}splitLine(r){let i=[];for(let c=0;c<r.length-1;c++){let u=this.splitLineSegment(r[c],r[c+1]);u&&u[0]&&u[0][0]&&u[0][1]&&i.push(...u)}return i}drawLine(){let r=[[this.clickedLocation.longitude,this.clickedLocation.latitude],[this.streetViewLocation.longitude,this.streetViewLocation.latitude]],i=this.splitLine(r),c={type:"Feature",geometry:{type:"LineString",coordinates:i}};this.map.addSource("line",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:i}}}),this.map.addLayer({id:"lineLayer",type:"line",source:"line",paint:{"line-color":"#000000","line-width":1.5,"line-dasharray":[3,3],"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}});let u=new sc.default.LngLatBounds;i.forEach(s=>{u.extend(new sc.default.LngLat(s[0],s[1]))}),this.map.fitBounds(u,{padding:{top:50,bottom:50,left:50,right:50},duration:1500})}goToNextRound(){this.round++,this.router.navigate(["/streetview"],{queryParams:{totalScore:this.totalScore,round:this.round,timePassed:this.timePassed}})}saveScore(){let r=prompt("Enter your name:");if(!r)return;let i={name:r,score:this.totalScore,time:`${Math.floor(this.timePassed/60)}m ${this.timePassed%60}s`,mode:"Street View Mode"};this.leaderboardService.addEntry(i),this.timePassed=0}addCustomMarker(r,i){let c=document.createElement("div");c.className="custom-marker";let u=document.createElement("img");u.src=this.markerImagePath,u.alt="Marker",u.style.maxWidth="24px",u.style.maxHeight="24px",c.appendChild(u),this.myclick=new sc.default.Marker({element:c,anchor:"bottom"}).setLngLat([r,i]).addTo(this.map)}static \u0275fac=function(i){return new(i||t)(xt(tr),xt(Bn),xt(Wo))};static \u0275cmp=Gt({type:t,selectors:[["app-results"]],viewQuery:function(i,c){if(i&1&&Pi(m3,5),i&2){let u;di(u=hi())&&(c.mapContainer=u.first)}},decls:45,vars:11,consts:[["mapContainer",""],[1,"game-screen"],[1,"round-title"],["id","map"],[1,"results-section"],[1,"score-container"],[1,"distance"],[1,"points"],[1,"score-bar"],[1,"score-progress"],[1,"tables-container"],[1,"info-table"],[1,"table-title"],[1,"button-container"],["class","next-round-btn",3,"click",4,"ngIf"],["href","/leaderboard","class","leaderbtn",4,"ngIf"],["href","/home",1,"secondary-button"],[1,"next-round-btn",3,"click"],["href","/leaderboard",1,"leaderbtn"]],template:function(i,c){i&1&&(we(0,"div",1)(1,"h2",2),De(2),Me(),Ct(3,"div",3,0),we(5,"div",4)(6,"div",5)(7,"div",6)(8,"p")(9,"strong"),De(10,"You Are"),Me(),De(11),we(12,"strong"),De(13,"Far"),Me()()(),we(14,"div",7),De(15),Me(),we(16,"div",8),Ct(17,"div",9),Me()(),we(18,"div",10)(19,"div",11)(20,"h3",12),De(21,"Round Results"),Me(),we(22,"table")(23,"tbody")(24,"tr")(25,"td"),De(26,"Round"),Me(),we(27,"td"),De(28),Me()(),we(29,"tr")(30,"td"),De(31,"Total Score"),Me(),we(32,"td"),De(33),Me()(),we(34,"tr")(35,"td"),De(36,"Time Left"),Me(),we(37,"td"),De(38),Me()()()()()(),we(39,"div",13),Zn(40,g3,2,0,"button",14)(41,y3,2,0,"button",14)(42,_3,2,0,"a",15),we(43,"a",16),De(44," RETURN HOME "),Me()()()()),i&2&&(Ze(2),Yt("Round ",c.round,""),Ze(9),Yt(" ",c.distance,"KM "),Ze(4),Yt("",c.roundScore," points"),Ze(2),$o("width",c.roundScore/200*100,"%"),Ze(11),Yt("",c.round,"/5"),Ze(5),Hr(c.totalScore),Ze(5),Yt("",c.timeLeft," seconds"),Ze(2),Mt("ngIf",!c.isFinal),Ze(),Mt("ngIf",c.isFinal),Ze(),Mt("ngIf",c.isFinal))},dependencies:[ur,Rr],styles:[".game-screen[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a1b26;padding:20px;display:flex;flex-direction:column;align-items:center}.round-title[_ngcontent-%COMP%]{color:#fff;font-size:28px;font-weight:700;font-style:italic;margin:20px 0}#map[_ngcontent-%COMP%]{width:70vh;height:30vh;background-color:#2a2b36;border-radius:8px;margin-bottom:30px}.map[_ngcontent-%COMP%]{width:auto;height:auto}.results-section[_ngcontent-%COMP%]{width:100%;max-width:800px;text-align:center}.score-container[_ngcontent-%COMP%]{margin-bottom:30px}.points[_ngcontent-%COMP%]{color:#fbbf24;font-size:24px;font-weight:700;margin-bottom:15px}.score-bar[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#374151;border-radius:4px;overflow:hidden;margin-bottom:15px}.score-progress[_ngcontent-%COMP%]{height:100%;background-color:#fbbf24;border-radius:4px;transition:width .5s ease}.tables-container[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:30px;justify-content:center;flex-wrap:wrap}.info-table[_ngcontent-%COMP%]{background-color:#ffffff0d;border-radius:12px;padding:20px;min-width:300px;flex:1;max-width:400px;display:flex;flex-direction:column;box-shadow:0 4px 10px #0003}.table-title[_ngcontent-%COMP%]{color:#fbbf24;font-size:18px;margin-bottom:10px;font-weight:700;display:flex;align-items:center;gap:10px}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 8px}tr[_ngcontent-%COMP%]{transition:background-color .2s ease}tr[_ngcontent-%COMP%]:hover{background-color:#ffffff08}td[_ngcontent-%COMP%]{padding:10px 12px;text-align:left;color:#9ca3af;border-bottom:1px solid rgba(255,255,255,.1)}td[_ngcontent-%COMP%]:first-child{color:#fff;font-weight:500}td[_ngcontent-%COMP%]:last-child{text-align:right}.flag-image[_ngcontent-%COMP%]{width:10vh;height:6vh;border-radius:5px;object-fit:cover;display:inline-block;vertical-align:middle}.button-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:10px}.next-round-btn[_ngcontent-%COMP%]{background-color:#059669;color:#fff;padding:12px 20px;border-radius:9999px;border:2px solid #059669;border:none;font-weight:500;cursor:pointer;transition:background-color .2s ease;min-width:200px}.next-round-btn[_ngcontent-%COMP%]:hover{background:transparent;color:#059669;border:2px solid #059669}.secondary-button[_ngcontent-%COMP%]{background-color:#4b5563;color:#fff;padding:.75rem 2rem;border-radius:9999px;border:2px solid #374151;font-weight:500;cursor:pointer;width:32vh;text-align:center;text-decoration:none;transition:background-color .2s ease}.secondary-button[_ngcontent-%COMP%]:hover{background:transparent;color:#fff;border:2px solid #374151}.leaderbtn[_ngcontent-%COMP%]{background-color:#fbbf24;color:#1a1b26;padding:.75rem 2rem;border-radius:9999px;font-weight:700;cursor:pointer;border:2px solid #fbbf24;width:100%;text-align:center;text-decoration:none;font-size:1.1em;transition:background-color .2s ease}.leaderbtn[_ngcontent-%COMP%]:hover{background:transparent;color:#fbbf24;border:2px solid #fbbf24}@media (max-width: 768px){.tables-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.info-table[_ngcontent-%COMP%]{width:100%}}.distance[_ngcontent-%COMP%]{text-align:center;color:#fff;font-weight:900;font-size:1.7em}"]})};function v3(t,r){t&1&&(we(0,"span",12),De(1,"\u{1F947}"),Me())}function b3(t,r){t&1&&(we(0,"span",12),De(1,"\u{1F948}"),Me())}function x3(t,r){t&1&&(we(0,"span",12),De(1,"\u{1F949}"),Me())}function w3(t,r){if(t&1&&(we(0,"tr")(1,"td",10)(2,"span"),De(3),Me()(),we(4,"td"),De(5),Me(),we(6,"td"),Zn(7,v3,2,0,"span",11)(8,b3,2,0,"span",11)(9,x3,2,0,"span",11),De(10),Me(),we(11,"td"),De(12),Me()()),t&2){let i=r.$implicit,c=r.index;Ze(3),Yt("\xA0",c+1,""),Ze(2),Hr(i.name),Ze(2),Mt("ngIf",c===0),Ze(),Mt("ngIf",c===1),Ze(),Mt("ngIf",c===2),Ze(),Yt(" ",i.score," "),Ze(2),Hr(i.time)}}var My=class t{constructor(r){this.leaderboardService=r}modes=["Flags Mode","Street View Mode","Landmark Mode"];currentModeIndex=0;leaderboardData=[];ngOnInit(){this.updateLeaderboard()}updateLeaderboard(){let r=this.modes[this.currentModeIndex];this.leaderboardData=this.leaderboardService.getLeaderboard(r)}clearLeaderboard(){let r=this.modes[this.currentModeIndex];this.leaderboardService.clearLeaderboard(r),this.updateLeaderboard()}previousMode(){this.currentModeIndex=this.currentModeIndex===0?this.modes.length-1:this.currentModeIndex-1,this.updateLeaderboard()}nextMode(){this.currentModeIndex=this.currentModeIndex===this.modes.length-1?0:this.currentModeIndex+1,this.updateLeaderboard()}static \u0275fac=function(i){return new(i||t)(xt(Wo))};static \u0275cmp=Gt({type:t,selectors:[["app-leaderboard"]],decls:29,vars:2,consts:[[1,"all"],[1,"title"],[1,"frame"],[1,"prev"],[1,"slider-button","prev",3,"click"],[1,"leaderboard-container"],[4,"ngFor","ngForOf"],["href","/home",1,"secondary-button"],[1,"next"],[1,"slider-button","next",3,"click"],[1,"numbers"],["class","medals",4,"ngIf"],[1,"medals"]],template:function(i,c){i&1&&(we(0,"div",0)(1,"div",1)(2,"h1",1),De(3,"\u{1F3C6} Leaderboard"),Me()(),we(4,"div",2)(5,"div",3)(6,"button",4),qt("click",function(){return c.previousMode()}),De(7,"\u2039"),Me()(),we(8,"div",5)(9,"h2"),De(10),Me(),we(11,"table")(12,"thead")(13,"tr")(14,"th"),De(15,"Rank"),Me(),we(16,"th"),De(17,"Name"),Me(),we(18,"th"),De(19,"Score"),Me(),we(20,"th"),De(21,"Time"),Me()()(),we(22,"tbody"),Zn(23,w3,13,7,"tr",6),Me()(),we(24,"a",7),De(25," RETURN HOME "),Me()(),we(26,"div",8)(27,"button",9),qt("click",function(){return c.nextMode()}),De(28,"\u203A"),Me()()()()),i&2&&(Ze(10),Hr(c.modes[c.currentModeIndex]),Ze(13),Mt("ngForOf",c.leaderboardData))},dependencies:[ur,OM,Rr],styles:['.all[_ngcontent-%COMP%]{background:linear-gradient(20deg,rgba(0,87,183,.4) 0%,var(--primary-colorv2) 50%)}.title[_ngcontent-%COMP%]{font-family:Cinzel,serif;color:var(--secondary-colorv2);font-size:3rem;text-align:center;padding:5px 0;text-shadow:10px 10px 20px rgba(0,0,0,.3);letter-spacing:4px;font-weight:700;background:linear-gradient(90deg,#ffffff 0%,var(--secondary-colorv2) 10%);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;position:relative}.title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:-10px;left:50%;transform:translate(-50%);width:40vw;height:3px;background:linear-gradient(to right,transparent,var(--secondary-colorv2),transparent)}.frame[_ngcontent-%COMP%]{min-height:100vh;display:flex;justify-content:center;align-items:center;padding:1.5rem}.medals[_ngcontent-%COMP%]{font-size:1.8rem}.slider-container[_ngcontent-%COMP%]{width:100%;max-width:130vh;overflow:hidden;position:relative}.slider[_ngcontent-%COMP%]{display:flex;transition:transform .5s ease-in-out;width:300%}.leaderboard-slide[_ngcontent-%COMP%]{width:100%;flex-shrink:0}.leaderboard-container[_ngcontent-%COMP%]{background:var(--primary-colorv2);border-radius:16px;padding:2rem;box-shadow:0 8px 32px #00000080;width:100%;max-width:130vh;border:1px solid rgba(255,255,255,.1);position:relative}.leaderboard-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Cinzel,serif;color:#eee;font-size:2rem;margin-bottom:1.5rem;text-align:center;text-shadow:0 0 20px rgba(255,217,0,.3);letter-spacing:4px;font-weight:700;background-color:var(--secondary-colorv2);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;position:relative}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 8px;margin:1rem 0;font-family:Orbitron,sans-serif}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0057b71a}th[_ngcontent-%COMP%]{color:var(--secondary-colorv2);font-weight:700;text-transform:uppercase;font-size:1.2rem;letter-spacing:2px;padding:1rem;text-align:center;font-family:Rajdhani,sans-serif;text-shadow:0 0 10px rgba(255,215,0,.3)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0057b70d;transition:transform .3s ease,background .3s ease}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:#0057b726;transform:translate(4px)}td[_ngcontent-%COMP%]{color:#fff;padding:1rem;font-size:1rem;letter-spacing:1px}.numbers[_ngcontent-%COMP%]{font-weight:700;font-size:1.2rem;font-family:Orbitron,sans-serif}tr[_ngcontent-%COMP%]:nth-child(1)   td[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(255,215,0,.15),transparent);text-shadow:0 0 10px rgba(255,215,0,.6)}tr[_ngcontent-%COMP%]:nth-child(2)   td[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(192,192,192,.15),transparent);text-shadow:0 0 10px rgba(192,192,192,.6)}tr[_ngcontent-%COMP%]:nth-child(3)   td[_ngcontent-%COMP%]{background:linear-gradient(90deg,rgba(205,127,50,.15),transparent);text-shadow:0 0 10px rgba(205,127,50,.6)}tr[_ngcontent-%COMP%]:nth-child(n)   .numbers[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.5rem;display:inline-block;animation:_ngcontent-%COMP%_bounce 1s infinite}@keyframes _ngcontent-%COMP%_bounce{0%,to{transform:translateY(0)}50%{transform:translateY(-3px)}}button[_ngcontent-%COMP%]{font-family:Rajdhani,sans-serif;background:linear-gradient(30deg,#000,#132941 50%);color:#fff;border:3px solid var(--secondary-colorv2);padding:.75rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s;margin-top:1.5rem;text-transform:uppercase;letter-spacing:2px;font-size:.875rem;position:relative;overflow:hidden}button[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px var(--secondary-colorv2)}.slider-button[_ngcontent-%COMP%]{transform:translateY(-50%);background:#0009;border:2px solid var(--secondary-colorv2);color:var(--secondary-colorv2);font-size:3rem;font-weight:700;width:7vh;height:7vh;border-radius:50%;cursor:pointer;transition:transform .3s ease,background .3s ease;display:flex;align-items:center;justify-content:center;box-shadow:0 0 15px #ffd70080;z-index:1}.slider-button[_ngcontent-%COMP%]:hover{background:var(--secondary-colorv2);color:#000;transform:translateY(-50%) scale(1.1)}.slider-button.next[_ngcontent-%COMP%]{left:95%;margin-top:2px}.slider-button.prev[_ngcontent-%COMP%]{right:95%}@media (max-width: 768px){.leaderboard-container[_ngcontent-%COMP%]{padding:1rem;max-width:90vw}.leaderboard-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2.2rem}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:.75rem .5rem;font-size:.9rem}.slider-button[_ngcontent-%COMP%]{font-size:2rem;width:40px;height:40px}.slider-button.next[_ngcontent-%COMP%]{right:70%}.slider-button.prev[_ngcontent-%COMP%]{left:70%}}.secondary-button[_ngcontent-%COMP%]{background-color:#4b5563;color:#fff;padding:.75rem 2rem;border-radius:9999px;border:3px solid #374151;font-weight:500;cursor:pointer;width:100%;max-width:300px;text-align:center;display:inline-block;text-decoration:none;transition:background-color .2s ease}.secondary-button[_ngcontent-%COMP%]:hover{background:transparent;color:#fff;border:3px solid #374151}'],data:{animation:[by("fade",[xy("* => *",[wy(":enter",[oc({opacity:0})],{optional:!0}),hS([wy(":leave",[Lf("0.3s",oc({opacity:0}))],{optional:!0}),wy(":enter",[Lf("0.3s",oc({opacity:1}))],{optional:!0})])])])]}})};var Dy=class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-about"]],decls:29,vars:0,consts:[[1,"frame"],[1,"content"],[1,"title"],[1,"description"],[1,"credits"]],template:function(i,c){i&1&&(we(0,"div",0)(1,"div",1)(2,"h1",2),De(3,"About Our Game"),Me(),we(4,"p",3),De(5," Welcome to "),we(6,"strong"),De(7,"GlobeTreck"),Me(),De(8,", the ultimate geography challenge where every guess takes you on a journey around the world! "),Me(),we(9,"p",3)(10,"strong"),De(11,"GlobeTreck"),Me(),De(12," is an interactive web game that drops you into a random location on Earth using street view imagery. Your challenge? Figure out where you are! "),Me(),we(13,"p",3)(14,"strong"),De(15,"Why Play?"),Me(),Ct(16,"br"),De(17," - Improve your geography skills"),Ct(18,"br"),De(19," - Explore new places from your screen"),Ct(20,"br"),De(21," - Compete with friends for the best score"),Ct(22,"br"),De(23," - Learn fun facts about different locations "),Me(),we(24,"p",4)(25,"strong"),De(26,"Credits:"),Me(),Ct(27,"br"),De(28," Created by Hiba Zakari, Mohamed Amine Bazza, and El Mehdi Es-sakhi. "),Me()()())},styles:['[_nghost-%COMP%]{display:block;width:100vw;height:100vh;overflow:hidden}.frame[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#171723;font-family:Arvo,serif;display:flex;align-items:center;justify-content:center}.frame[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,transparent 30%,rgba(0,0,0,.9) 100%);opacity:.6;z-index:1}.content[_ngcontent-%COMP%]{position:relative;z-index:2;background:#ffffff1a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:15px;padding:2rem 3rem;text-align:center;max-width:600px;box-shadow:0 0 20px #fff3;opacity:0;transform:translateY(50px) scale(.9);animation:_ngcontent-%COMP%_fadeInUpScale 1s cubic-bezier(.25,1,.5,1) forwards}.title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.2em;margin-bottom:1rem;text-shadow:0 0 10px var(--neon-color),0 0 20px var(--neon-color);animation:_ngcontent-%COMP%_glow 2s ease-in-out infinite alternate}.description[_ngcontent-%COMP%]{color:#ddd;font-size:1.2rem;line-height:1.6;margin-bottom:1rem}.credits[_ngcontent-%COMP%]{color:#fc0;font-size:1rem;margin-top:2rem}@keyframes _ngcontent-%COMP%_fadeInUpScale{0%{opacity:0;transform:translateY(50px) scale(.9)}to{opacity:1;transform:translateY(0) scale(1)}}@keyframes _ngcontent-%COMP%_glow{0%{text-shadow:0 0 10px var(--neon-color),0 0 20px var(--neon-color)}to{text-shadow:0 0 20px var(--neon-color),0 0 40px var(--neon-color)}}@media (max-width: 768px){.content[_ngcontent-%COMP%]{max-width:90%;padding:1.5rem 2rem}.title[_ngcontent-%COMP%]{font-size:2rem}.description[_ngcontent-%COMP%]{font-size:1rem}}']})};var Sy=class t{static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-how-to-play"]],decls:31,vars:0,consts:[[1,"frame"],[1,"content"],[1,"title"],[1,"description"]],template:function(i,c){i&1&&(we(0,"div",0)(1,"div",1)(2,"h1",2),De(3,"How to Play"),Me(),we(4,"p",3),De(5," 1. "),we(6,"strong"),De(7,"Start the Game"),Me(),De(8,' - Click "Play" to get a random street view. '),Me(),we(9,"p",3),De(10," 2. "),we(11,"strong"),De(12,"Look Around"),Me(),De(13," - Rotate and explore to find clues. "),Me(),we(14,"p",3),De(15," 3. "),we(16,"strong"),De(17,"Make a Guess"),Me(),De(18," - Click on the map to place your pin. "),Me(),we(19,"p",3),De(20," 4. "),we(21,"strong"),De(22,"Submit & Score"),Me(),De(23," - The closer your guess, the higher your score! "),Me(),we(24,"p",3),De(25," 5. "),we(26,"strong"),De(27,"Play Again"),Me(),De(28," - Challenge yourself and improve your accuracy! "),Me(),we(29,"p",3),De(30," Good luck, and may your guesses be spot on! "),Me()()())},styles:['[_nghost-%COMP%]{display:block;width:100vw;height:100vh;overflow:hidden}.frame[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background:#171723;font-family:Arvo,serif;display:flex;align-items:center;justify-content:center;text-align:center}.frame[_ngcontent-%COMP%]:before{content:"";position:absolute;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at center,transparent 30%,rgba(0,0,0,.8) 100%);opacity:.4}.content[_ngcontent-%COMP%]{position:relative;z-index:2;max-width:600px;padding:2rem;background:#ffffff1a;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);border-radius:15px;box-shadow:0 0 15px #ffffff1a;color:#fff;animation:_ngcontent-%COMP%_fadeInUpScale 1s cubic-bezier(.25,1,.5,1) forwards}.title[_ngcontent-%COMP%]{font-size:2.5rem;font-weight:700;color:#fff;text-transform:uppercase;letter-spacing:.2em;margin-bottom:1rem;text-shadow:0 0 5px var(--neon-color),0 0 10px var(--neon-color);animation:_ngcontent-%COMP%_glow 2s ease-in-out infinite alternate}.description[_ngcontent-%COMP%]{font-size:1.2rem;margin-bottom:1rem;opacity:.9;line-height:1.6;text-shadow:0 0 5px rgba(255,255,255,.1)}.description[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--neon-color);font-weight:700}@keyframes _ngcontent-%COMP%_glow{0%{text-shadow:0 0 5px var(--neon-color),0 0 10px var(--neon-color)}to{text-shadow:0 0 10px var(--neon-color),0 0 20px var(--neon-color)}}@keyframes _ngcontent-%COMP%_fadeInUpScale{0%{opacity:0;transform:translateY(50px) scale(.8)}to{opacity:1;transform:translateY(0) scale(1)}}@media (max-width: 768px){.title[_ngcontent-%COMP%]{font-size:2rem;letter-spacing:.1em}.content[_ngcontent-%COMP%]{padding:1.5rem}.description[_ngcontent-%COMP%]{font-size:1rem}}']})};var sd=Sh(id());var C3=["mapContainer"],od=class t{constructor(r){this.renderer=r}mapContainer;locationClicked=new Rn;map;myclick=null;clickedLocation;NoAnswer=!0;markerImagePath="/images/Pennant.jpg";ngAfterViewInit(){this.initializeMap(),this.addHoverEffect()}addHoverEffect(){this.mapContainer&&(this.renderer.setStyle(this.mapContainer.nativeElement,"transform-origin","bottom left"),this.renderer.listen(this.mapContainer.nativeElement,"mouseover",()=>{this.renderer.setStyle(this.mapContainer.nativeElement,"transform","scale(1.5)"),this.renderer.setStyle(this.mapContainer.nativeElement,"transition","transform 0.3s ease-in-out")}),this.renderer.listen(this.mapContainer.nativeElement,"mouseleave",()=>{this.renderer.setStyle(this.mapContainer.nativeElement,"transform","scale(1)")}))}initializeMap(){return on(this,null,function*(){this.map=new sd.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ux7U0JoDzUbunhk0mxHh",center:[2,45],zoom:3}),this.map.addControl(new sd.NavigationControl),this.map.on("click",r=>{this.NoAnswer=!1,this.myclick&&this.myclick.remove(),this.clickedLocation={latitude:r.lngLat.lat,longitude:r.lngLat.lng},this.addCustomMarker(r.lngLat.lng,r.lngLat.lat),this.locationClicked.emit({location:this.clickedLocation,noAnswer:this.NoAnswer})})})}addCustomMarker(r,i){let c=document.createElement("div");c.className="custom-marker";let u=document.createElement("img");u.src=this.markerImagePath,u.alt="Marker",u.style.width="25px",u.style.height="25px",c.appendChild(u),this.myclick=new sd.Marker({element:c,anchor:"center"}).setLngLat([r,i]).addTo(this.map)}static \u0275fac=function(i){return new(i||t)(xt(Kl))};static \u0275cmp=Gt({type:t,selectors:[["app-sv-maplibre"]],viewQuery:function(i,c){if(i&1&&Pi(C3,5),i&2){let u;di(u=hi())&&(c.mapContainer=u.first)}},outputs:{locationClicked:"locationClicked"},decls:2,vars:0,consts:[["mapContainer",""],["id","map"]],template:function(i,c){i&1&&Ct(0,"div",1,0)},styles:["#map[_ngcontent-%COMP%]{width:100%;height:100%;position:relative}.maplibregl-canvas[_ngcontent-%COMP%]{will-change:transform;backface-visibility:hidden;transform:translateZ(0)}"]})};var Py=class t{dataUrl="data/Hard-streetviews.json";shuffledLocations=[];currentIndex=0;constructor(){}getRandomLocation(){return on(this,null,function*(){return(this.shuffledLocations.length===0||this.currentIndex>=this.shuffledLocations.length)&&(yield this.shuffleLocations(),this.currentIndex=0),this.shuffledLocations[this.currentIndex++]})}shuffleLocations(){return on(this,null,function*(){let i=yield(yield fetch(this.dataUrl)).json();this.shuffledLocations=this.fisherYatesShuffle(i.locations)})}fisherYatesShuffle(r){for(let i=r.length-1;i>0;i--){let c=Math.floor(Math.random()*(i+1));[r[i],r[c]]=[r[c],r[i]]}return r}static \u0275fac=function(i){return new(i||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})};var I3=(t,r,i)=>({warning:t,danger:r,finished:i});function T3(t,r){if(t&1&&(we(0,"div",12),Ct(1,"img",13),we(2,"div",14),De(3),Me()()),t&2){let i=er();Ze(3),Yt("Loading Round ",i.currentRound,"")}}var Ay=class t{constructor(r,i,c){this.randomsv=r;this.router=i;this.route=c}locationSelected=new Rn;isLoading=!0;mycurrentlocation;clickedLocation;distance=null;NoAnswer=!0;timer=124;intervalId;totalScore=0;currentRound=1;roundscore=0;totalRounds=5;timePassed=0;ngOnInit(){this.startNewRound(),this.route.queryParams.subscribe(r=>{r.round&&(this.currentRound=+r.round),r.totalScore&&(this.totalScore=+r.totalScore),r.timePassed&&(this.timePassed=+r.timePassed)}),this.loadStreetView()}ngAfterViewInit(){this.initializeVIEW()}ngOnDestroy(){this.stopTimer()}startTimer(){this.stopTimer(),this.intervalId=setInterval(()=>{this.timer>0?(this.timer--,this.timePassed++):this.timeUp()},1e3)}loadStreetView(){setTimeout(()=>{this.isLoading=!1},4e3)}stopTimer(){this.intervalId&&clearInterval(this.intervalId)}resetTimer(){this.timer=124,this.startTimer()}timeUp(){this.stopTimer(),this.finishRound()}get minutes(){return Math.floor(this.timer/60)}get seconds(){return this.timer%60}startNewRound(){this.resetTimer()}finishRound(){if(this.stopTimer(),this.NoAnswer)this.router.navigate(["results"],{queryParams:{NoAnswer:this.NoAnswer,streetViewLat:this.mycurrentlocation.latitude,streetViewLng:this.mycurrentlocation.longitude,timeLeft:this.timer,roundScore:0,currentRound:this.currentRound,totalScore:this.totalScore,timePassed:this.timePassed}});else{let i=this.mycurrentlocation.latitude*Math.PI/180,c=this.clickedLocation.latitude*Math.PI/180,u=(this.clickedLocation.latitude-this.mycurrentlocation.latitude)*Math.PI/180,s=(this.clickedLocation.longitude-this.mycurrentlocation.longitude)*Math.PI/180,x=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i)*Math.cos(c)*Math.sin(s/2)*Math.sin(s/2),M=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));this.distance=6371*M;let S=0,B=0,W=2e3,$=1,he=1e3;S=Math.round(he*Math.exp(-this.distance/W)),this.distance>5e3&&(S=0);let ge=500,qe=Math.exp(-this.timePassed/(120/2));B=Math.round(S*(ge/he)*qe);let Ye=S+B;this.totalScore+=Ye,this.router.navigate(["results"],{queryParams:{NoAnswer:this.NoAnswer,streetViewLat:this.mycurrentlocation.latitude,streetViewLng:this.mycurrentlocation.longitude,clickedLat:this.clickedLocation.latitude,clickedLng:this.clickedLocation.longitude,Distance:this.distance,timeLeft:this.timer,roundScore:Ye,currentRound:this.currentRound,totalScore:this.totalScore,timePassed:this.timePassed,distance:Math.round(this.distance*100)/100}})}}onLocationClicked(r){this.clickedLocation=r.location,this.NoAnswer=r.noAnswer}initializeVIEW(){return on(this,null,function*(){this.mycurrentlocation=yield this.randomsv.getRandomLocation(),document.getElementById("holder").innerHTML=this.mycurrentlocation.iframe})}static \u0275fac=function(i){return new(i||t)(xt(Py),xt(Bn),xt(tr))};static \u0275cmp=Gt({type:t,selectors:[["app-streetviewmode"]],outputs:{locationSelected:"locationSelected"},decls:15,vars:10,consts:[[1,"allholder"],["class","loading-screen",4,"ngIf"],[1,"uiholder"],[1,"top-bar"],[1,"score"],[1,"timer"],[3,"ngClass"],[1,"bottom-bar"],[1,"submitbtn",3,"click"],["id","holder"],[1,"mapholder"],[3,"locationClicked"],[1,"loading-screen"],["src","/logo-removebg.png","alt","Loading...",1,"floating-logo"],[1,"loading-text"]],template:function(i,c){i&1&&(we(0,"div",0),Zn(1,T3,4,1,"div",1),we(2,"div",2)(3,"div",3)(4,"div",4),De(5),Me(),we(6,"div",5)(7,"span",6),De(8),Me()()(),we(9,"div",7)(10,"button",8),qt("click",function(){return c.finishRound()}),De(11,"Submit Guess"),Me()()(),Ct(12,"div",9),we(13,"div",10)(14,"app-sv-maplibre",11),qt("locationClicked",function(s){return c.onLocationClicked(s)}),Me()()()),i&2&&(Ze(),Mt("ngIf",c.isLoading),Ze(4),Yt("Round: ",c.currentRound,"/5"),Ze(2),Mt("ngClass",Uu(6,I3,c.timer<=60,c.timer<=30,c.timer==0)),Ze(),Jl(" \u23F3 Time Left: ",c.minutes,":",c.seconds<10?"0":"","",c.seconds," "))},dependencies:[ur,qu,Rr,od],styles:[".allholder[_ngcontent-%COMP%]{margin:0;overflow:hidden}#holder[_ngcontent-%COMP%]{width:100%;height:100vh}.mapholder[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:1000;height:250px;width:250px}.uiholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:center;position:absolute;z-index:1000;height:100vh;width:100%;pointer-events:none}.top-bar[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-evenly;align-items:start;padding:20px}.timer[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700;padding:15px;border-radius:30px;background-color:#000000b3;box-shadow:0 4px 8px #ff4f4f99;width:60%;text-align:center;margin-bottom:20px;position:relative;z-index:1}.submitbtn[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;padding:10px 20px;border:none;cursor:pointer;border-radius:10px;align-self:flex-end}.submitbtn[_ngcontent-%COMP%]:hover{background-color:#000;box-shadow:0 4px 8px #ff4f4f99}.score[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700}@media (max-width: 1400px){.flag-container[_ngcontent-%COMP%]{top:0}.score[_ngcontent-%COMP%], .timer[_ngcontent-%COMP%]{font-size:1em}}.timer[_ngcontent-%COMP%], .score[_ngcontent-%COMP%], .submitbtn[_ngcontent-%COMP%]{pointer-events:auto;background:#0009;color:#fff;padding:10px 20px;border-radius:10px;text-align:center;width:20vh;z-index:1}.loading-screen[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1001;transition:opacity 5s ease-in-out,transform 5s ease-in-out}.floating-logo[_ngcontent-%COMP%]{width:150px;height:auto;animation:_ngcontent-%COMP%_float 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}to{transform:translateY(0)}}.loading-fade-out[_ngcontent-%COMP%]{opacity:0;transform:scale(1.2);pointer-events:none}"]})};var Ry=class t{dataUrl="data/landmarks.json";shuffledLocations=[];currentIndex=0;constructor(){}getRandomLocation(){return on(this,null,function*(){return(this.shuffledLocations.length===0||this.currentIndex>=this.shuffledLocations.length)&&(yield this.shuffleLocations(),this.currentIndex=0),this.shuffledLocations[this.currentIndex++]})}shuffleLocations(){return on(this,null,function*(){let i=yield(yield fetch(this.dataUrl)).json();this.shuffledLocations=this.fisherYatesShuffle(i.locations)})}fisherYatesShuffle(r){for(let i=r.length-1;i>0;i--){let c=Math.floor(Math.random()*(i+1));[r[i],r[c]]=[r[c],r[i]]}return r}static \u0275fac=function(i){return new(i||t)};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})};var D3=(t,r,i)=>({warning:t,danger:r,finished:i});function S3(t,r){if(t&1&&(we(0,"div",12),Ct(1,"img",13),we(2,"div",14),De(3),Me()()),t&2){let i=er();Ze(3),Yt("Loading Round ",i.currentRound,"")}}var ky=class t{constructor(r,i,c){this.randomsv=r;this.router=i;this.route=c}locationSelected=new Rn;isLoading=!0;mycurrentlocation;clickedLocation;distance=null;NoAnswer=!0;timer=124;intervalId;totalScore=0;currentRound=1;roundscore=0;totalRounds=5;timePassed=0;ngOnInit(){this.startNewRound(),this.route.queryParams.subscribe(r=>{r.round&&(this.currentRound=+r.round),r.totalScore&&(this.totalScore=+r.totalScore),r.timePassed&&(this.timePassed=+r.timePassed)}),this.loadStreetView()}ngAfterViewInit(){this.initializeVIEW()}ngOnDestroy(){this.stopTimer()}startTimer(){this.stopTimer(),this.intervalId=setInterval(()=>{this.timer>0?(this.timer--,this.timePassed++):this.timeUp()},1e3)}loadStreetView(){setTimeout(()=>{this.isLoading=!1},4e3)}stopTimer(){this.intervalId&&clearInterval(this.intervalId)}resetTimer(){this.timer=124,this.startTimer()}timeUp(){this.stopTimer(),this.finishRound()}get minutes(){return Math.floor(this.timer/60)}get seconds(){return this.timer%60}startNewRound(){this.resetTimer()}finishRound(){if(this.stopTimer(),this.NoAnswer)this.router.navigate(["resultslandmarks"],{queryParams:{NoAnswer:this.NoAnswer,streetViewLat:this.mycurrentlocation.latitude,streetViewLng:this.mycurrentlocation.longitude,timeLeft:this.timer,roundScore:0,currentRound:this.currentRound,totalScore:this.totalScore,timePassed:this.timePassed}});else{let i=this.mycurrentlocation.latitude*Math.PI/180,c=this.clickedLocation.latitude*Math.PI/180,u=(this.clickedLocation.latitude-this.mycurrentlocation.latitude)*Math.PI/180,s=(this.clickedLocation.longitude-this.mycurrentlocation.longitude)*Math.PI/180,x=Math.sin(u/2)*Math.sin(u/2)+Math.cos(i)*Math.cos(c)*Math.sin(s/2)*Math.sin(s/2),M=2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x));this.distance=6371*M;let S=0,B=0,W=2e3,$=1,he=1e3;S=Math.round(he*Math.exp(-this.distance/W)),this.distance>5e3&&(S=0);let ge=500,qe=Math.exp(-this.timePassed/(120/2));B=Math.round(S*(ge/he)*qe);let Ye=S+B;this.totalScore+=Ye,this.router.navigate(["resultslandmarks"],{queryParams:{NoAnswer:this.NoAnswer,streetViewLat:this.mycurrentlocation.latitude,streetViewLng:this.mycurrentlocation.longitude,clickedLat:this.clickedLocation.latitude,clickedLng:this.clickedLocation.longitude,Distance:this.distance,timeLeft:this.timer,roundScore:Ye,currentRound:this.currentRound,totalScore:this.totalScore,timePassed:this.timePassed,distance:Math.round(this.distance*100)/100}})}}onLocationClicked(r){this.clickedLocation=r.location,this.NoAnswer=r.noAnswer}initializeVIEW(){return on(this,null,function*(){this.mycurrentlocation=yield this.randomsv.getRandomLocation(),document.getElementById("holder").innerHTML=this.mycurrentlocation.iframe})}static \u0275fac=function(i){return new(i||t)(xt(Ry),xt(Bn),xt(tr))};static \u0275cmp=Gt({type:t,selectors:[["app-landmarksmode"]],outputs:{locationSelected:"locationSelected"},decls:15,vars:10,consts:[[1,"allholder"],["class","loading-screen",4,"ngIf"],[1,"uiholder"],[1,"top-bar"],[1,"score"],[1,"timer"],[3,"ngClass"],[1,"bottom-bar"],[1,"submitbtn",3,"click"],["id","holder"],[1,"mapholder"],[3,"locationClicked"],[1,"loading-screen"],["src","/logo-removebg.png","alt","Loading...",1,"floating-logo"],[1,"loading-text"]],template:function(i,c){i&1&&(we(0,"div",0),Zn(1,S3,4,1,"div",1),we(2,"div",2)(3,"div",3)(4,"div",4),De(5),Me(),we(6,"div",5)(7,"span",6),De(8),Me()()(),we(9,"div",7)(10,"button",8),qt("click",function(){return c.finishRound()}),De(11,"Submit Guess"),Me()()(),Ct(12,"div",9),we(13,"div",10)(14,"app-sv-maplibre",11),qt("locationClicked",function(s){return c.onLocationClicked(s)}),Me()()()),i&2&&(Ze(),Mt("ngIf",c.isLoading),Ze(4),Yt("Round: ",c.currentRound,"/5"),Ze(2),Mt("ngClass",Uu(6,D3,c.timer<=60,c.timer<=30,c.timer==0)),Ze(),Jl(" \u23F3 Time Left: ",c.minutes,":",c.seconds<10?"0":"","",c.seconds," "))},dependencies:[ur,qu,Rr,od],styles:[".allholder[_ngcontent-%COMP%]{margin:0;overflow:hidden}#holder[_ngcontent-%COMP%]{width:100%;height:100vh}.mapholder[_ngcontent-%COMP%]{position:absolute;bottom:0;left:0;z-index:1000;height:250px;width:250px}.uiholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:space-between;align-items:center;position:absolute;z-index:1000;height:100vh;width:100%;pointer-events:none}.top-bar[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-evenly;align-items:start;padding:20px}.timer[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700;padding:15px;border-radius:30px;background-color:#000000b3;box-shadow:0 4px 8px #ff4f4f99;width:60%;text-align:center;margin-bottom:20px;position:relative;z-index:1}.submitbtn[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;padding:10px 20px;border:none;cursor:pointer;border-radius:10px;align-self:flex-end}.submitbtn[_ngcontent-%COMP%]:hover{background-color:#000;box-shadow:0 4px 8px #ff4f4f99}.score[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700}@media (max-width: 1400px){.flag-container[_ngcontent-%COMP%]{top:0}.score[_ngcontent-%COMP%], .timer[_ngcontent-%COMP%]{font-size:1em}}.timer[_ngcontent-%COMP%], .score[_ngcontent-%COMP%], .submitbtn[_ngcontent-%COMP%]{pointer-events:auto;background:#0009;color:#fff;padding:10px 20px;border-radius:10px;text-align:center;width:20vh;z-index:1}.loading-screen[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1001;transition:opacity 5s ease-in-out,transform 5s ease-in-out}.floating-logo[_ngcontent-%COMP%]{width:150px;height:auto;animation:_ngcontent-%COMP%_float 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}to{transform:translateY(0)}}.loading-fade-out[_ngcontent-%COMP%]{opacity:0;transform:scale(1.2);pointer-events:none}"]})};var $a=Sh(id());var P3=["mapContainer"],ad=class t{name=new Rn;correctCountry="";falseCountry="";hover=!0;mapContainer;map;hoveredFeatureId;clickedFeatureId;selectedCountry="";countryname="";longitudeCorrect=0;latitudeCorrect=0;longitudeGuessed=0;latitudeGuessed=0;countryCoords=[];constructor(){}ngOnInit(){this.fetchCountryCorrect(),this.fetchCountryDetails()}ngAfterViewInit(){this.initializeMap(),this.correctCountry&&this.falseCountry?(this.countryCoords=[[this.longitudeCorrect,this.latitudeCorrect],[this.longitudeGuessed,this.latitudeGuessed]],this.fitMapToBounds(this.map,this.countryCoords),console.log("1:")):this.correctCountry&&(this.fitMapToBounds(this.map,[[this.longitudeCorrect,this.latitudeCorrect],[this.longitudeCorrect,this.latitudeCorrect]]),console.log("2:"+this.countryCoords)),console.log("3:"+this.countryCoords+" "+this.correctCountry+" "+this.falseCountry)}initializeMap(){return on(this,null,function*(){this.map=new $a.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ux7U0JoDzUbunhk0mxHh",center:[2,45],zoom:3}),this.map.addControl(new $a.NavigationControl),this.map.on("load",()=>{this.loadGeoJson()})})}loadGeoJson(){fetch("data/borders.json").then(i=>i.json()).then(i=>{i.features.forEach((u,s)=>{u.id=s}),this.map.addSource("countries",{type:"geojson",data:i});let c;this.hover?c=["case",["==",["get","NAME"],this.correctCountry],"#00ff00",["==",["get","NAME"],this.falseCountry],"#ff0000",["boolean",["feature-state","hover"],!1],"#ffff00",["boolean",["feature-state","click"],!1],"#ffff00","rgba(0,0,0,0)"]:c=["case",["==",["get","NAME"],this.correctCountry],"#00ff00",["==",["get","NAME"],this.falseCountry],"#ff0000","rgba(0,0,0,0)"],this.map.addLayer({id:"countries-layer",type:"fill",source:"countries",layout:{},paint:{"fill-color":c,"fill-opacity":.5}}),this.map.on("mousemove","countries-layer",u=>this.highlightFeature(u)),this.map.on("mouseleave","countries-layer",u=>this.resetHighlight(u)),this.map.on("click","countries-layer",u=>this.clickFeature(u))}).catch(i=>{console.error("Error loading GeoJSON:",i),alert("Error loading the map data.")})}highlightFeature(r){let i=this.map.queryRenderedFeatures(r.point,{layers:["countries-layer"]});if(i.length>0){let c=i[0].id;this.hoveredFeatureId!==void 0&&this.hoveredFeatureId!==c&&this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!1}),this.hoveredFeatureId=c,this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!0}),this.countryname=i[0].properties.NAME}}resetHighlight(r){this.hoveredFeatureId!==void 0&&(this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!1}),this.hoveredFeatureId=void 0)}clickFeature(r){let i=this.map.queryRenderedFeatures(r.point,{layers:["countries-layer"]});if(i.length>0){let c=i[0].id;this.clickedFeatureId!==void 0&&this.clickedFeatureId!==c&&this.map.setFeatureState({source:"countries",id:this.clickedFeatureId},{click:!1}),this.clickedFeatureId=c,this.map.setFeatureState({source:"countries",id:this.clickedFeatureId},{click:!0}),this.selectedCountry=i[0].properties.NAME,this.name.emit(this.selectedCountry)}}fetchCountryDetails(){return on(this,null,function*(){if(this.falseCountry){let r=`https://restcountries.com/v3.1/name/${encodeURIComponent(this.falseCountry)}?fullText=true`;try{let i=yield fetch(r);if(!i.ok)throw new Error(`Error fetching details for ${this.falseCountry}`);let u=(yield i.json())[0];u.latlng&&u.latlng.length>=2?(this.latitudeGuessed=u.latlng[0],this.longitudeGuessed=u.latlng[1],console.log(`Guessed country (${this.falseCountry}) coordinates: [${this.longitudeGuessed}, ${this.latitudeGuessed}]`)):console.error("LatLng data missing for guessed country."),this.updateMapBounds()}catch(i){console.error("Error fetching guessed country details:",i)}}})}fetchCountryCorrect(){return on(this,null,function*(){if(this.correctCountry){let r=`https://restcountries.com/v3.1/name/${encodeURIComponent(this.correctCountry)}?fullText=true`;try{let i=yield fetch(r);if(!i.ok)throw new Error(`Error fetching details for ${this.correctCountry}`);let u=(yield i.json())[0];u.latlng&&u.latlng.length>=2?(this.latitudeCorrect=u.latlng[0],this.longitudeCorrect=u.latlng[1],console.log(`Correct country (${this.correctCountry}) coordinates: [${this.longitudeCorrect}, ${this.latitudeCorrect}]`)):console.error("LatLng data missing for correct country."),this.updateMapBounds()}catch(i){console.error("Error fetching correct country details:",i)}}})}fitMapToBounds(r,i){if(!r||i.length<2){console.error("Map not initialized or not enough coordinates provided.");return}let c=new $a.LngLatBounds;i.forEach(x=>{c.extend(new $a.LngLat(x[0],x[1]))});let u=r.getContainer().getBoundingClientRect(),s=Math.min(u.width,u.height)*.2;r.fitBounds(c,{padding:{top:s*.5,bottom:s*2.3,left:s,right:s},duration:2e3,maxZoom:2,minZoom:2,linear:!1,essential:!0})}updateMapBounds(){this.longitudeGuessed&&this.latitudeGuessed&&this.longitudeCorrect&&this.latitudeCorrect&&(this.countryCoords=[[this.longitudeGuessed,this.latitudeGuessed],[this.longitudeCorrect,this.latitudeCorrect]],this.fitMapToBounds(this.map,this.countryCoords))}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-flagsm"]],viewQuery:function(i,c){if(i&1&&Pi(P3,5),i&2){let u;di(u=hi())&&(c.mapContainer=u.first)}},inputs:{correctCountry:"correctCountry",falseCountry:"falseCountry",hover:"hover"},outputs:{name:"name"},decls:2,vars:0,consts:[["mapContainer",""],["id","map"]],template:function(i,c){i&1&&Ct(0,"div",1,0)},dependencies:[ur],styles:["#map[_ngcontent-%COMP%]{width:100%;height:100%}"]})};var Oy=class t{constructor(r){this.http=r}flagsUrl="data/flags.json";getFlags(){return this.http.get(this.flagsUrl)}static \u0275fac=function(i){return new(i||t)(ht(Zb))};static \u0275prov=nt({token:t,factory:t.\u0275fac,providedIn:"root"})};var R3=(t,r,i)=>({warning:t,danger:r,finished:i});function k3(t,r){if(t&1&&(we(0,"div",12),Ct(1,"img",13),we(2,"div",14),De(3),Me()()),t&2){let i=er();Ze(3),Yt("Loading Round ",i.currentRound,"")}}function O3(t,r){if(t&1&&(we(0,"div",15),Ct(1,"img",16),Me()),t&2){let i=er();Ze(),Mt("src",i.currentFlag.source,Yl)("alt",i.currentFlag.name)}}var Ny=class t{constructor(r,i,c){this.flagService=r;this.router=i;this.route=c}currentFlag=null;flags=[];guessedCountryName="";selectedCoordinates=null;setSelectedCoordinates(r){this.selectedCoordinates=r}setGuessedCountryName(r){this.guessedCountryName=r}timer=124;intervalId;isLoading=!0;totalScore=0;currentRound=1;roundscore=0;totalRounds=10;timePassed=0;platformId=Le(Di);ngOnInit(){this.flagService.getFlags().subscribe(r=>{this.flags=r.flags,this.startNewRound(),this.loadMap()}),this.route.queryParams.subscribe(r=>{r.round&&(this.currentRound=r.round),r.totalScore&&(this.totalScore=r.totalScore),r.timePassed&&(this.timePassed=r.timePassed)})}loadMap(){setTimeout(()=>{this.isLoading=!1},4e3)}ngOnDestroy(){this.stopTimer()}startTimer(){this.stopTimer(),this.intervalId=setInterval(()=>{this.timer>0?(this.timer--,this.timePassed++):this.timeUp()},1e3)}stopTimer(){this.intervalId&&clearInterval(this.intervalId)}resetTimer(){this.timer=120,this.startTimer()}timeUp(){this.stopTimer(),alert("Time is up! Moving to next round."),this.finishRound()}get minutes(){return Math.floor(this.timer/60)}get seconds(){return this.timer%60}startNewRound(){this.currentFlag=this.getRandomFlag(),this.guessedCountryName="",this.selectedCoordinates=null,this.resetTimer()}getRandomFlag(){let r=Math.floor(Math.random()*this.flags.length);return this.flags[r]}finishRound(){this.stopTimer();let r=this.guessedCountryName.trim().toLowerCase(),i=this.currentFlag?this.currentFlag.name.trim().toLowerCase():"",c=0;r&&r===i&&(c=100+this.timer);let u={flagName:this.currentFlag?this.currentFlag.name:"",flagImage:this.currentFlag?this.currentFlag.source:"",guessedCountry:this.guessedCountryName,timeLeft:this.timer,roundScore:c,currentRound:this.currentRound,totalScore:this.totalScore,timePassed:this.timePassed};this.router.navigate(["resultsflags"],{queryParams:u})}static \u0275fac=function(i){return new(i||t)(xt(Oy),xt(Bn),xt(tr))};static \u0275cmp=Gt({type:t,selectors:[["app-flagsmode"]],decls:15,vars:11,consts:[[1,"game-container"],["class","loading-screen",4,"ngIf"],[1,"map-container"],[3,"name"],[1,"top-bar"],[1,"score"],["class","flag-container",4,"ngIf"],[1,"timer"],[3,"ngClass"],[1,"overlay"],[1,"bottom-bar"],[1,"submitbtn",3,"click"],[1,"loading-screen"],["src","/logo-removebg.png","alt","Loading...",1,"floating-logo"],[1,"loading-text"],[1,"flag-container"],[1,"flag-image",3,"src","alt"]],template:function(i,c){i&1&&(we(0,"div",0),Zn(1,k3,4,1,"div",1),we(2,"div",2)(3,"app-flagsm",3),qt("name",function(s){return c.setGuessedCountryName(s)}),Me()(),we(4,"div",4)(5,"div",5),De(6),Me(),Zn(7,O3,2,2,"div",6),we(8,"div",7)(9,"span",8),De(10),Me()()(),we(11,"div",9)(12,"div",10)(13,"button",11),qt("click",function(){return c.finishRound()}),De(14,"Submit Guess"),Me()()()()),i&2&&(Ze(),Mt("ngIf",c.isLoading),Ze(5),Yt("Score: ",c.totalScore,""),Ze(),Mt("ngIf",c.currentFlag),Ze(2),Mt("ngClass",Uu(7,R3,c.timer<=60,c.timer<=30,c.timer==0)),Ze(),Jl(" \u23F3 Time Left: ",c.minutes,":",c.seconds<10?"0":"","",c.seconds," "))},dependencies:[ur,qu,Rr,ad],styles:[".game-container[_ngcontent-%COMP%]{position:relative;width:100vw;height:100vh;overflow:hidden;display:flex;justify-content:center;align-items:center;flex-direction:column}.top-bar[_ngcontent-%COMP%]{width:100%;flex-flow:row;padding:20px;z-index:1;justify-content:space-between;pointer-events:none}.bottom-bar[_ngcontent-%COMP%]{width:100%;display:flex;z-index:1;justify-content:space-evenly;align-items:center;align-self:flex-end;justify-self:flex-end}.map-container[_ngcontent-%COMP%]{position:fixed;width:100%;height:100vh;z-index:0;pointer-events:auto}.map-container[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{pointer-events:auto!important}.overlay[_ngcontent-%COMP%]{display:flex;top:20px;left:0;width:100%;height:100%;padding:20px;z-index:1;pointer-events:none}.top-bar[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:space-evenly;align-items:start;padding:20px;z-index:1}.timer[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700;padding:15px;border-radius:30px;background-color:#000000b3;box-shadow:0 4px 8px #ff4f4f99;width:60%;text-align:center;margin-bottom:20px;position:relative;z-index:1}.submitbtn[_ngcontent-%COMP%]{color:#fff;font-size:1.2em;padding:10px 20px;border:none;cursor:pointer;border-radius:10px;align-self:flex-end}.submitbtn[_ngcontent-%COMP%]:hover{background-color:#000000b3;box-shadow:0 4px 8px #ff4f4f99}.score[_ngcontent-%COMP%]{font-size:1.2em;font-weight:700}.flag-container[_ngcontent-%COMP%]{display:flex;justify-content:center}.flag-image[_ngcontent-%COMP%]{width:5vw;height:auto;border:2px solid white;border-radius:5px}@media (max-width: 1400px){.flag-container[_ngcontent-%COMP%]{top:0}.score[_ngcontent-%COMP%], .timer[_ngcontent-%COMP%]{font-size:1em}}.timer[_ngcontent-%COMP%], .score[_ngcontent-%COMP%], .flag-container[_ngcontent-%COMP%], .submitbtn[_ngcontent-%COMP%]{pointer-events:auto;background:#0009;color:#fff;padding:10px 20px;border-radius:10px;text-align:center;width:20vh;z-index:1}.loading-screen[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1001;transition:opacity 5s ease-in-out,transform 5s ease-in-out}.floating-logo[_ngcontent-%COMP%]{width:150px;height:auto;animation:_ngcontent-%COMP%_float 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}to{transform:translateY(0)}}.loading-fade-out[_ngcontent-%COMP%]{opacity:0;transform:scale(1.2);pointer-events:none}"]})};var Ha=Sh(id());var N3=["mapContainer"];function L3(t,r){if(t&1&&(we(0,"div",21),Ct(1,"img",22),we(2,"div",23),De(3),Me()()),t&2){let i=er();Ze(3),Yt("Loading Results for Round ",i.round,"")}}function F3(t,r){t&1&&(we(0,"h3",24),De(1,"You guessed Right\u2714\uFE0F\u200B"),Me())}function z3(t,r){t&1&&(we(0,"h3",25),De(1,"You guessed Wrong\u274C\u200B"),Me())}function B3(t,r){if(t&1){let i=Si();we(0,"button",26),qt("click",function(){ci(i);let u=er();return ui(u.goToNextRound())}),De(1," START NEXT ROUND "),Me()}}function j3(t,r){if(t&1){let i=Si();we(0,"button",26),qt("click",function(){ci(i);let u=er();return ui(u.saveScore())}),De(1," SAVE SCORE "),Me()}}function V3(t,r){t&1&&(we(0,"a",27),De(1," Leaderboard "),Me())}var Ly=class t{constructor(r,i,c){this.route=r;this.router=i;this.leaderboardService=c}mapContainer;map;flagName="";flagImage="";guessedCountry="";timeLeft=0;roundScore=0;totalScore=0;round=1;isFinal=!1;timePassed=0;istrue=!1;hover=!1;isLoading=!0;capital="N/A";population=0;latitudeCorrect=0;longitudeCorrect=0;latitudeGuessed=0;longitudeGuessed=0;loading=!0;error="";hoveredFeatureId;clickedFeatureId;selectedCountry="";countryname="";countryCoords=[];ngOnInit(){return on(this,null,function*(){this.route.queryParams.subscribe(r=>on(this,null,function*(){if(this.flagName=r.flagName||"",this.flagImage=r.flagImage||"",this.guessedCountry=r.guessedCountry||"",this.timeLeft=+r.timeLeft||0,this.roundScore=+r.roundScore||0,this.totalScore=+r.totalScore||0,this.round=+r.currentRound||1,this.timePassed=+r.timePassed||0,!this.flagName){this.loading=!1,this.error="No country name provided";return}yield this.fetchCountryDetails(this.flagName),this.guessedCountry&&(yield this.fetchGuessedCountryDetails()),setTimeout(()=>{this.updateMapBounds()},1300),this.totalScore+=this.roundScore,this.guessedCountry===this.flagName&&(this.istrue=!0),this.round===10&&(this.isFinal=!0)}))})}ngAfterViewInit(){this.initializeMap(),setTimeout(()=>{this.isLoading=!1},1800)}fetchCountryDetails(r){return on(this,null,function*(){let i=`https://restcountries.com/v3.1/name/${encodeURIComponent(r)}?fullText=true`;try{let c=yield fetch(i);if(!c.ok)throw new Error(`Error fetching details for ${r}`);let s=(yield c.json())[0];this.capital=s.capital&&s.capital.length>0?s.capital[0]:"N/A",this.population=s.population||0,s.latlng&&s.latlng.length>=2&&(this.latitudeCorrect=s.latlng[0],this.longitudeCorrect=s.latlng[1]),this.loading=!1}catch(c){console.error("Error fetching country details:",c),this.error="Failed to fetch country details",this.loading=!1}})}fetchGuessedCountryDetails(){return on(this,null,function*(){if(!this.guessedCountry)return;let r=`https://restcountries.com/v3.1/name/${encodeURIComponent(this.guessedCountry)}?fullText=true`;try{let i=yield fetch(r);if(!i.ok)throw new Error(`Error fetching details for ${this.guessedCountry}`);let u=(yield i.json())[0];u.latlng&&u.latlng.length>=2&&(this.latitudeGuessed=u.latlng[0],this.longitudeGuessed=u.latlng[1])}catch(i){console.error("Error fetching guessed country details:",i)}})}initializeMap(){this.map=new Ha.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ux7U0JoDzUbunhk0mxHh",center:[2,45],zoom:3}),this.map.addControl(new Ha.NavigationControl),this.map.on("load",()=>{this.loadGeoJson(),setTimeout(()=>{this.updateMapBounds()},1300)})}loadGeoJson(){fetch("data/borders.json").then(i=>i.json()).then(i=>{i.features.forEach((u,s)=>{u.id=s}),this.map.addSource("countries",{type:"geojson",data:i});let c=["case",["==",["get","NAME"],this.flagName],"#00ff00",["==",["get","NAME"],this.guessedCountry],"#ff0000",this.hover?["case",["boolean",["feature-state","hover"],!1],"#ffff00",["boolean",["feature-state","click"],!1],"#ffff00","rgba(0,0,0,0)"]:"rgba(0,0,0,0)"];this.map.addLayer({id:"countries-layer",type:"fill",source:"countries",layout:{},paint:{"fill-color":c,"fill-opacity":.5}}),this.map.on("mousemove","countries-layer",u=>this.highlightFeature(u)),this.map.on("mouseleave","countries-layer",u=>this.resetHighlight(u)),this.map.on("click","countries-layer",u=>this.clickFeature(u))}).catch(i=>{console.error("Error loading GeoJSON:",i),alert("Error loading the map data.")})}highlightFeature(r){let i=this.map.queryRenderedFeatures(r.point,{layers:["countries-layer"]});if(i.length>0){let c=i[0].id;this.hoveredFeatureId!==void 0&&this.hoveredFeatureId!==c&&this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!1}),this.hoveredFeatureId=c,this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!0}),this.countryname=i[0].properties.NAME}}resetHighlight(r){this.hoveredFeatureId!==void 0&&(this.map.setFeatureState({source:"countries",id:this.hoveredFeatureId},{hover:!1}),this.hoveredFeatureId=void 0)}clickFeature(r){let i=this.map.queryRenderedFeatures(r.point,{layers:["countries-layer"]});if(i.length>0){let c=i[0].id;this.clickedFeatureId!==void 0&&this.clickedFeatureId!==c&&this.map.setFeatureState({source:"countries",id:this.clickedFeatureId},{click:!1}),this.clickedFeatureId=c,this.map.setFeatureState({source:"countries",id:this.clickedFeatureId},{click:!0}),this.selectedCountry=i[0].properties.NAME}}fitMapToBounds(r,i){if(!r||i.length<1){console.error("Map not initialized or insufficient coordinates provided.");return}let c=new Ha.LngLatBounds;i.forEach(u=>c.extend(new Ha.LngLat(u[0],u[1]))),r.fitBounds(c,{padding:{top:50,bottom:50,left:50,right:50},maxZoom:2,linear:!1,duration:1500})}updateMapBounds(){if(!this.map||!this.map.loaded()){this.map&&this.map.once("load",()=>this.updateMapBounds());return}let r=[];this.longitudeCorrect&&this.latitudeCorrect&&r.push([this.longitudeCorrect,this.latitudeCorrect]),this.guessedCountry&&this.longitudeGuessed&&this.latitudeGuessed&&r.push([this.longitudeGuessed,this.latitudeGuessed]),r.length>0&&this.fitMapToBounds(this.map,r)}goToNextRound(){this.round++,this.router.navigate(["/flags"],{queryParams:{totalScore:this.totalScore,round:this.round,timePassed:this.timePassed}})}saveScore(){let r=prompt("Enter your name:");if(!r)return;let i={name:r,score:this.totalScore,time:`${Math.floor(this.timePassed/60)}m ${this.timePassed%60}s`,mode:"Flags Mode"};this.leaderboardService.addEntry(i),this.timePassed=0}goToLeaderboard(){this.router.navigate(["/leaderboard"])}restartGame(){this.router.navigate(["/flags"])}static \u0275fac=function(i){return new(i||t)(xt(tr),xt(Bn),xt(Wo))};static \u0275cmp=Gt({type:t,selectors:[["app-resultsflags"]],viewQuery:function(i,c){if(i&1&&Pi(N3,5),i&2){let u;di(u=hi())&&(c.mapContainer=u.first)}},decls:70,vars:21,consts:[["mapContainer",""],[1,"game-screen"],[1,"round-title"],["class","loading-screen",4,"ngIf"],["id","map"],[1,"results-section"],[1,"score-container"],["class","right",4,"ngIf"],["class","wrong",4,"ngIf"],[1,"points"],[1,"score-bar"],[1,"score-progress"],[1,"tables-container"],[1,"info-table"],[1,"table-title"],[1,"country"],[1,"flag-image",3,"src","alt"],[1,"button-container"],["class","next-round-btn",3,"click",4,"ngIf"],["href","/leaderboard","class","leaderbtn",4,"ngIf"],["href","/home",1,"secondary-button"],[1,"loading-screen"],["src","/logo-removebg.png","alt","Loading...",1,"floating-logo"],[1,"loading-text"],[1,"right"],[1,"wrong"],[1,"next-round-btn",3,"click"],["href","/leaderboard",1,"leaderbtn"]],template:function(i,c){i&1&&(we(0,"div",1)(1,"h2",2),De(2),Me(),Zn(3,L3,4,1,"div",3),Ct(4,"div",4,0),we(6,"div",5)(7,"div",6),Zn(8,F3,2,0,"h3",7)(9,z3,2,0,"h3",8),we(10,"div",9),De(11),Me(),we(12,"div",10),Ct(13,"div",11),Me()(),we(14,"div",12)(15,"div",13)(16,"h3",14),De(17,"Round Results"),Me(),we(18,"table")(19,"tbody")(20,"tr")(21,"td"),De(22,"Your guess"),Me(),we(23,"td"),De(24),Me()(),we(25,"tr")(26,"td"),De(27,"Round"),Me(),we(28,"td"),De(29),Me()(),we(30,"tr")(31,"td"),De(32,"Total Score"),Me(),we(33,"td"),De(34),Me()(),we(35,"tr")(36,"td"),De(37,"Time Left"),Me(),we(38,"td"),De(39),Me()()()()(),we(40,"div",13)(41,"div",15)(42,"h3",14),De(43,"Country Details"),Me()(),Ct(44,"br")(45,"img",16),we(46,"table")(47,"tbody")(48,"tr")(49,"td"),De(50,"Country"),Me(),we(51,"td"),De(52),Me()(),we(53,"tr")(54,"td"),De(55,"Capital"),Me(),we(56,"td"),De(57),Me()(),we(58,"tr")(59,"td"),De(60,"Population"),Me(),we(61,"td"),De(62),hM(63,"number"),Me()()()()()(),we(64,"div",17),Zn(65,B3,2,0,"button",18)(66,j3,2,0,"button",18)(67,V3,2,0,"a",19),we(68,"a",20),De(69," RETURN HOME "),Me()()()()),i&2&&(Ze(2),Yt("Round ",c.round,""),Ze(),Mt("ngIf",c.isLoading),Ze(5),Mt("ngIf",c.istrue),Ze(),Mt("ngIf",!c.istrue),Ze(2),Yt("",c.roundScore," points"),Ze(2),$o("width",c.roundScore/200*100,"%"),Ze(11),Hr(c.guessedCountry),Ze(5),Yt("",c.round,"/10"),Ze(5),Hr(c.totalScore),Ze(5),Yt("",c.timeLeft," seconds"),Ze(6),Mt("src",c.flagImage,Yl)("alt",c.flagName),Ze(7),Hr(c.flagName),Ze(5),Hr(c.capital),Ze(5),Hr(fM(63,19,c.population)),Ze(3),Mt("ngIf",!c.isFinal),Ze(),Mt("ngIf",c.isFinal),Ze(),Mt("ngIf",c.isFinal))},dependencies:[ur,Rr,NM],styles:['.game-screen[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a1b26;padding:20px;display:flex;flex-direction:column;align-items:center;font-family:Passion One,serif;font-size:1.2rem}.round-title[_ngcontent-%COMP%]{color:#fff;font-size:22px;font-weight:700;margin:20px 0;font-family:"Press Start 2P",serif}#map[_ngcontent-%COMP%]{width:127vh;height:46vh;background-color:#2a2b36;border-radius:8px;margin-bottom:30px}.map[_ngcontent-%COMP%]{width:auto;height:auto}.results-section[_ngcontent-%COMP%]{width:100%;max-width:800px;text-align:center;font-size:20px}.score-container[_ngcontent-%COMP%]{margin-bottom:30px}.points[_ngcontent-%COMP%]{color:#fbbf24;font-size:5vh;font-weight:700;margin-bottom:15px;font-family:Passion One,serif}.score-bar[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#374151;border-radius:4px;overflow:hidden;margin-bottom:15px}.score-progress[_ngcontent-%COMP%]{height:100%;background-color:#fbbf24;border-radius:4px;transition:width .5s ease}.tables-container[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:30px;justify-content:center;flex-wrap:wrap}.info-table[_ngcontent-%COMP%]{background-color:#ffffff0d;border-radius:12px;padding:20px;min-width:300px;flex:1;max-width:400px;display:flex;flex-direction:column;box-shadow:0 4px 10px #0003;font-size:1.2rem}.table-title[_ngcontent-%COMP%]{color:#fbbf24;font-size:3vh;margin-bottom:10px;font-weight:700;display:flex;align-items:center;gap:10px}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 8px}tr[_ngcontent-%COMP%]{transition:background-color .2s ease}tr[_ngcontent-%COMP%]:hover{background-color:#ffffff08}td[_ngcontent-%COMP%]{padding:10px 12px;text-align:left;color:#9ca3af;border-bottom:1px solid rgba(255,255,255,.1)}td[_ngcontent-%COMP%]:first-child{color:#fff;font-weight:500}td[_ngcontent-%COMP%]:last-child{text-align:right}.flag-image[_ngcontent-%COMP%]{width:10vh;height:6vh;border-radius:5px;object-fit:cover;display:inline-block;vertical-align:middle}.button-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:10px;margin-top:20px}.next-round-btn[_ngcontent-%COMP%]{background-color:#059669;color:#fff;padding:12px 30px;border-radius:9999px;border:2px solid #059669;font-weight:500;cursor:pointer;transition:background-color .2s ease;min-width:200px}.next-round-btn[_ngcontent-%COMP%]:hover{background:transparent;color:#059669;border:2px solid #059669}.secondary-button[_ngcontent-%COMP%]{background-color:#4b5563;color:#fff;padding:.75rem 2rem;border-radius:9999px;border:2px solid #374151;font-weight:500;cursor:pointer;width:100%;max-width:300px;text-align:center;text-decoration:none;transition:background-color .2s ease}.secondary-button[_ngcontent-%COMP%]:hover{background:transparent;color:#fff;border:2px solid #374151}.leaderbtn[_ngcontent-%COMP%]{background-color:#fbbf24;color:#1a1b26;padding:.75rem 2rem;border-radius:9999px;font-weight:700;cursor:pointer;border:2px solid #fbbf24;width:100%;text-align:center;text-decoration:none;font-size:1.1em;transition:background-color .2s ease}.leaderbtn[_ngcontent-%COMP%]:hover{background:transparent;color:#fbbf24;border:2px solid #fbbf24}@media (max-width: 768px){.tables-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.info-table[_ngcontent-%COMP%]{width:100%}}.right[_ngcontent-%COMP%]{text-align:center;color:#fff;font-weight:900;font-size:1.7em;text-shadow:2px 3px #00ff00}.wrong[_ngcontent-%COMP%]{text-align:center;color:#fff;font-weight:500;font-size:1.7em;text-shadow:2px 3px #ff0000;font-family:Passion One,serif}.loading-screen[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1001;transition:opacity 5s ease-in-out,transform 5s ease-in-out}.floating-logo[_ngcontent-%COMP%]{width:150px;height:auto;animation:_ngcontent-%COMP%_float 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_float{0%{transform:translateY(0)}50%{transform:translateY(-20px)}to{transform:translateY(0)}}.loading-fade-out[_ngcontent-%COMP%]{opacity:0;transform:scale(1.2);pointer-events:none}']})};var Fy=class t{map;L;markers=[];platformId=Le(Di);initialCenter=[5,-5];zoom=5;selectedCoordinates=null;coordinatesSelected=new Rn;ngAfterViewInit(){return on(this,null,function*(){if(LM(this.platformId)){let r=yield import("./chunk-QOE23P4C.js");this.L=r,this.initMap()}})}initMap(){this.map=this.L.map("map",{center:this.initialCenter,zoom:this.zoom}),this.L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://carto.com/">Carto</a>'}).addTo(this.map),this.map.on("click",r=>{let i=r.latlng;this.addMarkerAtClick(i.lat,i.lng);let c={lat:i.lat,lng:i.lng};this.coordinatesSelected.emit(c)})}addMarkerAtClick(r,i){this.markers.length>0&&(this.markers.forEach(u=>this.map.removeLayer(u)),this.markers=[]);let c=this.L.marker([r,i]);c.addTo(this.map),c.bindPopup(`Latitude: ${r.toFixed(4)}<br>Longitude: ${i.toFixed(4)}`).openPopup(),this.markers.push(c)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-cartomap"]],inputs:{initialCenter:"initialCenter",zoom:"zoom",selectedCoordinates:"selectedCoordinates"},outputs:{coordinatesSelected:"coordinatesSelected"},decls:1,vars:0,consts:[["id","map"]],template:function(i,c){i&1&&Ct(0,"div",0)},styles:["#map[_ngcontent-%COMP%]{width:100%;height:100vh;border:2px solid black}"]})};function U3(t,r){if(t&1){let i=Si();we(0,"div",2)(1,"video",3,0),qt("error",function(u){ci(i);let s=er();return ui(s.handleVideoError(u))}),De(3," Your browser does not support the video tag. "),Me(),we(4,"div",4)(5,"div",5),De(6,"Loading Game..."),Me()()()}if(t&2){let i=er();Ze(),Mt("src",i.videoSource,Yl)("loop",!0)("muted",!0)("autoplay",!0)}}var zy=class t{isLoading=!0;videoSource="assets/Loading.mp4";loadingText="Loading...";handleVideoError(r){console.error("Video loading error:",r)}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-video-loader"]],inputs:{isLoading:"isLoading",videoSource:"videoSource",loadingText:"loadingText"},decls:1,vars:1,consts:[["videoPlayer",""],["class","loading-container",4,"ngIf"],[1,"loading-container"],["playsinline","",3,"error","src","loop","muted","autoplay"],[1,"typewriter-wrapper"],[1,"css-typewriter"]],template:function(i,c){i&1&&Zn(0,U3,7,4,"div",1),i&2&&Mt("ngIf",c.isLoading)},dependencies:[ur,Rr],styles:["*[_ngcontent-%COMP%]{margin:0;padding:0;box-sizing:border-box}.loading-container[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:end;background:linear-gradient(20deg,#8b8b5b,#46423a 50%);overflow:hidden}video[_ngcontent-%COMP%]{opacity:1;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:80%;border-radius:1em;scale:1;display:block}.css-typewriter[_ngcontent-%COMP%]{overflow:hidden;white-space:nowrap;border-right:2px solid white;font-size:5vh;font-family:Cinzel,monospace;color:#46423a;width:fit-content;margin:0 auto;animation:_ngcontent-%COMP%_typing 2.5s steps(10,end) infinite,_ngcontent-%COMP%_blinkCursor .7s step-end infinite}@keyframes _ngcontent-%COMP%_typing{0%{width:3ch}to{width:15ch}}@keyframes _ngcontent-%COMP%_blinkCursor{0%,to{border-color:#46423a}50%{border-color:transparent}}.typewriter-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:end;height:100vh}"]})};var ac=Sh(id());var $3=["mapContainer"];function H3(t,r){if(t&1){let i=Si();we(0,"button",17),qt("click",function(){ci(i);let u=er();return ui(u.goToNextRound())}),De(1," START NEXT ROUND "),Me()}}function G3(t,r){if(t&1){let i=Si();we(0,"button",17),qt("click",function(){ci(i);let u=er();return ui(u.saveScore())}),De(1," SAVE SCORE "),Me()}}function q3(t,r){t&1&&(we(0,"a",18),De(1," Leaderboard "),Me())}var By=class t{constructor(r,i,c){this.route=r;this.router=i;this.leaderboardService=c}mapContainer;map;streetViewLocation;NoAnswer=!0;clickedLocation;distance=null;timeLeft=0;roundScore=0;totalScore=0;round=1;isFinal=!1;timePassed=0;myclick=null;markerImagePath="/images/Pennant.jpg";ngOnInit(){this.route.queryParams.subscribe(r=>{this.streetViewLocation={latitude:+r.streetViewLat,longitude:+r.streetViewLng},this.NoAnswer=r.NoAnswer==="true",this.NoAnswer?this.clickedLocation=null:(this.distance=Math.round(+r.Distance),this.clickedLocation={latitude:+r.clickedLat,longitude:+r.clickedLng}),this.timeLeft=+r.timeLeft||0,this.roundScore=+r.roundScore,this.totalScore=+r.totalScore,this.round=+r.currentRound||1,this.timePassed=+r.timePassed||0}),this.round==5&&(this.isFinal=!0)}ngAfterViewInit(){this.initializeMap()}initializeMap(){this.map=new ac.default.Map({container:this.mapContainer.nativeElement,style:"https://api.maptiler.com/maps/streets-v2/style.json?key=ux7U0JoDzUbunhk0mxHh",center:[2,45],zoom:3}),this.map.on("load",()=>{this.NoAnswer?(new ac.default.Marker({color:"blue"}).setLngLat([this.streetViewLocation.longitude,this.streetViewLocation.latitude]).addTo(this.map),this.map.flyTo({center:[this.streetViewLocation.longitude,this.streetViewLocation.latitude],zoom:5,speed:.8,curve:1,essential:!0})):(this.addCustomMarker(this.clickedLocation.longitude,this.clickedLocation.latitude),new ac.default.Marker({color:"blue"}).setLngLat([this.streetViewLocation.longitude,this.streetViewLocation.latitude]).addTo(this.map),this.drawLine())})}splitLineSegment(r,i){if(Math.abs(i[0]-r[0])>180){let s=[(r[0]+i[0]+(r[0]>i[0]?360:-360))/2,(r[1]+i[1])/2],x=[r,s],M=[s,i];return this.splitLineSegment(x[0],x[1]).concat(this.splitLineSegment(M[0],M[1]))}else return[r,i]}splitLine(r){let i=[];for(let c=0;c<r.length-1;c++){let u=this.splitLineSegment(r[c],r[c+1]);u&&u[0]&&u[0][0]&&u[0][1]&&i.push(...u)}return i}drawLine(){let r=[[this.clickedLocation.longitude,this.clickedLocation.latitude],[this.streetViewLocation.longitude,this.streetViewLocation.latitude]],i=this.splitLine(r),c={type:"Feature",geometry:{type:"LineString",coordinates:i}};this.map.addSource("line",{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:i}}}),this.map.addLayer({id:"lineLayer",type:"line",source:"line",paint:{"line-color":"#000000","line-width":1.5,"line-dasharray":[3,3],"line-opacity":.8},layout:{"line-cap":"round","line-join":"round"}});let u=new ac.default.LngLatBounds;i.forEach(s=>{u.extend(new ac.default.LngLat(s[0],s[1]))}),this.map.fitBounds(u,{padding:{top:50,bottom:50,left:50,right:50},duration:1500})}goToNextRound(){this.round++,this.router.navigate(["/landmarks"],{queryParams:{totalScore:this.totalScore,round:this.round,timePassed:this.timePassed}})}saveScore(){let r=prompt("Enter your name:");if(!r)return;let i={name:r,score:this.totalScore,time:`${Math.floor(this.timePassed/60)}m ${this.timePassed%60}s`,mode:"Landmark Mode"};this.leaderboardService.addEntry(i),this.timePassed=0}addCustomMarker(r,i){let c=document.createElement("div");c.className="custom-marker";let u=document.createElement("img");u.src=this.markerImagePath,u.alt="Marker",u.style.width="32px",u.style.height="32px",c.appendChild(u),this.myclick=new ac.default.Marker({element:c,anchor:"center"}).setLngLat([r,i]).addTo(this.map)}static \u0275fac=function(i){return new(i||t)(xt(tr),xt(Bn),xt(Wo))};static \u0275cmp=Gt({type:t,selectors:[["app-resultslandmarks"]],viewQuery:function(i,c){if(i&1&&Pi($3,5),i&2){let u;di(u=hi())&&(c.mapContainer=u.first)}},decls:45,vars:11,consts:[["mapContainer",""],[1,"game-screen"],[1,"round-title"],["id","map"],[1,"results-section"],[1,"score-container"],[1,"distance"],[1,"points"],[1,"score-bar"],[1,"score-progress"],[1,"tables-container"],[1,"info-table"],[1,"table-title"],[1,"button-container"],["class","next-round-btn",3,"click",4,"ngIf"],["href","/leaderboard","class","leaderbtn",4,"ngIf"],["href","/home",1,"secondary-button"],[1,"next-round-btn",3,"click"],["href","/leaderboard",1,"leaderbtn"]],template:function(i,c){i&1&&(we(0,"div",1)(1,"h2",2),De(2),Me(),Ct(3,"div",3,0),we(5,"div",4)(6,"div",5)(7,"div",6)(8,"p")(9,"strong"),De(10,"You Are"),Me(),De(11),we(12,"strong"),De(13,"Far"),Me()()(),we(14,"div",7),De(15),Me(),we(16,"div",8),Ct(17,"div",9),Me()(),we(18,"div",10)(19,"div",11)(20,"h3",12),De(21,"Round Results"),Me(),we(22,"table")(23,"tbody")(24,"tr")(25,"td"),De(26,"Round"),Me(),we(27,"td"),De(28),Me()(),we(29,"tr")(30,"td"),De(31,"Total Score"),Me(),we(32,"td"),De(33),Me()(),we(34,"tr")(35,"td"),De(36,"Time Left"),Me(),we(37,"td"),De(38),Me()()()()()(),we(39,"div",13),Zn(40,H3,2,0,"button",14)(41,G3,2,0,"button",14)(42,q3,2,0,"a",15),we(43,"a",16),De(44," RETURN HOME "),Me()()()()),i&2&&(Ze(2),Yt("Round ",c.round,""),Ze(9),Yt(" ",c.distance,"KM "),Ze(4),Yt("",c.roundScore," points"),Ze(2),$o("width",c.roundScore/1e3*100,"%"),Ze(11),Yt("",c.round,"/10"),Ze(5),Hr(c.totalScore),Ze(5),Yt("",c.timeLeft," seconds"),Ze(2),Mt("ngIf",!c.isFinal),Ze(),Mt("ngIf",c.isFinal),Ze(),Mt("ngIf",c.isFinal))},dependencies:[ur,Rr],styles:[".game-screen[_ngcontent-%COMP%]{min-height:100vh;background-color:#1a1b26;padding:20px;display:flex;flex-direction:column;align-items:center;font-family:Avro,serif}.round-title[_ngcontent-%COMP%]{color:#fff;font-size:28px;font-weight:700;font-style:italic;margin:20px 0}#map[_ngcontent-%COMP%]{width:120vh;height:47vh;background-color:#2a2b36;border-radius:8px;overflow:hidden;margin-bottom:30px}.map[_ngcontent-%COMP%]{width:auto;height:auto}.results-section[_ngcontent-%COMP%]{width:100%;max-width:800px;text-align:center}.score-container[_ngcontent-%COMP%]{margin-bottom:30px}.points[_ngcontent-%COMP%]{color:#fbbf24;font-size:24px;font-weight:700;margin-bottom:15px}.score-bar[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#374151;border-radius:4px;overflow:hidden;margin-bottom:15px}.score-progress[_ngcontent-%COMP%]{height:100%;background-color:#fbbf24;border-radius:4px;transition:width .5s ease}.tables-container[_ngcontent-%COMP%]{display:flex;gap:20px;margin-bottom:30px;justify-content:center;flex-wrap:wrap}.info-table[_ngcontent-%COMP%]{background-color:#ffffff0d;border-radius:12px;padding:20px;min-width:300px;flex:1;max-width:400px;display:flex;flex-direction:column;box-shadow:0 4px 10px #0003}.table-title[_ngcontent-%COMP%]{color:#fbbf24;font-size:18px;margin-bottom:10px;font-weight:700;display:flex;align-items:center;gap:10px}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0 8px}tr[_ngcontent-%COMP%]{transition:background-color .2s ease}tr[_ngcontent-%COMP%]:hover{background-color:#ffffff08}td[_ngcontent-%COMP%]{padding:10px 12px;text-align:left;color:#9ca3af;border-bottom:1px solid rgba(255,255,255,.1)}td[_ngcontent-%COMP%]:first-child{color:#fff;font-weight:500}td[_ngcontent-%COMP%]:last-child{text-align:right}.flag-image[_ngcontent-%COMP%]{width:10vh;height:6vh;border-radius:5px;object-fit:cover;display:inline-block;vertical-align:middle}.button-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;gap:10px;margin-top:20px}.next-round-btn[_ngcontent-%COMP%]{background-color:#059669;color:#fff;padding:12px 30px;border-radius:9999px;border:2px solid #059669;font-weight:500;cursor:pointer;transition:background-color .2s ease;min-width:200px}.next-round-btn[_ngcontent-%COMP%]:hover{background:transparent;color:#059669;border:2px solid #059669}.secondary-button[_ngcontent-%COMP%]{background-color:#4b5563;color:#fff;padding:.75rem 2rem;border-radius:9999px;border:2px solid #374151;font-weight:500;cursor:pointer;max-width:300px;text-align:center;text-decoration:none;transition:background-color .2s ease}.secondary-button[_ngcontent-%COMP%]:hover{background:transparent;color:#fff;border:2px solid #374151}.leaderbtn[_ngcontent-%COMP%]{background-color:#fbbf24;color:#1a1b26;padding:.75rem 2rem;border-radius:9999px;font-weight:700;border:none;cursor:pointer;border:2px solid #fbbf24;width:100%;text-align:center;text-decoration:none;font-size:1.1em;transition:background-color .2s ease}.leaderbtn[_ngcontent-%COMP%]:hover{background:transparent;color:#fbbf24;border:2px solid #fbbf24}@media (max-width: 768px){.tables-container[_ngcontent-%COMP%]{flex-direction:column;align-items:center}.info-table[_ngcontent-%COMP%]{width:100%}}.distance[_ngcontent-%COMP%]{text-align:center;color:#fff;font-weight:900;font-size:1.7em}"]})};var pS=[{path:"",component:Cy},{path:"select-mode",component:Ey},{path:"streetview",component:Ay},{path:"landmarks",component:ky},{path:"flags",component:Ny},{path:"results",component:Ty},{path:"leaderboard",component:My},{path:"about",component:Dy},{path:"how-to-play",component:Sy},{path:"resultsflags",component:Ly},{path:"cartomap",component:Fy},{path:"loading",component:zy},{path:"resultslandmarks",component:By},{path:"flagsm",component:ad},{path:"**",redirectTo:""}];var mS={providers:[tD(nD()),mM({eventCoalescing:!0}),sS(pS),gD(mD())]};var jy=class t{title="GlobeTreck";static \u0275fac=function(i){return new(i||t)};static \u0275cmp=Gt({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(i,c){i&1&&Ct(0,"router-outlet")},dependencies:[Rx],encapsulation:2})};fD(jy,mS).catch(t=>console.error(t));
